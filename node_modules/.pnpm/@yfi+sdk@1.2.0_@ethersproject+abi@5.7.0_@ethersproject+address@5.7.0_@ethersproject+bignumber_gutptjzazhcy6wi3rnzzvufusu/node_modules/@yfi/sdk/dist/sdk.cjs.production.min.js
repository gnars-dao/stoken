"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0}),require("cross-fetch/polyfill");var t=require("@ethersproject/providers"),r=e(require("events")),n=require("@ethersproject/address"),a=require("bignumber.js"),s=e(a),i=require("@ethersproject/contracts"),u=e(require("emittery")),c=require("@ethersproject/bignumber"),o=e(require("cross-fetch")),p=require("@ethersproject/bignumber/lib/bignumber");function d(e,t,r,n,a,s,i){try{var u=e[s](i),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,a)}function f(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var s=e.apply(t,r);function i(e){d(s,n,a,i,u,"next",e)}function u(e){d(s,n,a,i,u,"throw",e)}i(void 0)}))}}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t,r){return t&&h(e.prototype,t),r&&h(e,r),e}function v(){return(v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function m(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,x(e,t)}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function x(e,t){return(x=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function b(e,t,r){return(b=y()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var a=new(Function.bind.apply(e,n));return r&&x(a,r.prototype),a}).apply(null,arguments)}function k(e){var t="function"==typeof Map?new Map:void 0;return(k=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return b(e,arguments,w(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),x(r,e)})(e)}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function A(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return g(e,void 0);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g(e,void 0):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var P=function(e){function t(t,r){var n;return(n=e.call(this,t)||this).error_type=r,n}return m(t,e),t}(k(Error)),S=function(e){function t(t,r){var n;return(n=e.call(this,t,"sdk")||this).error_code=r,n}return m(t,e),t}(P);S.NO_SLIPPAGE="no_slippage";var E=function(e){function t(t,r){var n;return(n=e.call(this,t,"simulation")||this).error_code=r,n}return m(t,e),t}(P);E.NO_LOG="no_log",E.TENDERLY_RESPONSE_ERROR="tenderly_response_error",E.PARTIAL_REVERT="partial_revert";var _=function(e){function t(t,r){var n;return(n=e.call(this,t,"zapper")||this).error_code=r,n}return m(t,e),t}(P);_.ZAP_IN_APPROVAL_STATE="zap_in_approval_state",_.ZAP_IN_APPROVAL="zap_in_approval",_.ZAP_OUT_APPROVAL_STATE="zap_out_approval_state",_.ZAP_OUT_APPROVAL="zap_out_approval",_.ZAP_IN="zap_in",_.ZAP_OUT="zap_out";var T=function(e){function t(t,r){var n;return(n=e.call(this,t,"ethers")||this).error_code=r,n}return m(t,e),t}(P);T.FAIL_TOKEN_FETCH="fail_token_fetch",T.NO_DECIMALS="no_decimals",T.NO_PRICE_PER_SHARE="no_price_per_share",T.POPULATING_TRANSACTION="populating_transaction";var I=function(e){function t(t,r){var n;return(n=e.call(this,t,"tenderly")||this).error_code=r,n}return m(t,e),t}(P);I.SIMULATION_CALL="simulation_call",I.CREATE_FORK="create_fork";var O,N=function(e){function t(t,r){var n;return(n=e.call(this,t,"price_fetching")||this).error_code=r,n}return m(t,e),t}(P);N.FETCHING_PRICE_ORACLE="fetching_price_oracle",N.FETCHING_PRICE_PICKLE="fetching_price_pickle",(O=exports.ZapProtocol||(exports.ZapProtocol={})).PICKLE="pickle",O.YEARN="yearn";var B={zapper:"96e0cc51-a62e-42ca-acee-910ea7d2a241",simulation:{dashboardUrl:"https://dashboard.tenderly.co/yearn/yearn-web"},cache:{useCache:!0,url:"https://cache.yearn.finance"}},R=function(){function e(e){this.ctx=Object.assign({},B,e),this.events=(new r).setMaxListeners(100),this.setProvider(e.provider)}return e.prototype.setProvider=function(r){r instanceof t.JsonRpcProvider?this.ctx.provider={read:r,write:r}:r&&(this.ctx.provider=r),this.events.emit(e.PROVIDER,this.ctx.provider)},l(e,[{key:"provider",get:function(){if(this.ctx.provider)return this.ctx.provider;throw new S("provider must be undefined in Context for this feature to work.")}},{key:"zapper",get:function(){if(this.ctx.zapper)return this.ctx.zapper;throw new S("zapper must be undefined in Context for this feature to work.")}},{key:"etherscan",get:function(){if(this.ctx.etherscan)return this.ctx.etherscan;throw new S("etherscan must be undefined in Context for this feature to work.")}},{key:"addresses",get:function(){return Object.assign({adapters:{}},this.ctx.addresses)}},{key:"simulation",get:function(){if(this.ctx.simulation)return this.ctx.simulation;throw new S("simulation configuration must be defined in Context for this feature to work.")}},{key:"cache",get:function(){if(this.ctx.cache)return this.ctx.cache;throw new S("cache must be defined in Context for this feature to work.")}}]),e}();R.PROVIDER="refresh:provider";var D,C=(function(e){var t=function(e){var t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",s=n.asyncIterator||"@@asyncIterator",i=n.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var a=Object.create((t&&t.prototype instanceof d?t:d).prototype),s=new A(n||[]);return a._invoke=function(e,t,r){var n="suspendedStart";return function(a,s){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===a)throw s;return{value:void 0,done:!0}}for(r.method=a,r.arg=s;;){var i=r.delegate;if(i){var u=b(i,r);if(u){if(u===p)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=o(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,s),a}function o(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var p={};function d(){}function f(){}function h(){}var l={};l[a]=function(){return this};var v=Object.getPrototypeOf,m=v&&v(v(P([])));m&&m!==t&&r.call(m,a)&&(l=m);var w=h.prototype=d.prototype=Object.create(l);function x(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){var n;this._invoke=function(a,s){function i(){return new t((function(n,i){!function n(a,s,i,u){var c=o(e[a],e,s);if("throw"!==c.type){var p=c.arg,d=p.value;return d&&"object"==typeof d&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,i,u)}),(function(e){n("throw",e,i,u)})):t.resolve(d).then((function(e){p.value=e,i(p)}),(function(e){return n("throw",e,i,u)}))}u(c.arg)}(a,s,n,i)}))}return n=n?n.then(i,i):i()}}function b(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var n=o(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,p;var a=n.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function g(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function P(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,s=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return s.next=s}}return{next:S}}function S(){return{value:void 0,done:!0}}return f.prototype=w.constructor=h,h.constructor=f,f.displayName=u(h,i,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,u(e,i,"GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},x(y.prototype),y.prototype[s]=function(){return this},e.AsyncIterator=y,e.async=function(t,r,n,a,s){void 0===s&&(s=Promise);var i=new y(c(t,r,n,a),s);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},x(w),u(w,i,"Generator"),w[a]=function(){return this},w.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=P,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(g),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return i.type="throw",i.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var s=this.tryEntries[a],i=s.completion;if("root"===s.tryLoc)return n("end");if(s.tryLoc<=this.prev){var u=r.call(s,"catchLoc"),c=r.call(s,"finallyLoc");if(u&&c){if(this.prev<s.catchLoc)return n(s.catchLoc,!0);if(this.prev<s.finallyLoc)return n(s.finallyLoc)}else if(u){if(this.prev<s.catchLoc)return n(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return n(s.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var s=a;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var i=s?s.completion:{};return i.type=e,i.arg=t,s?(this.method="next",this.next=s.finallyLoc,p):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),g(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;g(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:P(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}(D={exports:{}}),D.exports),F=function(){function e(e,t,r){this.path=e,this.ctx=t,this.chainId=r}var t=e.prototype;return t.fetch=function(){var e=f(C.mark((function e(t){var r,n,a,s,i,u,c,o,p;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ctx.cache.useCache&&this.ctx.cache.url){e.next=2;break}return e.abrupt("return",void 0);case 2:if(!(n=this.currentValue)){e.next=5;break}return e.abrupt("return",n);case 5:return a=this.ctx.cache.url+"/v1/chains/"+this.chainId+"/"+this.path,t&&(a+="?"+t),e.prev=7,e.next=11,this.fetchWithTimeout(a,5e3);case 11:s=e.sent,e.next=18;break;case 14:return e.prev=14,e.t0=e.catch(7),console.warn("Call to cache at "+a+" timed out"),e.abrupt("return",void 0);case 18:if(200===s.status){e.next=22;break}return i=s,console.warn("Call to cache failed at "+i.url+" (status "+i.status+" "+i.statusText+")"),e.abrupt("return",void 0);case 22:return e.next=24,s.json();case 24:if(u=e.sent){e.next=27;break}return e.abrupt("return",void 0);case 27:return c=null==(r=s.headers.get("cache-control"))?void 0:r.match(/max-age=(\d+)/),o=c?parseInt(c[1],10):30,p=(new Date).getTime(),this.expiryDate=new Date(p+1e3*o),this.cachedValue=u,e.abrupt("return",u);case 33:case"end":return e.stop()}}),e,this,[[7,14]])})));return function(t){return e.apply(this,arguments)}}(),t.fetchWithTimeout=function(){var e=f(C.mark((function e(t,r){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.race([fetch(t),new Promise((function(e,t){return setTimeout((function(){return t("timeout")}),r)}))]));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),l(e,[{key:"currentValue",get:function(){if(this.expiryDate)return new Date<this.expiryDate&&this.cachedValue?this.cachedValue:void 0}}]),e}(),U=function(e,t){this.chainId=e,this.ctx=t,this.events=new u},L=function(e){function t(t,r,n){var a;return(a=e.call(this,r,n)||this).yearn=t,a}return m(t,e),t}(U),z=function(e,t,r){var n=this;this.address=e,this.abi=t,this.read=new i.Contract(e,t,r.provider.read),this.write=new i.Contract(e,t,r.provider.write),r.events.on(R.PROVIDER,(function(e){n.read=new i.Contract(n.address,n.abi,e.read),n.write=new i.Contract(n.address,n.abi,e.write)}))},j=function(e){function t(t,r,n){var a;return(a=e.call(this,r,n)||this).address=t,a.contract=new z(a.address,a.constructor.abi,n),a}return m(t,e),t}(U);j.abi=[];var M=["0x9d409a0a012cfba9b15f6d4b36ac57a46966ab9a","0xc5bddf9843308380375a611c18b50fb9341f502a","0xced67a187b923f0e5ebcc77c7f2f7da20099e378"],V=function(e){return"query AssetHistoricEarnings($id: ID!) {\n    vault(id: $id) {\n      token {\n        id\n        decimals\n      }\n    }\n    "+e.map((function(e){return function(e){return"\n    block_"+e+": vault(id: $id, block: { number: "+e+" } ) {\n      vaultDayData(orderBy: timestamp, orderDirection: desc, first: 1) {\n        timestamp\n      }\n      strategies {\n        latestReport {\n          totalGain\n          totalLoss\n        }\n      }\n    }\n    "}(e)})).join("")+"\n  }\n  "},G=new a.BigNumber(0),Z=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).assetHistoricEarningsCache=new F("vaults/earnings/get",t.ctx,t.chainId),t}m(t,e);var r=t.prototype;return r.protocolEarnings=function(){var e=f(C.mark((function e(){var t,r,n,s,i,u,c;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.yearn.services.subgraph.fetchQuery("query ProtocolEarnings {\n    vaults {\n      token {\n        id\n        decimals\n      }\n      latestUpdate {\n        returnsGenerated\n      }\n    }\n  }\n");case 2:if(n=G,null!=(r=e.sent)&&r.data&&null!=(t=r.data)&&t.vaults){e.next=6;break}return e.abrupt("return",n.toFixed(0));case 6:s=A(r.data.vaults);case 7:if((i=s()).done){e.next=18;break}if((u=i.value).latestUpdate){e.next=11;break}return e.abrupt("continue",16);case 11:return c=new a.BigNumber(u.latestUpdate.returnsGenerated),e.next=14,this.tokensValueInUsdc(c,u.token.id,u.token.decimals);case 14:n=n.plus(e.sent);case 16:e.next=7;break;case 18:return e.abrupt("return",n.toFixed(0));case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.assetEarnings=function(){var e=f(C.mark((function e(t){var r,s,i,u,c,o;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.yearn.services.subgraph.fetchQuery("query VaultEarnings($vault: ID!) {\n    vault(id: $vault) {\n      token {\n        id\n        decimals\n      }\n      latestUpdate {\n        returnsGenerated\n      }\n    }\n  }\n",{vault:t});case 2:if(null!=(i=e.sent)&&i.data&&null!=(r=i.data)&&r.vault){e.next=5;break}throw new S("No asset with address "+t);case 5:return c=new a.BigNumber((null==(s=(u=i.data.vault).latestUpdate)?void 0:s.returnsGenerated)||0),e.next=9,this.tokensValueInUsdc(c,u.token.id,u.token.decimals);case 9:return o=e.sent,e.abrupt("return",{assetAddress:n.getAddress(t),amount:c.toFixed(0),amountUsdc:o.toFixed(0),tokenAddress:n.getAddress(u.token.id)});case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.accountAssetsData=function(){var e=f(C.mark((function e(t){var r,s,i,u,c,o,p,d,h,l,v,m=this;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.yearn.services.subgraph.fetchQuery("\n  query AccountEarnings($id: ID!, $ignoredVaults: [String!]) {\n    account(id: $id) {\n      vaultPositions(where: { vault_not_in: $ignoredVaults } ) {\n        balanceShares\n        token {\n          id\n          decimals\n        }\n        shareToken {\n          symbol\n        }\n        updates {\n          deposits\n          withdrawals\n          tokensReceived\n          tokensSent\n        }\n        vault {\n          id\n          latestUpdate {\n            pricePerShare\n          }\n        }\n      }\n    }\n  }\n",{id:t,ignoredVaults:M});case 2:if(i=null==(s=e.sent)||null==(r=s.data)?void 0:r.account){e.next=6;break}return e.abrupt("return",{earnings:"0",holdings:"0",earningsAssetData:[],grossApy:0,estimatedYearlyYield:"0"});case 6:return e.next=8,Promise.all(i.vaultPositions.map(function(){var e=f(C.mark((function e(t){var r,s,i,u,c,o,p,d,f,h,l;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=new a.BigNumber(t.balanceShares).multipliedBy(new a.BigNumber((null==(r=t.vault.latestUpdate)?void 0:r.pricePerShare)||0)).div(Math.pow(10,t.token.decimals)),i=t.updates.reduce((function(e,t){var r=e.withdrawals,n=e.tokensReceived,s=e.tokensSent;return{deposits:e.deposits.plus(new a.BigNumber(t.deposits)),withdrawals:r.plus(new a.BigNumber(t.withdrawals)),tokensReceived:n.plus(new a.BigNumber(t.tokensReceived)),tokensSent:s.plus(new a.BigNumber(t.tokensSent))}}),{deposits:G,withdrawals:G,tokensReceived:G,tokensSent:G}),u=i.deposits,c=i.tokensReceived,o=i.tokensSent,p=s.plus(i.withdrawals).plus(o),d=u.plus(c),f=p.minus(d),e.next=7,m.tokensValueInUsdc(f,t.token.id,t.token.decimals);case 7:return h=e.sent,e.next=10,m.tokensValueInUsdc(s,t.token.id,t.token.decimals);case 10:return l=e.sent,e.abrupt("return",{assetAddress:n.getAddress(t.vault.id),balanceUsdc:l,earned:h.toFixed(0)});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:return c=(u=e.sent).map((function(e){return e.assetAddress})),e.next=12,this.yearn.services.vision.apy(c);case 12:return o=e.sent,p=u.map((function(e){return new a.BigNumber(e.earned)})).reduce((function(e,t){return e.plus(t)})),d=u.map((function(e){return new a.BigNumber(e.balanceUsdc)})).reduce((function(e,t){return e.plus(t)})),h=d.isEqualTo(G)?G:u.map((function(e){var t,r=(null==(t=o[e.assetAddress])?void 0:t.net_apy)||0;return new a.BigNumber(r).times(e.balanceUsdc).div(d)})).reduce((function(e,t){return e.plus(t)})),l=h.multipliedBy(d),v=u.map((function(e){return{assetAddress:e.assetAddress,earned:e.earned}})),e.abrupt("return",{earnings:a.BigNumber.max(p,0).toFixed(0),holdings:a.BigNumber.max(d,0).toFixed(0),grossApy:h.toNumber(),estimatedYearlyYield:a.BigNumber.max(l,0).toFixed(0),earningsAssetData:v});case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.assetsHistoricEarnings=function(){var e=f(C.mark((function e(t){var r,n,a,s,i,u,c,o=this;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t&&(t=30),30!==t){e.next=7;break}return e.next=4,this.assetHistoricEarningsCache.fetch();case 4:if(!(r=e.sent)){e.next=7;break}return e.abrupt("return",r);case 7:return e.next=9,this.yearn.services.lens.adapters.vaults.v2.assetsStatic();case 9:return n=e.sent.map((function(e){return e.address})),e.next=13,this.ctx.provider.read.getBlockNumber();case 13:return a=e.sent,e.next=16,Promise.allSettled(n.map(function(){var e=f(C.mark((function e(r){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o.assetHistoricEarnings(r,t,a));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 16:for(s=[],i=A(e.sent);!(u=i()).done;)"fulfilled"===(c=u.value).status&&s.push(c.value);return e.abrupt("return",s);case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.assetHistoricEarnings=function(){var e=f(C.mark((function e(t,r,n){var s,i,u,c,o,p,d,f=this;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=4;break}s=n,e.next=7;break;case 4:return e.next=6,this.ctx.provider.read.getBlockNumber();case 6:s=e.sent;case 7:return s-=this.blockOffset(),i=Array.from(Array(r).keys()).reverse().map((function(e){return s-e*f.blocksPerDay()})),e.next=11,this.yearn.services.subgraph.fetchQuery(V(i),{id:t});case 11:return u=e.sent.data,c=i.map((function(e){return"block_"+e})),o=u.vault.token.id,e.next=17,this.yearn.services.oracle.getPriceUsdc(o).then((function(e){return new a.BigNumber(e)}));case 17:return p=e.sent,d=c.map((function(e){var t=u[e].strategies,r=t.map((function(e){return new a.BigNumber(e.latestReport?e.latestReport.totalGain:0)})).reduce((function(e,t){return e.plus(t)})),n=t.map((function(e){return new a.BigNumber(e.latestReport?e.latestReport.totalLoss:0)})).reduce((function(e,t){return e.plus(t)})),s=r.minus(n);return{earnings:{amountUsdc:p.multipliedBy(s).dividedBy(new a.BigNumber(10).pow(new a.BigNumber(u.vault.token.decimals))).toFixed(0),amount:s.toFixed(0)},date:new Date(+u[e].vaultDayData[0].timestamp).toJSON()}})),e.abrupt("return",{assetAddress:t,dayData:d,decimals:u.vault.token.decimals});case 21:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}(),r.accountHistoricEarnings=function(){var e=f(C.mark((function e(t,r,n,s){var i,u,c,o,p,d,h,l,v,m,w,x,y,b,k,g,P,E;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(s&&s>n)){e.next=2;break}throw new S("fromDaysAgo must be greater than toDaysAgo");case 2:return e.next=4,this.yearn.services.subgraph.fetchQuery("query AccountHistoricEarnings($id: ID!, $shareToken: String!, $fromDate: String!, $toDate: BigInt!) {\n  account(id: $id) {\n      vaultPositions(where: { shareToken: $shareToken }) {\n        balanceShares\n        token {\n          id\n          decimals\n        }\n        vault {\n          vaultDayData(where: { timestamp_gte: $fromDate, timestamp_lte: $toDate }, orderBy: timestamp, orderDirection: asc, first: 1000) {\n            pricePerShare\n            timestamp\n          }\n        }\n        updates(orderBy: timestamp, orderDirection: asc, first: 1000) {\n          balanceShares\n          timestamp\n          deposits\n          withdrawals\n          tokensReceived\n          tokensSent\n        }\n      }\n    }\n  }\n",{id:t,shareToken:r,fromDate:this.getDate(n).getTime().toString(),toDate:this.getDate(s||0).getTime().toString()});case 4:if(u=null==(i=e.sent.data.account)?void 0:i.vaultPositions){e.next=8;break}throw new S("No account with address "+t);case 8:for(c=[],o=u.flatMap((function(e){return e.updates})).sort((function(e,t){return+e.timestamp-+t.timestamp})),p=A(o.entries());!(d=p()).done;)v=(h=d.value)[1],0===(l=h[0])?(m={startDate:new Date(0),endDate:new Date(+v.timestamp),deposits:new a.BigNumber(v.deposits),withdrawals:new a.BigNumber(v.withdrawals),tokensReceived:new a.BigNumber(v.tokensReceived),tokensSent:new a.BigNumber(v.tokensSent),balanceShares:new a.BigNumber(v.balanceShares)},c.push(m)):(x={startDate:(w=c[l-1]).endDate,endDate:new Date(+v.timestamp),deposits:w.deposits.plus(new a.BigNumber(v.deposits)),withdrawals:w.withdrawals.plus(new a.BigNumber(v.withdrawals)),tokensReceived:w.tokensReceived.plus(new a.BigNumber(v.tokensReceived)),tokensSent:w.tokensSent.plus(new a.BigNumber(v.tokensSent)),balanceShares:w.balanceShares.plus(new a.BigNumber(v.balanceShares))},c.push(x));return c.length>0&&(y=c[c.length-1],b=(new Date).setFullYear(3e3),k={startDate:y.endDate,endDate:new Date(b),deposits:y.deposits,withdrawals:y.withdrawals,tokensReceived:y.tokensReceived,tokensSent:y.tokensSent,balanceShares:y.balanceShares},c.push(k)),g=u[0].vault.vaultDayData,P=u[0].token,e.next=16,this.yearn.services.oracle.getPriceUsdc(P.id).then((function(e){return new a.BigNumber(e)}));case 16:return E=e.sent,e.next=19,Promise.all(g.map(function(){var e=f(C.mark((function e(t){var r,n,s,i,u,o,p;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=new Date(+t.timestamp),!(n=c.find((function(e){return r>=e.startDate&&r<e.endDate})))){e.next=11;break}return s=n.balanceShares.multipliedBy(new a.BigNumber(t.pricePerShare)).dividedBy(new a.BigNumber(Math.pow(10,P.decimals))),i=s.plus(n.withdrawals).plus(n.tokensSent),u=n.deposits.plus(n.tokensReceived),o=i.minus(u),p=E.multipliedBy(o).dividedBy(new a.BigNumber(10).pow(P.decimals)),e.abrupt("return",{earnings:{amount:o.toFixed(0),amountUsdc:p.toFixed(0)},date:r.toJSON()});case 11:return e.abrupt("return",{earnings:{amount:"0",amountUsdc:"0"},date:r.toJSON()});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 19:return e.abrupt("return",{accountAddress:t,shareTokenAddress:r,decimals:P.decimals,dayData:e.sent});case 21:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),r.tokensValueInUsdc=function(){var e=f(C.mark((function e(t,r,n){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.yearn.services.oracle.getPriceUsdc(r);case 2:return e.abrupt("return",new a.BigNumber(e.sent).multipliedBy(t).div(Math.pow(10,n)));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}(),r.getDate=function(e){var t=new Date;return t.setDate(t.getDate()-e),t},r.blocksPerDay=function(){switch(this.chainId){case 1:case 1337:case 42161:return 5760;case 250:return 86400}},r.blockOffset=function(){switch(this.chainId){case 1:case 1337:case 42161:return 100;case 250:return 1e3}},t}(L),q=function(e){function t(){return e.apply(this,arguments)||this}return m(t,e),t.prototype.protocolFees=function(){var e=f(C.mark((function e(t){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.yearn.services.subgraph.fetchQuery("query ProtocolFees($sinceDate: BigInt!) {\n    transfers(where: { timestamp_gt: $sinceDate }, first: 1000) {\n      tokenAmountUsdc\n    }\n  }\n",{sinceDate:t.getTime().toString()});case 2:return e.abrupt("return",e.sent.data.transfers.reduce((function(e,t){return e.plus(new s(t.tokenAmountUsdc||0))}),new s(0)).toFixed(0));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t}(L),Y=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).cachedFetcherGet=new F("ironbank/get",t.ctx,t.chainId),t.cachedFetcherGetDynamic=new F("ironbank/getDynamic",t.ctx,t.chainId),t.cachedFetcherTokens=new F("ironbank/tokens",t.ctx,t.chainId),t}m(t,e);var r=t.prototype;return r.get=function(){var e=f(C.mark((function e(t,r){var n,a,s,i,u,c,o;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cachedFetcherGet.fetch();case 2:if(!(n=e.sent)){e.next=9;break}if(!t){e.next=8;break}return e.abrupt("return",n.filter((function(e){return t.includes(e.address)})));case 8:return e.abrupt("return",n);case 9:return e.next=11,this.yearn.services.lens.adapters.ironBank.assetsStatic(t,r);case 11:return a=e.sent,e.next=14,this.yearn.services.lens.adapters.ironBank.assetsDynamic(t,r);case 14:for(s=e.sent,i=new Array,u=function(){var e=o.value,t=s.find((function(t){return e.address===t.address}));if(!t)throw new S("Dynamic asset does not exist for "+e.address);i.push(v({},e,t))},c=A(a);!(o=c()).done;)u();return e.abrupt("return",i);case 19:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.getStatic=function(){var e=f(C.mark((function e(t,r){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.yearn.services.lens.adapters.ironBank.assetsStatic(t,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.getDynamic=function(){var e=f(C.mark((function e(t,r){var n;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cachedFetcherGetDynamic.fetch();case 2:if(!(n=e.sent)){e.next=9;break}if(!t){e.next=8;break}return e.abrupt("return",n.filter((function(e){return t.includes(e.address)})));case 8:return e.abrupt("return",n);case 9:return e.next=11,this.yearn.services.lens.adapters.ironBank.assetsDynamic(t,r);case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.positionsOf=function(){var e=f(C.mark((function e(t,r,n){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.yearn.services.lens.adapters.ironBank.positionsOf(t,r,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}(),r.summaryOf=function(){var e=f(C.mark((function e(t,r){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.yearn.services.lens.adapters.ironBank.generalPositionOf(t,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.metadataOf=function(){var e=f(C.mark((function e(t,r,n){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.yearn.services.lens.adapters.ironBank.assetsUserMetadata(t,r,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}(),r.balances=function(){var e=f(C.mark((function e(t,r){var n;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.tokens();case 2:return n=e.sent,e.next=5,this.yearn.services.helper.tokenBalances(t,n.map((function(e){return e.address})),r);case 5:return e.abrupt("return",e.sent.map((function(e){var t=n.find((function(t){return t.address===e.address}));if(!t)throw new S("Token does not exist for Balance("+e.address+")");return v({},e,{token:t})})));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.tokens=function(){var e=f(C.mark((function e(t){var r,n,a,s,i=this;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cachedFetcherTokens.fetch();case 2:if(!(r=e.sent)){e.next=5;break}return e.abrupt("return",r);case 5:return e.next=7,this.yearn.services.lens.adapters.ironBank.tokens(t);case 7:return n=e.sent,e.next=10,this.yearn.services.helper.tokens(n,t);case 10:return a=e.sent,s=this.yearn.services.asset.icon(n),e.abrupt("return",Promise.all(a.map(function(){var e=f(C.mark((function e(r){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=v,e.t1={},e.t2=r,e.t3=s[r.address],e.t4={},e.next=7,i.yearn.services.oracle.getPriceUsdc(r.address,t);case 7:return e.t5=e.sent,e.t6={icon:e.t3,supported:e.t4,priceUsdc:e.t5},e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t6));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())));case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t}(L),H="0x0000000000000000000000000000000000000000",J="0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE",$="0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2";function K(e){return W.apply(this,arguments)}function W(){return(W=f(C.mark((function e(t){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(200===t.status){e.next=3;break}throw new S("HTTP to "+t.url+" request failed (status "+t.status+" "+t.statusText+")");case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(e){return c.BigNumber.from(Math.floor(1e6*Number(e))).toString()}function X(e){return e.toString()}function ee(e,t){if(t<1)throw new Error("Size needs to be positive: "+t);for(var r=[],n=0;n<e.length;n+=t){var a=e.slice(n,n+t);r.push(a)}return r}var te=["0xCeD67a187b923F0E5ebcc77C7f2F7da20099e378"],re=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).pickleJarUSDPrices=new Map,t.lastFetchedDate=new Date(0),t}m(t,e);var r=t.prototype;return r.getPriceUsdc=function(){var e=f(C.mark((function e(t){var r,n;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new Date(Date.now()-36e5),!(this.lastFetchedDate<n)){e.next=4;break}return e.next=4,this.fetchPickleJarPrices();case 4:return e.abrupt("return",Q(null==(r=this.pickleJarUSDPrices.get(t))?void 0:r.toFixed(0))||"0");case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.fetchPickleJarPrices=function(){var e=f(C.mark((function e(){var t,r,s,i,u,c;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://api.pickle.finance/prod/protocol/pools").catch((function(){return fetch("https://f8wgg18t1h.execute-api.us-west-1.amazonaws.com/prod/protocol/pools")})).then((function(e){return e.json()}));case 2:for(t=e.sent,this.pickleJarUSDPrices.clear(),this.lastFetchedDate=new Date,r=t.filter((function(e){return te.includes(n.getAddress(e.jarAddress))})),s=A(r);!(i=s()).done;)c=new a.BigNumber((u=i.value).liquidity_locked/u.tokens),this.pickleJarUSDPrices.set(n.getAddress(u.jarAddress),c);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t}(U),ne="https://simulate.yearn.network",ae=function(){function e(e,t){this.telegram=e,this.ctx=t}var r=e.prototype;return r.simulateRaw=function(){var e=f(C.mark((function e(t,r,n,a,s){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===a&&(a={}),void 0===s&&(s="0"),e.next=4,this.makeSimulationRequest(t,r,n,a,s);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,s){return e.apply(this,arguments)}}(),r.simulateVaultInteraction=function(){var e=f(C.mark((function e(t,r,a,i,u,c){var o,p,d;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===c&&(c="0"),e.next=3,this.makeSimulationRequest(t,r,a,u,c);case 3:if(o=function(e){return n.getAddress(e.slice(-40))},p=e.sent.transaction.transaction_info.logs.reverse().find((function(e){return"0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"===e.raw.topics[0]&&o(e.raw.topics[2])===n.getAddress(t)}))){e.next=9;break}throw new E("No log of transferring token "+i+" to "+t,E.NO_LOG);case 9:return d=new s(p.raw.data).toFixed(0),e.abrupt("return",d);case 11:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,s,i){return e.apply(this,arguments)}}(),r.makeSimulationRequest=function(){var e=f(C.mark((function e(t,r,n,a,s){var i,u,c,o,p,d,f,h,l,v,m,w,x;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===s&&(s="0"),p=null!=a&&a.forkId?ne+"/fork/"+a.forkId+"/simulate":ne+"/simulate",e.next=4,this.getPopulatedTransactionRequest(t,r,n,a,s);case 4:return f={from:t,to:r,input:n,network_id:(null==(i=(d=e.sent).chainId)?void 0:i.toString())||"1",block_number:-1,simulation_type:"quick",root:null==a?void 0:a.root,value:(null==(u=d.value)?void 0:u.toString())||"0",gas:parseInt((null==(c=d.gasLimit)?void 0:c.toString())||"0"),gas_price:(null==(o=d.gasPrice)?void 0:o.toString())||0,save:a.save||!0,nonce:d.nonce},e.next=8,fetch(p,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)}).then((function(e){return e.json()})).catch((function(){throw new I("simulation call to Tenderly failed",I.SIMULATION_CALL)}));case 8:if(!(l=(h=e.sent).transaction.error_message)){e.next=15;break}throw a.save&&this.sendErrorMessage(l,h.simulation.id,a.forkId),new E(l,E.TENDERLY_RESPONSE_ERROR);case 15:if(m=this.getAllSimulationCalls(h.transaction.transaction_info.call_trace),!(w=null==(v=m.find((function(e){return e.error})))?void 0:v.error)){e.next=21;break}throw this.sendErrorMessage(x="Partial Revert - "+w,h.simulation.id,null==a?void 0:a.forkId),new E(x,E.PARTIAL_REVERT);case 21:return e.abrupt("return",h);case 22:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,s){return e.apply(this,arguments)}}(),r.executeSimulationWithReSimulationOnFailure=function(){var e=f(C.mark((function e(t,r){var n=this;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r=null),e.prev=1,e.next=4,t(!1).then((function(e){return r&&n.deleteFork(r),e}));case 4:return e.abrupt("return",e.sent);case 8:e.prev=8,e.t0=e.catch(1);try{t(!0)}catch(e){}throw e.t0;case 12:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,r){return e.apply(this,arguments)}}(),r.getAllSimulationCalls=function(e){var t=[];t=t.concat(e.calls||[]);for(var r,n=A(e.calls||[]);!(r=n()).done;){var a=this.getAllSimulationCalls(r.value);t=t.concat(a)}return t},r.getPopulatedTransactionRequest=function(){var e=f(C.mark((function e(r,n,a,s,i){var u,c,o;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===i&&(i="0"),null!=s&&s.forkId?(c=new t.JsonRpcProvider("https://rpc.tenderly.co/fork/"+s.forkId),u=c.getSigner(r)):u=this.ctx.provider.write.getSigner(r),s.maxFeePerGas&&s.maxPriorityFeePerGas&&delete s.gasPrice,o={from:r,to:n,data:a,value:i,gasLimit:s.gasLimit,gasPrice:s.gasPrice,maxFeePerGas:s.maxFeePerGas,maxPriorityFeePerGas:s.maxPriorityFeePerGas,type:s.gasPrice?0:void 0},e.next=6,u.populateTransaction(o).catch((function(){throw new T("error populating transaction",T.POPULATING_TRANSACTION)}));case 6:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,s){return e.apply(this,arguments)}}(),r.createFork=function(){var e=f(C.mark((function e(){var t;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={alias:"",description:"",network_id:"1"},e.next=3,fetch(ne+"/fork",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(e){return e.json()})).catch((function(){throw new I("failed to create fork",I.CREATE_FORK)}));case 3:return e.abrupt("return",e.sent.simulation_fork.id);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),r.deleteFork=function(){var e=f(C.mark((function e(t){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(ne+"/fork/"+t,{method:"DELETE"});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.sendErrorMessage=function(e,t,r){var n;this.ctx.simulation.dashboardUrl&&(n=this.ctx.simulation.dashboardUrl+"/"+(r?"fork/"+r+"/simulation":"simulator")+"/"+t);var a=["Simulation error",e,n].map((function(e){return e})).join("\n\n");this.telegram.sendMessage(a)},e}(),se=function(){function e(e){var t=this;this.contract=e,this.encodeDeposit=function(e){return t.contract.interface.encodeFunctionData("deposit",[e])},this.encodeWithdraw=function(e){return t.contract.interface.encodeFunctionData("withdraw",[e])}}var t=e.prototype;return t.decimals=function(){var e=f(C.mark((function e(){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.decimals();case 2:return e.abrupt("return",new a.BigNumber(e.sent.toString()));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.token=function(){var e=f(C.mark((function e(){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.token();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),l(e,null,[{key:"abi",get:function(){return["function token() view returns (address)","function decimals() view returns (uint256)","function deposit(uint256 amount) public","function withdraw(uint256 amount) public"]}}]),e}(),ie=function(e){function t(r,n){return e.call(this,new i.Contract(r,[].concat(se.abi,t.pickleJarAbi),n))||this}return m(t,e),t.prototype.pricePerShare=function(){var e=f(C.mark((function e(){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.getRatio();case 2:return e.abrupt("return",new a.BigNumber(e.sent.toString()));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),l(t,null,[{key:"pickleJarAbi",get:function(){return["function getRatio() public view returns (uint256)"]}}]),t}(se),ue=function(e){function t(r,n){return e.call(this,new i.Contract(r,[].concat(se.abi,t.yearnVaultAbi),n))||this}return m(t,e),t.prototype.pricePerShare=function(){var e=f(C.mark((function e(){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.pricePerShare();case 2:return e.abrupt("return",new a.BigNumber(e.sent.toString()));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),l(t,null,[{key:"yearnVaultAbi",get:function(){return["function pricePerShare() view returns (uint256)"]}}]),t}(se),ce=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).simulationExecutor=new ae(t.yearn.services.telegram,t.ctx),t}m(t,e);var r=t.prototype;return r.deposit=function(){var e=f(C.mark((function e(t,r,n,a,s){var i,u,c,o,p,d,h,l,v=this;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===s&&(s={}),i=this.ctx.provider.write.getSigner(t),u=te.includes(a)?exports.ZapProtocol.PICKLE:exports.ZapProtocol.YEARN,c=u===exports.ZapProtocol.PICKLE?new ie(a,i):new ue(a,i),e.next=6,c.token().catch((function(){throw new T("failed to fetch token",T.FAIL_TOKEN_FETCH)}));case 6:if((o=e.sent)===r){e.next=39;break}if(s.slippage){e.next=11;break}throw new S("slippage needs to be specified for a zap",S.NO_SLIPPAGE);case 11:if(r!==J){e.next=15;break}h=!1,e.next=18;break;case 15:return e.next=17,this.yearn.services.zapper.zapInApprovalState(t,r,u).then((function(e){return!e.isApproved})).catch((function(){throw new _("approval state",_.ZAP_IN_APPROVAL_STATE)}));case 17:h=e.sent;case 18:if(!h){e.next=24;break}return e.next=21,this.simulationExecutor.createFork();case 21:e.t0=e.sent,e.next=25;break;case 24:e.t0=void 0;case 25:if(s.forkId=p=e.t0,!h){e.next=33;break}return e.next=30,this.yearn.services.zapper.zapInApprovalTransaction(t,r,"0",u).catch((function(){throw new _("approval",_.ZAP_IN_APPROVAL)})).then(function(){var e=f(C.mark((function e(t){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.simulateZapApprovalTransaction(t,s);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then((function(e){return e.simulation.id}));case 30:e.t1=e.sent,e.next=34;break;case 33:e.t1=void 0;case 34:s.root=e.t1,d=function(e){return s.save=e,v.zapIn(t,r,o,n,a,c,u,h,s)},e.next=61;break;case 39:return e.next=41,this.depositNeedsApproving(t,r,a,n,i);case 41:if(!(l=e.sent)){e.next=48;break}return e.next=45,this.simulationExecutor.createFork();case 45:e.t2=e.sent,e.next=49;break;case 48:e.t2=void 0;case 49:if(s.forkId=p=e.t2,!l){e.next=57;break}return e.next=54,this.approve(t,r,n,a,s);case 54:e.t3=e.sent,e.next=58;break;case 57:e.t3=void 0;case 58:s.root=e.t3,d=function(e){return s.save=e,v.directDeposit(t,r,n,a,c,s)};case 61:return e.abrupt("return",this.simulationExecutor.executeSimulationWithReSimulationOnFailure(d,p));case 62:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,s){return e.apply(this,arguments)}}(),r.withdraw=function(){var e=f(C.mark((function e(t,r,a,s,i){var u,c,o,p,d,h,l=this;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===i&&(i={}),u=this.ctx.provider.write.getSigner(t),c=new ue(r,u),e.next=5,c.token();case 5:if((o=e.sent)===n.getAddress(s)){e.next=38;break}if(i.slippage){e.next=10;break}throw new S("slippage needs to be specified for a zap",S.NO_SLIPPAGE);case 10:if(r!==J){e.next=14;break}h=!1,e.next=17;break;case 14:return e.next=16,this.yearn.services.zapper.zapOutApprovalState(t,r).then((function(e){return!e.isApproved})).catch((function(){throw new _("zap out approval state",_.ZAP_OUT_APPROVAL_STATE)}));case 16:h=e.sent;case 17:if(!h){e.next=23;break}return e.next=20,this.simulationExecutor.createFork();case 20:e.t0=e.sent,e.next=24;break;case 23:e.t0=void 0;case 24:if(i.forkId=p=e.t0,!h){e.next=32;break}return e.next=29,this.yearn.services.zapper.zapOutApprovalTransaction(t,r,"0").catch((function(){throw new _("zap out approval transaction",_.ZAP_OUT_APPROVAL)})).then(function(){var e=f(C.mark((function e(t){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.simulateZapApprovalTransaction(t,i);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then((function(e){return e.simulation.id}));case 29:e.t1=e.sent,e.next=33;break;case 32:e.t1=void 0;case 33:i.root=e.t1,d=function(e){return i.save=e,l.zapOut(t,s,o,a,r,h,i)},e.next=39;break;case 38:d=function(e){return i.save=e,l.directWithdraw(t,s,a,r,c,i)};case 39:return e.abrupt("return",this.simulationExecutor.executeSimulationWithReSimulationOnFailure(d,p));case 40:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,s){return e.apply(this,arguments)}}(),r.approve=function(){var e=f(C.mark((function e(t,r,n,a,s){var u,c,o,p;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=["function approve(address spender, uint256 amount) returns (bool)"],c=this.ctx.provider.write.getSigner(t),o=new i.Contract(r,u,c),p=o.interface.encodeFunctionData("approve",[a,n]),s.save=!0,e.next=7,this.simulationExecutor.makeSimulationRequest(t,r,p,s);case 7:return e.abrupt("return",e.sent.simulation.id);case 9:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,s){return e.apply(this,arguments)}}(),r.depositNeedsApproving=function(){var e=f(C.mark((function e(t,r,n,a,u){var c;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=new i.Contract(r,["function allowance(address owner, address spender) view returns (uint256)"],u),e.next=4,c.allowance(t,n).catch((function(){}));case 4:return e.abrupt("return",new s(e.sent.toString()).lt(new s(a)));case 6:case"end":return e.stop()}}),e)})));return function(t,r,n,a,s){return e.apply(this,arguments)}}(),r.directDeposit=function(){var e=f(C.mark((function e(t,r,n,a,i,u){var c,o,p,d,f,h,l;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=i.encodeDeposit(n),e.next=3,this.simulationExecutor.simulateVaultInteraction(t,a,c,a,u);case 3:return o=e.sent,e.next=6,this.yearn.services.oracle.getNormalizedValueUsdc(a,o).catch((function(){throw new N("Error fetching price",N.FETCHING_PRICE_ORACLE)}));case 6:return p=e.sent,e.next=9,Promise.all([i.decimals().catch((function(){throw new T("no decimals",T.NO_DECIMALS)})),i.pricePerShare().catch((function(){throw new T("no price per share",T.NO_PRICE_PER_SHARE)}))]);case 9:return f=(d=e.sent)[0],h=d[1],l=new s(o).div(new s(10).pow(f)).multipliedBy(h).toFixed(0),e.abrupt("return",{sourceTokenAddress:r,sourceTokenAmount:n,targetTokenAddress:a,targetTokenAmount:o,targetTokenAmountUsdc:p,targetUnderlyingTokenAddress:a,targetUnderlyingTokenAmount:l,conversionRate:1,slippage:0});case 15:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,s,i){return e.apply(this,arguments)}}(),r.zapIn=function(){var e=f(C.mark((function e(t,r,n,a,i,u,c,o,p){var d,f,h,l,v,m,w,x,y,b,k,g,A;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d=r===J?H:r,p.slippage){e.next=3;break}throw new S("slippage needs to be set",S.NO_SLIPPAGE);case 3:return e.next=5,this.yearn.services.zapper.zapIn(t,d,a,i,p.gasPrice||"0",p.slippage,o,c).catch((function(){throw new _("zap in",_.ZAP_IN)}));case 5:return h=new s((f=e.sent).value).toFixed(0),p.gasPrice=p.gasPrice||f.gasPrice,o||(p.gasLimit=f.gas),e.next=11,this.simulationExecutor.simulateVaultInteraction(t,f.to,f.data,i,p,h);case 11:return l=e.sent,e.next=14,Promise.all([u.decimals().catch((function(){throw new T("no decimals",T.NO_DECIMALS)})),u.pricePerShare().catch((function(){throw new T("no price per share",T.NO_PRICE_PER_SHARE)}))]);case 14:m=(v=e.sent)[0],w=v[1],x=new s(l).div(new s(10).pow(m)).multipliedBy(w).toFixed(0),e.t0=c,e.next=e.t0===exports.ZapProtocol.YEARN?21:e.t0===exports.ZapProtocol.PICKLE?25:29;break;case 21:return e.next=23,this.yearn.services.oracle.getNormalizedValueUsdc(i,l).then((function(e){return new s(e)})).catch((function(){throw new N("error fetching price",N.FETCHING_PRICE_ORACLE)}));case 23:return y=e.sent,e.abrupt("break",29);case 25:return e.next=27,this.yearn.services.pickle.getPriceUsdc(i).catch((function(){throw new N("error fetching price",N.FETCHING_PRICE_PICKLE)})).then((function(e){return new s(e)}));case 27:return y=e.sent.dividedBy(new s(10).pow(m)).multipliedBy(new s(l)),e.abrupt("break",29);case 29:return b=r===J?$:r,e.t1=s,e.next=33,this.yearn.services.oracle.getNormalizedValueUsdc(b,a).catch((function(){throw new N("error fetching price",N.FETCHING_PRICE_ORACLE)}));case 33:return e.t2=e.sent,k=new e.t1(e.t2),g=y.div(new s(k)).toNumber(),A={sourceTokenAddress:r,sourceTokenAmount:a,targetTokenAddress:f.buyTokenAddress,targetTokenAmount:l,targetTokenAmountUsdc:y.toFixed(0),targetUnderlyingTokenAddress:n,targetUnderlyingTokenAmount:x,conversionRate:g,slippage:1-g},e.abrupt("return",A);case 38:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,s,i,u,c,o){return e.apply(this,arguments)}}(),r.directWithdraw=function(){var e=f(C.mark((function e(t,r,n,a,s,i){var u,c;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=s.encodeWithdraw(n),e.next=3,this.simulationExecutor.simulateVaultInteraction(t,a,u,r,i);case 3:return c=e.sent,e.next=6,this.yearn.services.oracle.getNormalizedValueUsdc(r,c).catch((function(){throw new N("error fetching price",N.FETCHING_PRICE_ORACLE)}));case 6:return e.abrupt("return",{sourceTokenAddress:a,sourceTokenAmount:n,targetTokenAddress:r,targetTokenAmount:c,targetTokenAmountUsdc:e.sent,targetUnderlyingTokenAddress:r,targetUnderlyingTokenAmount:c,conversionRate:1,slippage:0});case 9:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,s,i){return e.apply(this,arguments)}}(),r.zapOut=function(){var e=f(C.mark((function e(t,r,n,a,i,u,c){var o,p,d,h,l,v,m,w=this;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c.slippage){e.next=2;break}throw new S("slippage needs to be set",S.NO_SLIPPAGE);case 2:return o=r===J?H:r,e.next=5,this.yearn.services.zapper.zapOut(t,o,a,i,"0",c.slippage,u).catch((function(){throw new _("error zapping out",_.ZAP_OUT)}));case 5:return p=e.sent,u||(c.gasLimit=p.gas),e.next=9,f(C.mark((function e(){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o!==H){e.next=7;break}return e.next=3,w.simulationExecutor.makeSimulationRequest(t,p.to,p.data,c,p.value);case 3:return e.abrupt("return",new s(e.sent.transaction.transaction_info.call_trace.output).toFixed(0));case 7:return e.next=9,w.simulationExecutor.simulateVaultInteraction(t,p.to,p.data,r,c,p.value);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)})))();case 9:return d=e.sent,h=r===J?$:r,e.next=13,this.yearn.services.oracle.getNormalizedValueUsdc(h,d).catch((function(){throw new N("error fetching price",N.FETCHING_PRICE_ORACLE)}));case 13:return l=e.sent,e.next=16,this.yearn.services.oracle.getNormalizedValueUsdc(i,a).catch((function(){throw new N("error fetching price",N.FETCHING_PRICE_ORACLE)}));case 16:return v=e.sent,m=new s(l).div(new s(v)).toNumber(),e.abrupt("return",{sourceTokenAddress:i,sourceTokenAmount:a,targetTokenAddress:r,targetTokenAmount:d,targetTokenAmountUsdc:l,targetUnderlyingTokenAddress:n,targetUnderlyingTokenAmount:d,conversionRate:m,slippage:1-m});case 20:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,s,i,u){return e.apply(this,arguments)}}(),r.simulateZapApprovalTransaction=function(){var e=f(C.mark((function e(t,r){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.save=!0,e.next=3,this.simulationExecutor.makeSimulationRequest(t.from,t.to,t.data,r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),t}(L),oe=["function strategies(address) view returns (uint256 performanceFee, uint256 activation, uint256 debtRatio, uint256 rateLimit, uint256 lastReport, uint256 totalDebt, uint256 totalGain, uint256 totalLoss)","function token() view returns (address)","event StrategyAdded(address indexed strategy, uint256 debtRatio, uint256 minDebtPerHarvest, uint256 maxDebtPerHarvest, uint256 performanceFee)"],pe=["function symbol() view returns (string)"],de=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).cachedFetcher=new F("strategies/metadata/get",t.ctx,t.chainId),t}m(t,e);var r=t.prototype;return r.vaultsStrategiesMetadata=function(){var e=f(C.mark((function e(t){var r,n,a;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cachedFetcher.fetch();case 2:if(!(r=e.sent)){e.next=5;break}return e.abrupt("return",r);case 5:if(!t){e.next=9;break}n=t,e.next=12;break;case 9:return e.next=11,this.yearn.services.lens.adapters.vaults.v2.assetsStatic().then((function(e){return e.map((function(e){return e.address}))}));case 11:n=e.sent;case 12:return e.prev=12,e.next=15,this.fetchMetadataFromApi(n);case 15:a=e.sent,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(12),console.error(e.t0);case 21:if(a){e.next=25;break}return e.next=24,this.fetchMetadataFromChain(n);case 24:a=e.sent;case 25:return e.abrupt("return",a);case 26:case"end":return e.stop()}}),e,this,[[12,18]])})));return function(t){return e.apply(this,arguments)}}(),r.fetchMetadataFromApi=function(){var e=f(C.mark((function e(t){var r,n,a,s=this;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchVaultsData();case 2:return r=e.sent,e.next=5,this.yearn.services.meta.strategies();case 5:return n=e.sent,a=t.map(function(){var e=f(C.mark((function e(t){var a,u;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.find((function(e){return e.address===t}))){e.next=3;break}return e.abrupt("return",void 0);case 3:return u=new i.Contract(a.address,oe,s.ctx.provider.read),e.abrupt("return",s.fetchVaultStrategiesMetadata(a.strategies,n,u,a.token.symbol));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",Promise.all(a).then((function(e){return e.flatMap((function(e){return e?[e]:[]}))})));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.fetchMetadataFromChain=function(){var e=f(C.mark((function e(t){var r,n,a,s=this;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.yearn.services.meta.strategies();case 2:return r=e.sent,n=this.ctx.provider.read,a=t.map(function(){var e=f(C.mark((function e(t){var a,u,c,o,p;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new i.Contract(t,oe,n),u=s.yearn.services.helper.assetStrategiesAddresses(t).then((function(e){return e.map((function(e){return{address:e}}))})),e.next=4,Promise.all([u,a.token()]);case 4:return o=(c=e.sent)[0],p=new i.Contract(c[1],pe,n),e.next=10,p.symbol();case 10:return e.abrupt("return",s.fetchVaultStrategiesMetadata(o,r,a,e.sent));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",Promise.all(a).then((function(e){return e.flatMap((function(e){return e?[e]:[]}))})));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.fetchVaultStrategiesMetadata=function(){var e=f(C.mark((function e(t,r,n,a){var s;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.next=4,Promise.all(t.map(function(){var e=f(C.mark((function e(t){var s,i,u,o,p;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.strategies(t.address);case 3:u=e.sent.debtRatio,e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",void 0);case 10:if(!u.lte(c.BigNumber.from("0"))){e.next=12;break}return e.abrupt("return",void 0);case 12:return o=r.find((function(e){return e.addresses.includes(t.address)})),(p={address:t.address,name:(null==o?void 0:o.name)||t.name||"Strategy",description:null!=(s=null==o?void 0:o.description)?s:"I don't have a description for this strategy yet",protocols:null!=(i=null==o?void 0:o.protocols)?i:[]}).description=null==p?void 0:p.description.replace(/{{token}}/g,a),e.abrupt("return",{data:p,debtRatio:u});case 16:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}())).then((function(e){return e.flatMap((function(e){return e?[e]:[]})).sort((function(e,t){return e.debtRatio.lt(t.debtRatio)?1:e.debtRatio.eq(t.debtRatio)?0:-1})).map((function(e){return e.data}))}));case 4:if(0!==(s=e.sent).length){e.next=7;break}return e.abrupt("return",void 0);case 7:return e.abrupt("return",{vaultAddress:n.address,strategiesMetadata:s});case 9:case"end":return e.stop()}}),e)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),r.fetchVaultsData=function(){var e=f(C.mark((function e(){var t;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o("https://api.yearn.finance/v1/chains/"+this.chainId+"/vaults/all");case 2:if((t=e.sent).ok){e.next=5;break}throw new Error("An error has occured fetching vaults data: "+t.status);case 5:return e.next=7,t.json();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t}(L),fe=["function approve(address _spender, uint256 _value) public"],he=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).cachedFetcherSupported=new F("tokens/supported",t.ctx,t.chainId),t.cachedFetcher=new F("tokens/metadata",t.ctx,t.chainId),t}m(t,e);var r=t.prototype;return r.price=function(){var e=f(C.mark((function e(t,r){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.yearn.services.oracle.getPriceFromRouter(t,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.priceUsdc=function(){var e=f(C.mark((function e(t,r){var n=this;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(t)){e.next=5;break}return e.next=3,Promise.all(t.map(function(){var e=f(C.mark((function e(t){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.yearn.services.oracle.getPriceUsdc(t,r);case 2:return e.abrupt("return",[t,e.sent]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:return e.abrupt("return",Object.fromEntries(e.sent));case 5:return e.abrupt("return",this.yearn.services.oracle.getPriceUsdc(t,r));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.balances=function(){var e=f(C.mark((function e(t){var r,n,a,s,i;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.yearn.vaults.balances(t).then((function(e){return e.filter((function(e){return"0"!==e.balance}))}));case 2:r=e.sent,e.t0=this.chainId,e.next=1===e.t0||1337===e.t0?6:250===e.t0||42161===e.t0?19:25;break;case 6:return n=[],e.prev=7,e.next=10,this.yearn.services.zapper.balances(t);case 10:n=e.sent,e.next=16;break;case 13:e.prev=13,e.t1=e.catch(7),console.error(e.t1);case 16:return a=new Set(r.map((function(e){return e.address}))),n=n.filter((function(e){return!a.has(e.address)})),e.abrupt("return",n.concat(r));case 19:return e.next=21,this.yearn.ironBank.balances(t);case 21:return s=e.sent,i=new Set(r.map((function(e){return e.address}))),s=s.filter((function(e){return!i.has(e.address)})),e.abrupt("return",s.concat(r));case 25:return console.error("the chain "+this.chainId+" hasn't been implemented yet"),e.abrupt("return",[]);case 27:case"end":return e.stop()}}),e,this,[[7,13]])})));return function(t){return e.apply(this,arguments)}}(),r.supported=function(){var e=f(C.mark((function e(){var t,r,n,a=this;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.cachedFetcherSupported.fetch();case 3:if(!(t=e.sent)){e.next=6;break}return e.abrupt("return",t);case 6:if(1!==this.chainId&&1337!==this.chainId){e.next=14;break}return e.next=9,this.yearn.services.zapper.supportedTokens();case 9:return r=e.sent,e.next=12,this.yearn.services.asset.ready.then((function(){return a.yearn.services.asset.icon(r.map((function(e){return e.address})))}));case 12:return n=e.sent,e.abrupt("return",r.map((function(e){var t=n[e.address];return t?v({},e,{icon:t}):e})));case 14:console.error("the chain "+this.chainId+" hasn't been implemented yet"),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(0),console.error(e.t0);case 20:return e.abrupt("return",[]);case 21:case"end":return e.stop()}}),e,this,[[0,17]])})));return function(){return e.apply(this,arguments)}}(),r.approve=function(){var e=f(C.mark((function e(t,r,n,a){var u,c,o,p,d;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(J!==r){e.next=2;break}return e.abrupt("return",!0);case 2:if(u=this.ctx.provider.write.getSigner(a),t.token!==r){e.next=9;break}return c=new i.Contract(r,fe,u),e.next=7,c.populateTransaction.approve(t.address,n);case 7:return e.abrupt("return",this.yearn.services.transaction.sendTransaction(e.sent));case 9:return e.next=11,this.yearn.services.zapper.gas();case 11:return o=new s(e.sent.fast).times(new s(Math.pow(10,9))),p=te.includes(t.address)?exports.ZapProtocol.PICKLE:exports.ZapProtocol.YEARN,e.next=16,this.yearn.services.zapper.zapInApprovalState(a,r,p);case 16:if(e.sent.isApproved){e.next=23;break}return e.next=20,this.yearn.services.zapper.zapInApprovalTransaction(a,r,o.toString(),p);case 20:return e.abrupt("return",u.sendTransaction({to:(d=e.sent).to,from:d.from,gasPrice:d.gasPrice,data:d.data}));case 23:return e.abrupt("return",!0);case 24:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),r.approveZapOut=function(){var e=f(C.mark((function e(t,r,n){var a,i,u,c;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.ctx.provider.write.getSigner(n),t.token!==r){e.next=16;break}return e.next=4,this.yearn.services.zapper.gas();case 4:return i=new s(e.sent.fast).times(new s(Math.pow(10,9))),u=r,e.next=9,this.yearn.services.zapper.zapOutApprovalState(n,u);case 9:if(e.sent.isApproved){e.next=16;break}return e.next=13,this.yearn.services.zapper.zapOutApprovalTransaction(n,u,i.toString());case 13:return e.abrupt("return",a.sendTransaction({to:(c=e.sent).to,from:c.from,gasPrice:c.gasPrice,data:c.data}));case 16:return e.abrupt("return",!1);case 17:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}(),r.icon=function(e){return this.yearn.services.asset.icon(e)},r.metadata=function(){var e=f(C.mark((function e(t){var r,n;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cachedFetcher.fetch();case 2:if(!(n=e.sent)){e.next=7;break}r=n,e.next=10;break;case 7:return e.next=9,this.yearn.services.meta.tokens();case 9:r=e.sent;case 10:if(!t){e.next=14;break}return e.abrupt("return",r.filter((function(e){return t.includes(e.address)})));case 14:return e.abrupt("return",r);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t}(L),le=["function deposit(uint256 amount) public","function withdraw(uint256 amount) public"],ve=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).cachedFetcherGet=new F("vaults/get",t.ctx,t.chainId),t.cachedFetcherGetDynamic=new F("vaults/getDynamic",t.ctx,t.chainId),t.cachedFetcherTokens=new F("vaults/tokens",t.ctx,t.chainId),t}m(t,e);var r=t.prototype;return r.get=function(){var e=f(C.mark((function e(t,r){var n,a,s,i,u,c,o,p,d,h,l,m,w,x,y,b,k,g,P=this;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cachedFetcherGet.fetch();case 2:if(!(n=e.sent)){e.next=9;break}if(!t){e.next=8;break}return e.abrupt("return",n.filter((function(e){return t.includes(e.address)})));case 8:return e.abrupt("return",n);case 9:return a=this.yearn.services.meta.vaults().catch((function(e){return console.error(e),Promise.resolve([])})),e.next=12,Promise.all([a,this.getStatic(t,r)]);case 12:return i=(s=e.sent)[0],u=s[1],c=[],e.prev=16,e.next=19,this.getDynamic(t,i,r);case 19:c=e.sent,e.next=30;break;case 22:return e.prev=22,e.t0=e.catch(16),o=u.map((function(e){return e.address})),p=ee(o,30),d=p.map(function(){var e=f(C.mark((function e(t){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",P.getDynamic(t,i,r));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=29,Promise.all(d).then((function(e){return e.flat()}));case 29:c=e.sent;case 30:return h=this.yearn.strategies.vaultsStrategiesMetadata(c.map((function(e){return e.address}))).catch((function(e){return console.error(e),Promise.resolve([])})),l=this.yearn.earnings.assetsHistoricEarnings().catch((function(e){return console.error(e),Promise.resolve([])})),e.next=34,Promise.all([h,l]);case 34:w=(m=e.sent)[0],x=m[1],y=[],b=function(){var e,t,r=g.value,n=c.find((function(e){return r.address===e.address}));if(!n)throw new S("Dynamic asset does not exist for "+r.address);var a=i.find((function(e){return e.address===r.address}));if(null!=a&&a.hideAlways)return"continue";var s=null!=(e=null==a?void 0:a.order)?e:Math.max();n.metadata.displayName=n.metadata.displayName||r.name,n.metadata.strategies=w.find((function(e){return e.vaultAddress===r.address})),n.metadata.historicEarnings=null==(t=x.find((function(e){return e.assetAddress===r.address})))?void 0:t.dayData,y.push({vault:v({},r,n),order:s})},k=A(u);case 40:if((g=k()).done){e.next=46;break}if("continue"!==b()){e.next=44;break}return e.abrupt("continue",44);case 44:e.next=40;break;case 46:return e.abrupt("return",y.sort((function(e,t){return e.order-t.order})).map((function(e){return e.vault})));case 47:case"end":return e.stop()}}),e,this,[[16,22]])})));return function(t,r){return e.apply(this,arguments)}}(),r.getStatic=function(){var e=f(C.mark((function e(t,r){var n;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object.values(this.yearn.services.lens.adapters.vaults),e.next=3,Promise.all(n.map(function(){var e=f(C.mark((function e(n){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.assetsStatic(t,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())).then((function(e){return e.flat()}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.getDynamic=function(){var e=f(C.mark((function e(t,r,n){var a,s,i,u=this;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cachedFetcherGetDynamic.fetch();case 2:if(!(a=e.sent)){e.next=5;break}return e.abrupt("return",t?a.filter((function(e){return t.includes(e.address)})):a);case 5:if(!r){e.next=9;break}e.t0=r,e.next=12;break;case 9:return e.next=11,this.yearn.services.meta.vaults().catch((function(e){return console.error(e),Promise.resolve([])}));case 11:e.t0=e.sent;case 12:return s=e.t0,i=Object.values(this.yearn.services.lens.adapters.vaults),e.next=16,Promise.all(i.map(function(){var e=f(C.mark((function e(r){var a,i;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.assetsDynamic(t,n);case 2:return a=e.sent,e.next=5,u.yearn.services.vision.apy(a.map((function(e){return e.address})));case 5:return i=e.sent,e.abrupt("return",a.map((function(e){var t=s.find((function(t){return t.address===e.address}));if(e.metadata.apy=i[e.address],e.tokenId===$){var r,n=null!=(r=u.yearn.services.asset.icon(J))?r:"";e.metadata.displayIcon=n,e.metadata.displayName="ETH",e.metadata.defaultDisplayToken=J}else{var a,c=null!=(a=u.yearn.services.asset.icon(e.tokenId))?a:"";e.metadata.displayIcon=c;var o=u.yearn.services.asset.alias(e.tokenId);e.metadata.displayName=o?o.symbol:"",e.metadata.defaultDisplayToken=e.tokenId}return t&&u.fillMetadataOverrides(e,t),e})));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())).then((function(e){return e.flat()}));case 16:return e.abrupt("return",e.sent);case 17:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}(),r.positionsOf=function(){var e=f(C.mark((function e(t,r,n){var a,s=this;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object.values(this.yearn.services.lens.adapters.vaults),e.next=3,Promise.all(a.map(function(){var e=f(C.mark((function e(a){var i,u,c;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.positionsOf(t,r,n);case 3:return e.abrupt("return",e.sent);case 6:if(e.prev=6,e.t0=e.catch(0),!r){e.next=12;break}i=r,e.next=15;break;case 12:return e.next=14,s.getStatic(r,n).then((function(e){return e.map((function(e){return e.address}))}));case 14:i=e.sent;case 15:return u=ee(i,30),c=u.map(function(){var e=f(C.mark((function e(r){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a.positionsOf(t,r,n));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=19,Promise.all(c).then((function(e){return e.flat()}));case 19:return e.abrupt("return",e.sent);case 20:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}())).then((function(e){return e.flat()}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}(),r.summaryOf=function(){var e=f(C.mark((function e(t){var r;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.yearn.earnings.accountAssetsData(t);case 2:return e.abrupt("return",{earnings:(r=e.sent).earnings,holdings:r.holdings,grossApy:r.grossApy,estimatedYearlyYield:r.estimatedYearlyYield});case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.metadataOf=function(){var e=f(C.mark((function e(t,r){var n;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.yearn.earnings.accountAssetsData(t);case 2:if(n=e.sent.earningsAssetData,r){e.next=6;break}return e.abrupt("return",n);case 6:return e.abrupt("return",n.filter((function(e){return r.includes(e.assetAddress)})));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.balances=function(){var e=f(C.mark((function e(t,r){var n;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.tokens();case 2:return n=e.sent,e.next=5,this.yearn.services.helper.tokenBalances(t,n.map((function(e){return e.address})),r);case 5:return e.abrupt("return",e.sent.map((function(e){var t=n.find((function(t){return t.address===e.address}));if(!t)throw new S("Token does not exist for Balance("+e.address+")");return v({},e,{token:t})})));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.tokens=function(){var e=f(C.mark((function e(t){var r,n,a=this;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cachedFetcherTokens.fetch();case 2:if(!(r=e.sent)){e.next=5;break}return e.abrupt("return",r);case 5:return n=Object.values(this.yearn.services.lens.adapters.vaults),e.next=8,this.yearn.services.asset.ready;case 8:return e.next=10,Promise.all(n.map(function(){var e=f(C.mark((function e(r){var n,s,i,u,c,o;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.tokens(t);case 2:return s=a.yearn.services.asset.icon((n=e.sent).concat(J)),i=a.yearn.services.helper.tokens(n,t),u=a.yearn.tokens.metadata(n),e.next=8,Promise.all([i,u]);case 8:return o=(c=e.sent)[1],e.abrupt("return",Promise.all(c[0].map(function(){var e=f(C.mark((function e(r){var n,i,u,c;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=o.find((function(e){return e.address===r.address})),e.t0=v,e.t1={},e.t2=r,e.t3=s[r.address],e.t4={},e.next=8,a.yearn.services.oracle.getPriceUsdc(r.address,t);case 8:return e.t5=e.sent,e.t6=i,e.t7={icon:e.t3,supported:e.t4,priceUsdc:e.t5,metadata:e.t6},u=(0,e.t0)(e.t1,e.t2,e.t7),(c=null==(n=a.yearn.services.asset.alias(r.address))?void 0:n.symbol)&&(u.symbol=c),i&&a.fillTokenMetadataOverrides(u,i),e.abrupt("return",u);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())).then((function(e){return e.flat()}));case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.deposit=function(){var e=f(C.mark((function e(t,r,n,a,s,u){var c,o,p=this;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===s&&(s={}),void 0===u&&(u={}),c=this.ctx.provider.write.getSigner(a),!te.includes(t)){e.next=6;break}return e.abrupt("return",this.zapIn(t,r,n,a,s,exports.ZapProtocol.PICKLE,u));case 6:return e.next=8,this.getStatic([t],u);case 8:if(e.sent[0].token!==r){e.next=20;break}if(r!==J){e.next=15;break}throw new S("deposit:v2:eth not implemented");case 15:return o=new i.Contract(t,le,c),e.abrupt("return",this.executeVaultContractTransaction(function(){var e=f(C.mark((function e(t){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.populateTransaction.deposit(n,t);case 2:return e.abrupt("return",p.yearn.services.transaction.sendTransaction(e.sent));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),u));case 18:e.next=21;break;case 20:return e.abrupt("return",this.zapIn(t,r,n,a,s,exports.ZapProtocol.YEARN,u));case 21:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,s,i){return e.apply(this,arguments)}}(),r.withdraw=function(){var e=f(C.mark((function e(t,r,n,a,s,u){var o,p,d,h,l,v=this;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===s&&(s={}),void 0===u&&(u={}),e.next=4,this.getStatic([t],u);case 4:if(o=e.sent[0],p=this.ctx.provider.write.getSigner(a),o.token!==r){e.next=13;break}return d=new i.Contract(t,le,p),e.abrupt("return",this.executeVaultContractTransaction(function(){var e=f(C.mark((function e(t){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.populateTransaction.withdraw(n,t);case 2:return e.abrupt("return",v.yearn.services.transaction.sendTransaction(e.sent));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),u));case 13:if(void 0!==s.slippage){e.next=15;break}throw new S("zap operations should have a slippage set");case 15:return e.next=17,this.yearn.services.zapper.zapOut(a,r,n,t,"0",s.slippage,!1,void 0,s.signature);case 17:return l={to:(h=e.sent).to,from:h.from,gasPrice:c.BigNumber.from(h.gasPrice),gasLimit:c.BigNumber.from(h.gas),data:h.data,value:c.BigNumber.from(h.value)},e.abrupt("return",this.executeZapperTransaction(l,u,c.BigNumber.from(h.gasPrice)));case 20:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,s,i){return e.apply(this,arguments)}}(),r.zapIn=function(){var e=f(C.mark((function e(t,r,n,a,s,i,u){var o,p;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===s&&(s={}),void 0===i&&(i=exports.ZapProtocol.YEARN),void 0===u&&(u={}),void 0!==s.slippage){e.next=5;break}throw new S("zap operations should have a slippage set");case 5:return e.next=7,this.yearn.services.zapper.zapIn(a,r,n,t,"0",s.slippage,!1,i);case 7:return p={to:(o=e.sent).to,from:o.from,data:o.data,value:c.BigNumber.from(o.value),gasLimit:c.BigNumber.from(o.gas)},e.abrupt("return",this.executeZapperTransaction(p,u,c.BigNumber.from(o.gasPrice)));case 10:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,s,i,u){return e.apply(this,arguments)}}(),r.executeZapperTransaction=function(){var e=f(C.mark((function e(t,r,n){var a,s;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(a=v({},t,r)).gasPrice=void 0,e.next=5,this.yearn.services.transaction.sendTransaction(a);case 5:return e.abrupt("return",e.sent);case 8:if(e.prev=8,e.t0=e.catch(0),-32602!==e.t0.code){e.next=18;break}return(s=v({},t,r)).maxFeePerGas=void 0,s.maxPriorityFeePerGas=void 0,s.gasPrice=r.gasPrice||n,e.next=17,this.yearn.services.transaction.sendTransaction(s);case 17:return e.abrupt("return",e.sent);case 18:throw e.t0;case 19:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(t,r,n){return e.apply(this,arguments)}}(),r.executeVaultContractTransaction=function(){var e=f(C.mark((function e(t,r){var n;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.gasPrice,e.prev=1,r.gasPrice=void 0,e.next=5,t(r);case 5:return e.abrupt("return",e.sent);case 9:if(e.prev=9,e.t0=e.catch(1),-32602!==e.t0.code){e.next=19;break}return r.maxFeePerGas=void 0,r.maxPriorityFeePerGas=void 0,r.gasPrice=n,e.next=17,t(r);case 17:return e.abrupt("return",e.sent);case 19:throw e.t0;case 20:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,r){return e.apply(this,arguments)}}(),r.fillTokenMetadataOverrides=function(e,t){t.tokenIconOverride&&(e.icon=t.tokenIconOverride),t.tokenSymbolOverride&&(e.symbol=t.tokenSymbolOverride),t.tokenNameOverride&&(e.name=t.tokenNameOverride)},r.fillMetadataOverrides=function(e,t){t.displayName&&(e.metadata.displayName=t.displayName),t.vaultSymbolOverride&&(e.metadata.symbol=t.vaultSymbolOverride),t.vaultIconOverride&&(e.metadata.displayIcon=t.vaultIconOverride),t.apyTypeOverride&&(e.metadata.apy||(e.metadata.apy=this.makeEmptyApy()),e.metadata.apy.type=t.apyTypeOverride),t.apyOverride&&(e.metadata.apy||(e.metadata.apy=this.makeEmptyApy()),e.metadata.apy.net_apy=t.apyOverride,e.metadata.apy.type="override"),e.metadata.depositsDisabled=t.depositsDisabled,e.metadata.withdrawalsDisabled=t.withdrawalsDisabled,e.metadata.allowZapIn=t.allowZapIn,e.metadata.allowZapOut=t.allowZapOut,e.metadata.migrationContract=t.migrationContract,e.metadata.migrationTargetVault=t.migrationTargetVault,e.metadata.vaultNameOverride=t.vaultNameOverride,e.metadata.vaultDetailPageAssets=t.vaultDetailPageAssets,e.metadata.hideIfNoDeposits=e.metadata.emergencyShutdown||t.retired||t.migrationAvailable||!1,e.metadata.migrationAvailable=e.metadata.migrationAvailable||t.migrationAvailable||!1},r.makeEmptyApy=function(){return{type:"manual_override",gross_apr:0,net_apy:0,fees:{performance:null,withdrawal:null,management:null,keep_crv:null,cvx_keep_crv:null},points:null,composite:null}},t}(L),me="tuple(\n  address address,\n  string typeId,\n  address token,\n  string name,\n  string version,\n  string symbol,\n  uint8 decimals,\n)",we=function(e){return"tuple(\n  address address, \n  string typeId,\n  address tokenId,\n  tuple(uint256 amount, uint256 amountUsdc) underlyingTokenBalance,\n  "+e+" metadata\n)"},xe="tuple(address assetAddress, address tokenAddress, string typeId, uint256 balance,tuple(uint256 amount, uint256 amountUsdc) underlyingTokenBalance,tuple(address owner, address spender, uint256 amount)[] tokenAllowances,tuple(address owner, address spender, uint256 amount)[] assetAllowances)",ye=function(e){return["function assetsStatic() public view returns ("+me+"[] memory)","function assetsStatic(address[] memory) public view returns ("+me+"[] memory)","function assetsDynamic() public view returns ("+we(e)+"[] memory)","function assetsDynamic(address[] memory) public view returns ("+we(e)+"[] memory)","function assetsPositionsOf(address) public view returns ("+xe+"[] memory)","function assetsPositionsOf(address, address[] memory) public view returns ("+xe+"[] memory)","function assetsTokensAddresses() public view returns (address[] memory)"]};function be(e){if("object"!=typeof e)return e;var t=Object.keys(e).filter((function(e){return isNaN(Number(e))}));if(0===t.length)return ke(e);var r={};return t.forEach((function(t){var n=e[t];r[t]="object"!=typeof n||p.isBigNumberish(n)?Array.isArray(n)?n:p.isBigNumberish(n)?n.toString():n:be(n)})),r}function ke(e){return e.map((function(e){return be(e)}))}var ge=["function adapterPositionOf(address) external view returns (tuple(\n  uint256 supplyBalanceUsdc,\n  uint256 borrowBalanceUsdc,\n  uint256 borrowLimitUsdc,\n  uint256 utilizationRatioBips\n) memory)","function assetsUserMetadata(address) public view returns (tuple(\n  address assetAddress,\n  bool enteredMarket,\n  uint256 supplyBalanceUsdc,\n  uint256 borrowBalanceUsdc,\n  uint256 collateralBalanceUsdc,\n  uint256 borrowLimitUsdc\n)[] memory)","function blocksPerYear() public view returns (uint256)"],Ae=function(e){function t(r,n){var a;return e.call(this,null!=(a=n.addresses.adapters.ironBank)?a:t.addressByChain(r),r,n)||this}m(t,e),t.addressByChain=function(e){switch(e){case 1:case 1337:return"0x5D03ad44F4Fce73407C73A1779295011691D2e1F";case 250:return"0xC31E8C238287448f0d0CCF65df40424eeF429940";case 42161:return"0x7AAd416eB4e16a27b85e7076dD56742A44E9d25B"}};var r=t.prototype;return r.assetsStatic=function(){var e=f(C.mark((function e(t,r){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===r&&(r={}),!t){e.next=5;break}return e.next=4,this.contract.read["assetsStatic(address[])"](t,r).then(ke);case 4:return e.abrupt("return",e.sent);case 5:return e.next=7,this.contract.read["assetsStatic()"](r).then(ke);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.assetsDynamic=function(){var e=f(C.mark((function e(t,r){var n,a,s,i,u,c,o;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r={}),n=t?this.contract.read["assetsDynamic(address[])"](t,r).then(ke):this.contract.read["assetsDynamic()"](r).then(ke),e.next=4,Promise.all([n,this.blocksPerYear()]);case 4:for(i=(a=e.sent)[1],u=A(s=a[0]);!(c=u()).done;)(o=c.value).metadata.lendApyBips=this.aprBipsToApyBips(o.metadata.lendAprBips,i),o.metadata.borrowApyBips=this.aprBipsToApyBips(o.metadata.borrowAprBips,i);return e.abrupt("return",s);case 9:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.positionsOf=function(){var e=f(C.mark((function e(t,r,n){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===n&&(n={}),!r){e.next=5;break}return e.next=4,this.contract.read["assetsPositionsOf(address,address[])"](t,r,n).then(ke);case 4:return e.abrupt("return",e.sent);case 5:return e.next=7,this.contract.read["assetsPositionsOf(address)"](t,n).then(ke);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}(),r.generalPositionOf=function(){var e=f(C.mark((function e(t,r){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r={}),e.next=3,this.contract.read.adapterPositionOf(t,r).then(be);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.assetsUserMetadata=function(){var e=f(C.mark((function e(t,r,n){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===n&&(n={}),!r){e.next=5;break}return e.next=4,this.contract.read["assetsUserMetadata(address,address[])"](t,r,n).then(ke);case 4:return e.abrupt("return",e.sent);case 5:return e.next=7,this.contract.read["assetsUserMetadata(address)"](t,n).then(ke);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}(),r.tokens=function(){var e=f(C.mark((function e(t){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===t&&(t={}),e.next=3,this.contract.read.assetsTokensAddresses(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.blocksPerYear=function(){var e=f(C.mark((function e(t){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===t&&(t={}),e.next=3,this.contract.read.blocksPerYear(t);case 3:return e.abrupt("return",e.sent.toString());case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.aprBipsToApyBips=function(e,t){var r=a.BigNumber.clone({POW_PRECISION:6});return new r(e).div(new r(10).pow(4)).div(t).plus(1).pow(t).minus(1).multipliedBy(new r(10).pow(4)).toFixed(0)},t}(j);Ae.abi=ye("tuple(\n  uint256 totalSuppliedUsdc,\n  uint256 totalBorrowedUsdc,\n  uint256 lendAprBips,\n  uint256 borrowAprBips,\n  uint256 liquidity,\n  uint256 liquidityUsdc,\n  uint256 totalCollateralTokens,\n  uint256 collateralFactor,\n  uint256 collateralCap,\n  bool isActive,\n  uint256 reserveFactor,\n  uint256 exchangeRate\n)").concat(ge);var Pe=function(e){function t(r,n){var a;return e.call(this,null!=(a=n.addresses.adapters.registryV2)?a:t.addressByChain(r),r,n)||this}m(t,e),t.addressByChain=function(e){switch(e){case 1:case 1337:return"0x240315db938d44bb124ae619f5fd0269a02d1271";case 250:return"0xF628Fb7436fFC382e2af8E63DD7ccbaa142E3cd1";case 42161:return"0x57AA88A0810dfe3f9b71a9b179Dd8bF5F956C46A"}};var r=t.prototype;return r.assetsStatic=function(){var e=f(C.mark((function e(t,r){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===r&&(r={}),!t){e.next=5;break}return e.next=4,this.contract.read["assetsStatic(address[])"](t,r).then(ke);case 4:return e.abrupt("return",e.sent);case 5:return e.next=7,this.contract.read["assetsStatic()"]().then(ke);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.assetsDynamic=function(){var e=f(C.mark((function e(t,r){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===r&&(r={}),!t){e.next=5;break}return e.next=4,this.contract.read["assetsDynamic(address[])"](t,r).then(ke).then((function(e){return e.map((function(e){return v({},e,{metadata:v({controller:H,totalAssets:"0",totalSupply:"0"},e.metadata)})}))}));case 4:return e.abrupt("return",e.sent);case 5:return e.next=7,this.contract.read["assetsDynamic()"]().then(ke).then((function(e){return e.map((function(e){return v({},e,{metadata:v({controller:H,totalAssets:"0",totalSupply:"0"},e.metadata)})}))}));case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.positionsOf=function(){var e=f(C.mark((function e(t,r,n){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===n&&(n={}),!r){e.next=5;break}return e.next=4,this.contract.read["assetsPositionsOf(address,address[])"](t,r,n).then(ke);case 4:return e.abrupt("return",e.sent);case 5:return e.next=7,this.contract.read["assetsPositionsOf(address)"](t,n).then(ke);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}(),r.tokens=function(){var e=f(C.mark((function e(t){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===t&&(t={}),e.next=3,this.contract.read.assetsTokensAddresses(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t}(j);Pe.abi=ye("tuple(\n  uint256 pricePerShare,\n  bool migrationAvailable,\n  address latestVaultAddress,\n  uint256 depositLimit,\n  bool emergencyShutdown\n)");var Se=function(e,t){return"https://raw.githack.com/yearn/yearn-assets/master/icons/multichain-tokens/"+t+"/"+e+"/logo-128.png"},Ee=function(e,t){return"https://raw.githack.com/yearn/yearn-assets/master/icons/multichain-tokens/"+t+"/"+e+"/logo-alt-128.png"},_e=function(e){return"https://raw.githack.com/trustwallet/assets/master/blockchains/ethereum/assets/"+e+"/logo.png"},Te=function(e){function t(t,r,n){var a;return(a=e.call(this,t,r)||this).alts=[$],n?(a.supported=n.supported,a.aliases=n.aliases,a.ready=Promise.resolve()):(a.supported=new Map,a.aliases=new Map,a.ready=a.initialize()),a}m(t,e),t.deserializeState=function(e){var t=JSON.parse(e);return{supported:new Map(JSON.parse(t.supported)),aliases:new Map(JSON.parse(t.aliases))}};var r=t.prototype;return r.makeSerializedState=function(){var e=f(C.mark((function e(){var t,r;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ready;case 2:return t=JSON.stringify(Array.from(this.supported.entries())),r=JSON.stringify(Array.from(this.aliases.entries())),e.abrupt("return",JSON.stringify({supported:t,aliases:r}));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.initialize=function(){var e=f(C.mark((function e(){var t,r,n,a,s,i,u,c,p;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==this.chainId&&1337!==this.chainId){e.next=9;break}return e.next=3,o("https://raw.githubusercontent.com/yearn/yearn-assets/master/icons/aliases.json").then(K).then((function(e){return e.json()})).catch((function(e){return console.error(e),[]}));case 3:for(t=A(e.sent);!(r=t()).done;)this.aliases.set((n=r.value).address,n);return e.next=7,o("https://raw.githack.com/trustwallet/assets/master/blockchains/ethereum/tokenlist.json").then(K).then((function(e){return e.json()})).then((function(e){return e.tokens})).catch((function(e){return console.error(e),[]}));case 7:for(a=A(e.sent);!(s=a()).done;)this.supported.set((i=s.value).address,_e(i.address));case 9:return e.next=11,o((d=this.chainId,"https://api.github.com/repos/yearn/yearn-assets/contents/icons/multichain-tokens/"+d)).then(K).then((function(e){return e.json()})).catch((function(e){return console.error(e),[]}));case 11:for(u=A(e.sent);!(c=u()).done;)this.supported.set((p=c.value).name,Se(p.name,this.chainId)),this.alts.includes(p.name)?this.supported.set(p.name,Ee(p.name,this.chainId)):this.supported.set(p.name,Se(p.name,this.chainId));case 13:case"end":return e.stop()}var d}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.icon=function(e){var t=this;return Array.isArray(e)?Object.fromEntries(e.map((function(e){return[e,t.supported.get(e)]}))):this.supported.get(e)},r.alias=function(e){var t=this;return Array.isArray(e)?Object.fromEntries(e.map((function(e){return[e,t.aliases.get(e)]}))):this.aliases.get(e)},t}(U),Ie=function(e){function t(r,n){var a;return e.call(this,null!=(a=n.addresses.lens)?a:t.addressByChain(r),r,n)||this}m(t,e),t.addressByChain=function(e){switch(e){case 1:case 250:case 1337:case 42161:return"0xFa58130BE296EDFA23C42a1d15549fA91449F979"}};var r=t.prototype;return r.getAdapters=function(){var e=f(C.mark((function e(t){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===t&&(t={}),e.next=3,this.contract.read.getRegistries(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.getAssets=function(){var e=f(C.mark((function e(t){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===t&&(t={}),e.next=3,this.contract.read.getAssets(t).then(ke);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.getPositions=function(){var e=f(C.mark((function e(t,r){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r={}),e.next=3,this.contract.read.getPositionsOf(t,r).then(ke);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.getAssetsFromAdapter=function(){var e=f(C.mark((function e(t,r){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r={}),e.next=3,this.contract.read.getAssetsFromAdapter(t,r).then(ke);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),l(t,[{key:"adapters",get:function(){return{vaults:{v2:new Pe(this.chainId,this.ctx)},ironBank:new Ae(this.chainId,this.ctx)}}}]),t}(j);Ie.abi=["function getRegistries() external view returns (address[] memory)"];var Oe=function(e){function t(r,n){var a;return e.call(this,null!=(a=n.addresses.oracle)?a:t.addressByChain(r),r,n)||this}m(t,e),t.addressByChain=function(e){switch(e){case 1:case 1337:return"0x83d95e0D5f402511dB06817Aff3f9eA88224B030";case 250:return"0x57AA88A0810dfe3f9b71a9b179Dd8bF5F956C46A";case 42161:return"0x043518AB266485dC085a1DB095B8d9C2Fc78E9b9"}};var r=t.prototype;return r.getCalculations=function(){var e=f(C.mark((function e(t){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===t&&(t={}),e.next=3,this.contract.read.calculations(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.getPriceUsdc=function(){var e=f(C.mark((function e(t,r){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r={}),e.next=3,this.contract.read.getPriceUsdcRecommended(t,r).then(X);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.getNormalizedValueUsdc=function(){var e=f(C.mark((function e(t,r,n){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===n&&(n={}),e.next=3,this.contract.read.getNormalizedValueUsdc(t,r,n).then(X);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}(),r.getUsdcAddress=function(){var e=f(C.mark((function e(t){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===t&&(t={}),e.next=3,this.contract.read.usdcAddress(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.isCurveLpToken=function(){var e=f(C.mark((function e(t,r){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r={}),e.next=3,this.contract.read.isCurveLpToken(t,r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.getCurvePriceUsdc=function(){var e=f(C.mark((function e(t,r){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r={}),e.next=3,this.contract.read.getCurvePriceUsdc(t,r).then(X);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.getBasePrice=function(){var e=f(C.mark((function e(t,r){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r={}),e.next=3,this.contract.read.getBasePrice(t,r).then(X);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.getVirtualPrice=function(){var e=f(C.mark((function e(t,r){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r={}),e.next=3,this.contract.read.getVirtualPrice(t,r).then(X);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.getCurveRegistryAddress=function(){var e=f(C.mark((function e(t){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===t&&(t={}),e.next=3,this.contract.read.usdcAddress(t).then(X);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.isIronBankMarket=function(){var e=f(C.mark((function e(t,r){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r={}),e.next=3,this.contract.read.isIronBankMarket(t,r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.getIronBankMarketPriceUsdc=function(){var e=f(C.mark((function e(t,r){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r={}),e.next=3,this.contract.read.getIronBankMarketPriceUsdc(t,r).then(X);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.getIronBankMarkets=function(){var e=f(C.mark((function e(t){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===t&&(t={}),e.next=3,this.contract.read.getIronBankMarkets(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.isLpToken=function(){var e=f(C.mark((function e(t,r){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r={}),e.next=3,this.contract.read.isLpToken(t,r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.getPriceFromRouter=function(){var e=f(C.mark((function e(t,r,n){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===n&&(n={}),e.next=3,this.contract.read.getPriceFromRouter(t,r,n).then(X);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}(),r.getPriceFromRouterUsdc=function(){var e=f(C.mark((function e(t,r){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r={}),e.next=3,this.contract.read.getPriceFromRouterUsdc(t,r).then(X);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.getLpTokenTotalLiquidityUsdc=function(){var e=f(C.mark((function e(t,r){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r={}),e.next=3,this.contract.read.getLpTokenTotalLiquidityUsdc(t,r).then(X);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.getLpTokenPriceUsdc=function(){var e=f(C.mark((function e(t,r){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r={}),e.next=3,this.contract.read.getLpTokenPriceUsdc(t,r).then(X);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),t}(j);Oe.abi=["function calculations() external view returns (address[] memory)","function getPriceUsdcRecommended(address) public view returns (uint256)","function usdcAddress() public view returns (address)","function getNormalizedValueUsdc(address,uint256) view returns (uint256)","function isCurveLpToken(address) public view returns (bool)","function getCurvePriceUsdc(address) public view returns (uint256)","function getBasePrice(address) public view returns (uint256)","function getVirtualPrice(address) public view returns (uint256)","function curveRegistryAddress() public view returns (address)","function isIronBankMarket(address) public view returns (bool)","function getIronBankMarketPriceUsdc(address) public view returns (uint256)","function getIronBankMarkets() public view returns (address[] memory)","function isLpToken(address) public view returns (bool)","function getPriceFromRouter(address, address) public view returns (uint256)","function getPriceFromRouterUsdc(address) public view returns (uint256)","function getLpTokenTotalLiquidityUsdc(address) public view returns (uint256)","function getLpTokenPriceUsdc(address) public view returns (uint256)"];var Ne=function(e){function t(t,r){var n,a;switch(n=e.call(this,t,r)||this,t){case 1:case 1337:a="salazarguille/yearn-vaults-v2-subgraph-mainnet";break;case 250:a="yearn/yearn-vaults-v2-fantom";break;case 42161:a="yearn/yearn-vaults-v2-arbitrum";break;default:throw new S("No subgraph name for chain "+t)}return n.yearnSubgraphEndpoint="https://api.thegraph.com/subgraphs/name/"+a,n}return m(t,e),t.prototype.fetchQuery=function(){var e=f(C.mark((function e(t,r){var n;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r={}),Object.keys(r).forEach((function(e){var t=r[e];if("string"==typeof t)r[e]=t.toLowerCase();else if(Array.isArray(t))for(var n,a=A(t.entries());!(n=a()).done;){var s=n.value,i=s[1];"string"==typeof i&&(t[s[0]]=i.toLowerCase())}})),n={query:t,variables:r},e.next=5,fetch(this.yearnSubgraphEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((function(e){return e.json()})).then((function(e){if(e.errors)throw new S("Subgraph Error - "+JSON.stringify(e.errors));return e}));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),t}(U),Be=function(e){function t(){return e.apply(this,arguments)||this}return m(t,e),t.prototype.sendMessage=function(e){if(this.ctx.simulation.telegramChatId&&this.ctx.simulation.telegramBotId){var t=new URLSearchParams({chat_id:this.ctx.simulation.telegramChatId,text:e,disable_web_page_preview:"true"});fetch("https://api.telegram.org/bot"+this.ctx.simulation.telegramBotId+"/sendMessage?"+t)}},t}(U),Re=function(e){function t(){return e.apply(this,arguments)||this}return m(t,e),t.prototype.apy=function(){var e=f(C.mark((function e(t){var r,n,a,s,i,u,c;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="https://d28fcsszptni1s.cloudfront.net/v1/chains/"+this.chainId+"/vaults/all",e.next=3,fetch(r).then(K).then((function(e){return e.json()}));case 3:if(n=(n=e.sent).map((function(e){return e.apy&&"backscratcher"===e.apy.type?v({},e,{apy:(t=e.apy,t?v({},t,{composite:t.composite?v({},t.composite,{boost:t.composite.boost?t.composite.boost:t.composite.currentBoost,pool_apy:t.composite.pool_apy?t.composite.pool_apy:t.composite.poolApy,boosted_apr:t.composite.boosted_apr?t.composite.boosted_apr:t.composite.boostedApy,base_apr:t.composite.base_apr?t.composite.base_apr:t.composite.baseApy}):null}):void 0)}):e;var t})),!Array.isArray(t)){e.next=12;break}for(a=new Map,s=function(){var e=u.value,t=n.find((function(t){return t.address===e}));a.set(e,t?t.apy:void 0)},i=A(t);!(u=i()).done;)s();return e.abrupt("return",Object.fromEntries(a));case 12:if(!t){e.next=19;break}if(c=n.find((function(e){return e.address===t}))){e.next=16;break}return e.abrupt("return",void 0);case 16:return e.abrupt("return",c.apy);case 19:return e.abrupt("return",Object.fromEntries(n.map((function(e){return[e.address,e.apy]}))));case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t}(U),De={1:"ethereum",250:"fantom",1337:"ethereum",42161:"arbitrum"},Ce=function(e){function t(){return e.apply(this,arguments)||this}m(t,e);var r=t.prototype;return r.supportedTokens=function(){var e=f(C.mark((function e(){var t,r,a;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new URLSearchParams({api_key:this.ctx.zapper}),e.next=4,fetch("https://api.zapper.fi/v1/prices?"+r).then(K).then((function(e){return e.json()}));case 4:return a=null!=(t=De[this.chainId])?t:"ethereum",e.abrupt("return",e.sent.map((function(e){var t=e.address===H?J:n.getAddress(String(e.address)),r=!e.hide||!e.hide;return{address:t,name:e.symbol,symbol:e.symbol,icon:"https://assets.yearn.network/tokens/"+a+"/"+e.address+".png",decimals:e.decimals,priceUsdc:Q(e.price),supported:{zapper:r}}})));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.balances=function(){var e=f(C.mark((function e(t){var r,a;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new URLSearchParams({"addresses[]":Array.isArray(t)?t.join():t,api_key:this.ctx.zapper}),e.next=4,fetch("https://api.zapper.fi/v1/protocols/tokens/balances?"+r).then(K).then((function(e){return e.json()}));case 4:if(a=e.sent,Object.keys(a).forEach((function(e){var t=a[e];if(delete a[e],0===t.products.length)a[n.getAddress(e)]=[];else{var r=t.products[0].assets;a[n.getAddress(e)]=r.map((function(e){var t=e.address===H?J:n.getAddress(String(e.address));return{address:t,token:{address:t,name:e.symbol,symbol:e.symbol,decimals:e.decimals},balance:e.balanceRaw,balanceUsdc:Q(e.balanceUSD),priceUsdc:Q(e.price)}}))}})),Array.isArray(t)){e.next=8;break}return e.abrupt("return",a[t]);case 8:return e.abrupt("return",a);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.gas=function(){var e=f(C.mark((function e(){var t;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new URLSearchParams({api_key:this.ctx.zapper}),e.next=4,fetch("https://api.zapper.fi/v1/gas-price?"+t).then(K).then((function(e){return e.json()}));case 4:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.zapInApprovalState=function(){var e=f(C.mark((function e(t,r,n){var a,s;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===n&&(n=exports.ZapProtocol.YEARN),a="https://api.zapper.fi/v1/zap-in/vault/"+n+"/approval-state",s=new URLSearchParams({ownerAddress:t,sellTokenAddress:r,api_key:this.ctx.zapper}),e.next=5,fetch(a+"?"+s).then(K).then((function(e){return e.json()}));case 5:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}(),r.zapInApprovalTransaction=function(){var e=f(C.mark((function e(t,r,n,a){var s,i;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===a&&(a=exports.ZapProtocol.YEARN),s="https://api.zapper.fi/v1/zap-in/vault/"+a+"/approval-transaction",i=new URLSearchParams({gasPrice:n,ownerAddress:t,sellTokenAddress:r,api_key:this.ctx.zapper}),e.next=5,fetch(s+"?"+i).then(K).then((function(e){return e.json()}));case 5:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),r.zapOutApprovalState=function(){var e=f(C.mark((function e(t,r,n){var a,s;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===n&&(n=exports.ZapProtocol.YEARN),a="https://api.zapper.fi/v1/zap-out/vault/"+n+"/approval-state",s=new URLSearchParams({ownerAddress:t,sellTokenAddress:r,api_key:this.ctx.zapper}),e.next=5,fetch(a+"?"+s).then(K).then((function(e){return e.json()}));case 5:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}(),r.zapOutApprovalTransaction=function(){var e=f(C.mark((function e(t,r,n,a){var s,i;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===a&&(a=exports.ZapProtocol.YEARN),s="https://api.zapper.fi/v1/zap-out/vault/"+a+"/approval-transaction",i=new URLSearchParams({gasPrice:n,ownerAddress:t,sellTokenAddress:r,api_key:this.ctx.zapper}),e.next=5,fetch(s+"?"+i).then(K).then((function(e){return e.json()}));case 5:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),r.zapIn=function(){var e=f(C.mark((function e(t,r,n,a,s,i,u,c){var o,p,d;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===c&&(c=exports.ZapProtocol.YEARN),o=r,J===r&&(o=H),p="https://api.zapper.fi/v1/zap-in/vault/"+c+"/transaction",d=new URLSearchParams({affiliateAddress:"0xFEB4acf3df3cDEA7399794D0869ef76A6EfAff52",ownerAddress:t,sellTokenAddress:o,sellAmount:n,poolAddress:a,gasPrice:s,slippagePercentage:i.toString(),api_key:this.ctx.zapper,skipGasEstimate:u?"true":"false"}),e.next=7,fetch(p+"?"+d).then(K).then((function(e){return e.json()}));case 7:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,s,i,u,c){return e.apply(this,arguments)}}(),r.zapOut=function(){var e=f(C.mark((function e(t,r,n,a,s,i,u,c,o){var p,d,f;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===c&&(c=exports.ZapProtocol.YEARN),p=r,J===r&&(p=H),d="https://api.zapper.fi/v1/zap-out/vault/"+c+"/transaction",f=new URLSearchParams(v({affiliateAddress:"0xFEB4acf3df3cDEA7399794D0869ef76A6EfAff52",ownerAddress:t,toTokenAddress:p,sellAmount:n,poolAddress:a,gasPrice:s,slippagePercentage:i.toString(),api_key:this.ctx.zapper,shouldSellEntireBalance:"true",skipGasEstimate:u?"true":"false"},o&&{signature:o})),e.next=7,fetch(d+"?"+f).then(K).then((function(e){return e.json()}));case 7:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,s,i,u,c,o){return e.apply(this,arguments)}}(),t}(U),Fe=function(e){function t(t,r,n){return e.call(this,n,t,r)||this}return m(t,e),t.addressByChain=function(e){switch(e){case 250:return"0xD2322468e5Aa331381200754f6daAD3dF923539e";case 1:case 1337:case 42161:default:return null}},t.prototype.validateCalldata=function(){var e=f(C.mark((function e(r,n){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",{success:!1,error:"can't validate a tx that isn't targeting an address"});case 2:if(n){e.next=4;break}return e.abrupt("return",{success:!1,error:"can't validate a tx that has no call data"});case 4:return e.prev=4,e.next=7,this.contract.read.validateCalldataByOrigin(t.originName,r,n);case 7:if(e.sent){e.next=10;break}return e.abrupt("return",{success:!1,error:"tx is not permitted by the allow list"});case 10:return e.abrupt("return",{success:!0});case 13:return e.prev=13,e.t0=e.catch(4),e.abrupt("return",{success:!1,error:"failed to read from the allow list whether the transaction is valid"});case 16:case"end":return e.stop()}}),e,this,[[4,13]])})));return function(t,r){return e.apply(this,arguments)}}(),t}(j);Fe.abi=["function validateCalldataByOrigin(string memory originName, address targetAddress, bytes calldata data) public view returns (bool)"],Fe.originName="yearn.finance";var Ue=function(e){function t(r,n){var a;return e.call(this,null!=(a=n.addresses.helper)?a:t.addressByChain(r),r,n)||this}m(t,e),t.addressByChain=function(e){switch(e){case 1:case 1337:return"0x5AACD0D03096039aC4381CD814637e9FB7C34a6f";case 250:case 42161:return"0xE55Dd55b3355c261A048B3f310706C7478657d74"}};var r=t.prototype;return r.tokens=function(){var e=f(C.mark((function e(t,r){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r={}),e.next=3,this.contract.read.tokensMetadata(t,r).then(ke);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.tokenPrices=function(){var e=f(C.mark((function e(t,r){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r={}),e.next=3,this.contract.read.tokensPrices(t,r).then(ke);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.tokenBalances=function(){var e=f(C.mark((function e(t,r,n){var a,s,i=this;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===n&&(n={}),a=ee(r,30),s=a.map(function(){var e=f(C.mark((function e(r){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.contract.read.tokensBalances(t,r,n).then(ke));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",Promise.all(s).then((function(e){return e.flat()})));case 4:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),r.tokenAllowances=function(){var e=f(C.mark((function e(t,r,n,a){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===a&&(a={}),e.next=3,this.contract.read.allowances(t,r,n,a).then(ke);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),r.assetStrategiesAddresses=function(){var e=f(C.mark((function e(t,r){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r={}),e.abrupt("return",this.contract.read.assetStrategiesAddresses(t,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),t}(j);Ue.abi=["function tokensMetadata(address[] memory) public view returns (tuple(address address, string name, string symbol, uint256 decimals)[] memory)","function tokensPrices(address[] memory) public view returns (tuple(address address, uint256 priceUsdc)[] memory)","function tokensBalances(address, address[] memory) public view returns (tuple(\n  address address, \n  uint256 priceUsdc, \n  uint256 balance,\n  uint256 balanceUsdc\n)[] memory)","function allowances(address, address[] memory, address[] memory) external view returns (tuple(address owner, address spender, uint256 amount, address token)[] memory)","function assetStrategiesAddresses(address) public view returns (address[])"];var Le=function(e){function t(){return e.apply(this,arguments)||this}m(t,e);var r=t.prototype;return r.tokens=function(){var e=f(C.mark((function e(){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(this.buildUrl("tokens/{chain_id}/all")).then((function(e){return e.json()})));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.strategies=function(){var e=f(C.mark((function e(){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(this.buildUrl("strategies/{chain_id}/all")).then((function(e){return e.json()})));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.vaults=function(){var e=f(C.mark((function e(){return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(this.buildUrl("vaults/{chain_id}/all")).then((function(e){return e.json()})));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.buildUrl=function(e){return("https://meta.yearn.network/"+e).replace("{chain_id}",this.chainId.toString())},t}(U),ze=function(e){function t(t,r,n){var a;return(a=e.call(this,t,r)||this).allowListService=n,a}m(t,e);var r=t.prototype;return r.sendTransaction=function(){var e=f(C.mark((function e(t){var r,n,a;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.validateTx(t);case 2:if(n=(r=e.sent).error,r.success){e.next=7;break}throw new S(n||"transaction is not valid");case 7:return a=this.ctx.provider.write.getSigner(),e.abrupt("return",a.sendTransaction(t));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.validateTx=function(){var e=f(C.mark((function e(t){var r,n,a;return C.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.allowListService){e.next=2;break}return e.abrupt("return",Promise.resolve({success:!0,error:void 0}));case 2:return e.next=4,Promise.all([t.to,t.data]);case 4:return n=(r=e.sent)[0],a=r[1],e.next=9,this.allowListService.validateCalldata(n,a);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t}(U),je=function(){function e(e,t,r){this.context=new R(t);var n=Fe.addressByChain(e),a=n?new Fe(e,this.context,n):void 0;this.services={lens:new Ie(e,this.context),oracle:new Oe(e,this.context),zapper:new Ce(e,this.context),asset:new Te(e,this.context,r),vision:new Re(e,this.context),subgraph:new Ne(e,this.context),pickle:new re(e,this.context),helper:new Ue(e,this.context),telegram:new Be(e,this.context),meta:new Le(e,this.context),allowList:a,transaction:new ze(e,this.context,a)},this.vaults=new ve(this,e,this.context),this.tokens=new he(this,e,this.context),this.earnings=new Z(this,e,this.context),this.fees=new q(this,e,this.context),this.ironBank=new Y(this,e,this.context),this.simulation=new ce(this,e,this.context),this.strategies=new de(this,e,this.context),this.ready=Promise.all([this.services.asset.ready])}return e.prototype.setChainId=function(e){var t=Fe.addressByChain(e),r=t?new Fe(e,this.context,t):void 0;this.services={lens:new Ie(e,this.context),oracle:new Oe(e,this.context),zapper:new Ce(e,this.context),asset:new Te(e,this.context),vision:new Re(e,this.context),subgraph:new Ne(e,this.context),pickle:new re(e,this.context),helper:new Ue(e,this.context),telegram:new Be(e,this.context),meta:new Le(e,this.context),allowList:r,transaction:new ze(e,this.context,r)},this.vaults=new ve(this,e,this.context),this.tokens=new he(this,e,this.context),this.earnings=new Z(this,e,this.context),this.fees=new q(this,e,this.context),this.ironBank=new Y(this,e,this.context),this.simulation=new ce(this,e,this.context),this.strategies=new de(this,e,this.context),this.ready=Promise.all([this.services.asset.ready])},e}();exports.AssetService=Te,exports.Context=R,exports.CustomError=P,exports.EarningsInterface=Z,exports.EthersError=T,exports.FeesInterface=q,exports.IronBankAdapter=Ae,exports.IronBankInterface=Y,exports.LensService=Ie,exports.OracleService=Oe,exports.PriceFetchingError=N,exports.RegistryV2Adapter=Pe,exports.SdkError=S,exports.SimulationError=E,exports.SimulationInterface=ce,exports.StrategyInterface=de,exports.SubgraphService=Ne,exports.TelegramService=Be,exports.TenderlyError=I,exports.TokenInterface=he,exports.VaultInterface=ve,exports.VisionService=Re,exports.Yearn=je,exports.ZapperError=_,exports.ZapperService=Ce;
//# sourceMappingURL=sdk.cjs.production.min.js.map
