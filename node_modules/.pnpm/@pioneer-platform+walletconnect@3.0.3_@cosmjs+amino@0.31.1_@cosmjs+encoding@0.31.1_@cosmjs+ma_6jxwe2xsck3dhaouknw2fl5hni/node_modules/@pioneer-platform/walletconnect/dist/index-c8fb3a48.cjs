"use strict";const xt=require("events"),ht=require("./index-b3c97204.cjs"),$c=require("crypto"),jc=Symbol(),rn=Object.getPrototypeOf,Zi=new WeakMap,Bc=t=>t&&(Zi.has(t)?Zi.get(t):rn(t)===Object.prototype||rn(t)===Array.prototype),qc=t=>Bc(t)&&t[jc]||null,sn=(t,e=!0)=>{Zi.set(t,e)},Li=t=>typeof t=="object"&&t!==null,kt=new WeakMap,ci=new WeakSet,zc=(t=Object.is,e=(p,E)=>new Proxy(p,E),r=p=>Li(p)&&!ci.has(p)&&(Array.isArray(p)||!(Symbol.iterator in p))&&!(p instanceof WeakMap)&&!(p instanceof WeakSet)&&!(p instanceof Error)&&!(p instanceof Number)&&!(p instanceof Date)&&!(p instanceof String)&&!(p instanceof RegExp)&&!(p instanceof ArrayBuffer),i=p=>p.configurable&&p.enumerable&&p.writable,s=p=>{switch(p.status){case"fulfilled":return p.value;case"rejected":throw p.reason;default:throw p}},o=new WeakMap,u=(p,E,x=s)=>{const v=o.get(p);if((v==null?void 0:v[0])===E)return v[1];const I=Array.isArray(p)?[]:Object.create(Object.getPrototypeOf(p));return sn(I,!0),o.set(p,[E,I]),Reflect.ownKeys(p).forEach(N=>{if(Object.getOwnPropertyDescriptor(I,N))return;const P=Reflect.get(p,N),K={value:P,enumerable:!0,configurable:!0};if(ci.has(P))sn(P,!1);else if(P instanceof Promise)delete K.value,K.get=()=>x(P);else if(kt.has(P)){const[_,O]=kt.get(P);K.value=u(_,O(),x)}Object.defineProperty(I,N,K)}),Object.preventExtensions(I)},c=new WeakMap,h=[1,1],d=p=>{if(!Li(p))throw new Error("object required");const E=c.get(p);if(E)return E;let x=h[0];const v=new Set,I=(L,F=++h[0])=>{x!==F&&(x=F,v.forEach(z=>z(L,F)))};let N=h[1];const P=(L=++h[1])=>(N!==L&&!v.size&&(N=L,_.forEach(([F])=>{const z=F[1](L);z>x&&(x=z)})),x),K=L=>(F,z)=>{const b=[...F];b[1]=[L,...b[1]],I(b,z)},_=new Map,O=(L,F)=>{if(v.size){const z=F[3](K(L));_.set(L,[F,z])}else _.set(L,[F])},y=L=>{var F;const z=_.get(L);z&&(_.delete(L),(F=z[1])==null||F.call(z))},m=L=>(v.add(L),v.size===1&&_.forEach(([z,b],A)=>{const k=z[3](K(A));_.set(A,[z,k])}),()=>{v.delete(L),v.size===0&&_.forEach(([z,b],A)=>{b&&(b(),_.set(A,[z]))})}),f=Array.isArray(p)?[]:Object.create(Object.getPrototypeOf(p)),n=(L,F,z,b,A)=>{if(L&&(t(F,b)||c.has(b)&&t(F,c.get(b))))return;y(z),Li(b)&&(b=qc(b)||b);let k=b;if(b instanceof Promise)b.then(B=>{b.status="fulfilled",b.value=B,I(["resolve",[z],B])}).catch(B=>{b.status="rejected",b.reason=B,I(["reject",[z],B])});else{!kt.has(b)&&r(b)&&(k=d(b));const B=!ci.has(k)&&kt.get(k);B&&O(z,B)}A(k),I(["set",[z],b,F])},R=e(f,{deleteProperty(L,F){const z=Reflect.get(L,F);y(F);const b=Reflect.deleteProperty(L,F);return b&&I(["delete",[F],z]),b},set(L,F,z,b){const A=Reflect.has(L,F),k=Reflect.get(L,F,b);return n(A,k,F,z,B=>{Reflect.set(L,F,B,b)}),!0},defineProperty(L,F,z){if(i(z)){const b=Reflect.getOwnPropertyDescriptor(L,F);if(!b||i(b))return n(!!b&&"value"in b,b==null?void 0:b.value,F,z.value,A=>{Reflect.defineProperty(L,F,{...z,value:A})}),!0}return Reflect.defineProperty(L,F,z)}});c.set(p,R);const U=[f,P,u,m];return kt.set(R,U),Reflect.ownKeys(p).forEach(L=>{const F=Object.getOwnPropertyDescriptor(p,L);"value"in F&&(R[L]=p[L],delete F.value,delete F.writable),Object.defineProperty(f,L,F)}),R})=>[d,kt,ci,t,e,r,i,s,o,u,c,h],[Kc]=zc();function Xt(t={}){return Kc(t)}function dr(t,e,r){const i=kt.get(t);let s;const o=[],u=i[3];let c=!1;const d=u(p=>{if(o.push(p),r){e(o.splice(0));return}s||(s=Promise.resolve().then(()=>{s=void 0,c&&e(o.splice(0))}))});return c=!0,()=>{c=!1,d()}}function Vc(t,e){const r=kt.get(t),[i,s,o]=r;return o(i,s(),e)}const Xe=Xt({history:["ConnectWallet"],view:"ConnectWallet",data:void 0}),Es={state:Xe,subscribe(t){return dr(Xe,()=>t(Xe))},push(t,e){t!==Xe.view&&(Xe.view=t,e&&(Xe.data=e),Xe.history.push(t))},reset(t){Xe.view=t,Xe.history=[t]},replace(t){Xe.history.length>1&&(Xe.history[Xe.history.length-1]=t,Xe.view=t)},goBack(){if(Xe.history.length>1){Xe.history.pop();const[t]=Xe.history.slice(-1);Xe.view=t}},setData(t){Xe.data=t}},rt={WALLETCONNECT_DEEPLINK_CHOICE:"WALLETCONNECT_DEEPLINK_CHOICE",WCM_VERSION:"WCM_VERSION",RECOMMENDED_WALLET_AMOUNT:9,isMobile(){return typeof window<"u"?!!(window.matchMedia("(pointer:coarse)").matches||/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini/u.test(navigator.userAgent)):!1},isAndroid(){return rt.isMobile()&&navigator.userAgent.toLowerCase().includes("android")},isIos(){const t=navigator.userAgent.toLowerCase();return rt.isMobile()&&(t.includes("iphone")||t.includes("ipad"))},isHttpUrl(t){return t.startsWith("http://")||t.startsWith("https://")},isArray(t){return Array.isArray(t)&&t.length>0},formatNativeUrl(t,e,r){if(rt.isHttpUrl(t))return this.formatUniversalUrl(t,e,r);let i=t;i.includes("://")||(i=t.replaceAll("/","").replaceAll(":",""),i=`${i}://`),i.endsWith("/")||(i=`${i}/`),this.setWalletConnectDeepLink(i,r);const s=encodeURIComponent(e);return`${i}wc?uri=${s}`},formatUniversalUrl(t,e,r){if(!rt.isHttpUrl(t))return this.formatNativeUrl(t,e,r);let i=t;i.endsWith("/")||(i=`${i}/`),this.setWalletConnectDeepLink(i,r);const s=encodeURIComponent(e);return`${i}wc?uri=${s}`},async wait(t){return new Promise(e=>{setTimeout(e,t)})},openHref(t,e){window.open(t,e,"noreferrer noopener")},setWalletConnectDeepLink(t,e){try{localStorage.setItem(rt.WALLETCONNECT_DEEPLINK_CHOICE,JSON.stringify({href:t,name:e}))}catch{console.info("Unable to set WalletConnect deep link")}},setWalletConnectAndroidDeepLink(t){try{const[e]=t.split("?");localStorage.setItem(rt.WALLETCONNECT_DEEPLINK_CHOICE,JSON.stringify({href:e,name:"Android"}))}catch{console.info("Unable to set WalletConnect android deep link")}},removeWalletConnectDeepLink(){try{localStorage.removeItem(rt.WALLETCONNECT_DEEPLINK_CHOICE)}catch{console.info("Unable to remove WalletConnect deep link")}},setModalVersionInStorage(){try{typeof localStorage<"u"&&localStorage.setItem(rt.WCM_VERSION,"2.6.1")}catch{console.info("Unable to set Web3Modal version in storage")}},getWalletRouterData(){var t;const e=(t=Es.state.data)==null?void 0:t.Wallet;if(!e)throw new Error('Missing "Wallet" view data');return e}},Hc=typeof location<"u"&&(location.hostname.includes("localhost")||location.protocol.includes("https")),ot=Xt({enabled:Hc,userSessionId:"",events:[],connectedWalletId:void 0}),$o={state:ot,subscribe(t){return dr(ot.events,()=>t(Vc(ot.events[ot.events.length-1])))},initialize(){ot.enabled&&typeof(crypto==null?void 0:crypto.randomUUID)<"u"&&(ot.userSessionId=crypto.randomUUID())},setConnectedWalletId(t){ot.connectedWalletId=t},click(t){if(ot.enabled){const e={type:"CLICK",name:t.name,userSessionId:ot.userSessionId,timestamp:Date.now(),data:t};ot.events.push(e)}},track(t){if(ot.enabled){const e={type:"TRACK",name:t.name,userSessionId:ot.userSessionId,timestamp:Date.now(),data:t};ot.events.push(e)}},view(t){if(ot.enabled){const e={type:"VIEW",name:t.name,userSessionId:ot.userSessionId,timestamp:Date.now(),data:t};ot.events.push(e)}}},Rt=Xt({chains:void 0,walletConnectUri:void 0,isAuth:!1,isCustomDesktop:!1,isCustomMobile:!1,isDataLoaded:!1,isUiLoaded:!1}),It={state:Rt,subscribe(t){return dr(Rt,()=>t(Rt))},setChains(t){Rt.chains=t},setWalletConnectUri(t){Rt.walletConnectUri=t},setIsCustomDesktop(t){Rt.isCustomDesktop=t},setIsCustomMobile(t){Rt.isCustomMobile=t},setIsDataLoaded(t){Rt.isDataLoaded=t},setIsUiLoaded(t){Rt.isUiLoaded=t},setIsAuth(t){Rt.isAuth=t}},ui=Xt({projectId:"",mobileWallets:void 0,desktopWallets:void 0,walletImages:void 0,chains:void 0,enableAuthMode:!1,enableExplorer:!0,explorerExcludedWalletIds:void 0,explorerRecommendedWalletIds:void 0,termsOfServiceUrl:void 0,privacyPolicyUrl:void 0}),fr={state:ui,subscribe(t){return dr(ui,()=>t(ui))},setConfig(t){var e,r;$o.initialize(),It.setChains(t.chains),It.setIsAuth(!!t.enableAuthMode),It.setIsCustomMobile(!!((e=t.mobileWallets)!=null&&e.length)),It.setIsCustomDesktop(!!((r=t.desktopWallets)!=null&&r.length)),rt.setModalVersionInStorage(),Object.assign(ui,t)}};var Wc=Object.defineProperty,nn=Object.getOwnPropertySymbols,kc=Object.prototype.hasOwnProperty,Gc=Object.prototype.propertyIsEnumerable,on=(t,e,r)=>e in t?Wc(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Yc=(t,e)=>{for(var r in e||(e={}))kc.call(e,r)&&on(t,r,e[r]);if(nn)for(var r of nn(e))Gc.call(e,r)&&on(t,r,e[r]);return t};const es="https://explorer-api.walletconnect.com",ts="wcm",rs="js-2.6.1";async function hi(t,e){const r=Yc({sdkType:ts,sdkVersion:rs},e),i=new URL(t,es);return i.searchParams.append("projectId",fr.state.projectId),Object.entries(r).forEach(([s,o])=>{o&&i.searchParams.append(s,String(o))}),(await fetch(i)).json()}const ir={async getDesktopListings(t){return hi("/w3m/v1/getDesktopListings",t)},async getMobileListings(t){return hi("/w3m/v1/getMobileListings",t)},async getInjectedListings(t){return hi("/w3m/v1/getInjectedListings",t)},async getAllListings(t){return hi("/w3m/v1/getAllListings",t)},getWalletImageUrl(t){return`${es}/w3m/v1/getWalletImage/${t}?projectId=${fr.state.projectId}&sdkType=${ts}&sdkVersion=${rs}`},getAssetImageUrl(t){return`${es}/w3m/v1/getAssetImage/${t}?projectId=${fr.state.projectId}&sdkType=${ts}&sdkVersion=${rs}`}};var Jc=Object.defineProperty,an=Object.getOwnPropertySymbols,Xc=Object.prototype.hasOwnProperty,Qc=Object.prototype.propertyIsEnumerable,cn=(t,e,r)=>e in t?Jc(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Zc=(t,e)=>{for(var r in e||(e={}))Xc.call(e,r)&&cn(t,r,e[r]);if(an)for(var r of an(e))Qc.call(e,r)&&cn(t,r,e[r]);return t};const un=rt.isMobile(),Ut=Xt({wallets:{listings:[],total:0,page:1},search:{listings:[],total:0,page:1},recomendedWallets:[]}),eu={state:Ut,async getRecomendedWallets(){const{explorerRecommendedWalletIds:t,explorerExcludedWalletIds:e}=fr.state;if(t==="NONE"||e==="ALL"&&!t)return Ut.recomendedWallets;if(rt.isArray(t)){const r={recommendedIds:t.join(",")},{listings:i}=await ir.getAllListings(r),s=Object.values(i);s.sort((o,u)=>{const c=t.indexOf(o.id),h=t.indexOf(u.id);return c-h}),Ut.recomendedWallets=s}else{const{chains:r,isAuth:i}=It.state,s=r==null?void 0:r.join(","),o=rt.isArray(e),u={page:1,sdks:i?"auth_v1":void 0,entries:rt.RECOMMENDED_WALLET_AMOUNT,chains:s,version:2,excludedIds:o?e.join(","):void 0},{listings:c}=un?await ir.getMobileListings(u):await ir.getDesktopListings(u);Ut.recomendedWallets=Object.values(c)}return Ut.recomendedWallets},async getWallets(t){const e=Zc({},t),{explorerRecommendedWalletIds:r,explorerExcludedWalletIds:i}=fr.state,{recomendedWallets:s}=Ut;if(i==="ALL")return Ut.wallets;s.length?e.excludedIds=s.map(E=>E.id).join(","):rt.isArray(r)&&(e.excludedIds=r.join(",")),rt.isArray(i)&&(e.excludedIds=[e.excludedIds,i].filter(Boolean).join(",")),It.state.isAuth&&(e.sdks="auth_v1");const{page:o,search:u}=t,{listings:c,total:h}=un?await ir.getMobileListings(e):await ir.getDesktopListings(e),d=Object.values(c),p=u?"search":"wallets";return Ut[p]={listings:[...Ut[p].listings,...d],total:h,page:o??1},{listings:d,total:h}},getWalletImageUrl(t){return ir.getWalletImageUrl(t)},getAssetImageUrl(t){return ir.getAssetImageUrl(t)},resetSearch(){Ut.search={listings:[],total:0,page:1}}},wr=Xt({open:!1}),fi={state:wr,subscribe(t){return dr(wr,()=>t(wr))},async open(t){return new Promise(e=>{const{isUiLoaded:r,isDataLoaded:i}=It.state;if(rt.removeWalletConnectDeepLink(),It.setWalletConnectUri(t==null?void 0:t.uri),It.setChains(t==null?void 0:t.chains),Es.reset("ConnectWallet"),r&&i)wr.open=!0,e();else{const s=setInterval(()=>{const o=It.state;o.isUiLoaded&&o.isDataLoaded&&(clearInterval(s),wr.open=!0,e())},200)}})},close(){wr.open=!1}};var tu=Object.defineProperty,hn=Object.getOwnPropertySymbols,ru=Object.prototype.hasOwnProperty,iu=Object.prototype.propertyIsEnumerable,ln=(t,e,r)=>e in t?tu(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,su=(t,e)=>{for(var r in e||(e={}))ru.call(e,r)&&ln(t,r,e[r]);if(hn)for(var r of hn(e))iu.call(e,r)&&ln(t,r,e[r]);return t};function nu(){return typeof matchMedia<"u"&&matchMedia("(prefers-color-scheme: dark)").matches}const Nr=Xt({themeMode:nu()?"dark":"light"}),is={state:Nr,subscribe(t){return dr(Nr,()=>t(Nr))},setThemeConfig(t){const{themeMode:e,themeVariables:r}=t;e&&(Nr.themeMode=e),r&&(Nr.themeVariables=su({},r))}},sr=Xt({open:!1,message:"",variant:"success"}),ou={state:sr,subscribe(t){return dr(sr,()=>t(sr))},openToast(t,e){sr.open=!0,sr.message=t,sr.variant=e},closeToast(){sr.open=!1}};let au=class{constructor(e){this.openModal=fi.open,this.closeModal=fi.close,this.subscribeModal=fi.subscribe,this.setTheme=is.setThemeConfig,is.setThemeConfig(e),fr.setConfig(e),this.initUi()}async initUi(){if(typeof window<"u"){await Promise.resolve().then(()=>require("./index-af716c32.cjs"));const e=document.createElement("wcm-modal");document.body.insertAdjacentElement("beforeend",e),It.setIsUiLoaded(!0)}}};var Di={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var ss=function(t,e){return ss=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},ss(t,e)};function cu(t,e){ss(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var ns=function(){return ns=Object.assign||function(e){for(var r,i=1,s=arguments.length;i<s;i++){r=arguments[i];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},ns.apply(this,arguments)};function uu(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r}function hu(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(u=t[c])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o}function lu(t,e){return function(r,i){e(r,i,t)}}function fu(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function du(t,e,r,i){function s(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function c(p){try{d(i.next(p))}catch(E){u(E)}}function h(p){try{d(i.throw(p))}catch(E){u(E)}}function d(p){p.done?o(p.value):s(p.value).then(c,h)}d((i=i.apply(t,e||[])).next())})}function pu(t,e){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,s,o,u;return u={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function c(d){return function(p){return h([d,p])}}function h(d){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,s&&(o=d[0]&2?s.return:d[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,d[1])).done)return o;switch(s=0,o&&(d=[d[0]&2,o.value]),d[0]){case 0:case 1:o=d;break;case 4:return r.label++,{value:d[1],done:!1};case 5:r.label++,s=d[1],d=[0];continue;case 7:d=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(d[0]===6||d[0]===2)){r=0;continue}if(d[0]===3&&(!o||d[1]>o[0]&&d[1]<o[3])){r.label=d[1];break}if(d[0]===6&&r.label<o[1]){r.label=o[1],o=d;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(d);break}o[2]&&r.ops.pop(),r.trys.pop();continue}d=e.call(t,r)}catch(p){d=[6,p],s=0}finally{i=o=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}}function gu(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function yu(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function os(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function jo(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),s,o=[],u;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)o.push(s.value)}catch(c){u={error:c}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(u)throw u.error}}return o}function bu(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(jo(arguments[e]));return t}function wu(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),s=0,e=0;e<r;e++)for(var o=arguments[e],u=0,c=o.length;u<c;u++,s++)i[s]=o[u];return i}function kr(t){return this instanceof kr?(this.v=t,this):new kr(t)}function mu(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),s,o=[];return s={},u("next"),u("throw"),u("return"),s[Symbol.asyncIterator]=function(){return this},s;function u(x){i[x]&&(s[x]=function(v){return new Promise(function(I,N){o.push([x,v,I,N])>1||c(x,v)})})}function c(x,v){try{h(i[x](v))}catch(I){E(o[0][3],I)}}function h(x){x.value instanceof kr?Promise.resolve(x.value.v).then(d,p):E(o[0][2],x)}function d(x){c("next",x)}function p(x){c("throw",x)}function E(x,v){x(v),o.shift(),o.length&&c(o[0][0],o[0][1])}}function _u(t){var e,r;return e={},i("next"),i("throw",function(s){throw s}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(s,o){e[s]=t[s]?function(u){return(r=!r)?{value:kr(t[s](u)),done:s==="return"}:o?o(u):u}:o}}function vu(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof os=="function"?os(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(o){r[o]=t[o]&&function(u){return new Promise(function(c,h){u=t[o](u),s(c,h,u.done,u.value)})}}function s(o,u,c,h){Promise.resolve(h).then(function(d){o({value:d,done:c})},u)}}function Eu(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function Du(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function Su(t){return t&&t.__esModule?t:{default:t}}function Iu(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function xu(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}const Ou=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return ns},__asyncDelegator:_u,__asyncGenerator:mu,__asyncValues:vu,__await:kr,__awaiter:du,__classPrivateFieldGet:Iu,__classPrivateFieldSet:xu,__createBinding:gu,__decorate:hu,__exportStar:yu,__extends:cu,__generator:pu,__importDefault:Su,__importStar:Du,__makeTemplateObject:Eu,__metadata:fu,__param:lu,__read:jo,__rest:uu,__spread:bu,__spreadArrays:wu,__values:os},Symbol.toStringTag,{value:"Module"})),Ot=ht.getAugmentedNamespace(Ou);var Yr={};Object.defineProperty(Yr,"__esModule",{value:!0});function Au(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return JSON.parse(t)}catch{return t}}Yr.safeJsonParse=Au;function Cu(t){return typeof t=="string"?t:JSON.stringify(t,(e,r)=>typeof r>"u"?null:r)}Yr.safeJsonStringify=Cu;var Pr={exports:{}},fn;function Tu(){return fn||(fn=1,function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,i){this[r]=String(i)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(i){r[i]=void 0,delete r[i]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof ht.commonjsGlobal<"u"&&ht.commonjsGlobal.localStorage?Pr.exports=ht.commonjsGlobal.localStorage:typeof window<"u"&&window.localStorage?Pr.exports=window.localStorage:Pr.exports=new e}()),Pr.exports}var Fi={},Rr={},dn;function Nu(){if(dn)return Rr;dn=1,Object.defineProperty(Rr,"__esModule",{value:!0}),Rr.IKeyValueStorage=void 0;class t{}return Rr.IKeyValueStorage=t,Rr}var Ur={},pn;function Pu(){if(pn)return Ur;pn=1,Object.defineProperty(Ur,"__esModule",{value:!0}),Ur.parseEntry=void 0;const t=Yr;function e(r){var i;return[r[0],t.safeJsonParse((i=r[1])!==null&&i!==void 0?i:"")]}return Ur.parseEntry=e,Ur}var gn;function Ru(){return gn||(gn=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ot;e.__exportStar(Nu(),t),e.__exportStar(Pu(),t)}(Fi)),Fi}Object.defineProperty(Di,"__esModule",{value:!0});Di.KeyValueStorage=void 0;const _r=Ot,yn=Yr,Uu=_r.__importDefault(Tu()),Lu=Ru();class Bo{constructor(){this.localStorage=Uu.default}getKeys(){return _r.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return _r.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(Lu.parseEntry)})}getItem(e){return _r.__awaiter(this,void 0,void 0,function*(){const r=this.localStorage.getItem(e);if(r!==null)return yn.safeJsonParse(r)})}setItem(e,r){return _r.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(e,yn.safeJsonStringify(r))})}removeItem(e){return _r.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(e)})}}Di.KeyValueStorage=Bo;var Fu=Di.default=Bo,Sr={},Lr={},Q={},Mi={},Fr={},bn;function Mu(){if(bn)return Fr;bn=1,Object.defineProperty(Fr,"__esModule",{value:!0}),Fr.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return Fr.delay=t,Fr}var nr={},$i={},or={},wn;function $u(){return wn||(wn=1,Object.defineProperty(or,"__esModule",{value:!0}),or.ONE_THOUSAND=or.ONE_HUNDRED=void 0,or.ONE_HUNDRED=100,or.ONE_THOUSAND=1e3),or}var ji={},mn;function ju(){return mn||(mn=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(ji)),ji}var _n;function qo(){return _n||(_n=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ot;e.__exportStar($u(),t),e.__exportStar(ju(),t)}($i)),$i}var vn;function Bu(){if(vn)return nr;vn=1,Object.defineProperty(nr,"__esModule",{value:!0}),nr.fromMiliseconds=nr.toMiliseconds=void 0;const t=qo();function e(i){return i*t.ONE_THOUSAND}nr.toMiliseconds=e;function r(i){return Math.floor(i/t.ONE_THOUSAND)}return nr.fromMiliseconds=r,nr}var En;function qu(){return En||(En=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ot;e.__exportStar(Mu(),t),e.__exportStar(Bu(),t)}(Mi)),Mi}var mr={},Dn;function zu(){if(Dn)return mr;Dn=1,Object.defineProperty(mr,"__esModule",{value:!0}),mr.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const i=this.get(r);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const s=Date.now()-i.started;this.timestamps.set(r,{started:i.started,elapsed:s})}get(r){const i=this.timestamps.get(r);if(typeof i>"u")throw new Error(`No timestamp found for label: ${r}`);return i}elapsed(r){const i=this.get(r);return i.elapsed||Date.now()-i.started}}return mr.Watch=t,mr.default=t,mr}var Bi={},Mr={},Sn;function Ku(){if(Sn)return Mr;Sn=1,Object.defineProperty(Mr,"__esModule",{value:!0}),Mr.IWatch=void 0;class t{}return Mr.IWatch=t,Mr}var In;function Vu(){return In||(In=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Ot.__exportStar(Ku(),t)}(Bi)),Bi}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ot;e.__exportStar(qu(),t),e.__exportStar(zu(),t),e.__exportStar(Vu(),t),e.__exportStar(qo(),t)})(Q);var qi={},$r={};let pr=class{};const Hu=Object.freeze(Object.defineProperty({__proto__:null,IEvents:pr},Symbol.toStringTag,{value:"Module"})),Wu=ht.getAugmentedNamespace(Hu);var xn;function ku(){if(xn)return $r;xn=1,Object.defineProperty($r,"__esModule",{value:!0}),$r.IHeartBeat=void 0;const t=Wu;class e extends t.IEvents{constructor(i){super()}}return $r.IHeartBeat=e,$r}var On;function zo(){return On||(On=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Ot.__exportStar(ku(),t)}(qi)),qi}var zi={},ar={},An;function Gu(){if(An)return ar;An=1,Object.defineProperty(ar,"__esModule",{value:!0}),ar.HEARTBEAT_EVENTS=ar.HEARTBEAT_INTERVAL=void 0;const t=Q;return ar.HEARTBEAT_INTERVAL=t.FIVE_SECONDS,ar.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},ar}var Cn;function Ko(){return Cn||(Cn=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Ot.__exportStar(Gu(),t)}(zi)),zi}var Tn;function Yu(){if(Tn)return Lr;Tn=1,Object.defineProperty(Lr,"__esModule",{value:!0}),Lr.HeartBeat=void 0;const t=Ot,e=xt,r=Q,i=zo(),s=Ko();class o extends i.IHeartBeat{constructor(c){super(c),this.events=new e.EventEmitter,this.interval=s.HEARTBEAT_INTERVAL,this.interval=(c==null?void 0:c.interval)||s.HEARTBEAT_INTERVAL}static init(c){return t.__awaiter(this,void 0,void 0,function*(){const h=new o(c);return yield h.init(),h})}init(){return t.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(c,h){this.events.on(c,h)}once(c,h){this.events.once(c,h)}off(c,h){this.events.off(c,h)}removeListener(c,h){this.events.removeListener(c,h)}initialize(){return t.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(s.HEARTBEAT_EVENTS.pulse)}}return Lr.HeartBeat=o,Lr}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ot;e.__exportStar(Yu(),t),e.__exportStar(zo(),t),e.__exportStar(Ko(),t)})(Sr);var me={},Ki,Nn;function Ju(){if(Nn)return Ki;Nn=1;function t(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}Ki=e;function e(r,i,s){var o=s&&s.stringify||t,u=1;if(typeof r=="object"&&r!==null){var c=i.length+u;if(c===1)return r;var h=new Array(c);h[0]=o(r);for(var d=1;d<c;d++)h[d]=o(i[d]);return h.join(" ")}if(typeof r!="string")return r;var p=i.length;if(p===0)return r;for(var E="",x=1-u,v=-1,I=r&&r.length||0,N=0;N<I;){if(r.charCodeAt(N)===37&&N+1<I){switch(v=v>-1?v:0,r.charCodeAt(N+1)){case 100:case 102:if(x>=p||i[x]==null)break;v<N&&(E+=r.slice(v,N)),E+=Number(i[x]),v=N+2,N++;break;case 105:if(x>=p||i[x]==null)break;v<N&&(E+=r.slice(v,N)),E+=Math.floor(Number(i[x])),v=N+2,N++;break;case 79:case 111:case 106:if(x>=p||i[x]===void 0)break;v<N&&(E+=r.slice(v,N));var P=typeof i[x];if(P==="string"){E+="'"+i[x]+"'",v=N+2,N++;break}if(P==="function"){E+=i[x].name||"<anonymous>",v=N+2,N++;break}E+=o(i[x]),v=N+2,N++;break;case 115:if(x>=p)break;v<N&&(E+=r.slice(v,N)),E+=String(i[x]),v=N+2,N++;break;case 37:v<N&&(E+=r.slice(v,N)),E+="%",v=N+2,N++,x--;break}++x}++N}return v===-1?r:(v<I&&(E+=r.slice(v)),E)}return Ki}var Vi,Pn;function Xu(){if(Pn)return Vi;Pn=1;const t=Ju();Vi=s;const e=m().console||{},r={mapHttpRequest:I,mapHttpResponse:I,wrapRequestSerializer:N,wrapResponseSerializer:N,wrapErrorSerializer:N,req:I,res:I,err:x};function i(f,n){return Array.isArray(f)?f.filter(function(R){return R!=="!stdSerializers.err"}):f===!0?Object.keys(n):!1}function s(f){f=f||{},f.browser=f.browser||{};const n=f.browser.transmit;if(n&&typeof n.send!="function")throw Error("pino: transmit option must have a send function");const l=f.browser.write||e;f.browser.write&&(f.browser.asObject=!0);const R=f.serializers||{},U=i(f.browser.serialize,R);let L=f.browser.serialize;Array.isArray(f.browser.serialize)&&f.browser.serialize.indexOf("!stdSerializers.err")>-1&&(L=!1);const F=["error","fatal","warn","info","debug","trace"];typeof l=="function"&&(l.error=l.fatal=l.warn=l.info=l.debug=l.trace=l),f.enabled===!1&&(f.level="silent");const z=f.level||"info",b=Object.create(l);b.log||(b.log=P),Object.defineProperty(b,"levelVal",{get:k}),Object.defineProperty(b,"level",{get:B,set:$});const A={transmit:n,serialize:U,asObject:f.browser.asObject,levels:F,timestamp:v(f)};b.levels=s.levels,b.level=z,b.setMaxListeners=b.getMaxListeners=b.emit=b.addListener=b.on=b.prependListener=b.once=b.prependOnceListener=b.removeListener=b.removeAllListeners=b.listeners=b.listenerCount=b.eventNames=b.write=b.flush=P,b.serializers=R,b._serialize=U,b._stdErrSerialize=L,b.child=q,n&&(b._logEvent=E());function k(){return this.level==="silent"?1/0:this.levels.values[this.level]}function B(){return this._level}function $(M){if(M!=="silent"&&!this.levels.values[M])throw Error("unknown level "+M);this._level=M,o(A,b,"error","log"),o(A,b,"fatal","error"),o(A,b,"warn","error"),o(A,b,"info","log"),o(A,b,"debug","log"),o(A,b,"trace","log")}function q(M,V){if(!M)throw new Error("missing bindings for child Pino");V=V||{},U&&M.serializers&&(V.serializers=M.serializers);const te=V.serializers;if(U&&te){var H=Object.assign({},R,te),Z=f.browser.serialize===!0?Object.keys(H):U;delete M.serializers,h([M],Z,H,this._stdErrSerialize)}function J(ee){this._childLevel=(ee._childLevel|0)+1,this.error=d(ee,M,"error"),this.fatal=d(ee,M,"fatal"),this.warn=d(ee,M,"warn"),this.info=d(ee,M,"info"),this.debug=d(ee,M,"debug"),this.trace=d(ee,M,"trace"),H&&(this.serializers=H,this._serialize=Z),n&&(this._logEvent=E([].concat(ee._logEvent.bindings,M)))}return J.prototype=this,new J(this)}return b}s.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},s.stdSerializers=r,s.stdTimeFunctions=Object.assign({},{nullTime:K,epochTime:_,unixTime:O,isoTime:y});function o(f,n,l,R){const U=Object.getPrototypeOf(n);n[l]=n.levelVal>n.levels.values[l]?P:U[l]?U[l]:e[l]||e[R]||P,u(f,n,l)}function u(f,n,l){!f.transmit&&n[l]===P||(n[l]=function(R){return function(){const L=f.timestamp(),F=new Array(arguments.length),z=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var b=0;b<F.length;b++)F[b]=arguments[b];if(f.serialize&&!f.asObject&&h(F,this._serialize,this.serializers,this._stdErrSerialize),f.asObject?R.call(z,c(this,l,F,L)):R.apply(z,F),f.transmit){const A=f.transmit.level||n.level,k=s.levels.values[A],B=s.levels.values[l];if(B<k)return;p(this,{ts:L,methodLevel:l,methodValue:B,transmitLevel:A,transmitValue:s.levels.values[f.transmit.level||n.level],send:f.transmit.send,val:n.levelVal},F)}}}(n[l]))}function c(f,n,l,R){f._serialize&&h(l,f._serialize,f.serializers,f._stdErrSerialize);const U=l.slice();let L=U[0];const F={};R&&(F.time=R),F.level=s.levels.values[n];let z=(f._childLevel|0)+1;if(z<1&&(z=1),L!==null&&typeof L=="object"){for(;z--&&typeof U[0]=="object";)Object.assign(F,U.shift());L=U.length?t(U.shift(),U):void 0}else typeof L=="string"&&(L=t(U.shift(),U));return L!==void 0&&(F.msg=L),F}function h(f,n,l,R){for(const U in f)if(R&&f[U]instanceof Error)f[U]=s.stdSerializers.err(f[U]);else if(typeof f[U]=="object"&&!Array.isArray(f[U]))for(const L in f[U])n&&n.indexOf(L)>-1&&L in l&&(f[U][L]=l[L](f[U][L]))}function d(f,n,l){return function(){const R=new Array(1+arguments.length);R[0]=n;for(var U=1;U<R.length;U++)R[U]=arguments[U-1];return f[l].apply(this,R)}}function p(f,n,l){const R=n.send,U=n.ts,L=n.methodLevel,F=n.methodValue,z=n.val,b=f._logEvent.bindings;h(l,f._serialize||Object.keys(f.serializers),f.serializers,f._stdErrSerialize===void 0?!0:f._stdErrSerialize),f._logEvent.ts=U,f._logEvent.messages=l.filter(function(A){return b.indexOf(A)===-1}),f._logEvent.level.label=L,f._logEvent.level.value=F,R(L,f._logEvent,z),f._logEvent=E(b)}function E(f){return{ts:0,messages:[],bindings:f||[],level:{label:"",value:0}}}function x(f){const n={type:f.constructor.name,msg:f.message,stack:f.stack};for(const l in f)n[l]===void 0&&(n[l]=f[l]);return n}function v(f){return typeof f.timestamp=="function"?f.timestamp:f.timestamp===!1?K:_}function I(){return{}}function N(f){return f}function P(){}function K(){return!1}function _(){return Date.now()}function O(){return Math.round(Date.now()/1e3)}function y(){return new Date(Date.now()).toISOString()}function m(){function f(n){return typeof n<"u"&&n}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return f(self)||f(window)||f(this)||{}}}return Vi}var cr={},Rn;function Vo(){return Rn||(Rn=1,Object.defineProperty(cr,"__esModule",{value:!0}),cr.PINO_CUSTOM_CONTEXT_KEY=cr.PINO_LOGGER_DEFAULTS=void 0,cr.PINO_LOGGER_DEFAULTS={level:"info"},cr.PINO_CUSTOM_CONTEXT_KEY="custom_context"),cr}var lt={},Un;function Qu(){if(Un)return lt;Un=1,Object.defineProperty(lt,"__esModule",{value:!0}),lt.generateChildLogger=lt.formatChildLoggerContext=lt.getLoggerContext=lt.setBrowserLoggerContext=lt.getBrowserLoggerContext=lt.getDefaultLoggerOptions=void 0;const t=Vo();function e(c){return Object.assign(Object.assign({},c),{level:(c==null?void 0:c.level)||t.PINO_LOGGER_DEFAULTS.level})}lt.getDefaultLoggerOptions=e;function r(c,h=t.PINO_CUSTOM_CONTEXT_KEY){return c[h]||""}lt.getBrowserLoggerContext=r;function i(c,h,d=t.PINO_CUSTOM_CONTEXT_KEY){return c[d]=h,c}lt.setBrowserLoggerContext=i;function s(c,h=t.PINO_CUSTOM_CONTEXT_KEY){let d="";return typeof c.bindings>"u"?d=r(c,h):d=c.bindings().context||"",d}lt.getLoggerContext=s;function o(c,h,d=t.PINO_CUSTOM_CONTEXT_KEY){const p=s(c,d);return p.trim()?`${p}/${h}`:h}lt.formatChildLoggerContext=o;function u(c,h,d=t.PINO_CUSTOM_CONTEXT_KEY){const p=o(c,h,d),E=c.child({context:p});return i(E,p,d)}return lt.generateChildLogger=u,lt}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.pino=void 0;const e=Ot,r=e.__importDefault(Xu());Object.defineProperty(t,"pino",{enumerable:!0,get:function(){return r.default}}),e.__exportStar(Vo(),t),e.__exportStar(Qu(),t)})(me);let Zu=class extends pr{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}},eh=class extends pr{constructor(e,r){super(),this.core=e,this.logger=r,this.records=new Map}},th=class{constructor(e,r){this.logger=e,this.core=r}},rh=class extends pr{constructor(e,r){super(),this.relayer=e,this.logger=r}},ih=class extends pr{constructor(e){super()}},sh=class{constructor(e,r,i,s){this.core=e,this.logger=r,this.name=i}};class nh extends pr{constructor(e,r){super(),this.relayer=e,this.logger=r}}class oh extends pr{constructor(e,r){super(),this.core=e,this.logger=r}}let ah=class{constructor(e,r){this.projectId=e,this.logger=r}},ch=class{constructor(e){this.opts=e,this.protocol="wc",this.version=2}},uh=class{constructor(e){this.client=e}};const hh=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),lh=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(i,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function Ho(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return lh(t)}catch{return t}}function Ds(t){return typeof t=="string"?t:hh(t)||""}var Ss={},Ir={},Si={},Ii={};Object.defineProperty(Ii,"__esModule",{value:!0});Ii.BrowserRandomSource=void 0;const Ln=65536;class fh{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const e=typeof self<"u"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const r=new Uint8Array(e);for(let i=0;i<r.length;i+=Ln)this._crypto.getRandomValues(r.subarray(i,i+Math.min(r.length-i,Ln)));return r}}Ii.BrowserRandomSource=fh;function dh(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var xi={},_t={};Object.defineProperty(_t,"__esModule",{value:!0});function ph(t){for(var e=0;e<t.length;e++)t[e]=0;return t}_t.wipe=ph;Object.defineProperty(xi,"__esModule",{value:!0});xi.NodeRandomSource=void 0;const gh=_t;class yh{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof dh<"u"){const e=$c;e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let r=this._crypto.randomBytes(e);if(r.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");const i=new Uint8Array(e);for(let s=0;s<i.length;s++)i[s]=r[s];return(0,gh.wipe)(r),i}}xi.NodeRandomSource=yh;Object.defineProperty(Si,"__esModule",{value:!0});Si.SystemRandomSource=void 0;const bh=Ii,wh=xi;class mh{constructor(){if(this.isAvailable=!1,this.name="",this._source=new bh.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new wh.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}}Si.SystemRandomSource=mh;var se={},Wo={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});function e(c,h){var d=c>>>16&65535,p=c&65535,E=h>>>16&65535,x=h&65535;return p*x+(d*x+p*E<<16>>>0)|0}t.mul=Math.imul||e;function r(c,h){return c+h|0}t.add=r;function i(c,h){return c-h|0}t.sub=i;function s(c,h){return c<<h|c>>>32-h}t.rotl=s;function o(c,h){return c<<32-h|c>>>h}t.rotr=o;function u(c){return typeof c=="number"&&isFinite(c)&&Math.floor(c)===c}t.isInteger=Number.isInteger||u,t.MAX_SAFE_INTEGER=9007199254740991,t.isSafeInteger=function(c){return t.isInteger(c)&&c>=-t.MAX_SAFE_INTEGER&&c<=t.MAX_SAFE_INTEGER}})(Wo);Object.defineProperty(se,"__esModule",{value:!0});var ko=Wo;function _h(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])<<16>>16}se.readInt16BE=_h;function vh(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])>>>0}se.readUint16BE=vh;function Eh(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])<<16>>16}se.readInt16LE=Eh;function Dh(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])>>>0}se.readUint16LE=Dh;function Go(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>8,e[r+1]=t>>>0,e}se.writeUint16BE=Go;se.writeInt16BE=Go;function Yo(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e}se.writeUint16LE=Yo;se.writeInt16LE=Yo;function as(t,e){return e===void 0&&(e=0),t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}se.readInt32BE=as;function cs(t,e){return e===void 0&&(e=0),(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}se.readUint32BE=cs;function us(t,e){return e===void 0&&(e=0),t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}se.readInt32LE=us;function hs(t,e){return e===void 0&&(e=0),(t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e])>>>0}se.readUint32LE=hs;function gi(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>24,e[r+1]=t>>>16,e[r+2]=t>>>8,e[r+3]=t>>>0,e}se.writeUint32BE=gi;se.writeInt32BE=gi;function yi(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24,e}se.writeUint32LE=yi;se.writeInt32LE=yi;function Sh(t,e){e===void 0&&(e=0);var r=as(t,e),i=as(t,e+4);return r*4294967296+i-(i>>31)*4294967296}se.readInt64BE=Sh;function Ih(t,e){e===void 0&&(e=0);var r=cs(t,e),i=cs(t,e+4);return r*4294967296+i}se.readUint64BE=Ih;function xh(t,e){e===void 0&&(e=0);var r=us(t,e),i=us(t,e+4);return i*4294967296+r-(r>>31)*4294967296}se.readInt64LE=xh;function Oh(t,e){e===void 0&&(e=0);var r=hs(t,e),i=hs(t,e+4);return i*4294967296+r}se.readUint64LE=Oh;function Jo(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),gi(t/4294967296>>>0,e,r),gi(t>>>0,e,r+4),e}se.writeUint64BE=Jo;se.writeInt64BE=Jo;function Xo(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),yi(t>>>0,e,r),yi(t/4294967296>>>0,e,r+4),e}se.writeUint64LE=Xo;se.writeInt64LE=Xo;function Ah(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintBE: array is too short for the given bitLength");for(var i=0,s=1,o=t/8+r-1;o>=r;o--)i+=e[o]*s,s*=256;return i}se.readUintBE=Ah;function Ch(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintLE: array is too short for the given bitLength");for(var i=0,s=1,o=r;o<r+t/8;o++)i+=e[o]*s,s*=256;return i}se.readUintLE=Ch;function Th(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!ko.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var s=1,o=t/8+i-1;o>=i;o--)r[o]=e/s&255,s*=256;return r}se.writeUintBE=Th;function Nh(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!ko.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var s=1,o=i;o<i+t/8;o++)r[o]=e/s&255,s*=256;return r}se.writeUintLE=Nh;function Ph(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e)}se.readFloat32BE=Ph;function Rh(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e,!0)}se.readFloat32LE=Rh;function Uh(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e)}se.readFloat64BE=Uh;function Lh(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e,!0)}se.readFloat64LE=Lh;function Fh(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t),e}se.writeFloat32BE=Fh;function Mh(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t,!0),e}se.writeFloat32LE=Mh;function $h(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t),e}se.writeFloat64BE=$h;function jh(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t,!0),e}se.writeFloat64LE=jh;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.randomStringForEntropy=t.randomString=t.randomUint32=t.randomBytes=t.defaultRandomSource=void 0;const e=Si,r=se,i=_t;t.defaultRandomSource=new e.SystemRandomSource;function s(d,p=t.defaultRandomSource){return p.randomBytes(d)}t.randomBytes=s;function o(d=t.defaultRandomSource){const p=s(4,d),E=(0,r.readUint32LE)(p);return(0,i.wipe)(p),E}t.randomUint32=o;const u="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function c(d,p=u,E=t.defaultRandomSource){if(p.length<2)throw new Error("randomString charset is too short");if(p.length>256)throw new Error("randomString charset is too long");let x="";const v=p.length,I=256-256%v;for(;d>0;){const N=s(Math.ceil(d*256/I),E);for(let P=0;P<N.length&&d>0;P++){const K=N[P];K<I&&(x+=p.charAt(K%v),d--)}(0,i.wipe)(N)}return x}t.randomString=c;function h(d,p=u,E=t.defaultRandomSource){const x=Math.ceil(d/(Math.log(p.length)/Math.LN2));return c(x,p,E)}t.randomStringForEntropy=h})(Ir);var Qo={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=se,r=_t;t.DIGEST_LENGTH=64,t.BLOCK_SIZE=128;var i=function(){function c(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return c.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},c.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},c.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},c.prototype.update=function(h,d){if(d===void 0&&(d=h.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var p=0;if(this._bytesHashed+=d,this._bufferLength>0){for(;this._bufferLength<t.BLOCK_SIZE&&d>0;)this._buffer[this._bufferLength++]=h[p++],d--;this._bufferLength===this.blockSize&&(o(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(d>=this.blockSize&&(p=o(this._tempHi,this._tempLo,this._stateHi,this._stateLo,h,p,d),d%=this.blockSize);d>0;)this._buffer[this._bufferLength++]=h[p++],d--;return this},c.prototype.finish=function(h){if(!this._finished){var d=this._bytesHashed,p=this._bufferLength,E=d/536870912|0,x=d<<3,v=d%128<112?128:256;this._buffer[p]=128;for(var I=p+1;I<v-8;I++)this._buffer[I]=0;e.writeUint32BE(E,this._buffer,v-8),e.writeUint32BE(x,this._buffer,v-4),o(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,v),this._finished=!0}for(var I=0;I<this.digestLength/8;I++)e.writeUint32BE(this._stateHi[I],h,I*8),e.writeUint32BE(this._stateLo[I],h,I*8+4);return this},c.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},c.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},c.prototype.restoreState=function(h){return this._stateHi.set(h.stateHi),this._stateLo.set(h.stateLo),this._bufferLength=h.bufferLength,h.buffer&&this._buffer.set(h.buffer),this._bytesHashed=h.bytesHashed,this._finished=!1,this},c.prototype.cleanSavedState=function(h){r.wipe(h.stateHi),r.wipe(h.stateLo),h.buffer&&r.wipe(h.buffer),h.bufferLength=0,h.bytesHashed=0},c}();t.SHA512=i;var s=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function o(c,h,d,p,E,x,v){for(var I=d[0],N=d[1],P=d[2],K=d[3],_=d[4],O=d[5],y=d[6],m=d[7],f=p[0],n=p[1],l=p[2],R=p[3],U=p[4],L=p[5],F=p[6],z=p[7],b,A,k,B,$,q,M,V;v>=128;){for(var te=0;te<16;te++){var H=8*te+x;c[te]=e.readUint32BE(E,H),h[te]=e.readUint32BE(E,H+4)}for(var te=0;te<80;te++){var Z=I,J=N,ee=P,T=K,C=_,D=O,a=y,w=m,W=f,Y=n,le=l,be=R,de=U,ve=L,Le=F,Te=z;if(b=m,A=z,$=A&65535,q=A>>>16,M=b&65535,V=b>>>16,b=(_>>>14|U<<32-14)^(_>>>18|U<<32-18)^(U>>>41-32|_<<32-(41-32)),A=(U>>>14|_<<32-14)^(U>>>18|_<<32-18)^(_>>>41-32|U<<32-(41-32)),$+=A&65535,q+=A>>>16,M+=b&65535,V+=b>>>16,b=_&O^~_&y,A=U&L^~U&F,$+=A&65535,q+=A>>>16,M+=b&65535,V+=b>>>16,b=s[te*2],A=s[te*2+1],$+=A&65535,q+=A>>>16,M+=b&65535,V+=b>>>16,b=c[te%16],A=h[te%16],$+=A&65535,q+=A>>>16,M+=b&65535,V+=b>>>16,q+=$>>>16,M+=q>>>16,V+=M>>>16,k=M&65535|V<<16,B=$&65535|q<<16,b=k,A=B,$=A&65535,q=A>>>16,M=b&65535,V=b>>>16,b=(I>>>28|f<<32-28)^(f>>>34-32|I<<32-(34-32))^(f>>>39-32|I<<32-(39-32)),A=(f>>>28|I<<32-28)^(I>>>34-32|f<<32-(34-32))^(I>>>39-32|f<<32-(39-32)),$+=A&65535,q+=A>>>16,M+=b&65535,V+=b>>>16,b=I&N^I&P^N&P,A=f&n^f&l^n&l,$+=A&65535,q+=A>>>16,M+=b&65535,V+=b>>>16,q+=$>>>16,M+=q>>>16,V+=M>>>16,w=M&65535|V<<16,Te=$&65535|q<<16,b=T,A=be,$=A&65535,q=A>>>16,M=b&65535,V=b>>>16,b=k,A=B,$+=A&65535,q+=A>>>16,M+=b&65535,V+=b>>>16,q+=$>>>16,M+=q>>>16,V+=M>>>16,T=M&65535|V<<16,be=$&65535|q<<16,N=Z,P=J,K=ee,_=T,O=C,y=D,m=a,I=w,n=W,l=Y,R=le,U=be,L=de,F=ve,z=Le,f=Te,te%16===15)for(var H=0;H<16;H++)b=c[H],A=h[H],$=A&65535,q=A>>>16,M=b&65535,V=b>>>16,b=c[(H+9)%16],A=h[(H+9)%16],$+=A&65535,q+=A>>>16,M+=b&65535,V+=b>>>16,k=c[(H+1)%16],B=h[(H+1)%16],b=(k>>>1|B<<32-1)^(k>>>8|B<<32-8)^k>>>7,A=(B>>>1|k<<32-1)^(B>>>8|k<<32-8)^(B>>>7|k<<32-7),$+=A&65535,q+=A>>>16,M+=b&65535,V+=b>>>16,k=c[(H+14)%16],B=h[(H+14)%16],b=(k>>>19|B<<32-19)^(B>>>61-32|k<<32-(61-32))^k>>>6,A=(B>>>19|k<<32-19)^(k>>>61-32|B<<32-(61-32))^(B>>>6|k<<32-6),$+=A&65535,q+=A>>>16,M+=b&65535,V+=b>>>16,q+=$>>>16,M+=q>>>16,V+=M>>>16,c[H]=M&65535|V<<16,h[H]=$&65535|q<<16}b=I,A=f,$=A&65535,q=A>>>16,M=b&65535,V=b>>>16,b=d[0],A=p[0],$+=A&65535,q+=A>>>16,M+=b&65535,V+=b>>>16,q+=$>>>16,M+=q>>>16,V+=M>>>16,d[0]=I=M&65535|V<<16,p[0]=f=$&65535|q<<16,b=N,A=n,$=A&65535,q=A>>>16,M=b&65535,V=b>>>16,b=d[1],A=p[1],$+=A&65535,q+=A>>>16,M+=b&65535,V+=b>>>16,q+=$>>>16,M+=q>>>16,V+=M>>>16,d[1]=N=M&65535|V<<16,p[1]=n=$&65535|q<<16,b=P,A=l,$=A&65535,q=A>>>16,M=b&65535,V=b>>>16,b=d[2],A=p[2],$+=A&65535,q+=A>>>16,M+=b&65535,V+=b>>>16,q+=$>>>16,M+=q>>>16,V+=M>>>16,d[2]=P=M&65535|V<<16,p[2]=l=$&65535|q<<16,b=K,A=R,$=A&65535,q=A>>>16,M=b&65535,V=b>>>16,b=d[3],A=p[3],$+=A&65535,q+=A>>>16,M+=b&65535,V+=b>>>16,q+=$>>>16,M+=q>>>16,V+=M>>>16,d[3]=K=M&65535|V<<16,p[3]=R=$&65535|q<<16,b=_,A=U,$=A&65535,q=A>>>16,M=b&65535,V=b>>>16,b=d[4],A=p[4],$+=A&65535,q+=A>>>16,M+=b&65535,V+=b>>>16,q+=$>>>16,M+=q>>>16,V+=M>>>16,d[4]=_=M&65535|V<<16,p[4]=U=$&65535|q<<16,b=O,A=L,$=A&65535,q=A>>>16,M=b&65535,V=b>>>16,b=d[5],A=p[5],$+=A&65535,q+=A>>>16,M+=b&65535,V+=b>>>16,q+=$>>>16,M+=q>>>16,V+=M>>>16,d[5]=O=M&65535|V<<16,p[5]=L=$&65535|q<<16,b=y,A=F,$=A&65535,q=A>>>16,M=b&65535,V=b>>>16,b=d[6],A=p[6],$+=A&65535,q+=A>>>16,M+=b&65535,V+=b>>>16,q+=$>>>16,M+=q>>>16,V+=M>>>16,d[6]=y=M&65535|V<<16,p[6]=F=$&65535|q<<16,b=m,A=z,$=A&65535,q=A>>>16,M=b&65535,V=b>>>16,b=d[7],A=p[7],$+=A&65535,q+=A>>>16,M+=b&65535,V+=b>>>16,q+=$>>>16,M+=q>>>16,V+=M>>>16,d[7]=m=M&65535|V<<16,p[7]=z=$&65535|q<<16,x+=128,v-=128}return x}function u(c){var h=new i;h.update(c);var d=h.digest();return h.clean(),d}t.hash=u})(Qo);(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.convertSecretKeyToX25519=t.convertPublicKeyToX25519=t.verify=t.sign=t.extractPublicKeyFromSecretKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.SEED_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=t.SIGNATURE_LENGTH=void 0;const e=Ir,r=Qo,i=_t;t.SIGNATURE_LENGTH=64,t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=64,t.SEED_LENGTH=32;function s(T){const C=new Float64Array(16);if(T)for(let D=0;D<T.length;D++)C[D]=T[D];return C}const o=new Uint8Array(32);o[0]=9;const u=s(),c=s([1]),h=s([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),d=s([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),p=s([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),E=s([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),x=s([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function v(T,C){for(let D=0;D<16;D++)T[D]=C[D]|0}function I(T){let C=1;for(let D=0;D<16;D++){let a=T[D]+C+65535;C=Math.floor(a/65536),T[D]=a-C*65536}T[0]+=C-1+37*(C-1)}function N(T,C,D){const a=~(D-1);for(let w=0;w<16;w++){const W=a&(T[w]^C[w]);T[w]^=W,C[w]^=W}}function P(T,C){const D=s(),a=s();for(let w=0;w<16;w++)a[w]=C[w];I(a),I(a),I(a);for(let w=0;w<2;w++){D[0]=a[0]-65517;for(let Y=1;Y<15;Y++)D[Y]=a[Y]-65535-(D[Y-1]>>16&1),D[Y-1]&=65535;D[15]=a[15]-32767-(D[14]>>16&1);const W=D[15]>>16&1;D[14]&=65535,N(a,D,1-W)}for(let w=0;w<16;w++)T[2*w]=a[w]&255,T[2*w+1]=a[w]>>8}function K(T,C){let D=0;for(let a=0;a<32;a++)D|=T[a]^C[a];return(1&D-1>>>8)-1}function _(T,C){const D=new Uint8Array(32),a=new Uint8Array(32);return P(D,T),P(a,C),K(D,a)}function O(T){const C=new Uint8Array(32);return P(C,T),C[0]&1}function y(T,C){for(let D=0;D<16;D++)T[D]=C[2*D]+(C[2*D+1]<<8);T[15]&=32767}function m(T,C,D){for(let a=0;a<16;a++)T[a]=C[a]+D[a]}function f(T,C,D){for(let a=0;a<16;a++)T[a]=C[a]-D[a]}function n(T,C,D){let a,w,W=0,Y=0,le=0,be=0,de=0,ve=0,Le=0,Te=0,ye=0,pe=0,fe=0,ue=0,ce=0,ae=0,oe=0,re=0,he=0,ge=0,ie=0,we=0,_e=0,De=0,Se=0,Ee=0,At=0,Pt=0,Kt=0,wt=0,Zt=0,Ar=0,ti=0,Fe=D[0],Ne=D[1],Me=D[2],$e=D[3],je=D[4],Pe=D[5],Ke=D[6],Ve=D[7],He=D[8],We=D[9],ke=D[10],ze=D[11],Be=D[12],Oe=D[13],Ge=D[14],Ye=D[15];a=C[0],W+=a*Fe,Y+=a*Ne,le+=a*Me,be+=a*$e,de+=a*je,ve+=a*Pe,Le+=a*Ke,Te+=a*Ve,ye+=a*He,pe+=a*We,fe+=a*ke,ue+=a*ze,ce+=a*Be,ae+=a*Oe,oe+=a*Ge,re+=a*Ye,a=C[1],Y+=a*Fe,le+=a*Ne,be+=a*Me,de+=a*$e,ve+=a*je,Le+=a*Pe,Te+=a*Ke,ye+=a*Ve,pe+=a*He,fe+=a*We,ue+=a*ke,ce+=a*ze,ae+=a*Be,oe+=a*Oe,re+=a*Ge,he+=a*Ye,a=C[2],le+=a*Fe,be+=a*Ne,de+=a*Me,ve+=a*$e,Le+=a*je,Te+=a*Pe,ye+=a*Ke,pe+=a*Ve,fe+=a*He,ue+=a*We,ce+=a*ke,ae+=a*ze,oe+=a*Be,re+=a*Oe,he+=a*Ge,ge+=a*Ye,a=C[3],be+=a*Fe,de+=a*Ne,ve+=a*Me,Le+=a*$e,Te+=a*je,ye+=a*Pe,pe+=a*Ke,fe+=a*Ve,ue+=a*He,ce+=a*We,ae+=a*ke,oe+=a*ze,re+=a*Be,he+=a*Oe,ge+=a*Ge,ie+=a*Ye,a=C[4],de+=a*Fe,ve+=a*Ne,Le+=a*Me,Te+=a*$e,ye+=a*je,pe+=a*Pe,fe+=a*Ke,ue+=a*Ve,ce+=a*He,ae+=a*We,oe+=a*ke,re+=a*ze,he+=a*Be,ge+=a*Oe,ie+=a*Ge,we+=a*Ye,a=C[5],ve+=a*Fe,Le+=a*Ne,Te+=a*Me,ye+=a*$e,pe+=a*je,fe+=a*Pe,ue+=a*Ke,ce+=a*Ve,ae+=a*He,oe+=a*We,re+=a*ke,he+=a*ze,ge+=a*Be,ie+=a*Oe,we+=a*Ge,_e+=a*Ye,a=C[6],Le+=a*Fe,Te+=a*Ne,ye+=a*Me,pe+=a*$e,fe+=a*je,ue+=a*Pe,ce+=a*Ke,ae+=a*Ve,oe+=a*He,re+=a*We,he+=a*ke,ge+=a*ze,ie+=a*Be,we+=a*Oe,_e+=a*Ge,De+=a*Ye,a=C[7],Te+=a*Fe,ye+=a*Ne,pe+=a*Me,fe+=a*$e,ue+=a*je,ce+=a*Pe,ae+=a*Ke,oe+=a*Ve,re+=a*He,he+=a*We,ge+=a*ke,ie+=a*ze,we+=a*Be,_e+=a*Oe,De+=a*Ge,Se+=a*Ye,a=C[8],ye+=a*Fe,pe+=a*Ne,fe+=a*Me,ue+=a*$e,ce+=a*je,ae+=a*Pe,oe+=a*Ke,re+=a*Ve,he+=a*He,ge+=a*We,ie+=a*ke,we+=a*ze,_e+=a*Be,De+=a*Oe,Se+=a*Ge,Ee+=a*Ye,a=C[9],pe+=a*Fe,fe+=a*Ne,ue+=a*Me,ce+=a*$e,ae+=a*je,oe+=a*Pe,re+=a*Ke,he+=a*Ve,ge+=a*He,ie+=a*We,we+=a*ke,_e+=a*ze,De+=a*Be,Se+=a*Oe,Ee+=a*Ge,At+=a*Ye,a=C[10],fe+=a*Fe,ue+=a*Ne,ce+=a*Me,ae+=a*$e,oe+=a*je,re+=a*Pe,he+=a*Ke,ge+=a*Ve,ie+=a*He,we+=a*We,_e+=a*ke,De+=a*ze,Se+=a*Be,Ee+=a*Oe,At+=a*Ge,Pt+=a*Ye,a=C[11],ue+=a*Fe,ce+=a*Ne,ae+=a*Me,oe+=a*$e,re+=a*je,he+=a*Pe,ge+=a*Ke,ie+=a*Ve,we+=a*He,_e+=a*We,De+=a*ke,Se+=a*ze,Ee+=a*Be,At+=a*Oe,Pt+=a*Ge,Kt+=a*Ye,a=C[12],ce+=a*Fe,ae+=a*Ne,oe+=a*Me,re+=a*$e,he+=a*je,ge+=a*Pe,ie+=a*Ke,we+=a*Ve,_e+=a*He,De+=a*We,Se+=a*ke,Ee+=a*ze,At+=a*Be,Pt+=a*Oe,Kt+=a*Ge,wt+=a*Ye,a=C[13],ae+=a*Fe,oe+=a*Ne,re+=a*Me,he+=a*$e,ge+=a*je,ie+=a*Pe,we+=a*Ke,_e+=a*Ve,De+=a*He,Se+=a*We,Ee+=a*ke,At+=a*ze,Pt+=a*Be,Kt+=a*Oe,wt+=a*Ge,Zt+=a*Ye,a=C[14],oe+=a*Fe,re+=a*Ne,he+=a*Me,ge+=a*$e,ie+=a*je,we+=a*Pe,_e+=a*Ke,De+=a*Ve,Se+=a*He,Ee+=a*We,At+=a*ke,Pt+=a*ze,Kt+=a*Be,wt+=a*Oe,Zt+=a*Ge,Ar+=a*Ye,a=C[15],re+=a*Fe,he+=a*Ne,ge+=a*Me,ie+=a*$e,we+=a*je,_e+=a*Pe,De+=a*Ke,Se+=a*Ve,Ee+=a*He,At+=a*We,Pt+=a*ke,Kt+=a*ze,wt+=a*Be,Zt+=a*Oe,Ar+=a*Ge,ti+=a*Ye,W+=38*he,Y+=38*ge,le+=38*ie,be+=38*we,de+=38*_e,ve+=38*De,Le+=38*Se,Te+=38*Ee,ye+=38*At,pe+=38*Pt,fe+=38*Kt,ue+=38*wt,ce+=38*Zt,ae+=38*Ar,oe+=38*ti,w=1,a=W+w+65535,w=Math.floor(a/65536),W=a-w*65536,a=Y+w+65535,w=Math.floor(a/65536),Y=a-w*65536,a=le+w+65535,w=Math.floor(a/65536),le=a-w*65536,a=be+w+65535,w=Math.floor(a/65536),be=a-w*65536,a=de+w+65535,w=Math.floor(a/65536),de=a-w*65536,a=ve+w+65535,w=Math.floor(a/65536),ve=a-w*65536,a=Le+w+65535,w=Math.floor(a/65536),Le=a-w*65536,a=Te+w+65535,w=Math.floor(a/65536),Te=a-w*65536,a=ye+w+65535,w=Math.floor(a/65536),ye=a-w*65536,a=pe+w+65535,w=Math.floor(a/65536),pe=a-w*65536,a=fe+w+65535,w=Math.floor(a/65536),fe=a-w*65536,a=ue+w+65535,w=Math.floor(a/65536),ue=a-w*65536,a=ce+w+65535,w=Math.floor(a/65536),ce=a-w*65536,a=ae+w+65535,w=Math.floor(a/65536),ae=a-w*65536,a=oe+w+65535,w=Math.floor(a/65536),oe=a-w*65536,a=re+w+65535,w=Math.floor(a/65536),re=a-w*65536,W+=w-1+37*(w-1),w=1,a=W+w+65535,w=Math.floor(a/65536),W=a-w*65536,a=Y+w+65535,w=Math.floor(a/65536),Y=a-w*65536,a=le+w+65535,w=Math.floor(a/65536),le=a-w*65536,a=be+w+65535,w=Math.floor(a/65536),be=a-w*65536,a=de+w+65535,w=Math.floor(a/65536),de=a-w*65536,a=ve+w+65535,w=Math.floor(a/65536),ve=a-w*65536,a=Le+w+65535,w=Math.floor(a/65536),Le=a-w*65536,a=Te+w+65535,w=Math.floor(a/65536),Te=a-w*65536,a=ye+w+65535,w=Math.floor(a/65536),ye=a-w*65536,a=pe+w+65535,w=Math.floor(a/65536),pe=a-w*65536,a=fe+w+65535,w=Math.floor(a/65536),fe=a-w*65536,a=ue+w+65535,w=Math.floor(a/65536),ue=a-w*65536,a=ce+w+65535,w=Math.floor(a/65536),ce=a-w*65536,a=ae+w+65535,w=Math.floor(a/65536),ae=a-w*65536,a=oe+w+65535,w=Math.floor(a/65536),oe=a-w*65536,a=re+w+65535,w=Math.floor(a/65536),re=a-w*65536,W+=w-1+37*(w-1),T[0]=W,T[1]=Y,T[2]=le,T[3]=be,T[4]=de,T[5]=ve,T[6]=Le,T[7]=Te,T[8]=ye,T[9]=pe,T[10]=fe,T[11]=ue,T[12]=ce,T[13]=ae,T[14]=oe,T[15]=re}function l(T,C){n(T,C,C)}function R(T,C){const D=s();let a;for(a=0;a<16;a++)D[a]=C[a];for(a=253;a>=0;a--)l(D,D),a!==2&&a!==4&&n(D,D,C);for(a=0;a<16;a++)T[a]=D[a]}function U(T,C){const D=s();let a;for(a=0;a<16;a++)D[a]=C[a];for(a=250;a>=0;a--)l(D,D),a!==1&&n(D,D,C);for(a=0;a<16;a++)T[a]=D[a]}function L(T,C){const D=s(),a=s(),w=s(),W=s(),Y=s(),le=s(),be=s(),de=s(),ve=s();f(D,T[1],T[0]),f(ve,C[1],C[0]),n(D,D,ve),m(a,T[0],T[1]),m(ve,C[0],C[1]),n(a,a,ve),n(w,T[3],C[3]),n(w,w,d),n(W,T[2],C[2]),m(W,W,W),f(Y,a,D),f(le,W,w),m(be,W,w),m(de,a,D),n(T[0],Y,le),n(T[1],de,be),n(T[2],be,le),n(T[3],Y,de)}function F(T,C,D){for(let a=0;a<4;a++)N(T[a],C[a],D)}function z(T,C){const D=s(),a=s(),w=s();R(w,C[2]),n(D,C[0],w),n(a,C[1],w),P(T,a),T[31]^=O(D)<<7}function b(T,C,D){v(T[0],u),v(T[1],c),v(T[2],c),v(T[3],u);for(let a=255;a>=0;--a){const w=D[a/8|0]>>(a&7)&1;F(T,C,w),L(C,T),L(T,T),F(T,C,w)}}function A(T,C){const D=[s(),s(),s(),s()];v(D[0],p),v(D[1],E),v(D[2],c),n(D[3],p,E),b(T,D,C)}function k(T){if(T.length!==t.SEED_LENGTH)throw new Error(`ed25519: seed must be ${t.SEED_LENGTH} bytes`);const C=(0,r.hash)(T);C[0]&=248,C[31]&=127,C[31]|=64;const D=new Uint8Array(32),a=[s(),s(),s(),s()];A(a,C),z(D,a);const w=new Uint8Array(64);return w.set(T),w.set(D,32),{publicKey:D,secretKey:w}}t.generateKeyPairFromSeed=k;function B(T){const C=(0,e.randomBytes)(32,T),D=k(C);return(0,i.wipe)(C),D}t.generateKeyPair=B;function $(T){if(T.length!==t.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${t.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(T.subarray(32))}t.extractPublicKeyFromSecretKey=$;const q=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function M(T,C){let D,a,w,W;for(a=63;a>=32;--a){for(D=0,w=a-32,W=a-12;w<W;++w)C[w]+=D-16*C[a]*q[w-(a-32)],D=Math.floor((C[w]+128)/256),C[w]-=D*256;C[w]+=D,C[a]=0}for(D=0,w=0;w<32;w++)C[w]+=D-(C[31]>>4)*q[w],D=C[w]>>8,C[w]&=255;for(w=0;w<32;w++)C[w]-=D*q[w];for(a=0;a<32;a++)C[a+1]+=C[a]>>8,T[a]=C[a]&255}function V(T){const C=new Float64Array(64);for(let D=0;D<64;D++)C[D]=T[D];for(let D=0;D<64;D++)T[D]=0;M(T,C)}function te(T,C){const D=new Float64Array(64),a=[s(),s(),s(),s()],w=(0,r.hash)(T.subarray(0,32));w[0]&=248,w[31]&=127,w[31]|=64;const W=new Uint8Array(64);W.set(w.subarray(32),32);const Y=new r.SHA512;Y.update(W.subarray(32)),Y.update(C);const le=Y.digest();Y.clean(),V(le),A(a,le),z(W,a),Y.reset(),Y.update(W.subarray(0,32)),Y.update(T.subarray(32)),Y.update(C);const be=Y.digest();V(be);for(let de=0;de<32;de++)D[de]=le[de];for(let de=0;de<32;de++)for(let ve=0;ve<32;ve++)D[de+ve]+=be[de]*w[ve];return M(W.subarray(32),D),W}t.sign=te;function H(T,C){const D=s(),a=s(),w=s(),W=s(),Y=s(),le=s(),be=s();return v(T[2],c),y(T[1],C),l(w,T[1]),n(W,w,h),f(w,w,T[2]),m(W,T[2],W),l(Y,W),l(le,Y),n(be,le,Y),n(D,be,w),n(D,D,W),U(D,D),n(D,D,w),n(D,D,W),n(D,D,W),n(T[0],D,W),l(a,T[0]),n(a,a,W),_(a,w)&&n(T[0],T[0],x),l(a,T[0]),n(a,a,W),_(a,w)?-1:(O(T[0])===C[31]>>7&&f(T[0],u,T[0]),n(T[3],T[0],T[1]),0)}function Z(T,C,D){const a=new Uint8Array(32),w=[s(),s(),s(),s()],W=[s(),s(),s(),s()];if(D.length!==t.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${t.SIGNATURE_LENGTH} bytes`);if(H(W,T))return!1;const Y=new r.SHA512;Y.update(D.subarray(0,32)),Y.update(T),Y.update(C);const le=Y.digest();return V(le),b(w,W,le),A(W,D.subarray(32)),L(w,W),z(a,w),!K(D,a)}t.verify=Z;function J(T){let C=[s(),s(),s(),s()];if(H(C,T))throw new Error("Ed25519: invalid public key");let D=s(),a=s(),w=C[1];m(D,c,w),f(a,c,w),R(a,a),n(D,D,a);let W=new Uint8Array(32);return P(W,D),W}t.convertPublicKeyToX25519=J;function ee(T){const C=(0,r.hash)(T.subarray(0,32));C[0]&=248,C[31]&=127,C[31]|=64;const D=new Uint8Array(C.subarray(0,32));return(0,i.wipe)(C),D}t.convertSecretKeyToX25519=ee})(Ss);const Bh="EdDSA",qh="JWT",Zo=".",ea="base64url",zh="utf8",Kh="utf8",Vh=":",Hh="did",Wh="key",Fn="base58btc",kh="z",Gh="K36",Yh=32;function Is(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function ta(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Is(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function ls(t,e){e||(e=t.reduce((s,o)=>s+o.length,0));const r=ta(e);let i=0;for(const s of t)r.set(s,i),i+=s.length;return Is(r)}function Jh(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var o=t.charAt(s),u=o.charCodeAt(0);if(r[u]!==255)throw new TypeError(o+" is ambiguous");r[u]=s}var c=t.length,h=t.charAt(0),d=Math.log(c)/Math.log(256),p=Math.log(256)/Math.log(c);function E(I){if(I instanceof Uint8Array||(ArrayBuffer.isView(I)?I=new Uint8Array(I.buffer,I.byteOffset,I.byteLength):Array.isArray(I)&&(I=Uint8Array.from(I))),!(I instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(I.length===0)return"";for(var N=0,P=0,K=0,_=I.length;K!==_&&I[K]===0;)K++,N++;for(var O=(_-K)*p+1>>>0,y=new Uint8Array(O);K!==_;){for(var m=I[K],f=0,n=O-1;(m!==0||f<P)&&n!==-1;n--,f++)m+=256*y[n]>>>0,y[n]=m%c>>>0,m=m/c>>>0;if(m!==0)throw new Error("Non-zero carry");P=f,K++}for(var l=O-P;l!==O&&y[l]===0;)l++;for(var R=h.repeat(N);l<O;++l)R+=t.charAt(y[l]);return R}function x(I){if(typeof I!="string")throw new TypeError("Expected String");if(I.length===0)return new Uint8Array;var N=0;if(I[N]!==" "){for(var P=0,K=0;I[N]===h;)P++,N++;for(var _=(I.length-N)*d+1>>>0,O=new Uint8Array(_);I[N];){var y=r[I.charCodeAt(N)];if(y===255)return;for(var m=0,f=_-1;(y!==0||m<K)&&f!==-1;f--,m++)y+=c*O[f]>>>0,O[f]=y%256>>>0,y=y/256>>>0;if(y!==0)throw new Error("Non-zero carry");K=m,N++}if(I[N]!==" "){for(var n=_-K;n!==_&&O[n]===0;)n++;for(var l=new Uint8Array(P+(_-n)),R=P;n!==_;)l[R++]=O[n++];return l}}}function v(I){var N=x(I);if(N)return N;throw new Error(`Non-${e} character`)}return{encode:E,decodeUnsafe:x,decode:v}}var Xh=Jh,Qh=Xh;const Zh=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},el=t=>new TextEncoder().encode(t),tl=t=>new TextDecoder().decode(t);class rl{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class il{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ra(this,e)}}class sl{constructor(e){this.decoders=e}or(e){return ra(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ra=(t,e)=>new sl({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class nl{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new rl(e,r,i),this.decoder=new il(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Oi=({name:t,prefix:e,encode:r,decode:i})=>new nl(t,e,r,i),Jr=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=Qh(r,e);return Oi({prefix:t,name:e,encode:i,decode:o=>Zh(s(o))})},ol=(t,e,r,i)=>{const s={};for(let p=0;p<e.length;++p)s[e[p]]=p;let o=t.length;for(;t[o-1]==="=";)--o;const u=new Uint8Array(o*r/8|0);let c=0,h=0,d=0;for(let p=0;p<o;++p){const E=s[t[p]];if(E===void 0)throw new SyntaxError(`Non-${i} character`);h=h<<r|E,c+=r,c>=8&&(c-=8,u[d++]=255&h>>c)}if(c>=r||255&h<<8-c)throw new SyntaxError("Unexpected end of data");return u},al=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let o="",u=0,c=0;for(let h=0;h<t.length;++h)for(c=c<<8|t[h],u+=8;u>r;)u-=r,o+=e[s&c>>u];if(u&&(o+=e[s&c<<r-u]),i)for(;o.length*r&7;)o+="=";return o},it=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>Oi({prefix:e,name:t,encode(s){return al(s,i,r)},decode(s){return ol(s,i,r,t)}}),cl=Oi({prefix:"\0",name:"identity",encode:t=>tl(t),decode:t=>el(t)}),ul=Object.freeze(Object.defineProperty({__proto__:null,identity:cl},Symbol.toStringTag,{value:"Module"})),hl=it({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),ll=Object.freeze(Object.defineProperty({__proto__:null,base2:hl},Symbol.toStringTag,{value:"Module"})),fl=it({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),dl=Object.freeze(Object.defineProperty({__proto__:null,base8:fl},Symbol.toStringTag,{value:"Module"})),pl=Jr({prefix:"9",name:"base10",alphabet:"0123456789"}),gl=Object.freeze(Object.defineProperty({__proto__:null,base10:pl},Symbol.toStringTag,{value:"Module"})),yl=it({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),bl=it({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),wl=Object.freeze(Object.defineProperty({__proto__:null,base16:yl,base16upper:bl},Symbol.toStringTag,{value:"Module"})),ml=it({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),_l=it({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),vl=it({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),El=it({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Dl=it({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Sl=it({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Il=it({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),xl=it({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Ol=it({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Al=Object.freeze(Object.defineProperty({__proto__:null,base32:ml,base32hex:Dl,base32hexpad:Il,base32hexpadupper:xl,base32hexupper:Sl,base32pad:vl,base32padupper:El,base32upper:_l,base32z:Ol},Symbol.toStringTag,{value:"Module"})),Cl=Jr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Tl=Jr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Nl=Object.freeze(Object.defineProperty({__proto__:null,base36:Cl,base36upper:Tl},Symbol.toStringTag,{value:"Module"})),Pl=Jr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Rl=Jr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Ul=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Pl,base58flickr:Rl},Symbol.toStringTag,{value:"Module"})),Ll=it({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Fl=it({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ml=it({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),$l=it({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),jl=Object.freeze(Object.defineProperty({__proto__:null,base64:Ll,base64pad:Fl,base64url:Ml,base64urlpad:$l},Symbol.toStringTag,{value:"Module"})),ia=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Bl=ia.reduce((t,e,r)=>(t[r]=e,t),[]),ql=ia.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function zl(t){return t.reduce((e,r)=>(e+=Bl[r],e),"")}function Kl(t){const e=[];for(const r of t){const i=ql[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const Vl=Oi({prefix:"🚀",name:"base256emoji",encode:zl,decode:Kl}),Hl=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Vl},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Mn={...ul,...ll,...dl,...gl,...wl,...Al,...Nl,...Ul,...jl,...Hl};function sa(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const $n=sa("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Hi=sa("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=ta(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),na={utf8:$n,"utf-8":$n,hex:Mn.base16,latin1:Hi,ascii:Hi,binary:Hi,...Mn};function gt(t,e="utf8"){const r=na[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function bt(t,e="utf8"){const r=na[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Is(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function bi(t){return gt(bt(Ds(t),zh),ea)}function oa(t){const e=bt(Gh,Fn),r=kh+gt(ls([e,t]),Fn);return[Hh,Wh,r].join(Vh)}function Wl(t){return gt(t,ea)}function kl(t){return bt([bi(t.header),bi(t.payload)].join(Zo),Kh)}function Gl(t){return[bi(t.header),bi(t.payload),Wl(t.signature)].join(Zo)}function jn(t=Ir.randomBytes(Yh)){return Ss.generateKeyPairFromSeed(t)}async function Yl(t,e,r,i,s=Q.fromMiliseconds(Date.now())){const o={alg:Bh,typ:qh},u=oa(i.publicKey),c=s+r,h={iss:u,sub:t,aud:e,iat:s,exp:c},d=kl({header:o,payload:h}),p=Ss.sign(i.secretKey,d);return Gl({header:o,payload:h,signature:p})}var xs={},Ai={};Object.defineProperty(Ai,"__esModule",{value:!0});var at=se,fs=_t,Jl=20;function Xl(t,e,r){for(var i=1634760805,s=857760878,o=2036477234,u=1797285236,c=r[3]<<24|r[2]<<16|r[1]<<8|r[0],h=r[7]<<24|r[6]<<16|r[5]<<8|r[4],d=r[11]<<24|r[10]<<16|r[9]<<8|r[8],p=r[15]<<24|r[14]<<16|r[13]<<8|r[12],E=r[19]<<24|r[18]<<16|r[17]<<8|r[16],x=r[23]<<24|r[22]<<16|r[21]<<8|r[20],v=r[27]<<24|r[26]<<16|r[25]<<8|r[24],I=r[31]<<24|r[30]<<16|r[29]<<8|r[28],N=e[3]<<24|e[2]<<16|e[1]<<8|e[0],P=e[7]<<24|e[6]<<16|e[5]<<8|e[4],K=e[11]<<24|e[10]<<16|e[9]<<8|e[8],_=e[15]<<24|e[14]<<16|e[13]<<8|e[12],O=i,y=s,m=o,f=u,n=c,l=h,R=d,U=p,L=E,F=x,z=v,b=I,A=N,k=P,B=K,$=_,q=0;q<Jl;q+=2)O=O+n|0,A^=O,A=A>>>32-16|A<<16,L=L+A|0,n^=L,n=n>>>32-12|n<<12,y=y+l|0,k^=y,k=k>>>32-16|k<<16,F=F+k|0,l^=F,l=l>>>32-12|l<<12,m=m+R|0,B^=m,B=B>>>32-16|B<<16,z=z+B|0,R^=z,R=R>>>32-12|R<<12,f=f+U|0,$^=f,$=$>>>32-16|$<<16,b=b+$|0,U^=b,U=U>>>32-12|U<<12,m=m+R|0,B^=m,B=B>>>32-8|B<<8,z=z+B|0,R^=z,R=R>>>32-7|R<<7,f=f+U|0,$^=f,$=$>>>32-8|$<<8,b=b+$|0,U^=b,U=U>>>32-7|U<<7,y=y+l|0,k^=y,k=k>>>32-8|k<<8,F=F+k|0,l^=F,l=l>>>32-7|l<<7,O=O+n|0,A^=O,A=A>>>32-8|A<<8,L=L+A|0,n^=L,n=n>>>32-7|n<<7,O=O+l|0,$^=O,$=$>>>32-16|$<<16,z=z+$|0,l^=z,l=l>>>32-12|l<<12,y=y+R|0,A^=y,A=A>>>32-16|A<<16,b=b+A|0,R^=b,R=R>>>32-12|R<<12,m=m+U|0,k^=m,k=k>>>32-16|k<<16,L=L+k|0,U^=L,U=U>>>32-12|U<<12,f=f+n|0,B^=f,B=B>>>32-16|B<<16,F=F+B|0,n^=F,n=n>>>32-12|n<<12,m=m+U|0,k^=m,k=k>>>32-8|k<<8,L=L+k|0,U^=L,U=U>>>32-7|U<<7,f=f+n|0,B^=f,B=B>>>32-8|B<<8,F=F+B|0,n^=F,n=n>>>32-7|n<<7,y=y+R|0,A^=y,A=A>>>32-8|A<<8,b=b+A|0,R^=b,R=R>>>32-7|R<<7,O=O+l|0,$^=O,$=$>>>32-8|$<<8,z=z+$|0,l^=z,l=l>>>32-7|l<<7;at.writeUint32LE(O+i|0,t,0),at.writeUint32LE(y+s|0,t,4),at.writeUint32LE(m+o|0,t,8),at.writeUint32LE(f+u|0,t,12),at.writeUint32LE(n+c|0,t,16),at.writeUint32LE(l+h|0,t,20),at.writeUint32LE(R+d|0,t,24),at.writeUint32LE(U+p|0,t,28),at.writeUint32LE(L+E|0,t,32),at.writeUint32LE(F+x|0,t,36),at.writeUint32LE(z+v|0,t,40),at.writeUint32LE(b+I|0,t,44),at.writeUint32LE(A+N|0,t,48),at.writeUint32LE(k+P|0,t,52),at.writeUint32LE(B+K|0,t,56),at.writeUint32LE($+_|0,t,60)}function aa(t,e,r,i,s){if(s===void 0&&(s=0),t.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(i.length<r.length)throw new Error("ChaCha: destination is shorter than source");var o,u;if(s===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");o=new Uint8Array(16),u=o.length-e.length,o.set(e,u)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");o=e,u=s}for(var c=new Uint8Array(64),h=0;h<r.length;h+=64){Xl(c,o,t);for(var d=h;d<h+64&&d<r.length;d++)i[d]=r[d]^c[d-h];Zl(o,0,u)}return fs.wipe(c),s===0&&fs.wipe(o),i}Ai.streamXOR=aa;function Ql(t,e,r,i){return i===void 0&&(i=0),fs.wipe(r),aa(t,e,r,r,i)}Ai.stream=Ql;function Zl(t,e,r){for(var i=1;r--;)i=i+(t[e]&255)|0,t[e]=i&255,i>>>=8,e++;if(i>0)throw new Error("ChaCha: counter overflow")}var ca={},Qt={};Object.defineProperty(Qt,"__esModule",{value:!0});function ef(t,e,r){return~(t-1)&e|t-1&r}Qt.select=ef;function tf(t,e){return(t|0)-(e|0)-1>>>31&1}Qt.lessOrEqual=tf;function ua(t,e){if(t.length!==e.length)return 0;for(var r=0,i=0;i<t.length;i++)r|=t[i]^e[i];return 1&r-1>>>8}Qt.compare=ua;function rf(t,e){return t.length===0||e.length===0?!1:ua(t,e)!==0}Qt.equal=rf;(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=Qt,r=_t;t.DIGEST_LENGTH=16;var i=function(){function u(c){this.digestLength=t.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var h=c[0]|c[1]<<8;this._r[0]=h&8191;var d=c[2]|c[3]<<8;this._r[1]=(h>>>13|d<<3)&8191;var p=c[4]|c[5]<<8;this._r[2]=(d>>>10|p<<6)&7939;var E=c[6]|c[7]<<8;this._r[3]=(p>>>7|E<<9)&8191;var x=c[8]|c[9]<<8;this._r[4]=(E>>>4|x<<12)&255,this._r[5]=x>>>1&8190;var v=c[10]|c[11]<<8;this._r[6]=(x>>>14|v<<2)&8191;var I=c[12]|c[13]<<8;this._r[7]=(v>>>11|I<<5)&8065;var N=c[14]|c[15]<<8;this._r[8]=(I>>>8|N<<8)&8191,this._r[9]=N>>>5&127,this._pad[0]=c[16]|c[17]<<8,this._pad[1]=c[18]|c[19]<<8,this._pad[2]=c[20]|c[21]<<8,this._pad[3]=c[22]|c[23]<<8,this._pad[4]=c[24]|c[25]<<8,this._pad[5]=c[26]|c[27]<<8,this._pad[6]=c[28]|c[29]<<8,this._pad[7]=c[30]|c[31]<<8}return u.prototype._blocks=function(c,h,d){for(var p=this._fin?0:2048,E=this._h[0],x=this._h[1],v=this._h[2],I=this._h[3],N=this._h[4],P=this._h[5],K=this._h[6],_=this._h[7],O=this._h[8],y=this._h[9],m=this._r[0],f=this._r[1],n=this._r[2],l=this._r[3],R=this._r[4],U=this._r[5],L=this._r[6],F=this._r[7],z=this._r[8],b=this._r[9];d>=16;){var A=c[h+0]|c[h+1]<<8;E+=A&8191;var k=c[h+2]|c[h+3]<<8;x+=(A>>>13|k<<3)&8191;var B=c[h+4]|c[h+5]<<8;v+=(k>>>10|B<<6)&8191;var $=c[h+6]|c[h+7]<<8;I+=(B>>>7|$<<9)&8191;var q=c[h+8]|c[h+9]<<8;N+=($>>>4|q<<12)&8191,P+=q>>>1&8191;var M=c[h+10]|c[h+11]<<8;K+=(q>>>14|M<<2)&8191;var V=c[h+12]|c[h+13]<<8;_+=(M>>>11|V<<5)&8191;var te=c[h+14]|c[h+15]<<8;O+=(V>>>8|te<<8)&8191,y+=te>>>5|p;var H=0,Z=H;Z+=E*m,Z+=x*(5*b),Z+=v*(5*z),Z+=I*(5*F),Z+=N*(5*L),H=Z>>>13,Z&=8191,Z+=P*(5*U),Z+=K*(5*R),Z+=_*(5*l),Z+=O*(5*n),Z+=y*(5*f),H+=Z>>>13,Z&=8191;var J=H;J+=E*f,J+=x*m,J+=v*(5*b),J+=I*(5*z),J+=N*(5*F),H=J>>>13,J&=8191,J+=P*(5*L),J+=K*(5*U),J+=_*(5*R),J+=O*(5*l),J+=y*(5*n),H+=J>>>13,J&=8191;var ee=H;ee+=E*n,ee+=x*f,ee+=v*m,ee+=I*(5*b),ee+=N*(5*z),H=ee>>>13,ee&=8191,ee+=P*(5*F),ee+=K*(5*L),ee+=_*(5*U),ee+=O*(5*R),ee+=y*(5*l),H+=ee>>>13,ee&=8191;var T=H;T+=E*l,T+=x*n,T+=v*f,T+=I*m,T+=N*(5*b),H=T>>>13,T&=8191,T+=P*(5*z),T+=K*(5*F),T+=_*(5*L),T+=O*(5*U),T+=y*(5*R),H+=T>>>13,T&=8191;var C=H;C+=E*R,C+=x*l,C+=v*n,C+=I*f,C+=N*m,H=C>>>13,C&=8191,C+=P*(5*b),C+=K*(5*z),C+=_*(5*F),C+=O*(5*L),C+=y*(5*U),H+=C>>>13,C&=8191;var D=H;D+=E*U,D+=x*R,D+=v*l,D+=I*n,D+=N*f,H=D>>>13,D&=8191,D+=P*m,D+=K*(5*b),D+=_*(5*z),D+=O*(5*F),D+=y*(5*L),H+=D>>>13,D&=8191;var a=H;a+=E*L,a+=x*U,a+=v*R,a+=I*l,a+=N*n,H=a>>>13,a&=8191,a+=P*f,a+=K*m,a+=_*(5*b),a+=O*(5*z),a+=y*(5*F),H+=a>>>13,a&=8191;var w=H;w+=E*F,w+=x*L,w+=v*U,w+=I*R,w+=N*l,H=w>>>13,w&=8191,w+=P*n,w+=K*f,w+=_*m,w+=O*(5*b),w+=y*(5*z),H+=w>>>13,w&=8191;var W=H;W+=E*z,W+=x*F,W+=v*L,W+=I*U,W+=N*R,H=W>>>13,W&=8191,W+=P*l,W+=K*n,W+=_*f,W+=O*m,W+=y*(5*b),H+=W>>>13,W&=8191;var Y=H;Y+=E*b,Y+=x*z,Y+=v*F,Y+=I*L,Y+=N*U,H=Y>>>13,Y&=8191,Y+=P*R,Y+=K*l,Y+=_*n,Y+=O*f,Y+=y*m,H+=Y>>>13,Y&=8191,H=(H<<2)+H|0,H=H+Z|0,Z=H&8191,H=H>>>13,J+=H,E=Z,x=J,v=ee,I=T,N=C,P=D,K=a,_=w,O=W,y=Y,h+=16,d-=16}this._h[0]=E,this._h[1]=x,this._h[2]=v,this._h[3]=I,this._h[4]=N,this._h[5]=P,this._h[6]=K,this._h[7]=_,this._h[8]=O,this._h[9]=y},u.prototype.finish=function(c,h){h===void 0&&(h=0);var d=new Uint16Array(10),p,E,x,v;if(this._leftover){for(v=this._leftover,this._buffer[v++]=1;v<16;v++)this._buffer[v]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(p=this._h[1]>>>13,this._h[1]&=8191,v=2;v<10;v++)this._h[v]+=p,p=this._h[v]>>>13,this._h[v]&=8191;for(this._h[0]+=p*5,p=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=p,p=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=p,d[0]=this._h[0]+5,p=d[0]>>>13,d[0]&=8191,v=1;v<10;v++)d[v]=this._h[v]+p,p=d[v]>>>13,d[v]&=8191;for(d[9]-=8192,E=(p^1)-1,v=0;v<10;v++)d[v]&=E;for(E=~E,v=0;v<10;v++)this._h[v]=this._h[v]&E|d[v];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,x=this._h[0]+this._pad[0],this._h[0]=x&65535,v=1;v<8;v++)x=(this._h[v]+this._pad[v]|0)+(x>>>16)|0,this._h[v]=x&65535;return c[h+0]=this._h[0]>>>0,c[h+1]=this._h[0]>>>8,c[h+2]=this._h[1]>>>0,c[h+3]=this._h[1]>>>8,c[h+4]=this._h[2]>>>0,c[h+5]=this._h[2]>>>8,c[h+6]=this._h[3]>>>0,c[h+7]=this._h[3]>>>8,c[h+8]=this._h[4]>>>0,c[h+9]=this._h[4]>>>8,c[h+10]=this._h[5]>>>0,c[h+11]=this._h[5]>>>8,c[h+12]=this._h[6]>>>0,c[h+13]=this._h[6]>>>8,c[h+14]=this._h[7]>>>0,c[h+15]=this._h[7]>>>8,this._finished=!0,this},u.prototype.update=function(c){var h=0,d=c.length,p;if(this._leftover){p=16-this._leftover,p>d&&(p=d);for(var E=0;E<p;E++)this._buffer[this._leftover+E]=c[h+E];if(d-=p,h+=p,this._leftover+=p,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(d>=16&&(p=d-d%16,this._blocks(c,h,p),h+=p,d-=p),d){for(var E=0;E<d;E++)this._buffer[this._leftover+E]=c[h+E];this._leftover+=d}return this},u.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var c=new Uint8Array(16);return this.finish(c),c},u.prototype.clean=function(){return r.wipe(this._buffer),r.wipe(this._r),r.wipe(this._h),r.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},u}();t.Poly1305=i;function s(u,c){var h=new i(u);h.update(c);var d=h.digest();return h.clean(),d}t.oneTimeAuth=s;function o(u,c){return u.length!==t.DIGEST_LENGTH||c.length!==t.DIGEST_LENGTH?!1:e.equal(u,c)}t.equal=o})(ca);(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=Ai,r=ca,i=_t,s=se,o=Qt;t.KEY_LENGTH=32,t.NONCE_LENGTH=12,t.TAG_LENGTH=16;var u=new Uint8Array(16),c=function(){function h(d){if(this.nonceLength=t.NONCE_LENGTH,this.tagLength=t.TAG_LENGTH,d.length!==t.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(d)}return h.prototype.seal=function(d,p,E,x){if(d.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var v=new Uint8Array(16);v.set(d,v.length-d.length);var I=new Uint8Array(32);e.stream(this._key,v,I,4);var N=p.length+this.tagLength,P;if(x){if(x.length!==N)throw new Error("ChaCha20Poly1305: incorrect destination length");P=x}else P=new Uint8Array(N);return e.streamXOR(this._key,v,p,P,4),this._authenticate(P.subarray(P.length-this.tagLength,P.length),I,P.subarray(0,P.length-this.tagLength),E),i.wipe(v),P},h.prototype.open=function(d,p,E,x){if(d.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(p.length<this.tagLength)return null;var v=new Uint8Array(16);v.set(d,v.length-d.length);var I=new Uint8Array(32);e.stream(this._key,v,I,4);var N=new Uint8Array(this.tagLength);if(this._authenticate(N,I,p.subarray(0,p.length-this.tagLength),E),!o.equal(N,p.subarray(p.length-this.tagLength,p.length)))return null;var P=p.length-this.tagLength,K;if(x){if(x.length!==P)throw new Error("ChaCha20Poly1305: incorrect destination length");K=x}else K=new Uint8Array(P);return e.streamXOR(this._key,v,p.subarray(0,p.length-this.tagLength),K,4),i.wipe(v),K},h.prototype.clean=function(){return i.wipe(this._key),this},h.prototype._authenticate=function(d,p,E,x){var v=new r.Poly1305(p);x&&(v.update(x),x.length%16>0&&v.update(u.subarray(x.length%16))),v.update(E),E.length%16>0&&v.update(u.subarray(E.length%16));var I=new Uint8Array(8);x&&s.writeUint64LE(x.length,I),v.update(I),s.writeUint64LE(E.length,I),v.update(I);for(var N=v.digest(),P=0;P<N.length;P++)d[P]=N[P];v.clean(),i.wipe(N),i.wipe(I)},h}();t.ChaCha20Poly1305=c})(xs);var ha={},Xr={},Os={};Object.defineProperty(Os,"__esModule",{value:!0});function sf(t){return typeof t.saveState<"u"&&typeof t.restoreState<"u"&&typeof t.cleanSavedState<"u"}Os.isSerializableHash=sf;Object.defineProperty(Xr,"__esModule",{value:!0});var Lt=Os,nf=Qt,of=_t,la=function(){function t(e,r){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var i=new Uint8Array(this.blockSize);r.length>this.blockSize?this._inner.update(r).finish(i).clean():i.set(r);for(var s=0;s<i.length;s++)i[s]^=54;this._inner.update(i);for(var s=0;s<i.length;s++)i[s]^=106;this._outer.update(i),Lt.isSerializableHash(this._inner)&&Lt.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),of.wipe(i)}return t.prototype.reset=function(){if(!Lt.isSerializableHash(this._inner)||!Lt.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.clean=function(){Lt.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),Lt.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},t.prototype.update=function(e){return this._inner.update(e),this},t.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},t.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},t.prototype.saveState=function(){if(!Lt.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},t.prototype.restoreState=function(e){if(!Lt.isSerializableHash(this._inner)||!Lt.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.cleanSavedState=function(e){if(!Lt.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},t}();Xr.HMAC=la;function af(t,e,r){var i=new la(t,e);i.update(r);var s=i.digest();return i.clean(),s}Xr.hmac=af;Xr.equal=nf.equal;Object.defineProperty(ha,"__esModule",{value:!0});var Bn=Xr,qn=_t,cf=function(){function t(e,r,i,s){i===void 0&&(i=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=s;var o=Bn.hmac(this._hash,i,r);this._hmac=new Bn.HMAC(e,o),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return t.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},t.prototype.expand=function(e){for(var r=new Uint8Array(e),i=0;i<r.length;i++)this._bufpos===this._buffer.length&&this._fillBuffer(),r[i]=this._buffer[this._bufpos++];return r},t.prototype.clean=function(){this._hmac.clean(),qn.wipe(this._buffer),qn.wipe(this._counter),this._bufpos=0},t}(),uf=ha.HKDF=cf,Ci={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=se,r=_t;t.DIGEST_LENGTH=32,t.BLOCK_SIZE=64;var i=function(){function c(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return c.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},c.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},c.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._temp),this.reset()},c.prototype.update=function(h,d){if(d===void 0&&(d=h.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var p=0;if(this._bytesHashed+=d,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&d>0;)this._buffer[this._bufferLength++]=h[p++],d--;this._bufferLength===this.blockSize&&(o(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(d>=this.blockSize&&(p=o(this._temp,this._state,h,p,d),d%=this.blockSize);d>0;)this._buffer[this._bufferLength++]=h[p++],d--;return this},c.prototype.finish=function(h){if(!this._finished){var d=this._bytesHashed,p=this._bufferLength,E=d/536870912|0,x=d<<3,v=d%64<56?64:128;this._buffer[p]=128;for(var I=p+1;I<v-8;I++)this._buffer[I]=0;e.writeUint32BE(E,this._buffer,v-8),e.writeUint32BE(x,this._buffer,v-4),o(this._temp,this._state,this._buffer,0,v),this._finished=!0}for(var I=0;I<this.digestLength/4;I++)e.writeUint32BE(this._state[I],h,I*4);return this},c.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},c.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},c.prototype.restoreState=function(h){return this._state.set(h.state),this._bufferLength=h.bufferLength,h.buffer&&this._buffer.set(h.buffer),this._bytesHashed=h.bytesHashed,this._finished=!1,this},c.prototype.cleanSavedState=function(h){r.wipe(h.state),h.buffer&&r.wipe(h.buffer),h.bufferLength=0,h.bytesHashed=0},c}();t.SHA256=i;var s=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function o(c,h,d,p,E){for(;E>=64;){for(var x=h[0],v=h[1],I=h[2],N=h[3],P=h[4],K=h[5],_=h[6],O=h[7],y=0;y<16;y++){var m=p+y*4;c[y]=e.readUint32BE(d,m)}for(var y=16;y<64;y++){var f=c[y-2],n=(f>>>17|f<<32-17)^(f>>>19|f<<32-19)^f>>>10;f=c[y-15];var l=(f>>>7|f<<32-7)^(f>>>18|f<<32-18)^f>>>3;c[y]=(n+c[y-7]|0)+(l+c[y-16]|0)}for(var y=0;y<64;y++){var n=(((P>>>6|P<<26)^(P>>>11|P<<21)^(P>>>25|P<<7))+(P&K^~P&_)|0)+(O+(s[y]+c[y]|0)|0)|0,l=((x>>>2|x<<32-2)^(x>>>13|x<<32-13)^(x>>>22|x<<32-22))+(x&v^x&I^v&I)|0;O=_,_=K,K=P,P=N+n|0,N=I,I=v,v=x,x=n+l|0}h[0]+=x,h[1]+=v,h[2]+=I,h[3]+=N,h[4]+=P,h[5]+=K,h[6]+=_,h[7]+=O,p+=64,E-=64}return p}function u(c){var h=new i;h.update(c);var d=h.digest();return h.clean(),d}t.hash=u})(Ci);var As={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.sharedKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.scalarMultBase=t.scalarMult=t.SHARED_KEY_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=void 0;const e=Ir,r=_t;t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=32,t.SHARED_KEY_LENGTH=32;function i(y){const m=new Float64Array(16);if(y)for(let f=0;f<y.length;f++)m[f]=y[f];return m}const s=new Uint8Array(32);s[0]=9;const o=i([56129,1]);function u(y){let m=1;for(let f=0;f<16;f++){let n=y[f]+m+65535;m=Math.floor(n/65536),y[f]=n-m*65536}y[0]+=m-1+37*(m-1)}function c(y,m,f){const n=~(f-1);for(let l=0;l<16;l++){const R=n&(y[l]^m[l]);y[l]^=R,m[l]^=R}}function h(y,m){const f=i(),n=i();for(let l=0;l<16;l++)n[l]=m[l];u(n),u(n),u(n);for(let l=0;l<2;l++){f[0]=n[0]-65517;for(let U=1;U<15;U++)f[U]=n[U]-65535-(f[U-1]>>16&1),f[U-1]&=65535;f[15]=n[15]-32767-(f[14]>>16&1);const R=f[15]>>16&1;f[14]&=65535,c(n,f,1-R)}for(let l=0;l<16;l++)y[2*l]=n[l]&255,y[2*l+1]=n[l]>>8}function d(y,m){for(let f=0;f<16;f++)y[f]=m[2*f]+(m[2*f+1]<<8);y[15]&=32767}function p(y,m,f){for(let n=0;n<16;n++)y[n]=m[n]+f[n]}function E(y,m,f){for(let n=0;n<16;n++)y[n]=m[n]-f[n]}function x(y,m,f){let n,l,R=0,U=0,L=0,F=0,z=0,b=0,A=0,k=0,B=0,$=0,q=0,M=0,V=0,te=0,H=0,Z=0,J=0,ee=0,T=0,C=0,D=0,a=0,w=0,W=0,Y=0,le=0,be=0,de=0,ve=0,Le=0,Te=0,ye=f[0],pe=f[1],fe=f[2],ue=f[3],ce=f[4],ae=f[5],oe=f[6],re=f[7],he=f[8],ge=f[9],ie=f[10],we=f[11],_e=f[12],De=f[13],Se=f[14],Ee=f[15];n=m[0],R+=n*ye,U+=n*pe,L+=n*fe,F+=n*ue,z+=n*ce,b+=n*ae,A+=n*oe,k+=n*re,B+=n*he,$+=n*ge,q+=n*ie,M+=n*we,V+=n*_e,te+=n*De,H+=n*Se,Z+=n*Ee,n=m[1],U+=n*ye,L+=n*pe,F+=n*fe,z+=n*ue,b+=n*ce,A+=n*ae,k+=n*oe,B+=n*re,$+=n*he,q+=n*ge,M+=n*ie,V+=n*we,te+=n*_e,H+=n*De,Z+=n*Se,J+=n*Ee,n=m[2],L+=n*ye,F+=n*pe,z+=n*fe,b+=n*ue,A+=n*ce,k+=n*ae,B+=n*oe,$+=n*re,q+=n*he,M+=n*ge,V+=n*ie,te+=n*we,H+=n*_e,Z+=n*De,J+=n*Se,ee+=n*Ee,n=m[3],F+=n*ye,z+=n*pe,b+=n*fe,A+=n*ue,k+=n*ce,B+=n*ae,$+=n*oe,q+=n*re,M+=n*he,V+=n*ge,te+=n*ie,H+=n*we,Z+=n*_e,J+=n*De,ee+=n*Se,T+=n*Ee,n=m[4],z+=n*ye,b+=n*pe,A+=n*fe,k+=n*ue,B+=n*ce,$+=n*ae,q+=n*oe,M+=n*re,V+=n*he,te+=n*ge,H+=n*ie,Z+=n*we,J+=n*_e,ee+=n*De,T+=n*Se,C+=n*Ee,n=m[5],b+=n*ye,A+=n*pe,k+=n*fe,B+=n*ue,$+=n*ce,q+=n*ae,M+=n*oe,V+=n*re,te+=n*he,H+=n*ge,Z+=n*ie,J+=n*we,ee+=n*_e,T+=n*De,C+=n*Se,D+=n*Ee,n=m[6],A+=n*ye,k+=n*pe,B+=n*fe,$+=n*ue,q+=n*ce,M+=n*ae,V+=n*oe,te+=n*re,H+=n*he,Z+=n*ge,J+=n*ie,ee+=n*we,T+=n*_e,C+=n*De,D+=n*Se,a+=n*Ee,n=m[7],k+=n*ye,B+=n*pe,$+=n*fe,q+=n*ue,M+=n*ce,V+=n*ae,te+=n*oe,H+=n*re,Z+=n*he,J+=n*ge,ee+=n*ie,T+=n*we,C+=n*_e,D+=n*De,a+=n*Se,w+=n*Ee,n=m[8],B+=n*ye,$+=n*pe,q+=n*fe,M+=n*ue,V+=n*ce,te+=n*ae,H+=n*oe,Z+=n*re,J+=n*he,ee+=n*ge,T+=n*ie,C+=n*we,D+=n*_e,a+=n*De,w+=n*Se,W+=n*Ee,n=m[9],$+=n*ye,q+=n*pe,M+=n*fe,V+=n*ue,te+=n*ce,H+=n*ae,Z+=n*oe,J+=n*re,ee+=n*he,T+=n*ge,C+=n*ie,D+=n*we,a+=n*_e,w+=n*De,W+=n*Se,Y+=n*Ee,n=m[10],q+=n*ye,M+=n*pe,V+=n*fe,te+=n*ue,H+=n*ce,Z+=n*ae,J+=n*oe,ee+=n*re,T+=n*he,C+=n*ge,D+=n*ie,a+=n*we,w+=n*_e,W+=n*De,Y+=n*Se,le+=n*Ee,n=m[11],M+=n*ye,V+=n*pe,te+=n*fe,H+=n*ue,Z+=n*ce,J+=n*ae,ee+=n*oe,T+=n*re,C+=n*he,D+=n*ge,a+=n*ie,w+=n*we,W+=n*_e,Y+=n*De,le+=n*Se,be+=n*Ee,n=m[12],V+=n*ye,te+=n*pe,H+=n*fe,Z+=n*ue,J+=n*ce,ee+=n*ae,T+=n*oe,C+=n*re,D+=n*he,a+=n*ge,w+=n*ie,W+=n*we,Y+=n*_e,le+=n*De,be+=n*Se,de+=n*Ee,n=m[13],te+=n*ye,H+=n*pe,Z+=n*fe,J+=n*ue,ee+=n*ce,T+=n*ae,C+=n*oe,D+=n*re,a+=n*he,w+=n*ge,W+=n*ie,Y+=n*we,le+=n*_e,be+=n*De,de+=n*Se,ve+=n*Ee,n=m[14],H+=n*ye,Z+=n*pe,J+=n*fe,ee+=n*ue,T+=n*ce,C+=n*ae,D+=n*oe,a+=n*re,w+=n*he,W+=n*ge,Y+=n*ie,le+=n*we,be+=n*_e,de+=n*De,ve+=n*Se,Le+=n*Ee,n=m[15],Z+=n*ye,J+=n*pe,ee+=n*fe,T+=n*ue,C+=n*ce,D+=n*ae,a+=n*oe,w+=n*re,W+=n*he,Y+=n*ge,le+=n*ie,be+=n*we,de+=n*_e,ve+=n*De,Le+=n*Se,Te+=n*Ee,R+=38*J,U+=38*ee,L+=38*T,F+=38*C,z+=38*D,b+=38*a,A+=38*w,k+=38*W,B+=38*Y,$+=38*le,q+=38*be,M+=38*de,V+=38*ve,te+=38*Le,H+=38*Te,l=1,n=R+l+65535,l=Math.floor(n/65536),R=n-l*65536,n=U+l+65535,l=Math.floor(n/65536),U=n-l*65536,n=L+l+65535,l=Math.floor(n/65536),L=n-l*65536,n=F+l+65535,l=Math.floor(n/65536),F=n-l*65536,n=z+l+65535,l=Math.floor(n/65536),z=n-l*65536,n=b+l+65535,l=Math.floor(n/65536),b=n-l*65536,n=A+l+65535,l=Math.floor(n/65536),A=n-l*65536,n=k+l+65535,l=Math.floor(n/65536),k=n-l*65536,n=B+l+65535,l=Math.floor(n/65536),B=n-l*65536,n=$+l+65535,l=Math.floor(n/65536),$=n-l*65536,n=q+l+65535,l=Math.floor(n/65536),q=n-l*65536,n=M+l+65535,l=Math.floor(n/65536),M=n-l*65536,n=V+l+65535,l=Math.floor(n/65536),V=n-l*65536,n=te+l+65535,l=Math.floor(n/65536),te=n-l*65536,n=H+l+65535,l=Math.floor(n/65536),H=n-l*65536,n=Z+l+65535,l=Math.floor(n/65536),Z=n-l*65536,R+=l-1+37*(l-1),l=1,n=R+l+65535,l=Math.floor(n/65536),R=n-l*65536,n=U+l+65535,l=Math.floor(n/65536),U=n-l*65536,n=L+l+65535,l=Math.floor(n/65536),L=n-l*65536,n=F+l+65535,l=Math.floor(n/65536),F=n-l*65536,n=z+l+65535,l=Math.floor(n/65536),z=n-l*65536,n=b+l+65535,l=Math.floor(n/65536),b=n-l*65536,n=A+l+65535,l=Math.floor(n/65536),A=n-l*65536,n=k+l+65535,l=Math.floor(n/65536),k=n-l*65536,n=B+l+65535,l=Math.floor(n/65536),B=n-l*65536,n=$+l+65535,l=Math.floor(n/65536),$=n-l*65536,n=q+l+65535,l=Math.floor(n/65536),q=n-l*65536,n=M+l+65535,l=Math.floor(n/65536),M=n-l*65536,n=V+l+65535,l=Math.floor(n/65536),V=n-l*65536,n=te+l+65535,l=Math.floor(n/65536),te=n-l*65536,n=H+l+65535,l=Math.floor(n/65536),H=n-l*65536,n=Z+l+65535,l=Math.floor(n/65536),Z=n-l*65536,R+=l-1+37*(l-1),y[0]=R,y[1]=U,y[2]=L,y[3]=F,y[4]=z,y[5]=b,y[6]=A,y[7]=k,y[8]=B,y[9]=$,y[10]=q,y[11]=M,y[12]=V,y[13]=te,y[14]=H,y[15]=Z}function v(y,m){x(y,m,m)}function I(y,m){const f=i();for(let n=0;n<16;n++)f[n]=m[n];for(let n=253;n>=0;n--)v(f,f),n!==2&&n!==4&&x(f,f,m);for(let n=0;n<16;n++)y[n]=f[n]}function N(y,m){const f=new Uint8Array(32),n=new Float64Array(80),l=i(),R=i(),U=i(),L=i(),F=i(),z=i();for(let B=0;B<31;B++)f[B]=y[B];f[31]=y[31]&127|64,f[0]&=248,d(n,m);for(let B=0;B<16;B++)R[B]=n[B];l[0]=L[0]=1;for(let B=254;B>=0;--B){const $=f[B>>>3]>>>(B&7)&1;c(l,R,$),c(U,L,$),p(F,l,U),E(l,l,U),p(U,R,L),E(R,R,L),v(L,F),v(z,l),x(l,U,l),x(U,R,F),p(F,l,U),E(l,l,U),v(R,l),E(U,L,z),x(l,U,o),p(l,l,L),x(U,U,l),x(l,L,z),x(L,R,n),v(R,F),c(l,R,$),c(U,L,$)}for(let B=0;B<16;B++)n[B+16]=l[B],n[B+32]=U[B],n[B+48]=R[B],n[B+64]=L[B];const b=n.subarray(32),A=n.subarray(16);I(b,b),x(A,A,b);const k=new Uint8Array(32);return h(k,A),k}t.scalarMult=N;function P(y){return N(y,s)}t.scalarMultBase=P;function K(y){if(y.length!==t.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${t.SECRET_KEY_LENGTH} bytes`);const m=new Uint8Array(y);return{publicKey:P(m),secretKey:m}}t.generateKeyPairFromSeed=K;function _(y){const m=(0,e.randomBytes)(32,y),f=K(m);return(0,r.wipe)(m),f}t.generateKeyPair=_;function O(y,m,f=!1){if(y.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(m.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const n=N(y,m);if(f){let l=0;for(let R=0;R<n.length;R++)l|=n[R];if(l===0)throw new Error("X25519: invalid shared key")}return n}t.sharedKey=O})(As);var zn=globalThis&&globalThis.__spreadArray||function(t,e,r){if(r||arguments.length===2)for(var i=0,s=e.length,o;i<s;i++)(o||!(i in e))&&(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},hf=function(){function t(e,r,i){this.name=e,this.version=r,this.os=i,this.type="browser"}return t}(),lf=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),ff=function(){function t(e,r,i,s){this.name=e,this.version=r,this.os=i,this.bot=s,this.type="bot-device"}return t}(),df=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),pf=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),gf=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,yf=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Kn=3,bf=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",gf]],Vn=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function wf(t){return t?Hn(t):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new pf:typeof navigator<"u"?Hn(navigator.userAgent):vf()}function mf(t){return t!==""&&bf.reduce(function(e,r){var i=r[0],s=r[1];if(e)return e;var o=s.exec(t);return!!o&&[i,o]},!1)}function Hn(t){var e=mf(t);if(!e)return null;var r=e[0],i=e[1];if(r==="searchbot")return new df;var s=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);s?s.length<Kn&&(s=zn(zn([],s,!0),Ef(Kn-s.length),!0)):s=[];var o=s.join("."),u=_f(t),c=yf.exec(t);return c&&c[1]?new ff(r,o,u,c[1]):new hf(r,o,u)}function _f(t){for(var e=0,r=Vn.length;e<r;e++){var i=Vn[e],s=i[0],o=i[1],u=o.exec(t);if(u)return s}return null}function vf(){var t=typeof process<"u"&&process.version;return t?new lf(process.version.slice(1)):null}function Ef(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var Ie={};Object.defineProperty(Ie,"__esModule",{value:!0});Ie.getLocalStorage=Ie.getLocalStorageOrThrow=Ie.getCrypto=Ie.getCryptoOrThrow=da=Ie.getLocation=Ie.getLocationOrThrow=Cs=Ie.getNavigator=Ie.getNavigatorOrThrow=fa=Ie.getDocument=Ie.getDocumentOrThrow=Ie.getFromWindowOrThrow=Ie.getFromWindow=void 0;function gr(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}Ie.getFromWindow=gr;function xr(t){const e=gr(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}Ie.getFromWindowOrThrow=xr;function Df(){return xr("document")}Ie.getDocumentOrThrow=Df;function Sf(){return gr("document")}var fa=Ie.getDocument=Sf;function If(){return xr("navigator")}Ie.getNavigatorOrThrow=If;function xf(){return gr("navigator")}var Cs=Ie.getNavigator=xf;function Of(){return xr("location")}Ie.getLocationOrThrow=Of;function Af(){return gr("location")}var da=Ie.getLocation=Af;function Cf(){return xr("crypto")}Ie.getCryptoOrThrow=Cf;function Tf(){return gr("crypto")}Ie.getCrypto=Tf;function Nf(){return xr("localStorage")}Ie.getLocalStorageOrThrow=Nf;function Pf(){return gr("localStorage")}Ie.getLocalStorage=Pf;var Ts={};Object.defineProperty(Ts,"__esModule",{value:!0});var pa=Ts.getWindowMetadata=void 0;const Wn=Ie;function Rf(){let t,e;try{t=Wn.getDocumentOrThrow(),e=Wn.getLocationOrThrow()}catch{return null}function r(){const E=t.getElementsByTagName("link"),x=[];for(let v=0;v<E.length;v++){const I=E[v],N=I.getAttribute("rel");if(N&&N.toLowerCase().indexOf("icon")>-1){const P=I.getAttribute("href");if(P)if(P.toLowerCase().indexOf("https:")===-1&&P.toLowerCase().indexOf("http:")===-1&&P.indexOf("//")!==0){let K=e.protocol+"//"+e.host;if(P.indexOf("/")===0)K+=P;else{const _=e.pathname.split("/");_.pop();const O=_.join("/");K+=O+"/"+P}x.push(K)}else if(P.indexOf("//")===0){const K=e.protocol+P;x.push(K)}else x.push(P)}}return x}function i(...E){const x=t.getElementsByTagName("meta");for(let v=0;v<x.length;v++){const I=x[v],N=["itemprop","property","name"].map(P=>I.getAttribute(P)).filter(P=>P?E.includes(P):!1);if(N.length&&N){const P=I.getAttribute("content");if(P)return P}}return""}function s(){let E=i("name","og:site_name","og:title","twitter:title");return E||(E=t.title),E}function o(){return i("description","og:description","twitter:description","keywords")}const u=s(),c=o(),h=e.origin,d=r();return{description:c,url:h,icons:d,name:u}}pa=Ts.getWindowMetadata=Rf;var Gr={},Uf=t=>encodeURIComponent(t).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),ga="%[a-f0-9]{2}",kn=new RegExp("("+ga+")|([^%]+?)","gi"),Gn=new RegExp("("+ga+")+","gi");function ds(t,e){try{return[decodeURIComponent(t.join(""))]}catch{}if(t.length===1)return t;e=e||1;var r=t.slice(0,e),i=t.slice(e);return Array.prototype.concat.call([],ds(r),ds(i))}function Lf(t){try{return decodeURIComponent(t)}catch{for(var e=t.match(kn)||[],r=1;r<e.length;r++)t=ds(e,r).join(""),e=t.match(kn)||[];return t}}function Ff(t){for(var e={"%FE%FF":"��","%FF%FE":"��"},r=Gn.exec(t);r;){try{e[r[0]]=decodeURIComponent(r[0])}catch{var i=Lf(r[0]);i!==r[0]&&(e[r[0]]=i)}r=Gn.exec(t)}e["%C2"]="�";for(var s=Object.keys(e),o=0;o<s.length;o++){var u=s[o];t=t.replace(new RegExp(u,"g"),e[u])}return t}var Mf=function(t){if(typeof t!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof t+"`");try{return t=t.replace(/\+/g," "),decodeURIComponent(t)}catch{return Ff(t)}},$f=(t,e)=>{if(!(typeof t=="string"&&typeof e=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(e==="")return[t];const r=t.indexOf(e);return r===-1?[t]:[t.slice(0,r),t.slice(r+e.length)]},jf=function(t,e){for(var r={},i=Object.keys(t),s=Array.isArray(e),o=0;o<i.length;o++){var u=i[o],c=t[u];(s?e.indexOf(u)!==-1:e(u,c,t))&&(r[u]=c)}return r};(function(t){const e=Uf,r=Mf,i=$f,s=jf,o=_=>_==null,u=Symbol("encodeFragmentIdentifier");function c(_){switch(_.arrayFormat){case"index":return O=>(y,m)=>{const f=y.length;return m===void 0||_.skipNull&&m===null||_.skipEmptyString&&m===""?y:m===null?[...y,[p(O,_),"[",f,"]"].join("")]:[...y,[p(O,_),"[",p(f,_),"]=",p(m,_)].join("")]};case"bracket":return O=>(y,m)=>m===void 0||_.skipNull&&m===null||_.skipEmptyString&&m===""?y:m===null?[...y,[p(O,_),"[]"].join("")]:[...y,[p(O,_),"[]=",p(m,_)].join("")];case"colon-list-separator":return O=>(y,m)=>m===void 0||_.skipNull&&m===null||_.skipEmptyString&&m===""?y:m===null?[...y,[p(O,_),":list="].join("")]:[...y,[p(O,_),":list=",p(m,_)].join("")];case"comma":case"separator":case"bracket-separator":{const O=_.arrayFormat==="bracket-separator"?"[]=":"=";return y=>(m,f)=>f===void 0||_.skipNull&&f===null||_.skipEmptyString&&f===""?m:(f=f===null?"":f,m.length===0?[[p(y,_),O,p(f,_)].join("")]:[[m,p(f,_)].join(_.arrayFormatSeparator)])}default:return O=>(y,m)=>m===void 0||_.skipNull&&m===null||_.skipEmptyString&&m===""?y:m===null?[...y,p(O,_)]:[...y,[p(O,_),"=",p(m,_)].join("")]}}function h(_){let O;switch(_.arrayFormat){case"index":return(y,m,f)=>{if(O=/\[(\d*)\]$/.exec(y),y=y.replace(/\[\d*\]$/,""),!O){f[y]=m;return}f[y]===void 0&&(f[y]={}),f[y][O[1]]=m};case"bracket":return(y,m,f)=>{if(O=/(\[\])$/.exec(y),y=y.replace(/\[\]$/,""),!O){f[y]=m;return}if(f[y]===void 0){f[y]=[m];return}f[y]=[].concat(f[y],m)};case"colon-list-separator":return(y,m,f)=>{if(O=/(:list)$/.exec(y),y=y.replace(/:list$/,""),!O){f[y]=m;return}if(f[y]===void 0){f[y]=[m];return}f[y]=[].concat(f[y],m)};case"comma":case"separator":return(y,m,f)=>{const n=typeof m=="string"&&m.includes(_.arrayFormatSeparator),l=typeof m=="string"&&!n&&E(m,_).includes(_.arrayFormatSeparator);m=l?E(m,_):m;const R=n||l?m.split(_.arrayFormatSeparator).map(U=>E(U,_)):m===null?m:E(m,_);f[y]=R};case"bracket-separator":return(y,m,f)=>{const n=/(\[\])$/.test(y);if(y=y.replace(/\[\]$/,""),!n){f[y]=m&&E(m,_);return}const l=m===null?[]:m.split(_.arrayFormatSeparator).map(R=>E(R,_));if(f[y]===void 0){f[y]=l;return}f[y]=[].concat(f[y],l)};default:return(y,m,f)=>{if(f[y]===void 0){f[y]=m;return}f[y]=[].concat(f[y],m)}}}function d(_){if(typeof _!="string"||_.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function p(_,O){return O.encode?O.strict?e(_):encodeURIComponent(_):_}function E(_,O){return O.decode?r(_):_}function x(_){return Array.isArray(_)?_.sort():typeof _=="object"?x(Object.keys(_)).sort((O,y)=>Number(O)-Number(y)).map(O=>_[O]):_}function v(_){const O=_.indexOf("#");return O!==-1&&(_=_.slice(0,O)),_}function I(_){let O="";const y=_.indexOf("#");return y!==-1&&(O=_.slice(y)),O}function N(_){_=v(_);const O=_.indexOf("?");return O===-1?"":_.slice(O+1)}function P(_,O){return O.parseNumbers&&!Number.isNaN(Number(_))&&typeof _=="string"&&_.trim()!==""?_=Number(_):O.parseBooleans&&_!==null&&(_.toLowerCase()==="true"||_.toLowerCase()==="false")&&(_=_.toLowerCase()==="true"),_}function K(_,O){O=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},O),d(O.arrayFormatSeparator);const y=h(O),m=Object.create(null);if(typeof _!="string"||(_=_.trim().replace(/^[?#&]/,""),!_))return m;for(const f of _.split("&")){if(f==="")continue;let[n,l]=i(O.decode?f.replace(/\+/g," "):f,"=");l=l===void 0?null:["comma","separator","bracket-separator"].includes(O.arrayFormat)?l:E(l,O),y(E(n,O),l,m)}for(const f of Object.keys(m)){const n=m[f];if(typeof n=="object"&&n!==null)for(const l of Object.keys(n))n[l]=P(n[l],O);else m[f]=P(n,O)}return O.sort===!1?m:(O.sort===!0?Object.keys(m).sort():Object.keys(m).sort(O.sort)).reduce((f,n)=>{const l=m[n];return l&&typeof l=="object"&&!Array.isArray(l)?f[n]=x(l):f[n]=l,f},Object.create(null))}t.extract=N,t.parse=K,t.stringify=(_,O)=>{if(!_)return"";O=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},O),d(O.arrayFormatSeparator);const y=l=>O.skipNull&&o(_[l])||O.skipEmptyString&&_[l]==="",m=c(O),f={};for(const l of Object.keys(_))y(l)||(f[l]=_[l]);const n=Object.keys(f);return O.sort!==!1&&n.sort(O.sort),n.map(l=>{const R=_[l];return R===void 0?"":R===null?p(l,O):Array.isArray(R)?R.length===0&&O.arrayFormat==="bracket-separator"?p(l,O)+"[]":R.reduce(m(l),[]).join("&"):p(l,O)+"="+p(R,O)}).filter(l=>l.length>0).join("&")},t.parseUrl=(_,O)=>{O=Object.assign({decode:!0},O);const[y,m]=i(_,"#");return Object.assign({url:y.split("?")[0]||"",query:K(N(_),O)},O&&O.parseFragmentIdentifier&&m?{fragmentIdentifier:E(m,O)}:{})},t.stringifyUrl=(_,O)=>{O=Object.assign({encode:!0,strict:!0,[u]:!0},O);const y=v(_.url).split("?")[0]||"",m=t.extract(_.url),f=t.parse(m,{sort:!1}),n=Object.assign(f,_.query);let l=t.stringify(n,O);l&&(l=`?${l}`);let R=I(_.url);return _.fragmentIdentifier&&(R=`#${O[u]?p(_.fragmentIdentifier,O):_.fragmentIdentifier}`),`${y}${l}${R}`},t.pick=(_,O,y)=>{y=Object.assign({parseFragmentIdentifier:!0,[u]:!1},y);const{url:m,query:f,fragmentIdentifier:n}=t.parseUrl(_,y);return t.stringifyUrl({url:m,query:s(f,O),fragmentIdentifier:n},y)},t.exclude=(_,O,y)=>{const m=Array.isArray(O)?f=>!O.includes(f):(f,n)=>!O(f,n);return t.pick(_,m,y)}})(Gr);const Bf={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe"}};function ya(t,e){return t.includes(":")?[t]:e.chains||[]}const ba="base10",pt="base16",ps="base64pad",Ns="utf8",wa=0,yr=1,qf=0,Yn=1,gs=12,Ps=32;function zf(){const t=As.generateKeyPair();return{privateKey:gt(t.secretKey,pt),publicKey:gt(t.publicKey,pt)}}function ys(){const t=Ir.randomBytes(Ps);return gt(t,pt)}function Kf(t,e){const r=As.sharedKey(bt(t,pt),bt(e,pt)),i=new uf(Ci.SHA256,r).expand(Ps);return gt(i,pt)}function Vf(t){const e=Ci.hash(bt(t,pt));return gt(e,pt)}function Dr(t){const e=Ci.hash(bt(t,Ns));return gt(e,pt)}function Hf(t){return bt(`${t}`,ba)}function Qr(t){return Number(gt(t,ba))}function Wf(t){const e=Hf(typeof t.type<"u"?t.type:wa);if(Qr(e)===yr&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?bt(t.senderPublicKey,pt):void 0,i=typeof t.iv<"u"?bt(t.iv,pt):Ir.randomBytes(gs),s=new xs.ChaCha20Poly1305(bt(t.symKey,pt)).seal(i,bt(t.message,Ns));return Gf({type:e,sealed:s,iv:i,senderPublicKey:r})}function kf(t){const e=new xs.ChaCha20Poly1305(bt(t.symKey,pt)),{sealed:r,iv:i}=wi(t.encoded),s=e.open(i,r);if(s===null)throw new Error("Failed to decrypt");return gt(s,Ns)}function Gf(t){if(Qr(t.type)===yr){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return gt(ls([t.type,t.senderPublicKey,t.iv,t.sealed]),ps)}return gt(ls([t.type,t.iv,t.sealed]),ps)}function wi(t){const e=bt(t,ps),r=e.slice(qf,Yn),i=Yn;if(Qr(r)===yr){const c=i+Ps,h=c+gs,d=e.slice(i,c),p=e.slice(c,h),E=e.slice(h);return{type:r,sealed:E,iv:p,senderPublicKey:d}}const s=i+gs,o=e.slice(i,s),u=e.slice(s);return{type:r,sealed:u,iv:o}}function Yf(t,e){const r=wi(t);return ma({type:Qr(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?gt(r.senderPublicKey,pt):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function ma(t){const e=(t==null?void 0:t.type)||wa;if(e===yr){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function Jn(t){return t.type===yr&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}var Jf=Object.defineProperty,Xn=Object.getOwnPropertySymbols,Xf=Object.prototype.hasOwnProperty,Qf=Object.prototype.propertyIsEnumerable,Qn=(t,e,r)=>e in t?Jf(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Zn=(t,e)=>{for(var r in e||(e={}))Xf.call(e,r)&&Qn(t,r,e[r]);if(Xn)for(var r of Xn(e))Qf.call(e,r)&&Qn(t,r,e[r]);return t};const Zf="ReactNative",Yt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},ed="js";function Rs(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function _a(){return!fa()&&!!Cs()&&navigator.product===Zf}function Us(){return!Rs()&&!!Cs()}function Ls(){return _a()?Yt.reactNative:Rs()?Yt.node:Us()?Yt.browser:Yt.unknown}function td(t,e){let r=Gr.parse(t);return r=Zn(Zn({},r),e),t=Gr.stringify(r),t}function rd(){return pa()||{name:"",description:"",url:"",icons:[""]}}function id(){if(Ls()===Yt.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:i}=global.Platform;return[r,i].join("-")}const t=wf();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function sd(){var t;const e=Ls();return e===Yt.browser?[e,((t=da())==null?void 0:t.host)||"unknown"].join(":"):e}function nd(t,e,r){const i=id(),s=sd();return[[t,e].join("-"),[ed,r].join("-"),i,s].join("/")}function od({protocol:t,version:e,relayUrl:r,sdkVersion:i,auth:s,projectId:o,useOnCloseEvent:u}){const c=r.split("?"),h=nd(t,e,i),d={auth:s,ua:h,projectId:o,useOnCloseEvent:u||void 0},p=td(c[1]||"",d);return c[0]+"?"+p}function lr(t,e){return t.filter(r=>e.includes(r)).length===t.length}function va(t){return Object.fromEntries(t.entries())}function Ea(t){return new Map(Object.entries(t))}function vr(t=Q.FIVE_MINUTES,e){const r=Q.toMiliseconds(t||Q.FIVE_MINUTES);let i,s,o;return{resolve:u=>{o&&i&&(clearTimeout(o),i(u))},reject:u=>{o&&s&&(clearTimeout(o),s(u))},done:()=>new Promise((u,c)=>{o=setTimeout(()=>{c(new Error(e))},r),i=u,s=c})}}function mi(t,e,r){return new Promise(async(i,s)=>{const o=setTimeout(()=>s(new Error(r)),e);try{const u=await t;i(u)}catch(u){s(u)}clearTimeout(o)})}function Da(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function ad(t){return Da("topic",t)}function cd(t){return Da("id",t)}function Sa(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function Tt(t,e){return Q.fromMiliseconds((e||Date.now())+Q.toMiliseconds(t))}function Gt(t){return Date.now()>=Q.toMiliseconds(t)}function qe(t,e){return`${t}${e?`:${e}`:""}`}async function ud({id:t,topic:e,wcDeepLink:r}){try{if(!r)return;const i=typeof r=="string"?JSON.parse(r):r;let s=i==null?void 0:i.href;if(typeof s!="string")return;s.endsWith("/")&&(s=s.slice(0,-1));const o=`${s}/wc?requestId=${t}&sessionTopic=${e}`,u=Ls();u===Yt.browser?o.startsWith("https://")?window.open(o,"_blank","noreferrer noopener"):window.open(o,"_self","noreferrer noopener"):u===Yt.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(i){console.error(i)}}const hd="irn";function bs(t){return(t==null?void 0:t.relay)||{protocol:hd}}function di(t){const e=Bf[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var ld=Object.defineProperty,eo=Object.getOwnPropertySymbols,fd=Object.prototype.hasOwnProperty,dd=Object.prototype.propertyIsEnumerable,to=(t,e,r)=>e in t?ld(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,pd=(t,e)=>{for(var r in e||(e={}))fd.call(e,r)&&to(t,r,e[r]);if(eo)for(var r of eo(e))dd.call(e,r)&&to(t,r,e[r]);return t};function gd(t,e="-"){const r={},i="relay"+e;return Object.keys(t).forEach(s=>{if(s.startsWith(i)){const o=s.replace(i,""),u=t[s];r[o]=u}}),r}function yd(t){const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,i=t.substring(0,e),s=t.substring(e+1,r).split("@"),o=typeof r<"u"?t.substring(r):"",u=Gr.parse(o);return{protocol:i,topic:bd(s[0]),version:parseInt(s[1],10),symKey:u.symKey,relay:gd(u)}}function bd(t){return t.startsWith("//")?t.substring(2):t}function wd(t,e="-"){const r="relay",i={};return Object.keys(t).forEach(s=>{const o=r+e+s;t[s]&&(i[o]=t[s])}),i}function md(t){return`${t.protocol}:${t.topic}@${t.version}?`+Gr.stringify(pd({symKey:t.symKey},wd(t.relay)))}function Or(t){const e=[];return t.forEach(r=>{const[i,s]=r.split(":");e.push(`${i}:${s}`)}),e}function _d(t){const e=[];return Object.values(t).forEach(r=>{e.push(...Or(r.accounts))}),e}function vd(t,e){const r=[];return Object.values(t).forEach(i=>{Or(i.accounts).includes(e)&&r.push(...i.methods)}),r}function Ed(t,e){const r=[];return Object.values(t).forEach(i=>{Or(i.accounts).includes(e)&&r.push(...i.events)}),r}function Dd(t,e){const r=pi(t,e);if(r)throw new Error(r.message);const i={};for(const[s,o]of Object.entries(t))i[s]={methods:o.methods,events:o.events,chains:o.accounts.map(u=>`${u.split(":")[0]}:${u.split(":")[1]}`)};return i}const Sd={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Id={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function G(t,e){const{message:r,code:i}=Id[t];return{message:e?`${r} ${e}`:r,code:i}}function Ze(t,e){const{message:r,code:i}=Sd[t];return{message:e?`${r} ${e}`:r,code:i}}function Zr(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function Hr(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function dt(t){return typeof t>"u"}function et(t,e){return e&&dt(t)?!0:typeof t=="string"&&!!t.trim().length}function Fs(t,e){return e&&dt(t)?!0:typeof t=="number"&&!isNaN(t)}function xd(t,e){const{requiredNamespaces:r}=e,i=Object.keys(t.namespaces),s=Object.keys(r);let o=!0;return lr(s,i)?(i.forEach(u=>{const{accounts:c,methods:h,events:d}=t.namespaces[u],p=Or(c),E=r[u];(!lr(ya(u,E),p)||!lr(E.methods,h)||!lr(E.events,d))&&(o=!1)}),o):!1}function _i(t){return et(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function Od(t){if(et(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&_i(r)}}return!1}function Ad(t){if(et(t,!1))try{return typeof new URL(t)<"u"}catch{return!1}return!1}function Cd(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function Td(t){return t==null?void 0:t.topic}function Nd(t,e){let r=null;return et(t==null?void 0:t.publicKey,!1)||(r=G("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function ro(t){let e=!0;return Zr(t)?t.length&&(e=t.every(r=>et(r,!1))):e=!1,e}function Pd(t,e,r){let i=null;return Zr(e)&&e.length?e.forEach(s=>{i||_i(s)||(i=Ze("UNSUPPORTED_CHAINS",`${r}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):_i(t)||(i=Ze("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function Rd(t,e,r){let i=null;return Object.entries(t).forEach(([s,o])=>{if(i)return;const u=Pd(s,ya(s,o),`${e} ${r}`);u&&(i=u)}),i}function Ud(t,e){let r=null;return Zr(t)?t.forEach(i=>{r||Od(i)||(r=Ze("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):r=Ze("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function Ld(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const s=Ud(i==null?void 0:i.accounts,`${e} namespace`);s&&(r=s)}),r}function Fd(t,e){let r=null;return ro(t==null?void 0:t.methods)?ro(t==null?void 0:t.events)||(r=Ze("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=Ze("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function Ia(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const s=Fd(i,`${e}, namespace`);s&&(r=s)}),r}function Md(t,e,r){let i=null;if(t&&Hr(t)){const s=Ia(t,e);s&&(i=s);const o=Rd(t,e,r);o&&(i=o)}else i=G("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return i}function pi(t,e){let r=null;if(t&&Hr(t)){const i=Ia(t,e);i&&(r=i);const s=Ld(t,e);s&&(r=s)}else r=G("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function xa(t){return et(t.protocol,!0)}function $d(t,e){let r=!1;return e&&!t?r=!0:t&&Zr(t)&&t.length&&t.forEach(i=>{r=xa(i)}),r}function jd(t){return typeof t=="number"}function yt(t){return typeof t<"u"&&typeof t!==null}function Bd(t){return!(!t||typeof t!="object"||!t.code||!Fs(t.code,!1)||!t.message||!et(t.message,!1))}function qd(t){return!(dt(t)||!et(t.method,!1))}function zd(t){return!(dt(t)||dt(t.result)&&dt(t.error)||!Fs(t.id,!1)||!et(t.jsonrpc,!1))}function Kd(t){return!(dt(t)||!et(t.name,!1))}function io(t,e){return!(!_i(e)||!_d(t).includes(e))}function Vd(t,e,r){return et(r,!1)?vd(t,e).includes(r):!1}function Hd(t,e,r){return et(r,!1)?Ed(t,e).includes(r):!1}function so(t,e,r){let i=null;const s=Wd(t),o=kd(e),u=Object.keys(s),c=Object.keys(o),h=no(Object.keys(t)),d=no(Object.keys(e)),p=h.filter(E=>!d.includes(E));return p.length&&(i=G("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${p.toString()}
      Received: ${Object.keys(e).toString()}`)),lr(u,c)||(i=G("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${u.toString()}
      Approved: ${c.toString()}`)),Object.keys(e).forEach(E=>{if(!E.includes(":")||i)return;const x=Or(e[E].accounts);x.includes(E)||(i=G("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${E}
        Required: ${E}
        Approved: ${x.toString()}`))}),u.forEach(E=>{i||(lr(s[E].methods,o[E].methods)?lr(s[E].events,o[E].events)||(i=G("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${E}`)):i=G("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${E}`))}),i}function Wd(t){const e={};return Object.keys(t).forEach(r=>{var i;r.includes(":")?e[r]=t[r]:(i=t[r].chains)==null||i.forEach(s=>{e[s]={methods:t[r].methods,events:t[r].events}})}),e}function no(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function kd(t){const e={};return Object.keys(t).forEach(r=>{if(r.includes(":"))e[r]=t[r];else{const i=Or(t[r].accounts);i==null||i.forEach(s=>{e[s]={accounts:t[r].accounts.filter(o=>o.includes(`${s}:`)),methods:t[r].methods,events:t[r].events}})}}),e}function Gd(t,e){return Fs(t,!1)&&t<=e.max&&t>=e.min}const Yd="PARSE_ERROR",Jd="INVALID_REQUEST",Xd="METHOD_NOT_FOUND",Qd="INVALID_PARAMS",Oa="INTERNAL_ERROR",Ms="SERVER_ERROR",Zd=[-32700,-32600,-32601,-32602,-32603],Wr={[Yd]:{code:-32700,message:"Parse error"},[Jd]:{code:-32600,message:"Invalid Request"},[Xd]:{code:-32601,message:"Method not found"},[Qd]:{code:-32602,message:"Invalid params"},[Oa]:{code:-32603,message:"Internal error"},[Ms]:{code:-32e3,message:"Server error"}},Aa=Ms;function ep(t){return Zd.includes(t)}function oo(t){return Object.keys(Wr).includes(t)?Wr[t]:Wr[Aa]}function tp(t){const e=Object.values(Wr).find(r=>r.code===t);return e||Wr[Aa]}function rp(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var Ca={},Bt={},ao;function ip(){if(ao)return Bt;ao=1,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.isBrowserCryptoAvailable=Bt.getSubtleCrypto=Bt.getBrowerCrypto=void 0;function t(){return(ht.commonjsGlobal===null||ht.commonjsGlobal===void 0?void 0:ht.commonjsGlobal.crypto)||(ht.commonjsGlobal===null||ht.commonjsGlobal===void 0?void 0:ht.commonjsGlobal.msCrypto)||{}}Bt.getBrowerCrypto=t;function e(){const i=t();return i.subtle||i.webkitSubtle}Bt.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return Bt.isBrowserCryptoAvailable=r,Bt}var qt={},co;function sp(){if(co)return qt;co=1,Object.defineProperty(qt,"__esModule",{value:!0}),qt.isBrowser=qt.isNode=qt.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}qt.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}qt.isNode=e;function r(){return!t()&&!e()}return qt.isBrowser=r,qt}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ot;e.__exportStar(ip(),t),e.__exportStar(sp(),t)})(Ca);function Ta(t=3){const e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function $s(t=6){return BigInt(Ta(t))}function Ti(t,e,r){return{id:r||Ta(),jsonrpc:"2.0",method:t,params:e}}function js(t,e){return{id:t,jsonrpc:"2.0",result:e}}function Bs(t,e,r){return{id:t,jsonrpc:"2.0",error:np(e,r)}}function np(t,e){return typeof t>"u"?oo(Oa):(typeof t=="string"&&(t=Object.assign(Object.assign({},oo(Ms)),{message:t})),typeof e<"u"&&(t.data=e),ep(t.code)&&(t=tp(t.code)),t)}class op{}class ap extends op{constructor(){super()}}class cp extends ap{constructor(e){super()}}const up="^wss?:";function hp(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function lp(t,e){const r=hp(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function uo(t){return lp(t,up)}function fp(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function Na(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function qs(t){return Na(t)&&"method"in t}function Ni(t){return Na(t)&&(zt(t)||Nt(t))}function zt(t){return"result"in t}function Nt(t){return"error"in t}class dp extends cp{constructor(e){super(e),this.events=new xt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(Ti(e.method,e.params||[],e.id||$s().toString()),r)}async requestStrict(e,r){return new Promise(async(i,s)=>{if(!this.connection.connected)try{await this.open()}catch(o){s(o)}this.events.on(`${e.id}`,o=>{Nt(o)?s(o.error):i(o.result)});try{await this.connection.send(e,r)}catch(o){s(o)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Ni(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}var Wi,ho;function pp(){return ho||(ho=1,Wi=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}),Wi}const gp=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:pp(),yp=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",lo=t=>t.split("?")[0],fo=10,bp=gp();class wp{constructor(e){if(this.url=e,this.events=new xt.EventEmitter,this.registering=!1,!uo(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),e()},this.socket.close()})}async send(e,r){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Ds(e))}catch(i){this.onError(e.id,i)}}register(e=this.url){if(!uo(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,s)=>{this.events.once("register_error",o=>{this.resetMaxListeners(),s(o)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,i)=>{const s=Ca.isReactNative()?void 0:{rejectUnauthorized:!fp(e)},o=new bp(e,[],s);yp()?o.onerror=u=>{const c=u;i(this.emitError(c.error))}:o.on("error",u=>{i(this.emitError(u))}),o.onopen=()=>{this.onOpen(o),r(o)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Ho(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),s=i.message||i.toString(),o=Bs(e,s);this.events.emit("payload",o)}parseError(e,r=this.url){return rp(e,lo(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>fo&&this.events.setMaxListeners(fo)}emitError(e){const r=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${lo(this.url)}`));return this.events.emit("register_error",r),r}}var vi={exports:{}};vi.exports;(function(t,e){var r=200,i="__lodash_hash_undefined__",s=1,o=2,u=9007199254740991,c="[object Arguments]",h="[object Array]",d="[object AsyncFunction]",p="[object Boolean]",E="[object Date]",x="[object Error]",v="[object Function]",I="[object GeneratorFunction]",N="[object Map]",P="[object Number]",K="[object Null]",_="[object Object]",O="[object Promise]",y="[object Proxy]",m="[object RegExp]",f="[object Set]",n="[object String]",l="[object Symbol]",R="[object Undefined]",U="[object WeakMap]",L="[object ArrayBuffer]",F="[object DataView]",z="[object Float32Array]",b="[object Float64Array]",A="[object Int8Array]",k="[object Int16Array]",B="[object Int32Array]",$="[object Uint8Array]",q="[object Uint8ClampedArray]",M="[object Uint16Array]",V="[object Uint32Array]",te=/[\\^$.*+?()[\]{}|]/g,H=/^\[object .+?Constructor\]$/,Z=/^(?:0|[1-9]\d*)$/,J={};J[z]=J[b]=J[A]=J[k]=J[B]=J[$]=J[q]=J[M]=J[V]=!0,J[c]=J[h]=J[L]=J[p]=J[F]=J[E]=J[x]=J[v]=J[N]=J[P]=J[_]=J[m]=J[f]=J[n]=J[U]=!1;var ee=typeof ht.commonjsGlobal=="object"&&ht.commonjsGlobal&&ht.commonjsGlobal.Object===Object&&ht.commonjsGlobal,T=typeof self=="object"&&self&&self.Object===Object&&self,C=ee||T||Function("return this")(),D=e&&!e.nodeType&&e,a=D&&!0&&t&&!t.nodeType&&t,w=a&&a.exports===D,W=w&&ee.process,Y=function(){try{return W&&W.binding&&W.binding("util")}catch{}}(),le=Y&&Y.isTypedArray;function be(g,S){for(var j=-1,X=g==null?0:g.length,xe=0,ne=[];++j<X;){var Re=g[j];S(Re,j,g)&&(ne[xe++]=Re)}return ne}function de(g,S){for(var j=-1,X=S.length,xe=g.length;++j<X;)g[xe+j]=S[j];return g}function ve(g,S){for(var j=-1,X=g==null?0:g.length;++j<X;)if(S(g[j],j,g))return!0;return!1}function Le(g,S){for(var j=-1,X=Array(g);++j<g;)X[j]=S(j);return X}function Te(g){return function(S){return g(S)}}function ye(g,S){return g.has(S)}function pe(g,S){return g==null?void 0:g[S]}function fe(g){var S=-1,j=Array(g.size);return g.forEach(function(X,xe){j[++S]=[xe,X]}),j}function ue(g,S){return function(j){return g(S(j))}}function ce(g){var S=-1,j=Array(g.size);return g.forEach(function(X){j[++S]=X}),j}var ae=Array.prototype,oe=Function.prototype,re=Object.prototype,he=C["__core-js_shared__"],ge=oe.toString,ie=re.hasOwnProperty,we=function(){var g=/[^.]+$/.exec(he&&he.keys&&he.keys.IE_PROTO||"");return g?"Symbol(src)_1."+g:""}(),_e=re.toString,De=RegExp("^"+ge.call(ie).replace(te,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Se=w?C.Buffer:void 0,Ee=C.Symbol,At=C.Uint8Array,Pt=re.propertyIsEnumerable,Kt=ae.splice,wt=Ee?Ee.toStringTag:void 0,Zt=Object.getOwnPropertySymbols,Ar=Se?Se.isBuffer:void 0,ti=ue(Object.keys,Object),Fe=br(C,"DataView"),Ne=br(C,"Map"),Me=br(C,"Promise"),$e=br(C,"Set"),je=br(C,"WeakMap"),Pe=br(Object,"create"),Ke=tr(Fe),Ve=tr(Ne),He=tr(Me),We=tr($e),ke=tr(je),ze=Ee?Ee.prototype:void 0,Be=ze?ze.valueOf:void 0;function Oe(g){var S=-1,j=g==null?0:g.length;for(this.clear();++S<j;){var X=g[S];this.set(X[0],X[1])}}function Ge(){this.__data__=Pe?Pe(null):{},this.size=0}function Ye(g){var S=this.has(g)&&delete this.__data__[g];return this.size-=S?1:0,S}function Xa(g){var S=this.__data__;if(Pe){var j=S[g];return j===i?void 0:j}return ie.call(S,g)?S[g]:void 0}function Qa(g){var S=this.__data__;return Pe?S[g]!==void 0:ie.call(S,g)}function Za(g,S){var j=this.__data__;return this.size+=this.has(g)?0:1,j[g]=Pe&&S===void 0?i:S,this}Oe.prototype.clear=Ge,Oe.prototype.delete=Ye,Oe.prototype.get=Xa,Oe.prototype.has=Qa,Oe.prototype.set=Za;function $t(g){var S=-1,j=g==null?0:g.length;for(this.clear();++S<j;){var X=g[S];this.set(X[0],X[1])}}function ec(){this.__data__=[],this.size=0}function tc(g){var S=this.__data__,j=ii(S,g);if(j<0)return!1;var X=S.length-1;return j==X?S.pop():Kt.call(S,j,1),--this.size,!0}function rc(g){var S=this.__data__,j=ii(S,g);return j<0?void 0:S[j][1]}function ic(g){return ii(this.__data__,g)>-1}function sc(g,S){var j=this.__data__,X=ii(j,g);return X<0?(++this.size,j.push([g,S])):j[X][1]=S,this}$t.prototype.clear=ec,$t.prototype.delete=tc,$t.prototype.get=rc,$t.prototype.has=ic,$t.prototype.set=sc;function er(g){var S=-1,j=g==null?0:g.length;for(this.clear();++S<j;){var X=g[S];this.set(X[0],X[1])}}function nc(){this.size=0,this.__data__={hash:new Oe,map:new(Ne||$t),string:new Oe}}function oc(g){var S=si(this,g).delete(g);return this.size-=S?1:0,S}function ac(g){return si(this,g).get(g)}function cc(g){return si(this,g).has(g)}function uc(g,S){var j=si(this,g),X=j.size;return j.set(g,S),this.size+=j.size==X?0:1,this}er.prototype.clear=nc,er.prototype.delete=oc,er.prototype.get=ac,er.prototype.has=cc,er.prototype.set=uc;function ri(g){var S=-1,j=g==null?0:g.length;for(this.__data__=new er;++S<j;)this.add(g[S])}function hc(g){return this.__data__.set(g,i),this}function lc(g){return this.__data__.has(g)}ri.prototype.add=ri.prototype.push=hc,ri.prototype.has=lc;function Vt(g){var S=this.__data__=new $t(g);this.size=S.size}function fc(){this.__data__=new $t,this.size=0}function dc(g){var S=this.__data__,j=S.delete(g);return this.size=S.size,j}function pc(g){return this.__data__.get(g)}function gc(g){return this.__data__.has(g)}function yc(g,S){var j=this.__data__;if(j instanceof $t){var X=j.__data__;if(!Ne||X.length<r-1)return X.push([g,S]),this.size=++j.size,this;j=this.__data__=new er(X)}return j.set(g,S),this.size=j.size,this}Vt.prototype.clear=fc,Vt.prototype.delete=dc,Vt.prototype.get=pc,Vt.prototype.has=gc,Vt.prototype.set=yc;function bc(g,S){var j=ni(g),X=!j&&Pc(g),xe=!j&&!X&&Ui(g),ne=!j&&!X&&!xe&&en(g),Re=j||X||xe||ne,Je=Re?Le(g.length,String):[],tt=Je.length;for(var Ce in g)(S||ie.call(g,Ce))&&!(Re&&(Ce=="length"||xe&&(Ce=="offset"||Ce=="parent")||ne&&(Ce=="buffer"||Ce=="byteLength"||Ce=="byteOffset")||Oc(Ce,tt)))&&Je.push(Ce);return Je}function ii(g,S){for(var j=g.length;j--;)if(Js(g[j][0],S))return j;return-1}function wc(g,S,j){var X=S(g);return ni(g)?X:de(X,j(g))}function Cr(g){return g==null?g===void 0?R:K:wt&&wt in Object(g)?Ic(g):Nc(g)}function Ws(g){return Tr(g)&&Cr(g)==c}function ks(g,S,j,X,xe){return g===S?!0:g==null||S==null||!Tr(g)&&!Tr(S)?g!==g&&S!==S:mc(g,S,j,X,ks,xe)}function mc(g,S,j,X,xe,ne){var Re=ni(g),Je=ni(S),tt=Re?h:Ht(g),Ce=Je?h:Ht(S);tt=tt==c?_:tt,Ce=Ce==c?_:Ce;var mt=tt==_,Ct=Ce==_,nt=tt==Ce;if(nt&&Ui(g)){if(!Ui(S))return!1;Re=!0,mt=!1}if(nt&&!mt)return ne||(ne=new Vt),Re||en(g)?Gs(g,S,j,X,xe,ne):Dc(g,S,tt,j,X,xe,ne);if(!(j&s)){var vt=mt&&ie.call(g,"__wrapped__"),Et=Ct&&ie.call(S,"__wrapped__");if(vt||Et){var Wt=vt?g.value():g,jt=Et?S.value():S;return ne||(ne=new Vt),xe(Wt,jt,j,X,ne)}}return nt?(ne||(ne=new Vt),Sc(g,S,j,X,xe,ne)):!1}function _c(g){if(!Zs(g)||Cc(g))return!1;var S=Xs(g)?De:H;return S.test(tr(g))}function vc(g){return Tr(g)&&Qs(g.length)&&!!J[Cr(g)]}function Ec(g){if(!Tc(g))return ti(g);var S=[];for(var j in Object(g))ie.call(g,j)&&j!="constructor"&&S.push(j);return S}function Gs(g,S,j,X,xe,ne){var Re=j&s,Je=g.length,tt=S.length;if(Je!=tt&&!(Re&&tt>Je))return!1;var Ce=ne.get(g);if(Ce&&ne.get(S))return Ce==S;var mt=-1,Ct=!0,nt=j&o?new ri:void 0;for(ne.set(g,S),ne.set(S,g);++mt<Je;){var vt=g[mt],Et=S[mt];if(X)var Wt=Re?X(Et,vt,mt,S,g,ne):X(vt,Et,mt,g,S,ne);if(Wt!==void 0){if(Wt)continue;Ct=!1;break}if(nt){if(!ve(S,function(jt,rr){if(!ye(nt,rr)&&(vt===jt||xe(vt,jt,j,X,ne)))return nt.push(rr)})){Ct=!1;break}}else if(!(vt===Et||xe(vt,Et,j,X,ne))){Ct=!1;break}}return ne.delete(g),ne.delete(S),Ct}function Dc(g,S,j,X,xe,ne,Re){switch(j){case F:if(g.byteLength!=S.byteLength||g.byteOffset!=S.byteOffset)return!1;g=g.buffer,S=S.buffer;case L:return!(g.byteLength!=S.byteLength||!ne(new At(g),new At(S)));case p:case E:case P:return Js(+g,+S);case x:return g.name==S.name&&g.message==S.message;case m:case n:return g==S+"";case N:var Je=fe;case f:var tt=X&s;if(Je||(Je=ce),g.size!=S.size&&!tt)return!1;var Ce=Re.get(g);if(Ce)return Ce==S;X|=o,Re.set(g,S);var mt=Gs(Je(g),Je(S),X,xe,ne,Re);return Re.delete(g),mt;case l:if(Be)return Be.call(g)==Be.call(S)}return!1}function Sc(g,S,j,X,xe,ne){var Re=j&s,Je=Ys(g),tt=Je.length,Ce=Ys(S),mt=Ce.length;if(tt!=mt&&!Re)return!1;for(var Ct=tt;Ct--;){var nt=Je[Ct];if(!(Re?nt in S:ie.call(S,nt)))return!1}var vt=ne.get(g);if(vt&&ne.get(S))return vt==S;var Et=!0;ne.set(g,S),ne.set(S,g);for(var Wt=Re;++Ct<tt;){nt=Je[Ct];var jt=g[nt],rr=S[nt];if(X)var tn=Re?X(rr,jt,nt,S,g,ne):X(jt,rr,nt,g,S,ne);if(!(tn===void 0?jt===rr||xe(jt,rr,j,X,ne):tn)){Et=!1;break}Wt||(Wt=nt=="constructor")}if(Et&&!Wt){var oi=g.constructor,ai=S.constructor;oi!=ai&&"constructor"in g&&"constructor"in S&&!(typeof oi=="function"&&oi instanceof oi&&typeof ai=="function"&&ai instanceof ai)&&(Et=!1)}return ne.delete(g),ne.delete(S),Et}function Ys(g){return wc(g,Lc,xc)}function si(g,S){var j=g.__data__;return Ac(S)?j[typeof S=="string"?"string":"hash"]:j.map}function br(g,S){var j=pe(g,S);return _c(j)?j:void 0}function Ic(g){var S=ie.call(g,wt),j=g[wt];try{g[wt]=void 0;var X=!0}catch{}var xe=_e.call(g);return X&&(S?g[wt]=j:delete g[wt]),xe}var xc=Zt?function(g){return g==null?[]:(g=Object(g),be(Zt(g),function(S){return Pt.call(g,S)}))}:Fc,Ht=Cr;(Fe&&Ht(new Fe(new ArrayBuffer(1)))!=F||Ne&&Ht(new Ne)!=N||Me&&Ht(Me.resolve())!=O||$e&&Ht(new $e)!=f||je&&Ht(new je)!=U)&&(Ht=function(g){var S=Cr(g),j=S==_?g.constructor:void 0,X=j?tr(j):"";if(X)switch(X){case Ke:return F;case Ve:return N;case He:return O;case We:return f;case ke:return U}return S});function Oc(g,S){return S=S??u,!!S&&(typeof g=="number"||Z.test(g))&&g>-1&&g%1==0&&g<S}function Ac(g){var S=typeof g;return S=="string"||S=="number"||S=="symbol"||S=="boolean"?g!=="__proto__":g===null}function Cc(g){return!!we&&we in g}function Tc(g){var S=g&&g.constructor,j=typeof S=="function"&&S.prototype||re;return g===j}function Nc(g){return _e.call(g)}function tr(g){if(g!=null){try{return ge.call(g)}catch{}try{return g+""}catch{}}return""}function Js(g,S){return g===S||g!==g&&S!==S}var Pc=Ws(function(){return arguments}())?Ws:function(g){return Tr(g)&&ie.call(g,"callee")&&!Pt.call(g,"callee")},ni=Array.isArray;function Rc(g){return g!=null&&Qs(g.length)&&!Xs(g)}var Ui=Ar||Mc;function Uc(g,S){return ks(g,S)}function Xs(g){if(!Zs(g))return!1;var S=Cr(g);return S==v||S==I||S==d||S==y}function Qs(g){return typeof g=="number"&&g>-1&&g%1==0&&g<=u}function Zs(g){var S=typeof g;return g!=null&&(S=="object"||S=="function")}function Tr(g){return g!=null&&typeof g=="object"}var en=le?Te(le):vc;function Lc(g){return Rc(g)?bc(g):Ec(g)}function Fc(){return[]}function Mc(){return!1}t.exports=Uc})(vi,vi.exports);var mp=vi.exports;const _p=ht.getDefaultExportFromCjs(mp);function vp(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var o=t.charAt(s),u=o.charCodeAt(0);if(r[u]!==255)throw new TypeError(o+" is ambiguous");r[u]=s}var c=t.length,h=t.charAt(0),d=Math.log(c)/Math.log(256),p=Math.log(256)/Math.log(c);function E(I){if(I instanceof Uint8Array||(ArrayBuffer.isView(I)?I=new Uint8Array(I.buffer,I.byteOffset,I.byteLength):Array.isArray(I)&&(I=Uint8Array.from(I))),!(I instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(I.length===0)return"";for(var N=0,P=0,K=0,_=I.length;K!==_&&I[K]===0;)K++,N++;for(var O=(_-K)*p+1>>>0,y=new Uint8Array(O);K!==_;){for(var m=I[K],f=0,n=O-1;(m!==0||f<P)&&n!==-1;n--,f++)m+=256*y[n]>>>0,y[n]=m%c>>>0,m=m/c>>>0;if(m!==0)throw new Error("Non-zero carry");P=f,K++}for(var l=O-P;l!==O&&y[l]===0;)l++;for(var R=h.repeat(N);l<O;++l)R+=t.charAt(y[l]);return R}function x(I){if(typeof I!="string")throw new TypeError("Expected String");if(I.length===0)return new Uint8Array;var N=0;if(I[N]!==" "){for(var P=0,K=0;I[N]===h;)P++,N++;for(var _=(I.length-N)*d+1>>>0,O=new Uint8Array(_);I[N];){var y=r[I.charCodeAt(N)];if(y===255)return;for(var m=0,f=_-1;(y!==0||m<K)&&f!==-1;f--,m++)y+=c*O[f]>>>0,O[f]=y%256>>>0,y=y/256>>>0;if(y!==0)throw new Error("Non-zero carry");K=m,N++}if(I[N]!==" "){for(var n=_-K;n!==_&&O[n]===0;)n++;for(var l=new Uint8Array(P+(_-n)),R=P;n!==_;)l[R++]=O[n++];return l}}}function v(I){var N=x(I);if(N)return N;throw new Error(`Non-${e} character`)}return{encode:E,decodeUnsafe:x,decode:v}}var Ep=vp,Dp=Ep;const Pa=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Sp=t=>new TextEncoder().encode(t),Ip=t=>new TextDecoder().decode(t);class xp{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Op{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Ra(this,e)}}class Ap{constructor(e){this.decoders=e}or(e){return Ra(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Ra=(t,e)=>new Ap({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class Cp{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new xp(e,r,i),this.decoder=new Op(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Pi=({name:t,prefix:e,encode:r,decode:i})=>new Cp(t,e,r,i),ei=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=Dp(r,e);return Pi({prefix:t,name:e,encode:i,decode:o=>Pa(s(o))})},Tp=(t,e,r,i)=>{const s={};for(let p=0;p<e.length;++p)s[e[p]]=p;let o=t.length;for(;t[o-1]==="=";)--o;const u=new Uint8Array(o*r/8|0);let c=0,h=0,d=0;for(let p=0;p<o;++p){const E=s[t[p]];if(E===void 0)throw new SyntaxError(`Non-${i} character`);h=h<<r|E,c+=r,c>=8&&(c-=8,u[d++]=255&h>>c)}if(c>=r||255&h<<8-c)throw new SyntaxError("Unexpected end of data");return u},Np=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let o="",u=0,c=0;for(let h=0;h<t.length;++h)for(c=c<<8|t[h],u+=8;u>r;)u-=r,o+=e[s&c>>u];if(u&&(o+=e[s&c<<r-u]),i)for(;o.length*r&7;)o+="=";return o},st=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>Pi({prefix:e,name:t,encode(s){return Np(s,i,r)},decode(s){return Tp(s,i,r,t)}}),Pp=Pi({prefix:"\0",name:"identity",encode:t=>Ip(t),decode:t=>Sp(t)});var Rp=Object.freeze({__proto__:null,identity:Pp});const Up=st({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Lp=Object.freeze({__proto__:null,base2:Up});const Fp=st({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Mp=Object.freeze({__proto__:null,base8:Fp});const $p=ei({prefix:"9",name:"base10",alphabet:"0123456789"});var jp=Object.freeze({__proto__:null,base10:$p});const Bp=st({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),qp=st({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var zp=Object.freeze({__proto__:null,base16:Bp,base16upper:qp});const Kp=st({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Vp=st({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Hp=st({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Wp=st({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),kp=st({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Gp=st({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Yp=st({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Jp=st({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Xp=st({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Qp=Object.freeze({__proto__:null,base32:Kp,base32upper:Vp,base32pad:Hp,base32padupper:Wp,base32hex:kp,base32hexupper:Gp,base32hexpad:Yp,base32hexpadupper:Jp,base32z:Xp});const Zp=ei({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),eg=ei({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var tg=Object.freeze({__proto__:null,base36:Zp,base36upper:eg});const rg=ei({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),ig=ei({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var sg=Object.freeze({__proto__:null,base58btc:rg,base58flickr:ig});const ng=st({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),og=st({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ag=st({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),cg=st({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var ug=Object.freeze({__proto__:null,base64:ng,base64pad:og,base64url:ag,base64urlpad:cg});const Ua=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),hg=Ua.reduce((t,e,r)=>(t[r]=e,t),[]),lg=Ua.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function fg(t){return t.reduce((e,r)=>(e+=hg[r],e),"")}function dg(t){const e=[];for(const r of t){const i=lg[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const pg=Pi({prefix:"🚀",name:"base256emoji",encode:fg,decode:dg});var gg=Object.freeze({__proto__:null,base256emoji:pg}),yg=La,po=128,bg=127,wg=~bg,mg=Math.pow(2,31);function La(t,e,r){e=e||[],r=r||0;for(var i=r;t>=mg;)e[r++]=t&255|po,t/=128;for(;t&wg;)e[r++]=t&255|po,t>>>=7;return e[r]=t|0,La.bytes=r-i+1,e}var _g=ws,vg=128,go=127;function ws(t,i){var r=0,i=i||0,s=0,o=i,u,c=t.length;do{if(o>=c)throw ws.bytes=0,new RangeError("Could not decode varint");u=t[o++],r+=s<28?(u&go)<<s:(u&go)*Math.pow(2,s),s+=7}while(u>=vg);return ws.bytes=o-i,r}var Eg=Math.pow(2,7),Dg=Math.pow(2,14),Sg=Math.pow(2,21),Ig=Math.pow(2,28),xg=Math.pow(2,35),Og=Math.pow(2,42),Ag=Math.pow(2,49),Cg=Math.pow(2,56),Tg=Math.pow(2,63),Ng=function(t){return t<Eg?1:t<Dg?2:t<Sg?3:t<Ig?4:t<xg?5:t<Og?6:t<Ag?7:t<Cg?8:t<Tg?9:10},Pg={encode:yg,decode:_g,encodingLength:Ng},Fa=Pg;const yo=(t,e,r=0)=>(Fa.encode(t,e,r),e),bo=t=>Fa.encodingLength(t),ms=(t,e)=>{const r=e.byteLength,i=bo(t),s=i+bo(r),o=new Uint8Array(s+r);return yo(t,o,0),yo(r,o,i),o.set(e,s),new Rg(t,r,e,o)};class Rg{constructor(e,r,i,s){this.code=e,this.size=r,this.digest=i,this.bytes=s}}const Ma=({name:t,code:e,encode:r})=>new Ug(t,e,r);class Ug{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?ms(this.code,r):r.then(i=>ms(this.code,i))}else throw Error("Unknown type, must be binary type")}}const $a=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Lg=Ma({name:"sha2-256",code:18,encode:$a("SHA-256")}),Fg=Ma({name:"sha2-512",code:19,encode:$a("SHA-512")});var Mg=Object.freeze({__proto__:null,sha256:Lg,sha512:Fg});const ja=0,$g="identity",Ba=Pa,jg=t=>ms(ja,Ba(t)),Bg={code:ja,name:$g,encode:Ba,digest:jg};var qg=Object.freeze({__proto__:null,identity:Bg});new TextEncoder,new TextDecoder;const wo={...Rp,...Lp,...Mp,...jp,...zp,...Qp,...tg,...sg,...ug,...gg};({...Mg,...qg});function qa(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function zg(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?qa(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function za(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const mo=za("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),ki=za("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=zg(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Kg={utf8:mo,"utf-8":mo,hex:wo.base16,latin1:ki,ascii:ki,binary:ki,...wo};function Vg(t,e="utf8"){const r=Kg[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?qa(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}const Ka="wc",Hg=2,zs="core",Jt=`${Ka}@2:${zs}:`,Wg={name:zs,logger:"error"},kg={database:":memory:"},Gg="crypto",_o="client_ed25519_seed",Yg=Q.ONE_DAY,Jg="keychain",Xg="0.3",Qg="messages",Zg="0.3",e0=Q.SIX_HOURS,t0="publisher",Va="irn",r0="error",Ha="wss://relay.walletconnect.com",vo="wss://relay.walletconnect.org",i0="relayer",Ue={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},s0="_subscription",jr={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},n0=Q.ONE_SECOND/2,o0="2.9.1",a0=1e4,c0="0.3",u0="WALLETCONNECT_CLIENT_ID",Mt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},h0="subscription",l0="0.3",f0=Q.FIVE_SECONDS*1e3,d0="pairing",p0="0.3",Br={wc_pairingDelete:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:Q.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:Q.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:0},res:{ttl:Q.ONE_DAY,prompt:!1,tag:0}}},Ft={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},g0="history",y0="0.3",b0="expirer",St={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},w0="0.3",Gi="verify-api",Eo="https://verify.walletconnect.com";class m0{constructor(e,r){this.core=e,this.logger=r,this.keychain=new Map,this.name=Jg,this.version=Xg,this.initialized=!1,this.storagePrefix=Jt,this.init=async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}},this.has=i=>(this.isInitialized(),this.keychain.has(i)),this.set=async(i,s)=>{this.isInitialized(),this.keychain.set(i,s),await this.persist()},this.get=i=>{this.isInitialized();const s=this.keychain.get(i);if(typeof s>"u"){const{message:o}=G("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(o)}return s},this.del=async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()},this.core=e,this.logger=me.generateChildLogger(r,this.name)}get context(){return me.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,va(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ea(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}class _0{constructor(e,r,i){this.core=e,this.logger=r,this.name=Gg,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=s=>(this.isInitialized(),this.keychain.has(s)),this.getClientId=async()=>{this.isInitialized();const s=await this.getClientSeed(),o=jn(s);return oa(o.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const s=zf();return this.setPrivateKey(s.publicKey,s.privateKey)},this.signJWT=async s=>{this.isInitialized();const o=await this.getClientSeed(),u=jn(o),c=ys();return await Yl(c,s,Yg,u)},this.generateSharedKey=(s,o,u)=>{this.isInitialized();const c=this.getPrivateKey(s),h=Kf(c,o);return this.setSymKey(h,u)},this.setSymKey=async(s,o)=>{this.isInitialized();const u=o||Vf(s);return await this.keychain.set(u,s),u},this.deleteKeyPair=async s=>{this.isInitialized(),await this.keychain.del(s)},this.deleteSymKey=async s=>{this.isInitialized(),await this.keychain.del(s)},this.encode=async(s,o,u)=>{this.isInitialized();const c=ma(u),h=Ds(o);if(Jn(c)){const x=c.senderPublicKey,v=c.receiverPublicKey;s=await this.generateSharedKey(x,v)}const d=this.getSymKey(s),{type:p,senderPublicKey:E}=c;return Wf({type:p,symKey:d,message:h,senderPublicKey:E})},this.decode=async(s,o,u)=>{this.isInitialized();const c=Yf(o,u);if(Jn(c)){const h=c.receiverPublicKey,d=c.senderPublicKey;s=await this.generateSharedKey(h,d)}try{const h=this.getSymKey(s),d=kf({symKey:h,encoded:o});return Ho(d)}catch(h){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(h)}},this.getPayloadType=s=>{const o=wi(s);return Qr(o.type)},this.getPayloadSenderPublicKey=s=>{const o=wi(s);return o.senderPublicKey?gt(o.senderPublicKey,pt):void 0},this.core=e,this.logger=me.generateChildLogger(r,this.name),this.keychain=i||new m0(this.core,this.logger)}get context(){return me.getLoggerContext(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(_o)}catch{e=ys(),await this.keychain.set(_o,e)}return Vg(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}class v0 extends th{constructor(e,r){super(e,r),this.logger=e,this.core=r,this.messages=new Map,this.name=Qg,this.version=Zg,this.initialized=!1,this.storagePrefix=Jt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}},this.set=async(i,s)=>{this.isInitialized();const o=Dr(s);let u=this.messages.get(i);return typeof u>"u"&&(u={}),typeof u[o]<"u"||(u[o]=s,this.messages.set(i,u),await this.persist()),o},this.get=i=>{this.isInitialized();let s=this.messages.get(i);return typeof s>"u"&&(s={}),s},this.has=(i,s)=>{this.isInitialized();const o=this.get(i),u=Dr(s);return typeof o[u]<"u"},this.del=async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()},this.logger=me.generateChildLogger(e,this.name),this.core=r}get context(){return me.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,va(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ea(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}class E0 extends rh{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.events=new xt.EventEmitter,this.name=t0,this.queue=new Map,this.publishTimeout=Q.toMiliseconds(Q.TEN_SECONDS),this.queueTimeout=Q.toMiliseconds(Q.FIVE_SECONDS),this.needsTransportRestart=!1,this.publish=async(i,s,o)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:o}});try{const u=(o==null?void 0:o.ttl)||e0,c=bs(o),h=(o==null?void 0:o.prompt)||!1,d=(o==null?void 0:o.tag)||0,p=(o==null?void 0:o.id)||$s().toString(),E={topic:i,message:s,opts:{ttl:u,relay:c,prompt:h,tag:d,id:p}},x=setTimeout(()=>this.queue.set(p,E),this.queueTimeout);try{await await mi(this.rpcPublish(i,s,u,c,h,d,p),this.publishTimeout),clearTimeout(x),this.relayer.events.emit(Ue.publish,E)}catch{this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0;return}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:o}})}catch(u){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(u),u}},this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.relayer=e,this.logger=me.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return me.getLoggerContext(this.logger)}rpcPublish(e,r,i,s,o,u,c){var h,d,p,E;const x={method:di(s.protocol).publish,params:{topic:e,message:r,ttl:i,prompt:o,tag:u},id:c};return dt((h=x.params)==null?void 0:h.prompt)&&((d=x.params)==null||delete d.prompt),dt((p=x.params)==null?void 0:p.tag)&&((E=x.params)==null||delete E.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:x}),this.relayer.request(x)}onPublish(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:r,message:i,opts:s}=e;await this.publish(r,i,s)})}registerEventListeners(){this.relayer.core.heartbeat.on(Sr.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Ue.connection_stalled);return}this.checkQueue()}),this.relayer.on(Ue.message_ack,e=>{this.onPublish(e.id.toString())})}}class D0{constructor(){this.map=new Map,this.set=(e,r)=>{const i=this.get(e);this.exists(e,r)||this.map.set(e,[...i,r])},this.get=e=>this.map.get(e)||[],this.exists=(e,r)=>this.get(e).includes(r),this.delete=(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,r))return;const s=i.filter(o=>o!==r);if(!s.length){this.map.delete(e);return}this.map.set(e,s)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var S0=Object.defineProperty,I0=Object.defineProperties,x0=Object.getOwnPropertyDescriptors,Do=Object.getOwnPropertySymbols,O0=Object.prototype.hasOwnProperty,A0=Object.prototype.propertyIsEnumerable,So=(t,e,r)=>e in t?S0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,qr=(t,e)=>{for(var r in e||(e={}))O0.call(e,r)&&So(t,r,e[r]);if(Do)for(var r of Do(e))A0.call(e,r)&&So(t,r,e[r]);return t},Yi=(t,e)=>I0(t,x0(e));class C0 extends nh{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.subscriptions=new Map,this.topicMap=new D0,this.events=new xt.EventEmitter,this.name=h0,this.version=l0,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Jt,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(i,s)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}});try{const o=bs(s),u={topic:i,relay:o};this.pending.set(i,u);const c=await this.rpcSubscribe(i,o);return this.onSubscribe(c,u),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}}),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}},this.unsubscribe=async(i,s)=>{await this.restartToComplete(),this.isInitialized(),typeof(s==null?void 0:s.id)<"u"?await this.unsubscribeById(i,s.id,s):await this.unsubscribeByTopic(i,s)},this.isSubscribed=async i=>this.topics.includes(i)?!0:await new Promise((s,o)=>{const u=new Q.Watch;u.start(this.pendingSubscriptionWatchLabel);const c=setInterval(()=>{!this.pending.has(i)&&this.topics.includes(i)&&(clearInterval(c),u.stop(this.pendingSubscriptionWatchLabel),s(!0)),u.elapsed(this.pendingSubscriptionWatchLabel)>=f0&&(clearInterval(c),u.stop(this.pendingSubscriptionWatchLabel),o(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=e,this.logger=me.generateChildLogger(r,this.name),this.clientId=""}get context(){return me.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,r){let i=!1;try{i=this.getSubscription(e).topic===r}catch{}return i}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const i=this.topicMap.get(e);await Promise.all(i.map(async s=>await this.unsubscribeById(e,s,r)))}async unsubscribeById(e,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}});try{const s=bs(i);await this.rpcUnsubscribe(e,r,s);const o=Ze("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,o),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,r){const i={method:di(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await mi(this.relayer.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Ue.connection_stalled)}return Dr(e+this.clientId)}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,i={method:di(r.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{return await await mi(this.relayer.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Ue.connection_stalled)}}rpcUnsubscribe(e,r,i){const s={method:di(i.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,r){this.setSubscription(e,Yi(qr({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,qr({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r))}addSubscription(e,r){this.subscriptions.set(e,qr({},r)),this.topicMap.set(r.topic,e),this.events.emit(Mt.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:i}=G("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(Mt.deleted,Yi(qr({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Mt.sync)}async reset(){if(this.cached.length){const e=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<e;r++){const i=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit(Mt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:r}=G("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(!e.length)return;const r=await this.rpcBatchSubscribe(e);Zr(r)&&this.onBatchSubscribe(r.map((i,s)=>Yi(qr({},e[s]),{id:i})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(this.relayer.transportExplicitlyClosed)return;const e=[];this.pending.forEach(r=>{e.push(r)}),await this.batchSubscribe(e)}registerEventListeners(){this.relayer.core.heartbeat.on(Sr.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Ue.connect,async()=>{await this.onConnect()}),this.relayer.on(Ue.disconnect,()=>{this.onDisconnect()}),this.events.on(Mt.created,async e=>{const r=Mt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()}),this.events.on(Mt.deleted,async e=>{const r=Mt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(){this.restartInProgress&&await new Promise(e=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),e())},this.pollingInterval)})}}var T0=Object.defineProperty,Io=Object.getOwnPropertySymbols,N0=Object.prototype.hasOwnProperty,P0=Object.prototype.propertyIsEnumerable,xo=(t,e,r)=>e in t?T0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,R0=(t,e)=>{for(var r in e||(e={}))N0.call(e,r)&&xo(t,r,e[r]);if(Io)for(var r of Io(e))P0.call(e,r)&&xo(t,r,e[r]);return t};class U0 extends ih{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new xt.EventEmitter,this.name=i0,this.transportExplicitlyClosed=!1,this.initialized=!1,this.reconnecting=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(i){throw this.logger.debug("Failed to Publish Request"),this.logger.error(i),i}},this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?me.generateChildLogger(e.logger,this.name):me.pino(me.getDefaultLoggerOptions({level:e.logger||r0})),this.messages=new v0(this.logger,e.core),this.subscriber=new C0(this,this.logger),this.publisher=new E0(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||Ha,this.projectId=e.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${vo}...`),await this.restartTransport(vo)}this.registerEventListeners(),this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},a0)}get context(){return me.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,r,i){this.isInitialized(),await this.publisher.publish(e,r,i),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now()})}async subscribe(e,r){var i;this.isInitialized();let s=((i=this.subscriber.topicMap.get(e))==null?void 0:i[0])||"";return s||(await Promise.all([new Promise(o=>{this.subscriber.once(Mt.created,u=>{u.topic===e&&o()})}),new Promise(async o=>{s=await this.subscriber.subscribe(e,r),o()})]),s)}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&(await this.provider.disconnect(),this.events.emit(Ue.transport_closed))}async transportOpen(e){if(this.transportExplicitlyClosed=!1,!this.reconnecting){this.relayUrl=e||this.relayUrl,this.reconnecting=!0;try{await Promise.all([new Promise(r=>{this.initialized||r(),this.subscriber.once(Mt.resubscribed,()=>{r()})}),await Promise.race([new Promise(async(r,i)=>{await mi(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(s=>i(s)).then(()=>r()).finally(()=>this.removeListener(Ue.transport_closed,this.rejectTransportOpen))}),new Promise(r=>this.once(Ue.transport_closed,this.rejectTransportOpen))])])}catch(r){this.logger.error(r);const i=r;if(!this.isConnectionStalled(i.message))throw r;this.events.emit(Ue.transport_closed)}finally{this.reconnecting=!1}}}async restartTransport(e){this.transportExplicitlyClosed||this.reconnecting||(this.relayUrl=e||this.relayUrl,this.connected&&await Promise.all([new Promise(r=>{this.provider.once(jr.disconnect,()=>{r()})}),this.transportClose()]),await this.createProvider(),await this.transportOpen())}isConnectionStalled(e){return this.staleConnectionErrors.some(r=>e.includes(r))}rejectTransportOpen(){throw new Error("Attempt to connect to relay via `transportOpen` has stalled. Retrying...")}async createProvider(){const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new dp(new wp(od({sdkVersion:o0,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(e){const{topic:r,message:i}=e;await this.messages.set(r,i)}async shouldIgnoreMessageEvent(e){const{topic:r,message:i}=e;if(!i||i.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const s=this.messages.has(r,i);return s&&this.logger.debug(`Ignoring duplicate message: ${i}`),s}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),qs(e)){if(!e.method.endsWith(s0))return;const r=e.params,{topic:i,message:s,publishedAt:o}=r.data,u={topic:i,message:s,publishedAt:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(R0({type:"event",event:r.id},u)),this.events.emit(r.id,u),await this.acknowledgePayload(e),await this.onMessageEvent(u)}else Ni(e)&&this.events.emit(Ue.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(Ue.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const r=js(e.id,!0);await this.provider.connection.send(r)}registerProviderListeners(){this.provider.on(jr.payload,e=>this.onProviderPayload(e)),this.provider.on(jr.connect,()=>{this.events.emit(Ue.connect)}),this.provider.on(jr.disconnect,()=>{this.onProviderDisconnect()}),this.provider.on(jr.error,e=>{this.logger.error(e),this.events.emit(Ue.error,e)})}registerEventListeners(){this.events.on(Ue.connection_stalled,async()=>{await this.restartTransport()})}onProviderDisconnect(){this.events.emit(Ue.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout(async()=>{await this.restartTransport()},Q.toMiliseconds(n0))}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(!this.connected){if(this.connecting)return await new Promise(e=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),e())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var L0=Object.defineProperty,Oo=Object.getOwnPropertySymbols,F0=Object.prototype.hasOwnProperty,M0=Object.prototype.propertyIsEnumerable,Ao=(t,e,r)=>e in t?L0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Co=(t,e)=>{for(var r in e||(e={}))F0.call(e,r)&&Ao(t,r,e[r]);if(Oo)for(var r of Oo(e))M0.call(e,r)&&Ao(t,r,e[r]);return t};class Ri extends sh{constructor(e,r,i,s=Jt,o=void 0){super(e,r,i,s),this.core=e,this.logger=r,this.name=i,this.map=new Map,this.version=c0,this.cached=[],this.initialized=!1,this.storagePrefix=Jt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(u=>{this.getKey&&u!==null&&!dt(u)?this.map.set(this.getKey(u),u):Cd(u)?this.map.set(u.id,u):Td(u)&&this.map.set(u.topic,u)}),this.cached=[],this.initialized=!0)},this.set=async(u,c)=>{this.isInitialized(),this.map.has(u)?await this.update(u,c):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:u,value:c}),this.map.set(u,c),await this.persist())},this.get=u=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:u}),this.getData(u)),this.getAll=u=>(this.isInitialized(),u?this.values.filter(c=>Object.keys(u).every(h=>_p(c[h],u[h]))):this.values),this.update=async(u,c)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:u,update:c});const h=Co(Co({},this.getData(u)),c);this.map.set(u,h),await this.persist()},this.delete=async(u,c)=>{this.isInitialized(),this.map.has(u)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:u,reason:c}),this.map.delete(u),await this.persist())},this.logger=me.generateChildLogger(r,this.name),this.storagePrefix=s,this.getKey=o}get context(){return me.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){const{message:i}=G("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=G("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}class $0{constructor(e,r){this.core=e,this.logger=r,this.name=d0,this.version=p0,this.events=new xt,this.initialized=!1,this.storagePrefix=Jt,this.ignoredPayloadTypes=[yr],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]},this.create=async()=>{this.isInitialized();const i=ys(),s=await this.core.crypto.setSymKey(i),o=Tt(Q.FIVE_MINUTES),u={protocol:Va},c={topic:s,expiry:o,relay:u,active:!1},h=md({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:i,relay:u});return await this.pairings.set(s,c),await this.core.relayer.subscribe(s),this.core.expirer.set(s,o),{topic:s,uri:h}},this.pair=async i=>{this.isInitialized(),this.isValidPair(i);const{topic:s,symKey:o,relay:u}=yd(i.uri);if(this.pairings.keys.includes(s))throw new Error(`Pairing already exists: ${s}`);if(this.core.crypto.hasKeys(s))throw new Error(`Keychain already exists: ${s}`);const c=Tt(Q.FIVE_MINUTES),h={topic:s,relay:u,expiry:c,active:!1};return await this.pairings.set(s,h),await this.core.crypto.setSymKey(o,s),await this.core.relayer.subscribe(s,{relay:u}),this.core.expirer.set(s,c),i.activatePairing&&await this.activate({topic:s}),h},this.activate=async({topic:i})=>{this.isInitialized();const s=Tt(Q.THIRTY_DAYS);await this.pairings.update(i,{active:!0,expiry:s}),this.core.expirer.set(i,s)},this.ping=async i=>{this.isInitialized(),await this.isValidPing(i);const{topic:s}=i;if(this.pairings.keys.includes(s)){const o=await this.sendRequest(s,"wc_pairingPing",{}),{done:u,resolve:c,reject:h}=vr();this.events.once(qe("pairing_ping",o),({error:d})=>{d?h(d):c()}),await u()}},this.updateExpiry=async({topic:i,expiry:s})=>{this.isInitialized(),await this.pairings.update(i,{expiry:s})},this.updateMetadata=async({topic:i,metadata:s})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:s})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:s}=i;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",Ze("USER_DISCONNECTED")),await this.deletePairing(s))},this.sendRequest=async(i,s,o)=>{const u=Ti(s,o),c=await this.core.crypto.encode(i,u),h=Br[s].req;return this.core.history.set(i,u),this.core.relayer.publish(i,c,h),u.id},this.sendResult=async(i,s,o)=>{const u=js(i,o),c=await this.core.crypto.encode(s,u),h=await this.core.history.get(s,i),d=Br[h.request.method].res;await this.core.relayer.publish(s,c,d),await this.core.history.resolve(u)},this.sendError=async(i,s,o)=>{const u=Bs(i,o),c=await this.core.crypto.encode(s,u),h=await this.core.history.get(s,i),d=Br[h.request.method]?Br[h.request.method].res:Br.unregistered_method.res;await this.core.relayer.publish(s,c,d),await this.core.history.resolve(u)},this.deletePairing=async(i,s)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,Ze("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),s?Promise.resolve():this.core.expirer.del(i)])},this.cleanup=async()=>{const i=this.pairings.getAll().filter(s=>Gt(s.expiry));await Promise.all(i.map(s=>this.deletePairing(s.topic)))},this.onRelayEventRequest=i=>{const{topic:s,payload:o}=i;switch(o.method){case"wc_pairingPing":return this.onPairingPingRequest(s,o);case"wc_pairingDelete":return this.onPairingDeleteRequest(s,o);default:return this.onUnknownRpcMethodRequest(s,o)}},this.onRelayEventResponse=async i=>{const{topic:s,payload:o}=i,u=(await this.core.history.get(s,o.id)).request.method;switch(u){case"wc_pairingPing":return this.onPairingPingResponse(s,o);default:return this.onUnknownRpcMethodResponse(u)}},this.onPairingPingRequest=async(i,s)=>{const{id:o}=s;try{this.isValidPing({topic:i}),await this.sendResult(o,i,!0),this.events.emit("pairing_ping",{id:o,topic:i})}catch(u){await this.sendError(o,i,u),this.logger.error(u)}},this.onPairingPingResponse=(i,s)=>{const{id:o}=s;setTimeout(()=>{zt(s)?this.events.emit(qe("pairing_ping",o),{}):Nt(s)&&this.events.emit(qe("pairing_ping",o),{error:s.error})},500)},this.onPairingDeleteRequest=async(i,s)=>{const{id:o}=s;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit("pairing_delete",{id:o,topic:i})}catch(u){await this.sendError(o,i,u),this.logger.error(u)}},this.onUnknownRpcMethodRequest=async(i,s)=>{const{id:o,method:u}=s;try{if(this.registeredMethods.includes(u))return;const c=Ze("WC_METHOD_UNSUPPORTED",u);await this.sendError(o,i,c),this.logger.error(c)}catch(c){await this.sendError(o,i,c),this.logger.error(c)}},this.onUnknownRpcMethodResponse=i=>{this.registeredMethods.includes(i)||this.logger.error(Ze("WC_METHOD_UNSUPPORTED",i))},this.isValidPair=i=>{if(!yt(i)){const{message:s}=G("MISSING_OR_INVALID",`pair() params: ${i}`);throw new Error(s)}if(!Ad(i.uri)){const{message:s}=G("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw new Error(s)}},this.isValidPing=async i=>{if(!yt(i)){const{message:o}=G("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(o)}const{topic:s}=i;await this.isValidPairingTopic(s)},this.isValidDisconnect=async i=>{if(!yt(i)){const{message:o}=G("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(o)}const{topic:s}=i;await this.isValidPairingTopic(s)},this.isValidPairingTopic=async i=>{if(!et(i,!1)){const{message:s}=G("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(s)}if(!this.pairings.keys.includes(i)){const{message:s}=G("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(s)}if(Gt(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:s}=G("EXPIRED",`pairing topic: ${i}`);throw new Error(s)}},this.core=e,this.logger=me.generateChildLogger(r,this.name),this.pairings=new Ri(this.core,this.logger,this.name,this.storagePrefix)}get context(){return me.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(Ue.message,async e=>{const{topic:r,message:i}=e;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const s=await this.core.crypto.decode(r,i);qs(s)?(this.core.history.set(r,s),this.onRelayEventRequest({topic:r,payload:s})):Ni(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:r,payload:s}),this.core.history.delete(r,s.id))})}registerExpirerEvents(){this.core.expirer.on(St.expired,async e=>{const{topic:r}=Sa(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit("pairing_expire",{topic:r}))})}}class j0 extends eh{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.records=new Map,this.events=new xt.EventEmitter,this.name=g0,this.version=y0,this.cached=[],this.initialized=!1,this.storagePrefix=Jt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(i,s,o)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:s,chainId:o}),this.records.has(s.id))return;const u={id:s.id,topic:i,request:{method:s.method,params:s.params||null},chainId:o,expiry:Tt(Q.THIRTY_DAYS)};this.records.set(u.id,u),this.events.emit(Ft.created,u)},this.resolve=async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const s=await this.getRecord(i.id);typeof s.response>"u"&&(s.response=Nt(i)?{error:i.error}:{result:i.result},this.records.set(s.id,s),this.events.emit(Ft.updated,s))},this.get=async(i,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:s}),await this.getRecord(s)),this.delete=(i,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(o=>{if(o.topic===i){if(typeof s<"u"&&o.id!==s)return;this.records.delete(o.id),this.events.emit(Ft.deleted,o)}})},this.exists=async(i,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===i:!1),this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.logger=me.generateChildLogger(r,this.name)}get context(){return me.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:Ti(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:i}=G("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Ft.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=G("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Ft.created,e=>{const r=Ft.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(Ft.updated,e=>{const r=Ft.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(Ft.deleted,e=>{const r=Ft.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.core.heartbeat.on(Sr.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(e=>{Q.toMiliseconds(e.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${e.id}`),this.delete(e.topic,e.id))})}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}class B0 extends oh{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.expirations=new Map,this.events=new xt.EventEmitter,this.name=b0,this.version=w0,this.cached=[],this.initialized=!1,this.storagePrefix=Jt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=i=>{try{const s=this.formatTarget(i);return typeof this.getExpiration(s)<"u"}catch{return!1}},this.set=(i,s)=>{this.isInitialized();const o=this.formatTarget(i),u={target:o,expiry:s};this.expirations.set(o,u),this.checkExpiry(o,u),this.events.emit(St.created,{target:o,expiration:u})},this.get=i=>{this.isInitialized();const s=this.formatTarget(i);return this.getExpiration(s)},this.del=i=>{if(this.isInitialized(),this.has(i)){const s=this.formatTarget(i),o=this.getExpiration(s);this.expirations.delete(s),this.events.emit(St.deleted,{target:s,expiration:o})}},this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.logger=me.generateChildLogger(r,this.name)}get context(){return me.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return ad(e);if(typeof e=="number")return cd(e);const{message:r}=G("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(St.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=G("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:i}=G("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}checkExpiry(e,r){const{expiry:i}=r;Q.toMiliseconds(i)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(St.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(Sr.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(St.created,e=>{const r=St.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(St.expired,e=>{const r=St.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(St.deleted,e=>{const r=St.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}class q0 extends ah{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,this.name=Gi,this.initialized=!1,this.init=async i=>{_a()||!Us()||(this.verifyUrl=(i==null?void 0:i.verifyUrl)||Eo,await this.createIframe())},this.register=async i=>{var s;if(this.initialized||await this.init(),!!this.iframe)try{(s=this.iframe.contentWindow)==null||s.postMessage(i.attestationId,this.verifyUrl),this.logger.info(`postMessage sent: ${i.attestationId} ${this.verifyUrl}`)}catch{}},this.resolve=async i=>{var s;if(this.isDevEnv)return"";this.logger.info(`resolving attestation: ${i.attestationId}`);const o=this.startAbortTimer(Q.FIVE_SECONDS),u=await fetch(`${this.verifyUrl}/attestation/${i.attestationId}`,{signal:this.abortController.signal});return clearTimeout(o),u.status===200?(s=await u.json())==null?void 0:s.origin:""},this.createIframe=async()=>{try{await Promise.race([new Promise((i,s)=>{if(document.getElementById(Gi))return i();const o=document.createElement("iframe");o.setAttribute("id",Gi),o.setAttribute("src",`${this.verifyUrl}/${this.projectId}`),o.style.display="none",o.addEventListener("load",()=>{this.initialized=!0,i()}),o.addEventListener("error",u=>{s(u)}),document.body.append(o),this.iframe=o}),new Promise(i=>{setTimeout(()=>i("iframe load timeout"),Q.toMiliseconds(Q.ONE_SECOND/2))})])}catch(i){this.logger.error(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.error(i)}},this.logger=me.generateChildLogger(r,this.name),this.verifyUrl=Eo,this.abortController=new AbortController,this.isDevEnv=Rs()&&process.env.IS_VITEST}get context(){return me.getLoggerContext(this.logger)}startAbortTimer(e){return setTimeout(()=>this.abortController.abort(),Q.toMiliseconds(e))}}var z0=Object.defineProperty,To=Object.getOwnPropertySymbols,K0=Object.prototype.hasOwnProperty,V0=Object.prototype.propertyIsEnumerable,No=(t,e,r)=>e in t?z0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Po=(t,e)=>{for(var r in e||(e={}))K0.call(e,r)&&No(t,r,e[r]);if(To)for(var r of To(e))V0.call(e,r)&&No(t,r,e[r]);return t};class Ks extends Zu{constructor(e){super(e),this.protocol=Ka,this.version=Hg,this.name=zs,this.events=new xt.EventEmitter,this.initialized=!1,this.on=(i,s)=>this.events.on(i,s),this.once=(i,s)=>this.events.once(i,s),this.off=(i,s)=>this.events.off(i,s),this.removeListener=(i,s)=>this.events.removeListener(i,s),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||Ha;const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:me.pino(me.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||Wg.logger}));this.logger=me.generateChildLogger(r,this.name),this.heartbeat=new Sr.HeartBeat,this.crypto=new _0(this,this.logger,e==null?void 0:e.keychain),this.history=new j0(this,this.logger),this.expirer=new B0(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Fu(Po(Po({},kg),e==null?void 0:e.storageOptions)),this.relayer=new U0({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new $0(this,this.logger),this.verify=new q0(this.projectId||"",this.logger)}static async init(e){const r=new Ks(e);await r.initialize();const i=await r.crypto.getClientId();return await r.storage.setItem(u0,i),r}get context(){return me.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const H0=Ks,Wa="wc",ka=2,Ga="client",Vs=`${Wa}@${ka}:${Ga}:`,Ji={name:Ga,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},W0="WALLETCONNECT_DEEPLINK_CHOICE",k0="proposal",G0="Proposal expired",Y0="session",li=Q.SEVEN_DAYS,J0="engine",zr={wc_sessionPropose:{req:{ttl:Q.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1104},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1106},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:Q.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:Q.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1112},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:Q.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:Q.THIRTY_SECONDS,prompt:!1,tag:1115}}},Xi={min:Q.FIVE_MINUTES,max:Q.SEVEN_DAYS},Kr={idle:"idle",active:"active"},X0="request",Q0=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var Z0=Object.defineProperty,ey=Object.defineProperties,ty=Object.getOwnPropertyDescriptors,Ro=Object.getOwnPropertySymbols,ry=Object.prototype.hasOwnProperty,iy=Object.prototype.propertyIsEnumerable,Uo=(t,e,r)=>e in t?Z0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Dt=(t,e)=>{for(var r in e||(e={}))ry.call(e,r)&&Uo(t,r,e[r]);if(Ro)for(var r of Ro(e))iy.call(e,r)&&Uo(t,r,e[r]);return t},Qi=(t,e)=>ey(t,ty(e));class sy extends uh{constructor(e){super(e),this.name=J0,this.events=new xt,this.initialized=!1,this.ignoredPayloadTypes=[yr],this.requestQueue={state:Kr.idle,requests:[]},this.requestQueueDelay=Q.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(zr)}),this.initialized=!0,setTimeout(()=>{this.requestQueue.requests=this.getPendingSessionRequests(),this.processRequestQueue()},Q.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{this.isInitialized();const i=Qi(Dt({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(i);const{pairingTopic:s,requiredNamespaces:o,optionalNamespaces:u,sessionProperties:c,relays:h}=i;let d=s,p,E=!1;if(d&&(E=this.client.core.pairing.pairings.get(d).active),!d||!E){const{topic:O,uri:y}=await this.client.core.pairing.create();d=O,p=y}const x=await this.client.core.crypto.generateKeyPair(),v=Dt({requiredNamespaces:o,optionalNamespaces:u,relays:h??[{protocol:Va}],proposer:{publicKey:x,metadata:this.client.metadata}},c&&{sessionProperties:c}),{reject:I,resolve:N,done:P}=vr(Q.FIVE_MINUTES,G0);if(this.events.once(qe("session_connect"),async({error:O,session:y})=>{if(O)I(O);else if(y){y.self.publicKey=x;const m=Qi(Dt({},y),{requiredNamespaces:y.requiredNamespaces,optionalNamespaces:y.optionalNamespaces});await this.client.session.set(y.topic,m),await this.setExpiry(y.topic,y.expiry),d&&await this.client.core.pairing.updateMetadata({topic:d,metadata:y.peer.metadata}),N(m)}}),!d){const{message:O}=G("NO_MATCHING_KEY",`connect() pairing topic: ${d}`);throw new Error(O)}const K=await this.sendRequest(d,"wc_sessionPropose",v),_=Tt(Q.FIVE_MINUTES);return await this.setProposal(K,Dt({id:K,expiry:_},v)),{uri:p,approval:P}},this.pair=async r=>(this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{this.isInitialized(),await this.isValidApprove(r);const{id:i,relayProtocol:s,namespaces:o,sessionProperties:u}=r,c=this.client.proposal.get(i);let{pairingTopic:h,proposer:d,requiredNamespaces:p,optionalNamespaces:E}=c;h=h||"",Hr(p)||(p=Dd(o,"approve()"));const x=await this.client.core.crypto.generateKeyPair(),v=d.publicKey,I=await this.client.core.crypto.generateSharedKey(x,v);h&&i&&(await this.client.core.pairing.updateMetadata({topic:h,metadata:d.metadata}),await this.sendResult(i,h,{relay:{protocol:s??"irn"},responderPublicKey:x}),await this.client.proposal.delete(i,Ze("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:h}));const N=Dt({relay:{protocol:s??"irn"},namespaces:o,requiredNamespaces:p,optionalNamespaces:E,pairingTopic:h,controller:{publicKey:x,metadata:this.client.metadata},expiry:Tt(li)},u&&{sessionProperties:u});await this.client.core.relayer.subscribe(I),await this.sendRequest(I,"wc_sessionSettle",N);const P=Qi(Dt({},N),{topic:I,pairingTopic:h,acknowledged:!1,self:N.controller,peer:{publicKey:d.publicKey,metadata:d.metadata},controller:x});return await this.client.session.set(I,P),await this.setExpiry(I,Tt(li)),{topic:I,acknowledged:()=>new Promise(K=>setTimeout(()=>K(this.client.session.get(I)),500))}},this.reject=async r=>{this.isInitialized(),await this.isValidReject(r);const{id:i,reason:s}=r,{pairingTopic:o}=this.client.proposal.get(i);o&&(await this.sendError(i,o,s),await this.client.proposal.delete(i,Ze("USER_DISCONNECTED")))},this.update=async r=>{this.isInitialized(),await this.isValidUpdate(r);const{topic:i,namespaces:s}=r,o=await this.sendRequest(i,"wc_sessionUpdate",{namespaces:s}),{done:u,resolve:c,reject:h}=vr();return this.events.once(qe("session_update",o),({error:d})=>{d?h(d):c()}),await this.client.session.update(i,{namespaces:s}),{acknowledged:u}},this.extend=async r=>{this.isInitialized(),await this.isValidExtend(r);const{topic:i}=r,s=await this.sendRequest(i,"wc_sessionExtend",{}),{done:o,resolve:u,reject:c}=vr();return this.events.once(qe("session_extend",s),({error:h})=>{h?c(h):u()}),await this.setExpiry(i,Tt(li)),{acknowledged:o}},this.request=async r=>{this.isInitialized(),await this.isValidRequest(r);const{chainId:i,request:s,topic:o,expiry:u}=r,c=await this.sendRequest(o,"wc_sessionRequest",{request:s,chainId:i},u),{done:h,resolve:d,reject:p}=vr(u);this.events.once(qe("session_request",c),({error:x,result:v})=>{x?p(x):d(v)}),this.client.events.emit("session_request_sent",{topic:o,request:s,chainId:i,id:c});const E=await this.client.core.storage.getItem(W0);return ud({id:c,topic:o,wcDeepLink:E}),await h()},this.respond=async r=>{this.isInitialized(),await this.isValidRespond(r);const{topic:i,response:s}=r,{id:o}=s;zt(s)?await this.sendResult(o,i,s.result):Nt(s)&&await this.sendError(o,i,s.error),this.cleanupAfterResponse(r)},this.ping=async r=>{this.isInitialized(),await this.isValidPing(r);const{topic:i}=r;if(this.client.session.keys.includes(i)){const s=await this.sendRequest(i,"wc_sessionPing",{}),{done:o,resolve:u,reject:c}=vr();this.events.once(qe("session_ping",s),({error:h})=>{h?c(h):u()}),await o()}else this.client.core.pairing.pairings.keys.includes(i)&&await this.client.core.pairing.ping({topic:i})},this.emit=async r=>{this.isInitialized(),await this.isValidEmit(r);const{topic:i,event:s,chainId:o}=r;await this.sendRequest(i,"wc_sessionEvent",{event:s,chainId:o})},this.disconnect=async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:i}=r;if(this.client.session.keys.includes(i)){const s=$s().toString();let o;const u=c=>{(c==null?void 0:c.id.toString())===s&&(this.client.core.relayer.events.removeListener(Ue.message_ack,u),o())};await Promise.all([new Promise(c=>{o=c,this.client.core.relayer.on(Ue.message_ack,u)}),this.sendRequest(i,"wc_sessionDelete",Ze("USER_DISCONNECTED"),void 0,s)]),await this.deleteSession(i)}else await this.client.core.pairing.disconnect({topic:i})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(i=>xd(i,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const i=this.client.core.pairing.pairings.get(r.pairingTopic),s=this.client.core.pairing.pairings.getAll().filter(o=>{var u,c;return((u=o.peerMetadata)==null?void 0:u.url)&&((c=o.peerMetadata)==null?void 0:c.url)===r.peer.metadata.url&&o.topic&&o.topic!==i.topic});if(s.length===0)return;this.client.logger.info(`Cleaning up ${s.length} duplicate pairing(s)`),await Promise.all(s.map(o=>this.client.core.pairing.disconnect({topic:o.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}},this.deleteSession=async(r,i)=>{const{self:s}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,Ze("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(s.publicKey)&&await this.client.core.crypto.deleteKeyPair(s.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),i||this.client.core.expirer.del(r)},this.deleteProposal=async(r,i)=>{await Promise.all([this.client.proposal.delete(r,Ze("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,i,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,i),s?Promise.resolve():this.client.core.expirer.del(r)]),this.requestQueue.requests=this.requestQueue.requests.filter(o=>o.id!==r),s&&(this.requestQueue.state=Kr.idle)},this.setExpiry=async(r,i)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:i}),this.client.core.expirer.set(r,i)},this.setProposal=async(r,i)=>{await this.client.proposal.set(r,i),this.client.core.expirer.set(r,i.expiry)},this.setPendingSessionRequest=async r=>{const i=zr.wc_sessionRequest.req.ttl,{id:s,topic:o,params:u}=r;await this.client.pendingRequest.set(s,{id:s,topic:o,params:u}),i&&this.client.core.expirer.set(s,Tt(i))},this.sendRequest=async(r,i,s,o,u)=>{const c=Ti(i,s);if(Us()&&Q0.includes(i)){const p=Dr(JSON.stringify(c));await this.client.core.verify.register({attestationId:p})}const h=await this.client.core.crypto.encode(r,c),d=zr[i].req;return o&&(d.ttl=o),u&&(d.id=u),this.client.core.history.set(r,c),this.client.core.relayer.publish(r,h,d),c.id},this.sendResult=async(r,i,s)=>{const o=js(r,s),u=await this.client.core.crypto.encode(i,o),c=await this.client.core.history.get(i,r),h=zr[c.request.method].res;this.client.core.relayer.publish(i,u,h),await this.client.core.history.resolve(o)},this.sendError=async(r,i,s)=>{const o=Bs(r,s),u=await this.client.core.crypto.encode(i,o),c=await this.client.core.history.get(i,r),h=zr[c.request.method].res;this.client.core.relayer.publish(i,u,h),await this.client.core.history.resolve(o)},this.cleanup=async()=>{const r=[],i=[];this.client.session.getAll().forEach(s=>{Gt(s.expiry)&&r.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{Gt(s.expiry)&&i.push(s.id)}),await Promise.all([...r.map(s=>this.deleteSession(s)),...i.map(s=>this.deleteProposal(s))])},this.onRelayEventRequest=r=>{const{topic:i,payload:s}=r,o=s.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeRequest(i,s);case"wc_sessionSettle":return this.onSessionSettleRequest(i,s);case"wc_sessionUpdate":return this.onSessionUpdateRequest(i,s);case"wc_sessionExtend":return this.onSessionExtendRequest(i,s);case"wc_sessionPing":return this.onSessionPingRequest(i,s);case"wc_sessionDelete":return this.onSessionDeleteRequest(i,s);case"wc_sessionRequest":return this.onSessionRequest(i,s);case"wc_sessionEvent":return this.onSessionEventRequest(i,s);default:return this.client.logger.info(`Unsupported request method ${o}`)}},this.onRelayEventResponse=async r=>{const{topic:i,payload:s}=r,o=(await this.client.core.history.get(i,s.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(i,s);case"wc_sessionSettle":return this.onSessionSettleResponse(i,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,s);case"wc_sessionExtend":return this.onSessionExtendResponse(i,s);case"wc_sessionPing":return this.onSessionPingResponse(i,s);case"wc_sessionRequest":return this.onSessionRequestResponse(i,s);default:return this.client.logger.info(`Unsupported response method ${o}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:i}=r,{message:s}=G("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)},this.onSessionProposeRequest=async(r,i)=>{const{params:s,id:o}=i;try{this.isValidConnect(Dt({},i.params));const u=Tt(Q.FIVE_MINUTES),c=Dt({id:o,pairingTopic:r,expiry:u},s);await this.setProposal(o,c);const h=Dr(JSON.stringify(i)),d=await this.getVerifyContext(h,c.proposer.metadata);this.client.events.emit("session_proposal",{id:o,params:c,verifyContext:d})}catch(u){await this.sendError(o,r,u),this.client.logger.error(u)}},this.onSessionProposeResponse=async(r,i)=>{const{id:s}=i;if(zt(i)){const{result:o}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const u=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:u});const c=u.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const h=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:h});const d=await this.client.core.crypto.generateSharedKey(c,h);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:d});const p=await this.client.core.relayer.subscribe(d);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:p}),await this.client.core.pairing.activate({topic:r})}else Nt(i)&&(await this.client.proposal.delete(s,Ze("USER_DISCONNECTED")),this.events.emit(qe("session_connect"),{error:i.error}))},this.onSessionSettleRequest=async(r,i)=>{const{id:s,params:o}=i;try{this.isValidSessionSettleRequest(o);const{relay:u,controller:c,expiry:h,namespaces:d,requiredNamespaces:p,optionalNamespaces:E,sessionProperties:x,pairingTopic:v}=i.params,I=Dt({topic:r,relay:u,expiry:h,namespaces:d,acknowledged:!0,pairingTopic:v,requiredNamespaces:p,optionalNamespaces:E,controller:c.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:c.publicKey,metadata:c.metadata}},x&&{sessionProperties:x});await this.sendResult(i.id,r,!0),this.events.emit(qe("session_connect"),{session:I}),this.cleanupDuplicatePairings(I)}catch(u){await this.sendError(s,r,u),this.client.logger.error(u)}},this.onSessionSettleResponse=async(r,i)=>{const{id:s}=i;zt(i)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(qe("session_approve",s),{})):Nt(i)&&(await this.client.session.delete(r,Ze("USER_DISCONNECTED")),this.events.emit(qe("session_approve",s),{error:i.error}))},this.onSessionUpdateRequest=async(r,i)=>{const{params:s,id:o}=i;try{this.isValidUpdate(Dt({topic:r},s)),await this.client.session.update(r,{namespaces:s.namespaces}),await this.sendResult(o,r,!0),this.client.events.emit("session_update",{id:o,topic:r,params:s})}catch(u){await this.sendError(o,r,u),this.client.logger.error(u)}},this.onSessionUpdateResponse=(r,i)=>{const{id:s}=i;zt(i)?this.events.emit(qe("session_update",s),{}):Nt(i)&&this.events.emit(qe("session_update",s),{error:i.error})},this.onSessionExtendRequest=async(r,i)=>{const{id:s}=i;try{this.isValidExtend({topic:r}),await this.setExpiry(r,Tt(li)),await this.sendResult(s,r,!0),this.client.events.emit("session_extend",{id:s,topic:r})}catch(o){await this.sendError(s,r,o),this.client.logger.error(o)}},this.onSessionExtendResponse=(r,i)=>{const{id:s}=i;zt(i)?this.events.emit(qe("session_extend",s),{}):Nt(i)&&this.events.emit(qe("session_extend",s),{error:i.error})},this.onSessionPingRequest=async(r,i)=>{const{id:s}=i;try{this.isValidPing({topic:r}),await this.sendResult(s,r,!0),this.client.events.emit("session_ping",{id:s,topic:r})}catch(o){await this.sendError(s,r,o),this.client.logger.error(o)}},this.onSessionPingResponse=(r,i)=>{const{id:s}=i;setTimeout(()=>{zt(i)?this.events.emit(qe("session_ping",s),{}):Nt(i)&&this.events.emit(qe("session_ping",s),{error:i.error})},500)},this.onSessionDeleteRequest=async(r,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:r,reason:i.params}),await Promise.all([new Promise(o=>{this.client.core.relayer.once(Ue.publish,async()=>{o(await this.deleteSession(r))})}),this.sendResult(s,r,!0)]),this.client.events.emit("session_delete",{id:s,topic:r})}catch(o){this.client.logger.error(o)}},this.onSessionRequest=async(r,i)=>{const{id:s,params:o}=i;try{this.isValidRequest(Dt({topic:r},o)),await this.setPendingSessionRequest({id:s,topic:r,params:o}),this.addRequestToQueue({id:s,topic:r,params:o}),await this.processRequestQueue()}catch(u){await this.sendError(s,r,u),this.client.logger.error(u)}},this.onSessionRequestResponse=(r,i)=>{const{id:s}=i;zt(i)?this.events.emit(qe("session_request",s),{result:i.result}):Nt(i)&&this.events.emit(qe("session_request",s),{error:i.error})},this.onSessionEventRequest=async(r,i)=>{const{id:s,params:o}=i;try{this.isValidEmit(Dt({topic:r},o)),this.client.events.emit("session_event",{id:s,topic:r,params:o})}catch(u){await this.sendError(s,r,u),this.client.logger.error(u)}},this.addRequestToQueue=r=>{this.requestQueue.requests.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.requestQueue.state=Kr.idle,this.processRequestQueue()},Q.toMiliseconds(this.requestQueueDelay))},this.processRequestQueue=async()=>{if(this.requestQueue.state===Kr.active){this.client.logger.info("session request queue is already active.");return}const r=this.requestQueue.requests[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{const{id:i,topic:s,params:o}=r,u=Dr(JSON.stringify({id:i,params:o})),c=this.client.session.get(s),h=await this.getVerifyContext(u,c.peer.metadata);this.requestQueue.state=Kr.active,this.client.events.emit("session_request",{id:i,topic:s,params:o,verifyContext:h})}catch(i){this.client.logger.error(i)}},this.isValidConnect=async r=>{if(!yt(r)){const{message:h}=G("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(h)}const{pairingTopic:i,requiredNamespaces:s,optionalNamespaces:o,sessionProperties:u,relays:c}=r;if(dt(i)||await this.isValidPairingTopic(i),!$d(c,!0)){const{message:h}=G("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(h)}!dt(s)&&Hr(s)!==0&&this.validateNamespaces(s,"requiredNamespaces"),!dt(o)&&Hr(o)!==0&&this.validateNamespaces(o,"optionalNamespaces"),dt(u)||this.validateSessionProps(u,"sessionProperties")},this.validateNamespaces=(r,i)=>{const s=Md(r,"connect()",i);if(s)throw new Error(s.message)},this.isValidApprove=async r=>{if(!yt(r))throw new Error(G("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:i,namespaces:s,relayProtocol:o,sessionProperties:u}=r;await this.isValidProposalId(i);const c=this.client.proposal.get(i),h=pi(s,"approve()");if(h)throw new Error(h.message);const d=so(c.requiredNamespaces,s,"approve()");if(d)throw new Error(d.message);if(!et(o,!0)){const{message:p}=G("MISSING_OR_INVALID",`approve() relayProtocol: ${o}`);throw new Error(p)}dt(u)||this.validateSessionProps(u,"sessionProperties")},this.isValidReject=async r=>{if(!yt(r)){const{message:o}=G("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(o)}const{id:i,reason:s}=r;if(await this.isValidProposalId(i),!Bd(s)){const{message:o}=G("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(o)}},this.isValidSessionSettleRequest=r=>{if(!yt(r)){const{message:d}=G("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(d)}const{relay:i,controller:s,namespaces:o,expiry:u}=r;if(!xa(i)){const{message:d}=G("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(d)}const c=Nd(s,"onSessionSettleRequest()");if(c)throw new Error(c.message);const h=pi(o,"onSessionSettleRequest()");if(h)throw new Error(h.message);if(Gt(u)){const{message:d}=G("EXPIRED","onSessionSettleRequest()");throw new Error(d)}},this.isValidUpdate=async r=>{if(!yt(r)){const{message:h}=G("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(h)}const{topic:i,namespaces:s}=r;await this.isValidSessionTopic(i);const o=this.client.session.get(i),u=pi(s,"update()");if(u)throw new Error(u.message);const c=so(o.requiredNamespaces,s,"update()");if(c)throw new Error(c.message)},this.isValidExtend=async r=>{if(!yt(r)){const{message:s}=G("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionTopic(i)},this.isValidRequest=async r=>{if(!yt(r)){const{message:h}=G("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(h)}const{topic:i,request:s,chainId:o,expiry:u}=r;await this.isValidSessionTopic(i);const{namespaces:c}=this.client.session.get(i);if(!io(c,o)){const{message:h}=G("MISSING_OR_INVALID",`request() chainId: ${o}`);throw new Error(h)}if(!qd(s)){const{message:h}=G("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(h)}if(!Vd(c,o,s.method)){const{message:h}=G("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(h)}if(u&&!Gd(u,Xi)){const{message:h}=G("MISSING_OR_INVALID",`request() expiry: ${u}. Expiry must be a number (in seconds) between ${Xi.min} and ${Xi.max}`);throw new Error(h)}},this.isValidRespond=async r=>{if(!yt(r)){const{message:o}=G("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(o)}const{topic:i,response:s}=r;if(await this.isValidSessionTopic(i),!zd(s)){const{message:o}=G("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(o)}},this.isValidPing=async r=>{if(!yt(r)){const{message:s}=G("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)},this.isValidEmit=async r=>{if(!yt(r)){const{message:c}=G("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(c)}const{topic:i,event:s,chainId:o}=r;await this.isValidSessionTopic(i);const{namespaces:u}=this.client.session.get(i);if(!io(u,o)){const{message:c}=G("MISSING_OR_INVALID",`emit() chainId: ${o}`);throw new Error(c)}if(!Kd(s)){const{message:c}=G("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(c)}if(!Hd(u,o,s.name)){const{message:c}=G("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(c)}},this.isValidDisconnect=async r=>{if(!yt(r)){const{message:s}=G("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)},this.getVerifyContext=async(r,i)=>{const s={verified:{verifyUrl:i.verifyUrl||"",validation:"UNKNOWN",origin:i.url||""}};try{const o=await this.client.core.verify.resolve({attestationId:r,verifyUrl:i.verifyUrl});o&&(s.verified.origin=o,s.verified.validation=o===i.url?"VALID":"INVALID")}catch(o){this.client.logger.error(o)}return this.client.logger.info(`Verify context: ${JSON.stringify(s)}`),s},this.validateSessionProps=(r,i)=>{Object.values(r).forEach(s=>{if(!et(s,!1)){const{message:o}=G("MISSING_OR_INVALID",`${i} must be in Record<string, string> format. Received: ${JSON.stringify(s)}`);throw new Error(o)}})}}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.client.core.relayer.on(Ue.message,async e=>{const{topic:r,message:i}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(i)))return;const s=await this.client.core.crypto.decode(r,i);qs(s)?(this.client.core.history.set(r,s),this.onRelayEventRequest({topic:r,payload:s})):Ni(s)?(await this.client.core.history.resolve(s),await this.onRelayEventResponse({topic:r,payload:s}),this.client.core.history.delete(r,s.id)):this.onRelayEventUnknownPayload({topic:r,payload:s})})}registerExpirerEvents(){this.client.core.expirer.on(St.expired,async e=>{const{topic:r,id:i}=Sa(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,G("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}isValidPairingTopic(e){if(!et(e,!1)){const{message:r}=G("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=G("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(Gt(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=G("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!et(e,!1)){const{message:r}=G("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(!this.client.session.keys.includes(e)){const{message:r}=G("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(Gt(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:r}=G("EXPIRED",`session topic: ${e}`);throw new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(et(e,!1)){const{message:r}=G("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=G("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!jd(e)){const{message:r}=G("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=G("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(Gt(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:r}=G("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}}class ny extends Ri{constructor(e,r){super(e,r,k0,Vs),this.core=e,this.logger=r}}class oy extends Ri{constructor(e,r){super(e,r,Y0,Vs),this.core=e,this.logger=r}}class ay extends Ri{constructor(e,r){super(e,r,X0,Vs,i=>i.id),this.core=e,this.logger=r}}let cy=class Ya extends ch{constructor(e){super(e),this.protocol=Wa,this.version=ka,this.name=Ji.name,this.events=new xt.EventEmitter,this.on=(i,s)=>this.events.on(i,s),this.once=(i,s)=>this.events.once(i,s),this.off=(i,s)=>this.events.off(i,s),this.removeListener=(i,s)=>this.events.removeListener(i,s),this.removeAllListeners=i=>this.events.removeAllListeners(i),this.connect=async i=>{try{return await this.engine.connect(i)}catch(s){throw this.logger.error(s.message),s}},this.pair=async i=>{try{return await this.engine.pair(i)}catch(s){throw this.logger.error(s.message),s}},this.approve=async i=>{try{return await this.engine.approve(i)}catch(s){throw this.logger.error(s.message),s}},this.reject=async i=>{try{return await this.engine.reject(i)}catch(s){throw this.logger.error(s.message),s}},this.update=async i=>{try{return await this.engine.update(i)}catch(s){throw this.logger.error(s.message),s}},this.extend=async i=>{try{return await this.engine.extend(i)}catch(s){throw this.logger.error(s.message),s}},this.request=async i=>{try{return await this.engine.request(i)}catch(s){throw this.logger.error(s.message),s}},this.respond=async i=>{try{return await this.engine.respond(i)}catch(s){throw this.logger.error(s.message),s}},this.ping=async i=>{try{return await this.engine.ping(i)}catch(s){throw this.logger.error(s.message),s}},this.emit=async i=>{try{return await this.engine.emit(i)}catch(s){throw this.logger.error(s.message),s}},this.disconnect=async i=>{try{return await this.engine.disconnect(i)}catch(s){throw this.logger.error(s.message),s}},this.find=i=>{try{return this.engine.find(i)}catch(s){throw this.logger.error(s.message),s}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}},this.name=(e==null?void 0:e.name)||Ji.name,this.metadata=(e==null?void 0:e.metadata)||rd();const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:me.pino(me.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||Ji.logger}));this.core=(e==null?void 0:e.core)||new H0(e),this.logger=me.generateChildLogger(r,this.name),this.session=new oy(this.core,this.logger),this.proposal=new ny(this.core,this.logger),this.pendingRequest=new ay(this.core,this.logger),this.engine=new sy(this)}static async init(e){const r=new Ya(e);return await r.initialize(),r}get context(){return me.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};var uy=Object.defineProperty,hy=Object.defineProperties,ly=Object.getOwnPropertyDescriptors,Lo=Object.getOwnPropertySymbols,fy=Object.prototype.hasOwnProperty,dy=Object.prototype.propertyIsEnumerable,Fo=(t,e,r)=>e in t?uy(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,py=(t,e)=>{for(var r in e||(e={}))fy.call(e,r)&&Fo(t,r,e[r]);if(Lo)for(var r of Lo(e))dy.call(e,r)&&Fo(t,r,e[r]);return t},gy=(t,e)=>hy(t,ly(e)),Hs=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)},Ae=(t,e,r)=>(Hs(t,e,"read from private field"),r?r.call(t):e.get(t)),ur=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},Ei=(t,e,r,i)=>(Hs(t,e,"write to private field"),i?i.call(t,r):e.set(t,r),r),ct=(t,e,r)=>(Hs(t,e,"access private method"),r),hr,Er,Vr,Qe,_s,Ja,ut,ft,vs,Mo;class yy{constructor(e){ur(this,_s),ur(this,ut),ur(this,vs),ur(this,hr,void 0),ur(this,Er,void 0),ur(this,Vr,void 0),ur(this,Qe,void 0),Ei(this,hr,e),Ei(this,Er,ct(this,_s,Ja).call(this)),ct(this,ut,ft).call(this)}async connect(e){const{requiredNamespaces:r,optionalNamespaces:i}=e;return new Promise(async(s,o)=>{await ct(this,ut,ft).call(this);const u=Ae(this,Er).subscribeModal(d=>{d.open||(u(),o(new Error("Modal closed")))}),{uri:c,approval:h}=await Ae(this,Qe).connect(e);if(c){const d=new Set;r&&Object.values(r).forEach(({chains:p})=>{p&&p.forEach(E=>d.add(E))}),i&&Object.values(i).forEach(({chains:p})=>{p&&p.forEach(E=>d.add(E))}),await Ae(this,Er).openModal({uri:c,chains:Array.from(d)})}try{const d=await h();s(d)}catch(d){o(d)}finally{u(),Ae(this,Er).closeModal()}})}async disconnect(e){await ct(this,ut,ft).call(this),await Ae(this,Qe).disconnect(e)}async request(e){return await ct(this,ut,ft).call(this),await Ae(this,Qe).request(e)}async getSessions(){return await ct(this,ut,ft).call(this),Ae(this,Qe).session.getAll()}async getSession(){return await ct(this,ut,ft).call(this),Ae(this,Qe).session.getAll().at(-1)}async onSessionEvent(e){await ct(this,ut,ft).call(this),Ae(this,Qe).on("session_event",e)}async offSessionEvent(e){await ct(this,ut,ft).call(this),Ae(this,Qe).off("session_event",e)}async onSessionUpdate(e){await ct(this,ut,ft).call(this),Ae(this,Qe).on("session_update",e)}async offSessionUpdate(e){await ct(this,ut,ft).call(this),Ae(this,Qe).off("session_update",e)}async onSessionDelete(e){await ct(this,ut,ft).call(this),Ae(this,Qe).on("session_delete",e)}async offSessionDelete(e){await ct(this,ut,ft).call(this),Ae(this,Qe).off("session_delete",e)}async onSessionExpire(e){await ct(this,ut,ft).call(this),Ae(this,Qe).on("session_expire",e)}async offSessionExpire(e){await ct(this,ut,ft).call(this),Ae(this,Qe).off("session_expire",e)}}hr=new WeakMap,Er=new WeakMap,Vr=new WeakMap,Qe=new WeakMap,_s=new WeakSet,Ja=function(){const{modalOptions:t,projectId:e}=Ae(this,hr);return new au(gy(py({},t),{projectId:e}))},ut=new WeakSet,ft=async function(){return Ae(this,Qe)?!0:(!Ae(this,Vr)&&typeof window<"u"&&Ei(this,Vr,ct(this,vs,Mo).call(this)),Ae(this,Vr))},vs=new WeakSet,Mo=async function(){Ei(this,Qe,await cy.init({metadata:Ae(this,hr).metadata,projectId:Ae(this,hr).projectId,relayUrl:Ae(this,hr).relayUrl}));const t=await Ae(this,Qe).core.crypto.getClientId();try{localStorage.setItem("WCM_WALLETCONNECT_CLIENT_ID",t)}catch{console.info("Unable to set client id")}};const by=Object.freeze(Object.defineProperty({__proto__:null,WalletConnectModalSign:yy},Symbol.toStringTag,{value:"Module"}));exports.R=$o;exports.T=Es;exports.a=rt;exports.index=by;exports.ne=is;exports.oe=ou;exports.p=It;exports.se=fi;exports.te=eu;exports.y=fr;
