{"version":3,"file":"BIP44CoinTypeNode.js","sourceRoot":"","sources":["../src/BIP44CoinTypeNode.ts"],"names":[],"mappings":"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","sourcesContent":["import { BIP44Node, BIP44NodeInterface, JsonBIP44Node } from './BIP44Node';\nimport {\n  BIP39Node,\n  BIP44Depth,\n  BIP44PurposeNodeToken,\n  BIP_32_HARDENED_OFFSET,\n  CoinTypeHDPathString,\n  HardenedBIP32Node,\n} from './constants';\nimport { SupportedCurve } from './curves';\nimport { deriveChildNode } from './SLIP10Node';\nimport {\n  CoinTypeToAddressIndices,\n  getBIP32NodeToken,\n  getBIP44ChangePathString,\n  getBIP44CoinTypePathString,\n  getBIP44CoinTypeToAddressPathTuple,\n  getHardenedBIP32NodeToken,\n  getUnhardenedBIP32NodeToken,\n  hexStringToBytes,\n  nullableHexStringToBytes,\n} from './utils';\n\nexport type CoinTypeHDPathTuple = [\n  BIP39Node,\n  typeof BIP44PurposeNodeToken,\n  HardenedBIP32Node,\n];\n\nexport const BIP_44_COIN_TYPE_DEPTH = 2;\n\nexport type JsonBIP44CoinTypeNode = JsonBIP44Node & {\n  readonly coin_type: number;\n  readonly path: CoinTypeHDPathString;\n};\n\nexport type BIP44CoinTypeNodeInterface = BIP44NodeInterface & {\n  readonly coin_type: number;\n  readonly path: CoinTypeHDPathString;\n};\n\n/**\n * A wrapper object for BIP-44 `coin_type` keys. `coin_type` is the index\n * specifying the protocol for which deeper keys are intended. For the\n * authoritative list of coin types, please see\n * [SLIP-44](https://github.com/satoshilabs/slips/blob/master/slip-0044.md).\n *\n * Recall that a BIP-44 HD tree path consists of the following nodes:\n *\n * `m / 44' / coin_type' / account' / change / address_index`\n *\n * With the following depths:\n *\n * `0 / 1 / 2 / 3 / 4 / 5`\n *\n */\nexport class BIP44CoinTypeNode implements BIP44CoinTypeNodeInterface {\n  /**\n   * Constructs a BIP-44 `coin_type` node. `coin_type` is the index\n   * specifying the protocol for which deeper keys are intended. For the\n   * authoritative list of coin types, please see\n   * [SLIP-44](https://github.com/satoshilabs/slips/blob/master/slip-0044.md).\n   *\n   * Recall that a BIP-44 HD tree path consists of the following nodes:\n   *\n   * `m / 44' / coin_type' / account' / change / address_index`\n   *\n   * With the following depths:\n   *\n   * `0 / 1 / 2 / 3 / 4 / 5`\n   *\n   * @param json - The {@link JsonBIP44Node} for the key of this node.\n   * @param coin_type - The coin_type index of this node. Must be a non-negative\n   * integer.\n   */\n  static async fromJSON(json: JsonBIP44Node, coin_type: number) {\n    validateCoinType(coin_type);\n    validateCoinTypeNodeDepth(json.depth);\n\n    const node = await BIP44Node.fromExtendedKey({\n      depth: json.depth,\n      index: json.index,\n      parentFingerprint: json.parentFingerprint,\n      chainCode: hexStringToBytes(json.chainCode),\n      privateKey: nullableHexStringToBytes(json.privateKey),\n      publicKey: hexStringToBytes(json.publicKey),\n    });\n\n    return new BIP44CoinTypeNode(node, coin_type);\n  }\n\n  /**\n   * Constructs a BIP-44 `coin_type` node. `coin_type` is the index\n   * specifying the protocol for which deeper keys are intended. For the\n   * authoritative list of coin types, please see\n   * [SLIP-44](https://github.com/satoshilabs/slips/blob/master/slip-0044.md).\n   *\n   * Recall that a BIP-44 HD tree path consists of the following nodes:\n   *\n   * `m / 44' / coin_type' / account' / change / address_index`\n   *\n   * With the following depths:\n   *\n   * `0 / 1 / 2 / 3 / 4 / 5`\n   *\n   * @param derivationPath - The derivation path for the key of this node.\n   */\n  static async fromDerivationPath(derivationPath: CoinTypeHDPathTuple) {\n    validateCoinTypeNodeDepth(derivationPath.length - 1);\n\n    const node = await BIP44Node.fromDerivationPath({\n      derivationPath,\n    });\n\n    // Split the bip32 string token and extract the coin_type index\n    const coinType = Number.parseInt(\n      derivationPath[BIP_44_COIN_TYPE_DEPTH].split(':')[1].replace(`'`, ''),\n      10,\n    );\n\n    return new BIP44CoinTypeNode(node, coinType);\n  }\n\n  /**\n   * Constructs a BIP-44 `coin_type` node. `coin_type` is the index\n   * specifying the protocol for which deeper keys are intended. For the\n   * authoritative list of coin types, please see\n   * [SLIP-44](https://github.com/satoshilabs/slips/blob/master/slip-0044.md).\n   *\n   * Recall that a BIP-44 HD tree path consists of the following nodes:\n   *\n   * `m / 44' / coin_type' / account' / change / address_index`\n   *\n   * With the following depths:\n   *\n   * `0 / 1 / 2 / 3 / 4 / 5`\n   *\n   * @param node - The {@link BIP44Node} for the key of this node.\n   * @param coin_type - The coin_type index of this node. Must be a non-negative\n   * integer.\n   */\n  static async fromNode(node: BIP44Node, coin_type: number) {\n    if (!(node instanceof BIP44Node)) {\n      throw new Error('Invalid node: Expected an instance of BIP44Node.');\n    }\n\n    validateCoinType(coin_type);\n    validateCoinTypeNodeDepth(node.depth);\n\n    // TODO: Make this function not async in a future version.\n    return Promise.resolve(new BIP44CoinTypeNode(node, coin_type));\n  }\n\n  readonly #node: BIP44Node;\n\n  public readonly path: CoinTypeHDPathString;\n\n  public readonly coin_type: number;\n\n  // Constructors cannot use hash names.\n  // eslint-disable-next-line no-restricted-syntax\n  private constructor(node: BIP44Node, coin_type: number) {\n    this.#node = node;\n    this.coin_type = coin_type;\n    this.path = getBIP44CoinTypePathString(coin_type);\n\n    Object.freeze(this);\n  }\n\n  public get depth(): BIP44Depth {\n    return this.#node.depth;\n  }\n\n  public get privateKeyBytes(): Uint8Array | undefined {\n    return this.#node.privateKeyBytes;\n  }\n\n  public get publicKeyBytes(): Uint8Array {\n    return this.#node.publicKeyBytes;\n  }\n\n  public get chainCodeBytes(): Uint8Array {\n    return this.#node.chainCodeBytes;\n  }\n\n  public get privateKey(): string | undefined {\n    return this.#node.privateKey;\n  }\n\n  public get publicKey(): string {\n    return this.#node.publicKey;\n  }\n\n  public get compressedPublicKey(): string {\n    return this.#node.compressedPublicKey;\n  }\n\n  public get compressedPublicKeyBytes(): Uint8Array {\n    return this.#node.compressedPublicKeyBytes;\n  }\n\n  public get chainCode(): string {\n    return this.#node.chainCode;\n  }\n\n  public get address(): string {\n    return this.#node.address;\n  }\n\n  public get masterFingerprint(): number | undefined {\n    return this.#node.masterFingerprint;\n  }\n\n  public get parentFingerprint(): number {\n    return this.#node.parentFingerprint;\n  }\n\n  public get fingerprint(): number {\n    return this.#node.fingerprint;\n  }\n\n  public get index(): number {\n    return this.#node.index;\n  }\n\n  public get curve(): SupportedCurve {\n    return this.#node.curve;\n  }\n\n  public get extendedKey(): string {\n    return this.#node.extendedKey;\n  }\n\n  /**\n   * Derives a BIP-44 `address_index` key corresponding to the path of this\n   * node and the specified `account`, `change`, and `address_index` values.\n   * `address_index` keys are normally the keys used to generate user account\n   * addresses.\n   *\n   * Recall that a BIP-44 HD tree path consists of the following nodes:\n   *\n   * `m / 44' / coin_type' / account' / change / address_index`\n   *\n   * With the following depths:\n   *\n   * `0 / 1 / 2 / 3 / 4 / 5`\n   *\n   * @param indices - The BIP-44 index values to use in key derivation.\n   * @param indices.account - The `account` index. Default: `0`\n   * @param indices.change - The `change` index. Default: `0`\n   * @param indices.address_index - The `address_index` index.\n   * @returns The derived BIP-44 `address_index` node.\n   */\n  async deriveBIP44AddressKey({\n    account = 0,\n    change = 0,\n    address_index,\n  }: CoinTypeToAddressIndices): Promise<BIP44Node> {\n    return await this.#node.derive(\n      getBIP44CoinTypeToAddressPathTuple({ account, change, address_index }),\n    );\n  }\n\n  toJSON(): JsonBIP44CoinTypeNode {\n    return {\n      ...this.#node.toJSON(),\n      coin_type: this.coin_type,\n      path: this.path,\n    };\n  }\n}\n\n/**\n * Validates the depth of a `coin_type` node. Simply, ensures that it is the\n * number `2`. An error is thrown if validation fails.\n *\n * @param depth - The depth to validate.\n */\nfunction validateCoinTypeNodeDepth(depth: number) {\n  if (depth !== BIP_44_COIN_TYPE_DEPTH) {\n    throw new Error(\n      `Invalid depth: Coin type nodes must be of depth ${BIP_44_COIN_TYPE_DEPTH}. Received: \"${depth}\"`,\n    );\n  }\n}\n\n/**\n * Validates that the coin type is a non-negative integer number. An error is\n * thrown if validation fails.\n *\n * @param coin_type - The coin type to validate.\n */\nfunction validateCoinType(coin_type: unknown): asserts coin_type is number {\n  if (\n    typeof coin_type !== 'number' ||\n    !Number.isInteger(coin_type) ||\n    coin_type < 0\n  ) {\n    throw new Error(\n      'Invalid coin type: The specified coin type must be a non-negative integer number.',\n    );\n  }\n}\n\n/**\n * Derives a BIP-44 address key corresponding to the specified derivation path,\n * given either by a {@link BIP44CoinTypeNode} or derivation path tuple.\n *\n * Recall that a BIP-44 HD tree path consists of the following nodes:\n *\n * `m / 44' / coin_type' / account' / change / address_index`\n *\n * With the following depths:\n *\n * `0 / 1 / 2 / 3 / 4 / 5`\n *\n * @param parentKeyOrNode - The `coin_type` parent key to derive from.\n * @param indices - The BIP-44 index values to use in key derivation.\n * @param indices.account - The `account` index. Default: `0`.\n * @param indices.change - The `change` index. Default: `0`.\n * @param indices.address_index - The `address_index` index.\n * @returns The derived `address_index` key for the specified derivation path.\n */\nexport async function deriveBIP44AddressKey(\n  parentKeyOrNode: BIP44CoinTypeNode | JsonBIP44CoinTypeNode | string,\n  { account = 0, change = 0, address_index }: CoinTypeToAddressIndices,\n): Promise<BIP44Node> {\n  const path = getBIP44CoinTypeToAddressPathTuple({\n    account,\n    change,\n    address_index,\n  });\n\n  const node = await getNode(parentKeyOrNode);\n  const childNode = await deriveChildNode({\n    path,\n    node,\n  });\n\n  return new BIP44Node(childNode);\n}\n\nexport type BIP44AddressKeyDeriver = {\n  /**\n   * @param address_index - The `address_index` value.\n   * @param isHardened - Whether the derived index is hardened.\n   * @returns The key corresponding to the path of this deriver and the\n   * specified `address_index` value.\n   */\n  (address_index: number, isHardened?: boolean): Promise<BIP44Node>;\n\n  /**\n   * A human-readable representation of the derivation path of this deriver\n   * function, excluding the `address_index`, which is parameterized.\n   *\n   * Recall that a BIP-44 HD tree path consists of the following nodes:\n   *\n   * `m / 44' / coin_type' / account' / change / address_index`\n   *\n   * With the following depths:\n   *\n   * `0 / 1 / 2 / 3 / 4 / 5`\n   */\n  path: ReturnType<typeof getBIP44ChangePathString>;\n\n  /**\n   * The `coin_type` index of addresses derived by this deriver function.\n   */\n  coin_type: number;\n};\n\n/**\n * Creates a function that derives BIP-44 address keys corresponding to the\n * specified derivation path, given either by a {@link BIP44CoinTypeNode} or\n * derivation path tuple.\n *\n * Recall that a BIP-44 HD tree path consists of the following nodes:\n *\n * `m / 44' / coin_type' / account' / change / address_index`\n *\n * With the following depths:\n *\n * `0 / 1 / 2 / 3 / 4 / 5`\n *\n * @param node - The {@link BIP44CoinTypeNode} to derive address keys from.\n * This node contains a BIP-44 key of depth 2, `coin_type`.\n * @param accountAndChangeIndices - The `account` and `change` indices that\n * will be used to derive addresses.\n * @returns The deriver function for the derivation path specified by the\n * `coin_type` node, `account`, and `change` indices.\n */\nexport async function getBIP44AddressKeyDeriver(\n  node: BIP44CoinTypeNode | JsonBIP44CoinTypeNode | string,\n  accountAndChangeIndices?: Omit<CoinTypeToAddressIndices, 'address_index'>,\n) {\n  const { account = 0, change = 0 } = accountAndChangeIndices ?? {};\n\n  const actualNode = await getNode(node);\n\n  const accountNode = getHardenedBIP32NodeToken(account);\n  const changeNode = getBIP32NodeToken(change);\n\n  const bip44AddressKeyDeriver: BIP44AddressKeyDeriver = async (\n    address_index: number,\n    isHardened = false,\n  ): Promise<BIP44Node> => {\n    const slip10Node = await deriveChildNode({\n      path: [\n        accountNode,\n        changeNode,\n        isHardened\n          ? getHardenedBIP32NodeToken(address_index)\n          : getUnhardenedBIP32NodeToken(address_index),\n      ],\n      node: actualNode,\n    });\n\n    return new BIP44Node(slip10Node);\n  };\n\n  bip44AddressKeyDeriver.coin_type = actualNode.coin_type;\n  bip44AddressKeyDeriver.path = getBIP44ChangePathString(actualNode.path, {\n    account,\n    change,\n  });\n\n  Object.freeze(bip44AddressKeyDeriver);\n\n  return bip44AddressKeyDeriver;\n}\n\n/**\n * Get a BIP-44 coin type node from a JSON node or extended key string. If an existing coin type\n * node is provided, the same node is returned.\n *\n * The depth of the node is validated to be a valid coin type node.\n *\n * @param node - A BIP-44 coin type node, JSON node or extended key.\n */\nasync function getNode(\n  node: BIP44CoinTypeNode | JsonBIP44CoinTypeNode | string,\n): Promise<BIP44CoinTypeNode> {\n  if (node instanceof BIP44CoinTypeNode) {\n    validateCoinTypeNodeDepth(node.depth);\n\n    return node;\n  }\n\n  if (typeof node === 'string') {\n    const bip44Node = await BIP44Node.fromExtendedKey(node);\n    const coinTypeNode = await BIP44CoinTypeNode.fromNode(\n      bip44Node,\n      bip44Node.index - BIP_32_HARDENED_OFFSET,\n    );\n\n    validateCoinTypeNodeDepth(coinTypeNode.depth);\n\n    return coinTypeNode;\n  }\n\n  return BIP44CoinTypeNode.fromJSON(node, node.coin_type);\n}\n"]}