{"version":3,"sources":["../../src/BIP44CoinTypeNode.ts"],"sourcesContent":["import { assert } from '@metamask/utils';\n\nimport type { BIP44NodeInterface, JsonBIP44Node } from './BIP44Node';\nimport { BIP44Node } from './BIP44Node';\nimport type {\n  BIP39Node,\n  BIP44Depth,\n  BIP44PurposeNodeToken,\n  CoinTypeHDPathString,\n  HardenedBIP32Node,\n} from './constants';\nimport { BIP_32_HARDENED_OFFSET } from './constants';\nimport type { SupportedCurve } from './curves';\nimport { deriveChildNode } from './SLIP10Node';\nimport type { CoinTypeToAddressIndices } from './utils';\nimport {\n  getBIP32NodeToken,\n  getBIP44ChangePathString,\n  getBIP44CoinTypePathString,\n  getBIP44CoinTypeToAddressPathTuple,\n  getHardenedBIP32NodeToken,\n  getUnhardenedBIP32NodeToken,\n  hexStringToBytes,\n  nullableHexStringToBytes,\n} from './utils';\n\nexport type CoinTypeHDPathTuple = [\n  BIP39Node,\n  typeof BIP44PurposeNodeToken,\n  HardenedBIP32Node,\n];\n\nexport const BIP_44_COIN_TYPE_DEPTH = 2;\n\nexport type JsonBIP44CoinTypeNode = JsonBIP44Node & {\n  readonly coin_type: number;\n  readonly path: CoinTypeHDPathString;\n};\n\nexport type BIP44CoinTypeNodeInterface = BIP44NodeInterface & {\n  readonly coin_type: number;\n  readonly path: CoinTypeHDPathString;\n};\n\n/**\n * A wrapper object for BIP-44 `coin_type` keys. `coin_type` is the index\n * specifying the protocol for which deeper keys are intended. For the\n * authoritative list of coin types, please see\n * [SLIP-44](https://github.com/satoshilabs/slips/blob/master/slip-0044.md).\n *\n * Recall that a BIP-44 HD tree path consists of the following nodes:\n *\n * `m / 44' / coin_type' / account' / change / address_index`\n *\n * With the following depths:\n *\n * `0 / 1 / 2 / 3 / 4 / 5`\n *\n */\nexport class BIP44CoinTypeNode implements BIP44CoinTypeNodeInterface {\n  /**\n   * Constructs a BIP-44 `coin_type` node. `coin_type` is the index\n   * specifying the protocol for which deeper keys are intended. For the\n   * authoritative list of coin types, please see\n   * [SLIP-44](https://github.com/satoshilabs/slips/blob/master/slip-0044.md).\n   *\n   * Recall that a BIP-44 HD tree path consists of the following nodes:\n   *\n   * `m / 44' / coin_type' / account' / change / address_index`\n   *\n   * With the following depths:\n   *\n   * `0 / 1 / 2 / 3 / 4 / 5`\n   *\n   * @param json - The {@link JsonBIP44Node} for the key of this node.\n   * @param coin_type - The coin_type index of this node. Must be a non-negative\n   * integer.\n   */\n  static async fromJSON(json: JsonBIP44Node, coin_type: number) {\n    validateCoinType(coin_type);\n    validateCoinTypeNodeDepth(json.depth);\n\n    const node = await BIP44Node.fromExtendedKey({\n      depth: json.depth,\n      index: json.index,\n      parentFingerprint: json.parentFingerprint,\n      chainCode: hexStringToBytes(json.chainCode),\n      privateKey: nullableHexStringToBytes(json.privateKey),\n      publicKey: hexStringToBytes(json.publicKey),\n    });\n\n    return new BIP44CoinTypeNode(node, coin_type);\n  }\n\n  /**\n   * Constructs a BIP-44 `coin_type` node. `coin_type` is the index\n   * specifying the protocol for which deeper keys are intended. For the\n   * authoritative list of coin types, please see\n   * [SLIP-44](https://github.com/satoshilabs/slips/blob/master/slip-0044.md).\n   *\n   * Recall that a BIP-44 HD tree path consists of the following nodes:\n   *\n   * `m / 44' / coin_type' / account' / change / address_index`\n   *\n   * With the following depths:\n   *\n   * `0 / 1 / 2 / 3 / 4 / 5`\n   *\n   * @param derivationPath - The derivation path for the key of this node.\n   */\n  static async fromDerivationPath(derivationPath: CoinTypeHDPathTuple) {\n    validateCoinTypeNodeDepth(derivationPath.length - 1);\n\n    const node = await BIP44Node.fromDerivationPath({\n      derivationPath,\n    });\n\n    // Split the bip32 string token and extract the coin_type index.\n    const pathPart = derivationPath[BIP_44_COIN_TYPE_DEPTH].split(\n      ':',\n    )[1]?.replace(`'`, '');\n\n    assert(pathPart, 'Invalid derivation path.');\n    const coinType = Number.parseInt(pathPart, 10);\n\n    return new BIP44CoinTypeNode(node, coinType);\n  }\n\n  /**\n   * Constructs a BIP-44 `coin_type` node. `coin_type` is the index\n   * specifying the protocol for which deeper keys are intended. For the\n   * authoritative list of coin types, please see\n   * [SLIP-44](https://github.com/satoshilabs/slips/blob/master/slip-0044.md).\n   *\n   * Recall that a BIP-44 HD tree path consists of the following nodes:\n   *\n   * `m / 44' / coin_type' / account' / change / address_index`\n   *\n   * With the following depths:\n   *\n   * `0 / 1 / 2 / 3 / 4 / 5`\n   *\n   * @param node - The {@link BIP44Node} for the key of this node.\n   * @param coin_type - The coin_type index of this node. Must be a non-negative\n   * integer.\n   */\n  static async fromNode(node: BIP44Node, coin_type: number) {\n    if (!(node instanceof BIP44Node)) {\n      throw new Error('Invalid node: Expected an instance of BIP44Node.');\n    }\n\n    validateCoinType(coin_type);\n    validateCoinTypeNodeDepth(node.depth);\n\n    // TODO: Make this function not async in a future version.\n    return Promise.resolve(new BIP44CoinTypeNode(node, coin_type));\n  }\n\n  readonly #node: BIP44Node;\n\n  public readonly path: CoinTypeHDPathString;\n\n  public readonly coin_type: number;\n\n  // Constructors cannot use hash names.\n  // eslint-disable-next-line no-restricted-syntax\n  private constructor(node: BIP44Node, coin_type: number) {\n    this.#node = node;\n    this.coin_type = coin_type;\n    this.path = getBIP44CoinTypePathString(coin_type);\n\n    Object.freeze(this);\n  }\n\n  public get depth(): BIP44Depth {\n    return this.#node.depth;\n  }\n\n  public get privateKeyBytes(): Uint8Array | undefined {\n    return this.#node.privateKeyBytes;\n  }\n\n  public get publicKeyBytes(): Uint8Array {\n    return this.#node.publicKeyBytes;\n  }\n\n  public get chainCodeBytes(): Uint8Array {\n    return this.#node.chainCodeBytes;\n  }\n\n  public get privateKey(): string | undefined {\n    return this.#node.privateKey;\n  }\n\n  public get publicKey(): string {\n    return this.#node.publicKey;\n  }\n\n  public get compressedPublicKey(): string {\n    return this.#node.compressedPublicKey;\n  }\n\n  public get compressedPublicKeyBytes(): Uint8Array {\n    return this.#node.compressedPublicKeyBytes;\n  }\n\n  public get chainCode(): string {\n    return this.#node.chainCode;\n  }\n\n  public get address(): string {\n    return this.#node.address;\n  }\n\n  public get masterFingerprint(): number | undefined {\n    return this.#node.masterFingerprint;\n  }\n\n  public get parentFingerprint(): number {\n    return this.#node.parentFingerprint;\n  }\n\n  public get fingerprint(): number {\n    return this.#node.fingerprint;\n  }\n\n  public get index(): number {\n    return this.#node.index;\n  }\n\n  public get curve(): SupportedCurve {\n    return this.#node.curve;\n  }\n\n  public get extendedKey(): string {\n    return this.#node.extendedKey;\n  }\n\n  /**\n   * Derives a BIP-44 `address_index` key corresponding to the path of this\n   * node and the specified `account`, `change`, and `address_index` values.\n   * `address_index` keys are normally the keys used to generate user account\n   * addresses.\n   *\n   * Recall that a BIP-44 HD tree path consists of the following nodes:\n   *\n   * `m / 44' / coin_type' / account' / change / address_index`\n   *\n   * With the following depths:\n   *\n   * `0 / 1 / 2 / 3 / 4 / 5`\n   *\n   * @param indices - The BIP-44 index values to use in key derivation.\n   * @param indices.account - The `account` index. Default: `0`\n   * @param indices.change - The `change` index. Default: `0`\n   * @param indices.address_index - The `address_index` index.\n   * @returns The derived BIP-44 `address_index` node.\n   */\n  async deriveBIP44AddressKey({\n    account = 0,\n    change = 0,\n    address_index,\n  }: CoinTypeToAddressIndices): Promise<BIP44Node> {\n    return await this.#node.derive(\n      getBIP44CoinTypeToAddressPathTuple({ account, change, address_index }),\n    );\n  }\n\n  toJSON(): JsonBIP44CoinTypeNode {\n    return {\n      ...this.#node.toJSON(),\n      coin_type: this.coin_type,\n      path: this.path,\n    };\n  }\n}\n\n/**\n * Validates the depth of a `coin_type` node. Simply, ensures that it is the\n * number `2`. An error is thrown if validation fails.\n *\n * @param depth - The depth to validate.\n */\nfunction validateCoinTypeNodeDepth(depth: number) {\n  if (depth !== BIP_44_COIN_TYPE_DEPTH) {\n    throw new Error(\n      `Invalid depth: Coin type nodes must be of depth ${BIP_44_COIN_TYPE_DEPTH}. Received: \"${depth}\"`,\n    );\n  }\n}\n\n/**\n * Validates that the coin type is a non-negative integer number. An error is\n * thrown if validation fails.\n *\n * @param coin_type - The coin type to validate.\n */\nfunction validateCoinType(coin_type: unknown): asserts coin_type is number {\n  if (\n    typeof coin_type !== 'number' ||\n    !Number.isInteger(coin_type) ||\n    coin_type < 0\n  ) {\n    throw new Error(\n      'Invalid coin type: The specified coin type must be a non-negative integer number.',\n    );\n  }\n}\n\n/**\n * Derives a BIP-44 address key corresponding to the specified derivation path,\n * given either by a {@link BIP44CoinTypeNode} or derivation path tuple.\n *\n * Recall that a BIP-44 HD tree path consists of the following nodes:\n *\n * `m / 44' / coin_type' / account' / change / address_index`\n *\n * With the following depths:\n *\n * `0 / 1 / 2 / 3 / 4 / 5`\n *\n * @param parentKeyOrNode - The `coin_type` parent key to derive from.\n * @param indices - The BIP-44 index values to use in key derivation.\n * @param indices.account - The `account` index. Default: `0`.\n * @param indices.change - The `change` index. Default: `0`.\n * @param indices.address_index - The `address_index` index.\n * @returns The derived `address_index` key for the specified derivation path.\n */\nexport async function deriveBIP44AddressKey(\n  parentKeyOrNode: BIP44CoinTypeNode | JsonBIP44CoinTypeNode | string,\n  { account = 0, change = 0, address_index }: CoinTypeToAddressIndices,\n): Promise<BIP44Node> {\n  const path = getBIP44CoinTypeToAddressPathTuple({\n    account,\n    change,\n    address_index,\n  });\n\n  const node = await getNode(parentKeyOrNode);\n  const childNode = await deriveChildNode({\n    path,\n    node,\n  });\n\n  return new BIP44Node(childNode);\n}\n\nexport type BIP44AddressKeyDeriver = {\n  /**\n   * @param address_index - The `address_index` value.\n   * @param isHardened - Whether the derived index is hardened.\n   * @returns The key corresponding to the path of this deriver and the\n   * specified `address_index` value.\n   */\n  (address_index: number, isHardened?: boolean): Promise<BIP44Node>;\n\n  /**\n   * A human-readable representation of the derivation path of this deriver\n   * function, excluding the `address_index`, which is parameterized.\n   *\n   * Recall that a BIP-44 HD tree path consists of the following nodes:\n   *\n   * `m / 44' / coin_type' / account' / change / address_index`\n   *\n   * With the following depths:\n   *\n   * `0 / 1 / 2 / 3 / 4 / 5`\n   */\n  path: ReturnType<typeof getBIP44ChangePathString>;\n\n  /**\n   * The `coin_type` index of addresses derived by this deriver function.\n   */\n  coin_type: number;\n};\n\n/**\n * Creates a function that derives BIP-44 address keys corresponding to the\n * specified derivation path, given either by a {@link BIP44CoinTypeNode} or\n * derivation path tuple.\n *\n * Recall that a BIP-44 HD tree path consists of the following nodes:\n *\n * `m / 44' / coin_type' / account' / change / address_index`\n *\n * With the following depths:\n *\n * `0 / 1 / 2 / 3 / 4 / 5`\n *\n * @param node - The {@link BIP44CoinTypeNode} to derive address keys from.\n * This node contains a BIP-44 key of depth 2, `coin_type`.\n * @param accountAndChangeIndices - The `account` and `change` indices that\n * will be used to derive addresses.\n * @returns The deriver function for the derivation path specified by the\n * `coin_type` node, `account`, and `change` indices.\n */\nexport async function getBIP44AddressKeyDeriver(\n  node: BIP44CoinTypeNode | JsonBIP44CoinTypeNode | string,\n  accountAndChangeIndices?: Omit<CoinTypeToAddressIndices, 'address_index'>,\n) {\n  const { account = 0, change = 0 } = accountAndChangeIndices ?? {};\n\n  const actualNode = await getNode(node);\n\n  const accountNode = getHardenedBIP32NodeToken(account);\n  const changeNode = getBIP32NodeToken(change);\n\n  const bip44AddressKeyDeriver: BIP44AddressKeyDeriver = async (\n    address_index: number,\n    isHardened = false,\n  ): Promise<BIP44Node> => {\n    const slip10Node = await deriveChildNode({\n      path: [\n        accountNode,\n        changeNode,\n        isHardened\n          ? getHardenedBIP32NodeToken(address_index)\n          : getUnhardenedBIP32NodeToken(address_index),\n      ],\n      node: actualNode,\n    });\n\n    return new BIP44Node(slip10Node);\n  };\n\n  bip44AddressKeyDeriver.coin_type = actualNode.coin_type;\n  bip44AddressKeyDeriver.path = getBIP44ChangePathString(actualNode.path, {\n    account,\n    change,\n  });\n\n  Object.freeze(bip44AddressKeyDeriver);\n\n  return bip44AddressKeyDeriver;\n}\n\n/**\n * Get a BIP-44 coin type node from a JSON node or extended key string. If an existing coin type\n * node is provided, the same node is returned.\n *\n * The depth of the node is validated to be a valid coin type node.\n *\n * @param node - A BIP-44 coin type node, JSON node or extended key.\n */\nasync function getNode(\n  node: BIP44CoinTypeNode | JsonBIP44CoinTypeNode | string,\n): Promise<BIP44CoinTypeNode> {\n  if (node instanceof BIP44CoinTypeNode) {\n    validateCoinTypeNodeDepth(node.depth);\n\n    return node;\n  }\n\n  if (typeof node === 'string') {\n    const bip44Node = await BIP44Node.fromExtendedKey(node);\n    const coinTypeNode = await BIP44CoinTypeNode.fromNode(\n      bip44Node,\n      bip44Node.index - BIP_32_HARDENED_OFFSET,\n    );\n\n    validateCoinTypeNodeDepth(coinTypeNode.depth);\n\n    return coinTypeNode;\n  }\n\n  return BIP44CoinTypeNode.fromJSON(node, node.coin_type);\n}\n"],"names":["BIP_44_COIN_TYPE_DEPTH","BIP44CoinTypeNode","deriveBIP44AddressKey","getBIP44AddressKeyDeriver","fromJSON","json","coin_type","validateCoinType","validateCoinTypeNodeDepth","depth","node","BIP44Node","fromExtendedKey","index","parentFingerprint","chainCode","hexStringToBytes","privateKey","nullableHexStringToBytes","publicKey","fromDerivationPath","derivationPath","length","pathPart","split","replace","assert","coinType","Number","parseInt","fromNode","Error","Promise","resolve","privateKeyBytes","publicKeyBytes","chainCodeBytes","compressedPublicKey","compressedPublicKeyBytes","address","masterFingerprint","fingerprint","curve","extendedKey","account","change","address_index","derive","getBIP44CoinTypeToAddressPathTuple","toJSON","path","getBIP44CoinTypePathString","Object","freeze","isInteger","parentKeyOrNode","getNode","childNode","deriveChildNode","accountAndChangeIndices","actualNode","accountNode","getHardenedBIP32NodeToken","changeNode","getBIP32NodeToken","bip44AddressKeyDeriver","isHardened","slip10Node","getUnhardenedBIP32NodeToken","getBIP44ChangePathString","bip44Node","coinTypeNode","BIP_32_HARDENED_OFFSET"],"mappings":"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"}