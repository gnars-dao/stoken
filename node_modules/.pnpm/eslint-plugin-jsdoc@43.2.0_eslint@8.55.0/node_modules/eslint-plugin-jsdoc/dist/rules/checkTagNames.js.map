{"version":3,"file":"checkTagNames.js","names":["_escapeStringRegexp","_interopRequireDefault","require","_iterateJsdoc","obj","__esModule","default","jsxTagNames","Set","typedTagsAlwaysUnnecessary","typedTagsNeedingName","typedTagsUnnecessaryOutsideDeclare","_default","iterateJsdoc","sourceCode","jsdoc","report","utils","context","node","settings","jsdocNode","definedTags","enableFixer","jsxTags","typed","options","definedPreferredTags","tagNamePreference","structuredTags","definedStructuredTags","Object","keys","definedNonPreferredTags","length","values","map","preferredTag","undefined","reportSettings","replacement","filter","preferredType","isInAmbientContext","subNode","type","getFilename","endsWith","Boolean","declare","parent","tagIsRedundantWhenTyped","jsdocTag","_node$parent","has","tag","includes","reportWithTagRemovalFixer","message","tagIndex","additionalTagChanges","reportJSDoc","description","trim","changeTag","postType","removeTag","removeEmptyBlock","checkTagForTypedValidity","postTag","name","tags","tagName","validTags","isValidTag","preferredTagName","getPreferredTagName","allowObjectReturn","defaultMessage","fixer","getText","replace","RegExp","escapeStringRegexp","replaceText","iterateAllJsdocs","meta","docs","url","fixable","schema","additionalProperties","properties","items","exports","module"],"sources":["../../src/rules/checkTagNames.js"],"sourcesContent":["import escapeStringRegexp from 'escape-string-regexp';\nimport iterateJsdoc from '../iterateJsdoc';\n\n// https://babeljs.io/docs/en/babel-plugin-transform-react-jsx/\nconst jsxTagNames = new Set([\n  'jsx',\n  'jsxFrag',\n  'jsxImportSource',\n  'jsxRuntime',\n]);\n\nconst typedTagsAlwaysUnnecessary = new Set([\n  'augments',\n  'callback',\n  'class',\n  'enum',\n  'implements',\n  'private',\n  'property',\n  'protected',\n  'public',\n  'readonly',\n  'this',\n  'type',\n  'typedef',\n]);\n\nconst typedTagsNeedingName = new Set([\n  'template',\n]);\n\nconst typedTagsUnnecessaryOutsideDeclare = new Set([\n  'abstract',\n  'access',\n  'class',\n  'constant',\n  'constructs',\n  'default',\n  'enum',\n  'export',\n  'exports',\n  'function',\n  'global',\n  'inherits',\n  'instance',\n  'interface',\n  'member',\n  'memberof',\n  'memberOf',\n  'method',\n  'mixes',\n  'mixin',\n  'module',\n  'name',\n  'namespace',\n  'override',\n  'property',\n  'requires',\n  'static',\n  'this',\n]);\n\nexport default iterateJsdoc(({\n  sourceCode,\n  jsdoc,\n  report,\n  utils,\n  context,\n  node,\n  settings,\n  jsdocNode,\n}) => {\n  const {\n    definedTags = [],\n    enableFixer = true,\n    jsxTags,\n    typed,\n  } = context.options[0] || {};\n\n  let definedPreferredTags = [];\n  const {\n    tagNamePreference,\n    structuredTags,\n  } = settings;\n  const definedStructuredTags = Object.keys(structuredTags);\n  const definedNonPreferredTags = Object.keys(tagNamePreference);\n  if (definedNonPreferredTags.length) {\n    definedPreferredTags = Object.values(tagNamePreference).map((preferredTag) => {\n      if (typeof preferredTag === 'string') {\n        // May become an empty string but will be filtered out below\n        return preferredTag;\n      }\n\n      if (!preferredTag) {\n        return undefined;\n      }\n\n      if (typeof preferredTag !== 'object') {\n        utils.reportSettings(\n          'Invalid `settings.jsdoc.tagNamePreference`. Values must be falsy, a string, or an object.',\n        );\n      }\n\n      return preferredTag.replacement;\n    })\n      .filter((preferredType) => {\n        return preferredType;\n      });\n  }\n\n  const isInAmbientContext = (subNode) => {\n    return subNode.type === 'Program' ?\n      context.getFilename().endsWith('.d.ts') :\n      Boolean(subNode.declare) || isInAmbientContext(subNode.parent);\n  };\n\n  const tagIsRedundantWhenTyped = (jsdocTag) => {\n    if (!typedTagsUnnecessaryOutsideDeclare.has(jsdocTag.tag)) {\n      return false;\n    }\n\n    if (jsdocTag.tag === 'default') {\n      return false;\n    }\n\n    if (context.getFilename().endsWith('.d.ts') && [\n      'Program', null, undefined,\n    ].includes(node?.parent?.type)) {\n      return false;\n    }\n\n    if (isInAmbientContext(node)) {\n      return false;\n    }\n\n    return true;\n  };\n\n  const reportWithTagRemovalFixer = (message, jsdocTag, tagIndex, additionalTagChanges) => {\n    utils.reportJSDoc(message, jsdocTag, enableFixer ? () => {\n      if (jsdocTag.description.trim()) {\n        utils.changeTag(jsdocTag, {\n          postType: '',\n          type: '',\n          ...additionalTagChanges,\n        });\n      } else {\n        utils.removeTag(tagIndex, {\n          removeEmptyBlock: true,\n        });\n      }\n    } : null, true);\n  };\n\n  const checkTagForTypedValidity = (jsdocTag, tagIndex) => {\n    if (typedTagsAlwaysUnnecessary.has(jsdocTag.tag)) {\n      reportWithTagRemovalFixer(`'@${jsdocTag.tag}' is redundant when using a type system.`, jsdocTag, tagIndex, {\n        postTag: '',\n        tag: '',\n      });\n      return true;\n    }\n\n    if (tagIsRedundantWhenTyped(jsdocTag)) {\n      reportWithTagRemovalFixer(`'@${jsdocTag.tag}' is redundant outside of ambient (\\`declare\\`/\\`.d.ts\\`) contexts when using a type system.`, jsdocTag, tagIndex);\n      return true;\n    }\n\n    if (typedTagsNeedingName.has(jsdocTag.tag) && !jsdocTag.name) {\n      reportWithTagRemovalFixer(`'@${jsdocTag.tag}' without a name is redundant when using a type system.`, jsdocTag, tagIndex);\n      return true;\n    }\n\n    return false;\n  };\n\n  for (let tagIndex = 0; tagIndex < jsdoc.tags.length; tagIndex += 1) {\n    const jsdocTag = jsdoc.tags[tagIndex];\n    const tagName = jsdocTag.tag;\n    if (jsxTags && jsxTagNames.has(tagName)) {\n      continue;\n    }\n\n    if (typed && checkTagForTypedValidity(jsdocTag, tagIndex)) {\n      continue;\n    }\n\n    const validTags = [\n      ...definedTags,\n      ...definedPreferredTags,\n      ...definedNonPreferredTags,\n      ...definedStructuredTags,\n      ...typed ? typedTagsNeedingName : [],\n    ];\n\n    if (utils.isValidTag(tagName, validTags)) {\n      let preferredTagName = utils.getPreferredTagName({\n        allowObjectReturn: true,\n        defaultMessage: `Blacklisted tag found (\\`@${tagName}\\`)`,\n        tagName,\n      });\n      if (!preferredTagName) {\n        continue;\n      }\n\n      let message;\n      if (typeof preferredTagName === 'object') {\n        ({\n          message,\n          replacement: preferredTagName,\n        } = preferredTagName);\n      }\n\n      if (!message) {\n        message = `Invalid JSDoc tag (preference). Replace \"${tagName}\" JSDoc tag with \"${preferredTagName}\".`;\n      }\n\n      if (preferredTagName !== tagName) {\n        report(message, (fixer) => {\n          const replacement = sourceCode.getText(jsdocNode).replace(\n            new RegExp(`@${escapeStringRegexp(tagName)}\\\\b`, 'u'),\n            `@${preferredTagName}`,\n          );\n\n          return fixer.replaceText(jsdocNode, replacement);\n        }, jsdocTag);\n      }\n    } else {\n      report(`Invalid JSDoc tag name \"${tagName}\".`, null, jsdocTag);\n    }\n  }\n}, {\n  iterateAllJsdocs: true,\n  meta: {\n    docs: {\n      description: 'Reports invalid block tag names.',\n      url: 'https://github.com/gajus/eslint-plugin-jsdoc#eslint-plugin-jsdoc-rules-check-tag-names',\n    },\n    fixable: 'code',\n    schema: [\n      {\n        additionalProperties: false,\n        properties: {\n          definedTags: {\n            items: {\n              type: 'string',\n            },\n            type: 'array',\n          },\n          enableFixer: {\n            type: 'boolean',\n          },\n          jsxTags: {\n            type: 'boolean',\n          },\n          typed: {\n            type: 'boolean',\n          },\n        },\n        type: 'object',\n      },\n    ],\n    type: 'suggestion',\n  },\n});\n"],"mappings":"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"}