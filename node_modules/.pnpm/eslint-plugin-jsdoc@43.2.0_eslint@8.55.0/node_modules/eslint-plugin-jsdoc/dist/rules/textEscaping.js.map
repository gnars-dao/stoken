{"version":3,"file":"textEscaping.js","names":["_iterateJsdoc","_interopRequireDefault","require","obj","__esModule","default","htmlRegex","markdownRegex","htmlReplacer","desc","replace","RegExp","_","markdownReplacer","backticks","encapsed","bookend","repeat","length","_default","iterateJsdoc","context","jsdoc","utils","escapeHTML","escapeMarkdown","options","report","loc","start","column","line","message","descriptions","getDescription","some","test","setDescriptionLines","reportJSDoc","tag","tags","getTagDescription","setTagDescription","source","number","iterateAllJsdocs","meta","docs","description","url","fixable","schema","additionalProperties","properties","type","exports","module"],"sources":["../../src/rules/textEscaping.js"],"sourcesContent":["import iterateJsdoc from '../iterateJsdoc';\n\n// We could disallow raw gt, quot, and apos, but allow for parity; but we do\n//  not allow hex or decimal character references\nconst htmlRegex = /(<|&(?!(?:amp|lt|gt|quot|apos);))(?=\\S)/u;\nconst markdownRegex = /(?<!\\\\)(`+)([^`]+)\\1(?!`)/u;\n\nconst htmlReplacer = (desc) => {\n  return desc.replace(new RegExp(htmlRegex, 'gu'), (_) => {\n    if (_ === '<') {\n      return '&lt;';\n    }\n\n    return '&amp;';\n  });\n};\n\nconst markdownReplacer = (desc) => {\n  return desc.replace(new RegExp(markdownRegex, 'gu'), (_, backticks, encapsed) => {\n    const bookend = '`'.repeat(backticks.length);\n    return `\\\\${bookend}${encapsed}${bookend}`;\n  });\n};\n\nexport default iterateJsdoc(({\n  context,\n  jsdoc,\n  utils,\n}) => {\n  const {\n    escapeHTML,\n    escapeMarkdown,\n  } = context.options[0] || {};\n\n  if (!escapeHTML && !escapeMarkdown) {\n    context.report({\n      loc: {\n        start: {\n          column: 1,\n          line: 1,\n        },\n      },\n      message: 'You must include either `escapeHTML` or `escapeMarkdown`',\n    });\n    return;\n  }\n\n  const {\n    descriptions,\n  } = utils.getDescription();\n\n  if (escapeHTML) {\n    if (descriptions.some((desc) => {\n      return htmlRegex.test(desc);\n    })) {\n      const line = utils.setDescriptionLines(htmlRegex, htmlReplacer);\n      utils.reportJSDoc('You have unescaped HTML characters < or &', {\n        line,\n      }, () => {}, true);\n      return;\n    }\n\n    for (const tag of jsdoc.tags) {\n      if (utils.getTagDescription(tag, true).some((desc) => {\n        return htmlRegex.test(desc);\n      })) {\n        const line = utils.setTagDescription(tag, htmlRegex, htmlReplacer) +\n          tag.source[0].number;\n        utils.reportJSDoc('You have unescaped HTML characters < or & in a tag', {\n          line,\n        }, () => {}, true);\n      }\n    }\n\n    return;\n  }\n\n  if (descriptions.some((desc) => {\n    return markdownRegex.test(desc);\n  })) {\n    const line = utils.setDescriptionLines(markdownRegex, markdownReplacer);\n    utils.reportJSDoc('You have unescaped Markdown backtick sequences', {\n      line,\n    }, () => {}, true);\n    return;\n  }\n\n  for (const tag of jsdoc.tags) {\n    if (utils.getTagDescription(tag, true).some((desc) => {\n      return markdownRegex.test(desc);\n    })) {\n      const line = utils.setTagDescription(\n        tag, markdownRegex, markdownReplacer,\n      ) + tag.source[0].number;\n      utils.reportJSDoc(\n        'You have unescaped Markdown backtick sequences in a tag',\n        {\n          line,\n        },\n        () => {},\n        true,\n      );\n    }\n  }\n}, {\n  iterateAllJsdocs: true,\n  meta: {\n    docs: {\n      description: '',\n      url: 'https://github.com/gajus/eslint-plugin-jsdoc#eslint-plugin-jsdoc-rules-text-escaping',\n    },\n    fixable: 'code',\n    schema: [\n      {\n        additionalProperties: false,\n        properties: {\n          // Option properties here (or remove the object)\n          escapeHTML: {\n            type: 'boolean',\n          },\n          escapeMarkdown: {\n            type: 'boolean',\n          },\n        },\n        type: 'object',\n      },\n    ],\n    type: 'suggestion',\n  },\n});\n"],"mappings":";;;;;;AAAA,IAAAA,aAAA,GAAAC,sBAAA,CAAAC,OAAA;AAA2C,SAAAD,uBAAAE,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAE3C;AACA;AACA,MAAMG,SAAS,GAAG,0CAA0C;AAC5D,MAAMC,aAAa,GAAG,4BAA4B;AAElD,MAAMC,YAAY,GAAIC,IAAI,IAAK;EAC7B,OAAOA,IAAI,CAACC,OAAO,CAAC,IAAIC,MAAM,CAACL,SAAS,EAAE,IAAI,CAAC,EAAGM,CAAC,IAAK;IACtD,IAAIA,CAAC,KAAK,GAAG,EAAE;MACb,OAAO,MAAM;IACf;IAEA,OAAO,OAAO;EAChB,CAAC,CAAC;AACJ,CAAC;AAED,MAAMC,gBAAgB,GAAIJ,IAAI,IAAK;EACjC,OAAOA,IAAI,CAACC,OAAO,CAAC,IAAIC,MAAM,CAACJ,aAAa,EAAE,IAAI,CAAC,EAAE,CAACK,CAAC,EAAEE,SAAS,EAAEC,QAAQ,KAAK;IAC/E,MAAMC,OAAO,GAAG,GAAG,CAACC,MAAM,CAACH,SAAS,CAACI,MAAM,CAAC;IAC5C,OAAQ,KAAIF,OAAQ,GAAED,QAAS,GAAEC,OAAQ,EAAC;EAC5C,CAAC,CAAC;AACJ,CAAC;AAAC,IAAAG,QAAA,GAEa,IAAAC,qBAAY,EAAC,CAAC;EAC3BC,OAAO;EACPC,KAAK;EACLC;AACF,CAAC,KAAK;EACJ,MAAM;IACJC,UAAU;IACVC;EACF,CAAC,GAAGJ,OAAO,CAACK,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC;EAE5B,IAAI,CAACF,UAAU,IAAI,CAACC,cAAc,EAAE;IAClCJ,OAAO,CAACM,MAAM,CAAC;MACbC,GAAG,EAAE;QACHC,KAAK,EAAE;UACLC,MAAM,EAAE,CAAC;UACTC,IAAI,EAAE;QACR;MACF,CAAC;MACDC,OAAO,EAAE;IACX,CAAC,CAAC;IACF;EACF;EAEA,MAAM;IACJC;EACF,CAAC,GAAGV,KAAK,CAACW,cAAc,CAAC,CAAC;EAE1B,IAAIV,UAAU,EAAE;IACd,IAAIS,YAAY,CAACE,IAAI,CAAE1B,IAAI,IAAK;MAC9B,OAAOH,SAAS,CAAC8B,IAAI,CAAC3B,IAAI,CAAC;IAC7B,CAAC,CAAC,EAAE;MACF,MAAMsB,IAAI,GAAGR,KAAK,CAACc,mBAAmB,CAAC/B,SAAS,EAAEE,YAAY,CAAC;MAC/De,KAAK,CAACe,WAAW,CAAC,2CAA2C,EAAE;QAC7DP;MACF,CAAC,EAAE,MAAM,CAAC,CAAC,EAAE,IAAI,CAAC;MAClB;IACF;IAEA,KAAK,MAAMQ,GAAG,IAAIjB,KAAK,CAACkB,IAAI,EAAE;MAC5B,IAAIjB,KAAK,CAACkB,iBAAiB,CAACF,GAAG,EAAE,IAAI,CAAC,CAACJ,IAAI,CAAE1B,IAAI,IAAK;QACpD,OAAOH,SAAS,CAAC8B,IAAI,CAAC3B,IAAI,CAAC;MAC7B,CAAC,CAAC,EAAE;QACF,MAAMsB,IAAI,GAAGR,KAAK,CAACmB,iBAAiB,CAACH,GAAG,EAAEjC,SAAS,EAAEE,YAAY,CAAC,GAChE+B,GAAG,CAACI,MAAM,CAAC,CAAC,CAAC,CAACC,MAAM;QACtBrB,KAAK,CAACe,WAAW,CAAC,oDAAoD,EAAE;UACtEP;QACF,CAAC,EAAE,MAAM,CAAC,CAAC,EAAE,IAAI,CAAC;MACpB;IACF;IAEA;EACF;EAEA,IAAIE,YAAY,CAACE,IAAI,CAAE1B,IAAI,IAAK;IAC9B,OAAOF,aAAa,CAAC6B,IAAI,CAAC3B,IAAI,CAAC;EACjC,CAAC,CAAC,EAAE;IACF,MAAMsB,IAAI,GAAGR,KAAK,CAACc,mBAAmB,CAAC9B,aAAa,EAAEM,gBAAgB,CAAC;IACvEU,KAAK,CAACe,WAAW,CAAC,gDAAgD,EAAE;MAClEP;IACF,CAAC,EAAE,MAAM,CAAC,CAAC,EAAE,IAAI,CAAC;IAClB;EACF;EAEA,KAAK,MAAMQ,GAAG,IAAIjB,KAAK,CAACkB,IAAI,EAAE;IAC5B,IAAIjB,KAAK,CAACkB,iBAAiB,CAACF,GAAG,EAAE,IAAI,CAAC,CAACJ,IAAI,CAAE1B,IAAI,IAAK;MACpD,OAAOF,aAAa,CAAC6B,IAAI,CAAC3B,IAAI,CAAC;IACjC,CAAC,CAAC,EAAE;MACF,MAAMsB,IAAI,GAAGR,KAAK,CAACmB,iBAAiB,CAClCH,GAAG,EAAEhC,aAAa,EAAEM,gBACtB,CAAC,GAAG0B,GAAG,CAACI,MAAM,CAAC,CAAC,CAAC,CAACC,MAAM;MACxBrB,KAAK,CAACe,WAAW,CACf,yDAAyD,EACzD;QACEP;MACF,CAAC,EACD,MAAM,CAAC,CAAC,EACR,IACF,CAAC;IACH;EACF;AACF,CAAC,EAAE;EACDc,gBAAgB,EAAE,IAAI;EACtBC,IAAI,EAAE;IACJC,IAAI,EAAE;MACJC,WAAW,EAAE,EAAE;MACfC,GAAG,EAAE;IACP,CAAC;IACDC,OAAO,EAAE,MAAM;IACfC,MAAM,EAAE,CACN;MACEC,oBAAoB,EAAE,KAAK;MAC3BC,UAAU,EAAE;QACV;QACA7B,UAAU,EAAE;UACV8B,IAAI,EAAE;QACR,CAAC;QACD7B,cAAc,EAAE;UACd6B,IAAI,EAAE;QACR;MACF,CAAC;MACDA,IAAI,EAAE;IACR,CAAC,CACF;IACDA,IAAI,EAAE;EACR;AACF,CAAC,CAAC;AAAAC,OAAA,CAAAlD,OAAA,GAAAc,QAAA;AAAAqC,MAAA,CAAAD,OAAA,GAAAA,OAAA,CAAAlD,OAAA"}