"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const d=require("./index-66e95feb.cjs"),P=require("./index-12aaf076.cjs");require("./index-9c3ad0eb.cjs");require("@cosmjs/encoding");require("@cosmjs/math");require("@cosmjs/proto-signing");require("@cosmjs/stargate");require("long");require("@ethersproject/bignumber");require("@ethersproject/abstract-signer");require("bn.js");require("bchaddrjs");require("bitcoinjs-lib");require("@scure/base");require("crypto");require("buffer");require("events");require("util");require("crypto-js");require("elliptic");require("coininfo");require("base64-js");var q=globalThis&&globalThis.__awaiter||function(h,e,t,c){function l(r){return r instanceof t?r:new t(function(n){n(r)})}return new(t||(t=Promise))(function(r,n){function s(u){try{o(c.next(u))}catch(f){n(f)}}function i(u){try{o(c.throw(u))}catch(f){n(f)}}function o(u){u.done?r(u.value):l(u.value).then(s,i)}o((c=c.apply(h,e||[])).next())})};const g=250,a=85,A="CSM",S=0,E=2,w=4,I=0,x=1,b=2,_=36864,C=27014;class m{constructor(e,t=A){this.transport=e,e.decorateAppAPIMethods(this,["getAddress","sign","getAppConfiguration"],t)}getAppConfiguration(){return this.transport.send(a,S,0,0).then(e=>({test_mode:e[0]!==0,version:""+e[1]+"."+e[2]+"."+e[3],device_locked:e[4]===1,major:e[1]}))}serializePath(e){const t=Buffer.alloc(20);return t.writeUInt32LE((2147483648|e[0])>>>0,0),t.writeUInt32LE((2147483648|e[1])>>>0,4),t.writeUInt32LE((2147483648|e[2])>>>0,8),t.writeUInt32LE(e[3],12),t.writeUInt32LE(e[4],16),t}serializeHRP(e){if(e==null||e.length===0||e.length>83)throw new Error("Invalid HRP");const t=Buffer.alloc(1+e.length);return t.writeUInt8(e.length,0),t.write(e,1),t}getAddress(e,t,c){const l=d.bippath.fromString(e).toPathArray(),r=this.serializePath(l),n=Buffer.concat([this.serializeHRP(t),r]);return this.transport.send(a,w,c?1:0,0,n,[_]).then(s=>{const i=Buffer.from(s.slice(33,-2)).toString(),o=Buffer.from(s.slice(0,33)).toString("hex");return{address:i,publicKey:o}})}foreach(e,t){function c(l,r,n){return l>=r.length?n:t(r[l],l).then(function(s){return n.push(s),c(l+1,r,n)})}return Promise.resolve().then(()=>c(0,e,[]))}sign(e,t){return q(this,void 0,void 0,function*(){const c=d.bippath.fromString(e).toPathArray(),l=this.serializePath(c),r=[];r.push(l);const n=Buffer.from(t);for(let i=0;i<n.length;i+=g){let o=i+g;i>n.length&&(o=n.length),r.push(n.slice(i,o))}let s={};return this.foreach(r,(i,o)=>this.transport.send(a,E,o===0?I:o+1===r.length?b:x,0,i,[_,C]).then(u=>s=u)).then(()=>{const i=s.slice(-2),o=i[0]*256+i[1];let u=null;if(s.length>2&&(u=s.slice(0,s.length-2)),o===27014)throw new P.UserRefusedOnDevice;return{signature:u,return_code:o}})})}}exports.default=m;
