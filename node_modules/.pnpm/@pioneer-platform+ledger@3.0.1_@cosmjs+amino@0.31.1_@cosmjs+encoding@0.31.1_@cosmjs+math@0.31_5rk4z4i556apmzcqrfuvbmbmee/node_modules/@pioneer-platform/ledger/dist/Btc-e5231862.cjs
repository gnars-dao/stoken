"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const $r=require("./index-66e95feb.cjs"),G=require("./index-9c3ad0eb.cjs"),Vi=require("string_decoder"),Te=require("bitcoinjs-lib"),Ki=require("./index-282fe8a0.cjs"),qi=require("bn.js"),Xi=require("elliptic"),Jn=require("./index-47fbb07d.cjs"),ei=require("./browser-83c4e3ad.cjs");require("@cosmjs/encoding");require("@cosmjs/math");require("@cosmjs/proto-signing");require("@cosmjs/stargate");require("long");require("@ethersproject/bignumber");require("@ethersproject/abstract-signer");require("bchaddrjs");require("@scure/base");require("crypto");require("buffer");require("events");require("util");require("crypto-js");require("coininfo");require("base64-js");var Hi=G.inherits_browserExports,ti=G.hashBase,ji=G.safeBufferExports.Buffer,Wi=new Array(16);function $t(){ti.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878}Hi($t,ti);$t.prototype._update=function(){for(var t=Wi,r=0;r<16;++r)t[r]=this._block.readInt32LE(r*4);var e=this._a,i=this._b,s=this._c,n=this._d;e=Z(e,i,s,n,t[0],3614090360,7),n=Z(n,e,i,s,t[1],3905402710,12),s=Z(s,n,e,i,t[2],606105819,17),i=Z(i,s,n,e,t[3],3250441966,22),e=Z(e,i,s,n,t[4],4118548399,7),n=Z(n,e,i,s,t[5],1200080426,12),s=Z(s,n,e,i,t[6],2821735955,17),i=Z(i,s,n,e,t[7],4249261313,22),e=Z(e,i,s,n,t[8],1770035416,7),n=Z(n,e,i,s,t[9],2336552879,12),s=Z(s,n,e,i,t[10],4294925233,17),i=Z(i,s,n,e,t[11],2304563134,22),e=Z(e,i,s,n,t[12],1804603682,7),n=Z(n,e,i,s,t[13],4254626195,12),s=Z(s,n,e,i,t[14],2792965006,17),i=Z(i,s,n,e,t[15],1236535329,22),e=Q(e,i,s,n,t[1],4129170786,5),n=Q(n,e,i,s,t[6],3225465664,9),s=Q(s,n,e,i,t[11],643717713,14),i=Q(i,s,n,e,t[0],3921069994,20),e=Q(e,i,s,n,t[5],3593408605,5),n=Q(n,e,i,s,t[10],38016083,9),s=Q(s,n,e,i,t[15],3634488961,14),i=Q(i,s,n,e,t[4],3889429448,20),e=Q(e,i,s,n,t[9],568446438,5),n=Q(n,e,i,s,t[14],3275163606,9),s=Q(s,n,e,i,t[3],4107603335,14),i=Q(i,s,n,e,t[8],1163531501,20),e=Q(e,i,s,n,t[13],2850285829,5),n=Q(n,e,i,s,t[2],4243563512,9),s=Q(s,n,e,i,t[7],1735328473,14),i=Q(i,s,n,e,t[12],2368359562,20),e=J(e,i,s,n,t[5],4294588738,4),n=J(n,e,i,s,t[8],2272392833,11),s=J(s,n,e,i,t[11],1839030562,16),i=J(i,s,n,e,t[14],4259657740,23),e=J(e,i,s,n,t[1],2763975236,4),n=J(n,e,i,s,t[4],1272893353,11),s=J(s,n,e,i,t[7],4139469664,16),i=J(i,s,n,e,t[10],3200236656,23),e=J(e,i,s,n,t[13],681279174,4),n=J(n,e,i,s,t[0],3936430074,11),s=J(s,n,e,i,t[3],3572445317,16),i=J(i,s,n,e,t[6],76029189,23),e=J(e,i,s,n,t[9],3654602809,4),n=J(n,e,i,s,t[12],3873151461,11),s=J(s,n,e,i,t[15],530742520,16),i=J(i,s,n,e,t[2],3299628645,23),e=ee(e,i,s,n,t[0],4096336452,6),n=ee(n,e,i,s,t[7],1126891415,10),s=ee(s,n,e,i,t[14],2878612391,15),i=ee(i,s,n,e,t[5],4237533241,21),e=ee(e,i,s,n,t[12],1700485571,6),n=ee(n,e,i,s,t[3],2399980690,10),s=ee(s,n,e,i,t[10],4293915773,15),i=ee(i,s,n,e,t[1],2240044497,21),e=ee(e,i,s,n,t[8],1873313359,6),n=ee(n,e,i,s,t[15],4264355552,10),s=ee(s,n,e,i,t[6],2734768916,15),i=ee(i,s,n,e,t[13],1309151649,21),e=ee(e,i,s,n,t[4],4149444226,6),n=ee(n,e,i,s,t[11],3174756917,10),s=ee(s,n,e,i,t[2],718787259,15),i=ee(i,s,n,e,t[9],3951481745,21),this._a=this._a+e|0,this._b=this._b+i|0,this._c=this._c+s|0,this._d=this._d+n|0};$t.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var t=ji.allocUnsafe(16);return t.writeInt32LE(this._a,0),t.writeInt32LE(this._b,4),t.writeInt32LE(this._c,8),t.writeInt32LE(this._d,12),t};function Rt(t,r){return t<<r|t>>>32-r}function Z(t,r,e,i,s,n,o){return Rt(t+(r&e|~r&i)+s+n|0,o)+r|0}function Q(t,r,e,i,s,n,o){return Rt(t+(r&i|e&~i)+s+n|0,o)+r|0}function J(t,r,e,i,s,n,o){return Rt(t+(r^e^i)+s+n|0,o)+r|0}function ee(t,r,e,i,s,n,o){return Rt(t+(e^(r|~i))+s+n|0,o)+r|0}var ri=$t,ni={exports:{}},ii=G.safeBufferExports.Buffer;function At(t,r){this._block=ii.alloc(t),this._finalSize=r,this._blockSize=t,this._len=0}At.prototype.update=function(t,r){typeof t=="string"&&(r=r||"utf8",t=ii.from(t,r));for(var e=this._block,i=this._blockSize,s=t.length,n=this._len,o=0;o<s;){for(var u=n%i,c=Math.min(s-o,i-u),a=0;a<c;a++)e[u+a]=t[o+a];n+=c,o+=c,n%i===0&&this._update(e)}return this._len+=s,this};At.prototype.digest=function(t){var r=this._len%this._blockSize;this._block[r]=128,this._block.fill(0,r+1),r>=this._finalSize&&(this._update(this._block),this._block.fill(0));var e=this._len*8;if(e<=4294967295)this._block.writeUInt32BE(e,this._blockSize-4);else{var i=(e&4294967295)>>>0,s=(e-i)/4294967296;this._block.writeUInt32BE(s,this._blockSize-8),this._block.writeUInt32BE(i,this._blockSize-4)}this._update(this._block);var n=this._hash();return t?n.toString(t):n};At.prototype._update=function(){throw new Error("_update must be implemented by subclass")};var Xe=At,zi=G.inherits_browserExports,si=Xe,Yi=G.safeBufferExports.Buffer,Zi=[1518500249,1859775393,-1894007588,-899497514],Qi=new Array(80);function it(){this.init(),this._w=Qi,si.call(this,64,56)}zi(it,si);it.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this};function Ji(t){return t<<5|t>>>27}function es(t){return t<<30|t>>>2}function ts(t,r,e,i){return t===0?r&e|~r&i:t===2?r&e|r&i|e&i:r^e^i}it.prototype._update=function(t){for(var r=this._w,e=this._a|0,i=this._b|0,s=this._c|0,n=this._d|0,o=this._e|0,u=0;u<16;++u)r[u]=t.readInt32BE(u*4);for(;u<80;++u)r[u]=r[u-3]^r[u-8]^r[u-14]^r[u-16];for(var c=0;c<80;++c){var a=~~(c/20),f=Ji(e)+ts(a,i,s,n)+o+r[c]+Zi[a]|0;o=n,n=s,s=es(i),i=e,e=f}this._a=e+this._a|0,this._b=i+this._b|0,this._c=s+this._c|0,this._d=n+this._d|0,this._e=o+this._e|0};it.prototype._hash=function(){var t=Yi.allocUnsafe(20);return t.writeInt32BE(this._a|0,0),t.writeInt32BE(this._b|0,4),t.writeInt32BE(this._c|0,8),t.writeInt32BE(this._d|0,12),t.writeInt32BE(this._e|0,16),t};var rs=it,ns=G.inherits_browserExports,ai=Xe,is=G.safeBufferExports.Buffer,ss=[1518500249,1859775393,-1894007588,-899497514],as=new Array(80);function st(){this.init(),this._w=as,ai.call(this,64,56)}ns(st,ai);st.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this};function os(t){return t<<1|t>>>31}function us(t){return t<<5|t>>>27}function fs(t){return t<<30|t>>>2}function cs(t,r,e,i){return t===0?r&e|~r&i:t===2?r&e|r&i|e&i:r^e^i}st.prototype._update=function(t){for(var r=this._w,e=this._a|0,i=this._b|0,s=this._c|0,n=this._d|0,o=this._e|0,u=0;u<16;++u)r[u]=t.readInt32BE(u*4);for(;u<80;++u)r[u]=os(r[u-3]^r[u-8]^r[u-14]^r[u-16]);for(var c=0;c<80;++c){var a=~~(c/20),f=us(e)+cs(a,i,s,n)+o+r[c]+ss[a]|0;o=n,n=s,s=fs(i),i=e,e=f}this._a=e+this._a|0,this._b=i+this._b|0,this._c=s+this._c|0,this._d=n+this._d|0,this._e=o+this._e|0};st.prototype._hash=function(){var t=is.allocUnsafe(20);return t.writeInt32BE(this._a|0,0),t.writeInt32BE(this._b|0,4),t.writeInt32BE(this._c|0,8),t.writeInt32BE(this._d|0,12),t.writeInt32BE(this._e|0,16),t};var ls=st,hs=G.inherits_browserExports,oi=Xe,ps=G.safeBufferExports.Buffer,ds=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],vs=new Array(64);function at(){this.init(),this._w=vs,oi.call(this,64,56)}hs(at,oi);at.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this};function gs(t,r,e){return e^t&(r^e)}function xs(t,r,e){return t&r|e&(t|r)}function Es(t){return(t>>>2|t<<30)^(t>>>13|t<<19)^(t>>>22|t<<10)}function ws(t){return(t>>>6|t<<26)^(t>>>11|t<<21)^(t>>>25|t<<7)}function ys(t){return(t>>>7|t<<25)^(t>>>18|t<<14)^t>>>3}function _s(t){return(t>>>17|t<<15)^(t>>>19|t<<13)^t>>>10}at.prototype._update=function(t){for(var r=this._w,e=this._a|0,i=this._b|0,s=this._c|0,n=this._d|0,o=this._e|0,u=this._f|0,c=this._g|0,a=this._h|0,f=0;f<16;++f)r[f]=t.readInt32BE(f*4);for(;f<64;++f)r[f]=_s(r[f-2])+r[f-7]+ys(r[f-15])+r[f-16]|0;for(var l=0;l<64;++l){var v=a+ws(o)+gs(o,u,c)+ds[l]+r[l]|0,h=Es(e)+xs(e,i,s)|0;a=c,c=u,u=o,o=n+v|0,n=s,s=i,i=e,e=v+h|0}this._a=e+this._a|0,this._b=i+this._b|0,this._c=s+this._c|0,this._d=n+this._d|0,this._e=o+this._e|0,this._f=u+this._f|0,this._g=c+this._g|0,this._h=a+this._h|0};at.prototype._hash=function(){var t=ps.allocUnsafe(32);return t.writeInt32BE(this._a,0),t.writeInt32BE(this._b,4),t.writeInt32BE(this._c,8),t.writeInt32BE(this._d,12),t.writeInt32BE(this._e,16),t.writeInt32BE(this._f,20),t.writeInt32BE(this._g,24),t.writeInt32BE(this._h,28),t};var ui=at,bs=G.inherits_browserExports,ms=ui,Is=Xe,Ts=G.safeBufferExports.Buffer,Ss=new Array(64);function Ot(){this.init(),this._w=Ss,Is.call(this,64,56)}bs(Ot,ms);Ot.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this};Ot.prototype._hash=function(){var t=Ts.allocUnsafe(28);return t.writeInt32BE(this._a,0),t.writeInt32BE(this._b,4),t.writeInt32BE(this._c,8),t.writeInt32BE(this._d,12),t.writeInt32BE(this._e,16),t.writeInt32BE(this._f,20),t.writeInt32BE(this._g,24),t};var Bs=Ot,$s=G.inherits_browserExports,fi=Xe,Rs=G.safeBufferExports.Buffer,tn=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],As=new Array(160);function ot(){this.init(),this._w=As,fi.call(this,128,112)}$s(ot,fi);ot.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this};function rn(t,r,e){return e^t&(r^e)}function nn(t,r,e){return t&r|e&(t|r)}function sn(t,r){return(t>>>28|r<<4)^(r>>>2|t<<30)^(r>>>7|t<<25)}function an(t,r){return(t>>>14|r<<18)^(t>>>18|r<<14)^(r>>>9|t<<23)}function Os(t,r){return(t>>>1|r<<31)^(t>>>8|r<<24)^t>>>7}function Ns(t,r){return(t>>>1|r<<31)^(t>>>8|r<<24)^(t>>>7|r<<25)}function Ps(t,r){return(t>>>19|r<<13)^(r>>>29|t<<3)^t>>>6}function Ls(t,r){return(t>>>19|r<<13)^(r>>>29|t<<3)^(t>>>6|r<<26)}function W(t,r){return t>>>0<r>>>0?1:0}ot.prototype._update=function(t){for(var r=this._w,e=this._ah|0,i=this._bh|0,s=this._ch|0,n=this._dh|0,o=this._eh|0,u=this._fh|0,c=this._gh|0,a=this._hh|0,f=this._al|0,l=this._bl|0,v=this._cl|0,h=this._dl|0,x=this._el|0,m=this._fl|0,E=this._gl|0,B=this._hl|0,p=0;p<32;p+=2)r[p]=t.readInt32BE(p*4),r[p+1]=t.readInt32BE(p*4+4);for(;p<160;p+=2){var $=r[p-30],R=r[p-15*2+1],P=Os($,R),I=Ns(R,$);$=r[p-2*2],R=r[p-2*2+1];var U=Ps($,R),L=Ls(R,$),H=r[p-7*2],A=r[p-7*2+1],k=r[p-16*2],N=r[p-16*2+1],d=I+A|0,g=P+H+W(d,I)|0;d=d+L|0,g=g+U+W(d,L)|0,d=d+N|0,g=g+k+W(d,N)|0,r[p]=g,r[p+1]=d}for(var _=0;_<160;_+=2){g=r[_],d=r[_+1];var T=nn(e,i,s),w=nn(f,l,v),y=sn(e,f),O=sn(f,e),S=an(o,x),b=an(x,o),D=tn[_],q=tn[_+1],F=rn(o,u,c),j=rn(x,m,E),X=B+b|0,te=a+S+W(X,B)|0;X=X+j|0,te=te+F+W(X,j)|0,X=X+q|0,te=te+D+W(X,q)|0,X=X+d|0,te=te+g+W(X,d)|0;var pe=O+w|0,ve=y+T+W(pe,O)|0;a=c,B=E,c=u,E=m,u=o,m=x,x=h+X|0,o=n+te+W(x,h)|0,n=s,h=v,s=i,v=l,i=e,l=f,f=X+pe|0,e=te+ve+W(f,X)|0}this._al=this._al+f|0,this._bl=this._bl+l|0,this._cl=this._cl+v|0,this._dl=this._dl+h|0,this._el=this._el+x|0,this._fl=this._fl+m|0,this._gl=this._gl+E|0,this._hl=this._hl+B|0,this._ah=this._ah+e+W(this._al,f)|0,this._bh=this._bh+i+W(this._bl,l)|0,this._ch=this._ch+s+W(this._cl,v)|0,this._dh=this._dh+n+W(this._dl,h)|0,this._eh=this._eh+o+W(this._el,x)|0,this._fh=this._fh+u+W(this._fl,m)|0,this._gh=this._gh+c+W(this._gl,E)|0,this._hh=this._hh+a+W(this._hl,B)|0};ot.prototype._hash=function(){var t=Rs.allocUnsafe(64);function r(e,i,s){t.writeInt32BE(e,s),t.writeInt32BE(i,s+4)}return r(this._ah,this._al,0),r(this._bh,this._bl,8),r(this._ch,this._cl,16),r(this._dh,this._dl,24),r(this._eh,this._el,32),r(this._fh,this._fl,40),r(this._gh,this._gl,48),r(this._hh,this._hl,56),t};var ci=ot,Cs=G.inherits_browserExports,Ds=ci,Us=Xe,ks=G.safeBufferExports.Buffer,Ms=new Array(160);function Nt(){this.init(),this._w=Ms,Us.call(this,128,112)}Cs(Nt,Ds);Nt.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this};Nt.prototype._hash=function(){var t=ks.allocUnsafe(48);function r(e,i,s){t.writeInt32BE(e,s),t.writeInt32BE(i,s+4)}return r(this._ah,this._al,0),r(this._bh,this._bl,8),r(this._ch,this._cl,16),r(this._dh,this._dl,24),r(this._eh,this._el,32),r(this._fh,this._fl,40),t};var Gs=Nt,Re=ni.exports=function(r){r=r.toLowerCase();var e=Re[r];if(!e)throw new Error(r+" is not supported (we accept pull requests)");return new e};Re.sha=rs;Re.sha1=ls;Re.sha224=Bs;Re.sha256=ui;Re.sha384=Gs;Re.sha512=ci;var Rr=ni.exports;const yt=G.getDefaultExportFromCjs(Rr);var li=G.safeBufferExports.Buffer,hi=G.readableBrowserExports.Transform,Fs=Vi.StringDecoder,Vs=G.inherits_browserExports;function ce(t){hi.call(this),this.hashMode=typeof t=="string",this.hashMode?this[t]=this._finalOrDigest:this.final=this._finalOrDigest,this._final&&(this.__final=this._final,this._final=null),this._decoder=null,this._encoding=null}Vs(ce,hi);ce.prototype.update=function(t,r,e){typeof t=="string"&&(t=li.from(t,r));var i=this._update(t);return this.hashMode?this:(e&&(i=this._toString(i,e)),i)};ce.prototype.setAutoPadding=function(){};ce.prototype.getAuthTag=function(){throw new Error("trying to get auth tag in unsupported state")};ce.prototype.setAuthTag=function(){throw new Error("trying to set auth tag in unsupported state")};ce.prototype.setAAD=function(){throw new Error("trying to set aad in unsupported state")};ce.prototype._transform=function(t,r,e){var i;try{this.hashMode?this._update(t):this.push(this._update(t))}catch(s){i=s}finally{e(i)}};ce.prototype._flush=function(t){var r;try{this.push(this.__final())}catch(e){r=e}t(r)};ce.prototype._finalOrDigest=function(t){var r=this.__final()||li.alloc(0);return t&&(r=this._toString(r,t,!0)),r};ce.prototype._toString=function(t,r,e){if(this._decoder||(this._decoder=new Fs(r),this._encoding=r),this._encoding!==r)throw new Error("can't switch encodings");var i=this._decoder.write(t);return e&&(i+=this._decoder.end()),i};var Ar=ce,Ks=G.inherits_browserExports,qs=ri,Xs=G.ripemd160,Hs=Rr,pi=Ar;function Pt(t){pi.call(this,"digest"),this._hash=t}Ks(Pt,pi);Pt.prototype._update=function(t){this._hash.update(t)};Pt.prototype._final=function(){return this._hash.digest()};var js=function(r){return r=r.toLowerCase(),r==="md5"?new qs:r==="rmd160"||r==="ripemd160"?new Xs:new Pt(Hs(r))},vt=G.safeBufferExports.Buffer;function Ws(t){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),e=0;e<r.length;e++)r[e]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),n=s.charCodeAt(0);if(r[n]!==255)throw new TypeError(s+" is ambiguous");r[n]=i}var o=t.length,u=t.charAt(0),c=Math.log(o)/Math.log(256),a=Math.log(256)/Math.log(o);function f(h){if((Array.isArray(h)||h instanceof Uint8Array)&&(h=vt.from(h)),!vt.isBuffer(h))throw new TypeError("Expected Buffer");if(h.length===0)return"";for(var x=0,m=0,E=0,B=h.length;E!==B&&h[E]===0;)E++,x++;for(var p=(B-E)*a+1>>>0,$=new Uint8Array(p);E!==B;){for(var R=h[E],P=0,I=p-1;(R!==0||P<m)&&I!==-1;I--,P++)R+=256*$[I]>>>0,$[I]=R%o>>>0,R=R/o>>>0;if(R!==0)throw new Error("Non-zero carry");m=P,E++}for(var U=p-m;U!==p&&$[U]===0;)U++;for(var L=u.repeat(x);U<p;++U)L+=t.charAt($[U]);return L}function l(h){if(typeof h!="string")throw new TypeError("Expected String");if(h.length===0)return vt.alloc(0);for(var x=0,m=0,E=0;h[x]===u;)m++,x++;for(var B=(h.length-x)*c+1>>>0,p=new Uint8Array(B);h[x];){var $=r[h.charCodeAt(x)];if($===255)return;for(var R=0,P=B-1;($!==0||R<E)&&P!==-1;P--,R++)$+=o*p[P]>>>0,p[P]=$%256>>>0,$=$/256>>>0;if($!==0)throw new Error("Non-zero carry");E=R,x++}for(var I=B-E;I!==B&&p[I]===0;)I++;var U=vt.allocUnsafe(m+(B-I));U.fill(0,0,m);for(var L=m;I!==B;)U[L++]=p[I++];return U}function v(h){var x=l(h);if(x)return x;throw new Error("Non-base"+o+" character")}return{encode:f,decodeUnsafe:l,decode:v}}var zs=Ws,Ys=zs,Zs="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",di=Ys(Zs);const Qs=G.getDefaultExportFromCjs(di);var Qt=di,Js=G.safeBufferExports.Buffer,ea=function(t){function r(n){var o=t(n);return Qt.encode(Js.concat([n,o],n.length+4))}function e(n){var o=n.slice(0,-4),u=n.slice(-4),c=t(o);if(!(u[0]^c[0]|u[1]^c[1]|u[2]^c[2]|u[3]^c[3]))return o}function i(n){var o=Qt.decodeUnsafe(n);if(o)return e(o)}function s(n){var o=Qt.decode(n),u=e(o);if(!u)throw new Error("Invalid checksum");return u}return{encode:r,decode:s,decodeUnsafe:i}},on=js,ta=ea;function ra(t){var r=on("sha256").update(t).digest();return on("sha256").update(r).digest()}var na=ta(ra);const vi=G.getDefaultExportFromCjs(na);function gi(t){var r=Buffer.alloc(1+t.length*4);return r[0]=t.length,t.forEach(function(e,i){r.writeUInt32BE(e,1+4*i)}),r}function Or(t){var r=t?xe(t):[];return gi(r)}function Nr(t){return $r.bippath.fromPathArray(t).toString()}function xe(t){return $r.bippath.fromString(t).toPathArray()}function un(t){var r=vi.decode(t);return r.slice(r.length-33)}function fn(t){var r=vi.decode(t);return{chaincode:r.slice(13,13+32),pubkey:r.slice(r.length-33),version:r.readUInt32BE(0)}}function ia(t){for(var r=t.length-1;r>=0;r--)if(t[r]>=2147483648)return t.slice(0,r+1);return[]}var hr={exports:{}};const sa="2.0.0",aa=256,oa=Number.MAX_SAFE_INTEGER||9007199254740991,ua=16,fa=["major","premajor","minor","preminor","patch","prepatch","prerelease"];var Lt={MAX_LENGTH:aa,MAX_SAFE_COMPONENT_LENGTH:ua,MAX_SAFE_INTEGER:oa,RELEASE_TYPES:fa,SEMVER_SPEC_VERSION:sa,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2};const ca=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{};var Ct=ca;(function(t,r){const{MAX_SAFE_COMPONENT_LENGTH:e}=Lt,i=Ct;r=t.exports={};const s=r.re=[],n=r.safeRe=[],o=r.src=[],u=r.t={};let c=0;const a=(f,l,v)=>{const h=l.split("\\s*").join("\\s{0,1}").split("\\s+").join("\\s"),x=c++;i(f,x,l),u[f]=x,o[x]=l,s[x]=new RegExp(l,v?"g":void 0),n[x]=new RegExp(h,v?"g":void 0)};a("NUMERICIDENTIFIER","0|[1-9]\\d*"),a("NUMERICIDENTIFIERLOOSE","[0-9]+"),a("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),a("MAINVERSION",`(${o[u.NUMERICIDENTIFIER]})\\.(${o[u.NUMERICIDENTIFIER]})\\.(${o[u.NUMERICIDENTIFIER]})`),a("MAINVERSIONLOOSE",`(${o[u.NUMERICIDENTIFIERLOOSE]})\\.(${o[u.NUMERICIDENTIFIERLOOSE]})\\.(${o[u.NUMERICIDENTIFIERLOOSE]})`),a("PRERELEASEIDENTIFIER",`(?:${o[u.NUMERICIDENTIFIER]}|${o[u.NONNUMERICIDENTIFIER]})`),a("PRERELEASEIDENTIFIERLOOSE",`(?:${o[u.NUMERICIDENTIFIERLOOSE]}|${o[u.NONNUMERICIDENTIFIER]})`),a("PRERELEASE",`(?:-(${o[u.PRERELEASEIDENTIFIER]}(?:\\.${o[u.PRERELEASEIDENTIFIER]})*))`),a("PRERELEASELOOSE",`(?:-?(${o[u.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${o[u.PRERELEASEIDENTIFIERLOOSE]})*))`),a("BUILDIDENTIFIER","[0-9A-Za-z-]+"),a("BUILD",`(?:\\+(${o[u.BUILDIDENTIFIER]}(?:\\.${o[u.BUILDIDENTIFIER]})*))`),a("FULLPLAIN",`v?${o[u.MAINVERSION]}${o[u.PRERELEASE]}?${o[u.BUILD]}?`),a("FULL",`^${o[u.FULLPLAIN]}$`),a("LOOSEPLAIN",`[v=\\s]*${o[u.MAINVERSIONLOOSE]}${o[u.PRERELEASELOOSE]}?${o[u.BUILD]}?`),a("LOOSE",`^${o[u.LOOSEPLAIN]}$`),a("GTLT","((?:<|>)?=?)"),a("XRANGEIDENTIFIERLOOSE",`${o[u.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),a("XRANGEIDENTIFIER",`${o[u.NUMERICIDENTIFIER]}|x|X|\\*`),a("XRANGEPLAIN",`[v=\\s]*(${o[u.XRANGEIDENTIFIER]})(?:\\.(${o[u.XRANGEIDENTIFIER]})(?:\\.(${o[u.XRANGEIDENTIFIER]})(?:${o[u.PRERELEASE]})?${o[u.BUILD]}?)?)?`),a("XRANGEPLAINLOOSE",`[v=\\s]*(${o[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[u.XRANGEIDENTIFIERLOOSE]})(?:${o[u.PRERELEASELOOSE]})?${o[u.BUILD]}?)?)?`),a("XRANGE",`^${o[u.GTLT]}\\s*${o[u.XRANGEPLAIN]}$`),a("XRANGELOOSE",`^${o[u.GTLT]}\\s*${o[u.XRANGEPLAINLOOSE]}$`),a("COERCE",`(^|[^\\d])(\\d{1,${e}})(?:\\.(\\d{1,${e}}))?(?:\\.(\\d{1,${e}}))?(?:$|[^\\d])`),a("COERCERTL",o[u.COERCE],!0),a("LONETILDE","(?:~>?)"),a("TILDETRIM",`(\\s*)${o[u.LONETILDE]}\\s+`,!0),r.tildeTrimReplace="$1~",a("TILDE",`^${o[u.LONETILDE]}${o[u.XRANGEPLAIN]}$`),a("TILDELOOSE",`^${o[u.LONETILDE]}${o[u.XRANGEPLAINLOOSE]}$`),a("LONECARET","(?:\\^)"),a("CARETTRIM",`(\\s*)${o[u.LONECARET]}\\s+`,!0),r.caretTrimReplace="$1^",a("CARET",`^${o[u.LONECARET]}${o[u.XRANGEPLAIN]}$`),a("CARETLOOSE",`^${o[u.LONECARET]}${o[u.XRANGEPLAINLOOSE]}$`),a("COMPARATORLOOSE",`^${o[u.GTLT]}\\s*(${o[u.LOOSEPLAIN]})$|^$`),a("COMPARATOR",`^${o[u.GTLT]}\\s*(${o[u.FULLPLAIN]})$|^$`),a("COMPARATORTRIM",`(\\s*)${o[u.GTLT]}\\s*(${o[u.LOOSEPLAIN]}|${o[u.XRANGEPLAIN]})`,!0),r.comparatorTrimReplace="$1$2$3",a("HYPHENRANGE",`^\\s*(${o[u.XRANGEPLAIN]})\\s+-\\s+(${o[u.XRANGEPLAIN]})\\s*$`),a("HYPHENRANGELOOSE",`^\\s*(${o[u.XRANGEPLAINLOOSE]})\\s+-\\s+(${o[u.XRANGEPLAINLOOSE]})\\s*$`),a("STAR","(<|>)?=?\\s*\\*"),a("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),a("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(hr,hr.exports);var ut=hr.exports;const la=Object.freeze({loose:!0}),ha=Object.freeze({}),pa=t=>t?typeof t!="object"?la:t:ha;var Pr=pa;const cn=/^[0-9]+$/,xi=(t,r)=>{const e=cn.test(t),i=cn.test(r);return e&&i&&(t=+t,r=+r),t===r?0:e&&!i?-1:i&&!e?1:t<r?-1:1},da=(t,r)=>xi(r,t);var Ei={compareIdentifiers:xi,rcompareIdentifiers:da};const gt=Ct,{MAX_LENGTH:ln,MAX_SAFE_INTEGER:xt}=Lt,{safeRe:hn,t:pn}=ut,va=Pr,{compareIdentifiers:Pe}=Ei;let ga=class de{constructor(r,e){if(e=va(e),r instanceof de){if(r.loose===!!e.loose&&r.includePrerelease===!!e.includePrerelease)return r;r=r.version}else if(typeof r!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof r}".`);if(r.length>ln)throw new TypeError(`version is longer than ${ln} characters`);gt("SemVer",r,e),this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease;const i=r.trim().match(e.loose?hn[pn.LOOSE]:hn[pn.FULL]);if(!i)throw new TypeError(`Invalid Version: ${r}`);if(this.raw=r,this.major=+i[1],this.minor=+i[2],this.patch=+i[3],this.major>xt||this.major<0)throw new TypeError("Invalid major version");if(this.minor>xt||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>xt||this.patch<0)throw new TypeError("Invalid patch version");i[4]?this.prerelease=i[4].split(".").map(s=>{if(/^[0-9]+$/.test(s)){const n=+s;if(n>=0&&n<xt)return n}return s}):this.prerelease=[],this.build=i[5]?i[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(r){if(gt("SemVer.compare",this.version,this.options,r),!(r instanceof de)){if(typeof r=="string"&&r===this.version)return 0;r=new de(r,this.options)}return r.version===this.version?0:this.compareMain(r)||this.comparePre(r)}compareMain(r){return r instanceof de||(r=new de(r,this.options)),Pe(this.major,r.major)||Pe(this.minor,r.minor)||Pe(this.patch,r.patch)}comparePre(r){if(r instanceof de||(r=new de(r,this.options)),this.prerelease.length&&!r.prerelease.length)return-1;if(!this.prerelease.length&&r.prerelease.length)return 1;if(!this.prerelease.length&&!r.prerelease.length)return 0;let e=0;do{const i=this.prerelease[e],s=r.prerelease[e];if(gt("prerelease compare",e,i,s),i===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(i===void 0)return-1;if(i===s)continue;return Pe(i,s)}while(++e)}compareBuild(r){r instanceof de||(r=new de(r,this.options));let e=0;do{const i=this.build[e],s=r.build[e];if(gt("prerelease compare",e,i,s),i===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(i===void 0)return-1;if(i===s)continue;return Pe(i,s)}while(++e)}inc(r,e,i){switch(r){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e,i);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e,i);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e,i),this.inc("pre",e,i);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",e,i),this.inc("pre",e,i);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const s=Number(i)?1:0;if(!e&&i===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[s];else{let n=this.prerelease.length;for(;--n>=0;)typeof this.prerelease[n]=="number"&&(this.prerelease[n]++,n=-2);if(n===-1){if(e===this.prerelease.join(".")&&i===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(s)}}if(e){let n=[e,s];i===!1&&(n=[e]),Pe(this.prerelease[0],e)===0?isNaN(this.prerelease[1])&&(this.prerelease=n):this.prerelease=n}break}default:throw new Error(`invalid increment argument: ${r}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};var re=ga;const dn=re,xa=(t,r,e=!1)=>{if(t instanceof dn)return t;try{return new dn(t,r)}catch(i){if(!e)return null;throw i}};var He=xa;const Ea=He,wa=(t,r)=>{const e=Ea(t,r);return e?e.version:null};var ya=wa;const _a=He,ba=(t,r)=>{const e=_a(t.trim().replace(/^[=v]+/,""),r);return e?e.version:null};var ma=ba;const vn=re,Ia=(t,r,e,i,s)=>{typeof e=="string"&&(s=i,i=e,e=void 0);try{return new vn(t instanceof vn?t.version:t,e).inc(r,i,s).version}catch{return null}};var Ta=Ia;const gn=He,Sa=(t,r)=>{const e=gn(t,null,!0),i=gn(r,null,!0),s=e.compare(i);if(s===0)return null;const n=s>0,o=n?e:i,u=n?i:e,c=!!o.prerelease.length;if(!!u.prerelease.length&&!c)return!u.patch&&!u.minor?"major":o.patch?"patch":o.minor?"minor":"major";const f=c?"pre":"";return e.major!==i.major?f+"major":e.minor!==i.minor?f+"minor":e.patch!==i.patch?f+"patch":"prerelease"};var Ba=Sa;const $a=re,Ra=(t,r)=>new $a(t,r).major;var Aa=Ra;const Oa=re,Na=(t,r)=>new Oa(t,r).minor;var Pa=Na;const La=re,Ca=(t,r)=>new La(t,r).patch;var Da=Ca;const Ua=He,ka=(t,r)=>{const e=Ua(t,r);return e&&e.prerelease.length?e.prerelease:null};var Ma=ka;const xn=re,Ga=(t,r,e)=>new xn(t,e).compare(new xn(r,e));var le=Ga;const Fa=le,Va=(t,r,e)=>Fa(r,t,e);var Ka=Va;const qa=le,Xa=(t,r)=>qa(t,r,!0);var Ha=Xa;const En=re,ja=(t,r,e)=>{const i=new En(t,e),s=new En(r,e);return i.compare(s)||i.compareBuild(s)};var Lr=ja;const Wa=Lr,za=(t,r)=>t.sort((e,i)=>Wa(e,i,r));var Ya=za;const Za=Lr,Qa=(t,r)=>t.sort((e,i)=>Za(i,e,r));var Ja=Qa;const eo=le,to=(t,r,e)=>eo(t,r,e)>0;var Dt=to;const ro=le,no=(t,r,e)=>ro(t,r,e)<0;var Cr=no;const io=le,so=(t,r,e)=>io(t,r,e)===0;var wi=so;const ao=le,oo=(t,r,e)=>ao(t,r,e)!==0;var yi=oo;const uo=le,fo=(t,r,e)=>uo(t,r,e)>=0;var Dr=fo;const co=le,lo=(t,r,e)=>co(t,r,e)<=0;var Ur=lo;const ho=wi,po=yi,vo=Dt,go=Dr,xo=Cr,Eo=Ur,wo=(t,r,e,i)=>{switch(r){case"===":return typeof t=="object"&&(t=t.version),typeof e=="object"&&(e=e.version),t===e;case"!==":return typeof t=="object"&&(t=t.version),typeof e=="object"&&(e=e.version),t!==e;case"":case"=":case"==":return ho(t,e,i);case"!=":return po(t,e,i);case">":return vo(t,e,i);case">=":return go(t,e,i);case"<":return xo(t,e,i);case"<=":return Eo(t,e,i);default:throw new TypeError(`Invalid operator: ${r}`)}};var _i=wo;const yo=re,_o=He,{safeRe:Et,t:wt}=ut,bo=(t,r)=>{if(t instanceof yo)return t;if(typeof t=="number"&&(t=String(t)),typeof t!="string")return null;r=r||{};let e=null;if(!r.rtl)e=t.match(Et[wt.COERCE]);else{let i;for(;(i=Et[wt.COERCERTL].exec(t))&&(!e||e.index+e[0].length!==t.length);)(!e||i.index+i[0].length!==e.index+e[0].length)&&(e=i),Et[wt.COERCERTL].lastIndex=i.index+i[1].length+i[2].length;Et[wt.COERCERTL].lastIndex=-1}return e===null?null:_o(`${e[2]}.${e[3]||"0"}.${e[4]||"0"}`,r)};var mo=bo,Jt,wn;function he(){if(wn)return Jt;wn=1;class t{constructor(g,_){if(_=i(_),g instanceof t)return g.loose===!!_.loose&&g.includePrerelease===!!_.includePrerelease?g:new t(g.raw,_);if(g instanceof s)return this.raw=g.value,this.set=[[g]],this.format(),this;if(this.options=_,this.loose=!!_.loose,this.includePrerelease=!!_.includePrerelease,this.raw=g.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(T=>this.parseRange(T)).filter(T=>T.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const T=this.set[0];if(this.set=this.set.filter(w=>!x(w[0])),this.set.length===0)this.set=[T];else if(this.set.length>1){for(const w of this.set)if(w.length===1&&m(w[0])){this.set=[w];break}}}this.format()}format(){return this.range=this.set.map(g=>g.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(g){const T=((this.options.includePrerelease&&v)|(this.options.loose&&h))+":"+g,w=e.get(T);if(w)return w;const y=this.options.loose,O=y?u[c.HYPHENRANGELOOSE]:u[c.HYPHENRANGE];g=g.replace(O,k(this.options.includePrerelease)),n("hyphen replace",g),g=g.replace(u[c.COMPARATORTRIM],a),n("comparator trim",g),g=g.replace(u[c.TILDETRIM],f),g=g.replace(u[c.CARETTRIM],l);let S=g.split(" ").map(F=>B(F,this.options)).join(" ").split(/\s+/).map(F=>A(F,this.options));y&&(S=S.filter(F=>(n("loose invalid filter",F,this.options),!!F.match(u[c.COMPARATORLOOSE])))),n("range list",S);const b=new Map,D=S.map(F=>new s(F,this.options));for(const F of D){if(x(F))return[F];b.set(F.value,F)}b.size>1&&b.has("")&&b.delete("");const q=[...b.values()];return e.set(T,q),q}intersects(g,_){if(!(g instanceof t))throw new TypeError("a Range is required");return this.set.some(T=>E(T,_)&&g.set.some(w=>E(w,_)&&T.every(y=>w.every(O=>y.intersects(O,_)))))}test(g){if(!g)return!1;if(typeof g=="string")try{g=new o(g,this.options)}catch{return!1}for(let _=0;_<this.set.length;_++)if(N(this.set[_],g,this.options))return!0;return!1}}Jt=t;const r=Ki.lruCache,e=new r({max:1e3}),i=Pr,s=Ut(),n=Ct,o=re,{safeRe:u,t:c,comparatorTrimReplace:a,tildeTrimReplace:f,caretTrimReplace:l}=ut,{FLAG_INCLUDE_PRERELEASE:v,FLAG_LOOSE:h}=Lt,x=d=>d.value==="<0.0.0-0",m=d=>d.value==="",E=(d,g)=>{let _=!0;const T=d.slice();let w=T.pop();for(;_&&T.length;)_=T.every(y=>w.intersects(y,g)),w=T.pop();return _},B=(d,g)=>(n("comp",d,g),d=P(d,g),n("caret",d),d=$(d,g),n("tildes",d),d=U(d,g),n("xrange",d),d=H(d,g),n("stars",d),d),p=d=>!d||d.toLowerCase()==="x"||d==="*",$=(d,g)=>d.trim().split(/\s+/).map(_=>R(_,g)).join(" "),R=(d,g)=>{const _=g.loose?u[c.TILDELOOSE]:u[c.TILDE];return d.replace(_,(T,w,y,O,S)=>{n("tilde",d,T,w,y,O,S);let b;return p(w)?b="":p(y)?b=`>=${w}.0.0 <${+w+1}.0.0-0`:p(O)?b=`>=${w}.${y}.0 <${w}.${+y+1}.0-0`:S?(n("replaceTilde pr",S),b=`>=${w}.${y}.${O}-${S} <${w}.${+y+1}.0-0`):b=`>=${w}.${y}.${O} <${w}.${+y+1}.0-0`,n("tilde return",b),b})},P=(d,g)=>d.trim().split(/\s+/).map(_=>I(_,g)).join(" "),I=(d,g)=>{n("caret",d,g);const _=g.loose?u[c.CARETLOOSE]:u[c.CARET],T=g.includePrerelease?"-0":"";return d.replace(_,(w,y,O,S,b)=>{n("caret",d,w,y,O,S,b);let D;return p(y)?D="":p(O)?D=`>=${y}.0.0${T} <${+y+1}.0.0-0`:p(S)?y==="0"?D=`>=${y}.${O}.0${T} <${y}.${+O+1}.0-0`:D=`>=${y}.${O}.0${T} <${+y+1}.0.0-0`:b?(n("replaceCaret pr",b),y==="0"?O==="0"?D=`>=${y}.${O}.${S}-${b} <${y}.${O}.${+S+1}-0`:D=`>=${y}.${O}.${S}-${b} <${y}.${+O+1}.0-0`:D=`>=${y}.${O}.${S}-${b} <${+y+1}.0.0-0`):(n("no pr"),y==="0"?O==="0"?D=`>=${y}.${O}.${S}${T} <${y}.${O}.${+S+1}-0`:D=`>=${y}.${O}.${S}${T} <${y}.${+O+1}.0-0`:D=`>=${y}.${O}.${S} <${+y+1}.0.0-0`),n("caret return",D),D})},U=(d,g)=>(n("replaceXRanges",d,g),d.split(/\s+/).map(_=>L(_,g)).join(" ")),L=(d,g)=>{d=d.trim();const _=g.loose?u[c.XRANGELOOSE]:u[c.XRANGE];return d.replace(_,(T,w,y,O,S,b)=>{n("xRange",d,T,w,y,O,S,b);const D=p(y),q=D||p(O),F=q||p(S),j=F;return w==="="&&j&&(w=""),b=g.includePrerelease?"-0":"",D?w===">"||w==="<"?T="<0.0.0-0":T="*":w&&j?(q&&(O=0),S=0,w===">"?(w=">=",q?(y=+y+1,O=0,S=0):(O=+O+1,S=0)):w==="<="&&(w="<",q?y=+y+1:O=+O+1),w==="<"&&(b="-0"),T=`${w+y}.${O}.${S}${b}`):q?T=`>=${y}.0.0${b} <${+y+1}.0.0-0`:F&&(T=`>=${y}.${O}.0${b} <${y}.${+O+1}.0-0`),n("xRange return",T),T})},H=(d,g)=>(n("replaceStars",d,g),d.trim().replace(u[c.STAR],"")),A=(d,g)=>(n("replaceGTE0",d,g),d.trim().replace(u[g.includePrerelease?c.GTE0PRE:c.GTE0],"")),k=d=>(g,_,T,w,y,O,S,b,D,q,F,j,X)=>(p(T)?_="":p(w)?_=`>=${T}.0.0${d?"-0":""}`:p(y)?_=`>=${T}.${w}.0${d?"-0":""}`:O?_=`>=${_}`:_=`>=${_}${d?"-0":""}`,p(D)?b="":p(q)?b=`<${+D+1}.0.0-0`:p(F)?b=`<${D}.${+q+1}.0-0`:j?b=`<=${D}.${q}.${F}-${j}`:d?b=`<${D}.${q}.${+F+1}-0`:b=`<=${b}`,`${_} ${b}`.trim()),N=(d,g,_)=>{for(let T=0;T<d.length;T++)if(!d[T].test(g))return!1;if(g.prerelease.length&&!_.includePrerelease){for(let T=0;T<d.length;T++)if(n(d[T].semver),d[T].semver!==s.ANY&&d[T].semver.prerelease.length>0){const w=d[T].semver;if(w.major===g.major&&w.minor===g.minor&&w.patch===g.patch)return!0}return!1}return!0};return Jt}var er,yn;function Ut(){if(yn)return er;yn=1;const t=Symbol("SemVer ANY");class r{static get ANY(){return t}constructor(f,l){if(l=e(l),f instanceof r){if(f.loose===!!l.loose)return f;f=f.value}f=f.trim().split(/\s+/).join(" "),o("comparator",f,l),this.options=l,this.loose=!!l.loose,this.parse(f),this.semver===t?this.value="":this.value=this.operator+this.semver.version,o("comp",this)}parse(f){const l=this.options.loose?i[s.COMPARATORLOOSE]:i[s.COMPARATOR],v=f.match(l);if(!v)throw new TypeError(`Invalid comparator: ${f}`);this.operator=v[1]!==void 0?v[1]:"",this.operator==="="&&(this.operator=""),v[2]?this.semver=new u(v[2],this.options.loose):this.semver=t}toString(){return this.value}test(f){if(o("Comparator.test",f,this.options.loose),this.semver===t||f===t)return!0;if(typeof f=="string")try{f=new u(f,this.options)}catch{return!1}return n(f,this.operator,this.semver,this.options)}intersects(f,l){if(!(f instanceof r))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new c(f.value,l).test(this.value):f.operator===""?f.value===""?!0:new c(this.value,l).test(f.semver):(l=e(l),l.includePrerelease&&(this.value==="<0.0.0-0"||f.value==="<0.0.0-0")||!l.includePrerelease&&(this.value.startsWith("<0.0.0")||f.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&f.operator.startsWith(">")||this.operator.startsWith("<")&&f.operator.startsWith("<")||this.semver.version===f.semver.version&&this.operator.includes("=")&&f.operator.includes("=")||n(this.semver,"<",f.semver,l)&&this.operator.startsWith(">")&&f.operator.startsWith("<")||n(this.semver,">",f.semver,l)&&this.operator.startsWith("<")&&f.operator.startsWith(">")))}}er=r;const e=Pr,{safeRe:i,t:s}=ut,n=_i,o=Ct,u=re,c=he();return er}const Io=he(),To=(t,r,e)=>{try{r=new Io(r,e)}catch{return!1}return r.test(t)};var kt=To;const So=he(),Bo=(t,r)=>new So(t,r).set.map(e=>e.map(i=>i.value).join(" ").trim().split(" "));var $o=Bo;const Ro=re,Ao=he(),Oo=(t,r,e)=>{let i=null,s=null,n=null;try{n=new Ao(r,e)}catch{return null}return t.forEach(o=>{n.test(o)&&(!i||s.compare(o)===-1)&&(i=o,s=new Ro(i,e))}),i};var No=Oo;const Po=re,Lo=he(),Co=(t,r,e)=>{let i=null,s=null,n=null;try{n=new Lo(r,e)}catch{return null}return t.forEach(o=>{n.test(o)&&(!i||s.compare(o)===1)&&(i=o,s=new Po(i,e))}),i};var Do=Co;const tr=re,Uo=he(),_n=Dt,ko=(t,r)=>{t=new Uo(t,r);let e=new tr("0.0.0");if(t.test(e)||(e=new tr("0.0.0-0"),t.test(e)))return e;e=null;for(let i=0;i<t.set.length;++i){const s=t.set[i];let n=null;s.forEach(o=>{const u=new tr(o.semver.version);switch(o.operator){case">":u.prerelease.length===0?u.patch++:u.prerelease.push(0),u.raw=u.format();case"":case">=":(!n||_n(u,n))&&(n=u);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${o.operator}`)}}),n&&(!e||_n(e,n))&&(e=n)}return e&&t.test(e)?e:null};var Mo=ko;const Go=he(),Fo=(t,r)=>{try{return new Go(t,r).range||"*"}catch{return null}};var Vo=Fo;const Ko=re,bi=Ut(),{ANY:qo}=bi,Xo=he(),Ho=kt,bn=Dt,mn=Cr,jo=Ur,Wo=Dr,zo=(t,r,e,i)=>{t=new Ko(t,i),r=new Xo(r,i);let s,n,o,u,c;switch(e){case">":s=bn,n=jo,o=mn,u=">",c=">=";break;case"<":s=mn,n=Wo,o=bn,u="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Ho(t,r,i))return!1;for(let a=0;a<r.set.length;++a){const f=r.set[a];let l=null,v=null;if(f.forEach(h=>{h.semver===qo&&(h=new bi(">=0.0.0")),l=l||h,v=v||h,s(h.semver,l.semver,i)?l=h:o(h.semver,v.semver,i)&&(v=h)}),l.operator===u||l.operator===c||(!v.operator||v.operator===u)&&n(t,v.semver))return!1;if(v.operator===c&&o(t,v.semver))return!1}return!0};var kr=zo;const Yo=kr,Zo=(t,r,e)=>Yo(t,r,">",e);var Qo=Zo;const Jo=kr,eu=(t,r,e)=>Jo(t,r,"<",e);var tu=eu;const In=he(),ru=(t,r,e)=>(t=new In(t,e),r=new In(r,e),t.intersects(r,e));var nu=ru;const iu=kt,su=le;var au=(t,r,e)=>{const i=[];let s=null,n=null;const o=t.sort((f,l)=>su(f,l,e));for(const f of o)iu(f,r,e)?(n=f,s||(s=f)):(n&&i.push([s,n]),n=null,s=null);s&&i.push([s,null]);const u=[];for(const[f,l]of i)f===l?u.push(f):!l&&f===o[0]?u.push("*"):l?f===o[0]?u.push(`<=${l}`):u.push(`${f} - ${l}`):u.push(`>=${f}`);const c=u.join(" || "),a=typeof r.raw=="string"?r.raw:String(r);return c.length<a.length?c:r};const Tn=he(),Mr=Ut(),{ANY:rr}=Mr,ze=kt,Gr=le,ou=(t,r,e={})=>{if(t===r)return!0;t=new Tn(t,e),r=new Tn(r,e);let i=!1;e:for(const s of t.set){for(const n of r.set){const o=fu(s,n,e);if(i=i||o!==null,o)continue e}if(i)return!1}return!0},uu=[new Mr(">=0.0.0-0")],Sn=[new Mr(">=0.0.0")],fu=(t,r,e)=>{if(t===r)return!0;if(t.length===1&&t[0].semver===rr){if(r.length===1&&r[0].semver===rr)return!0;e.includePrerelease?t=uu:t=Sn}if(r.length===1&&r[0].semver===rr){if(e.includePrerelease)return!0;r=Sn}const i=new Set;let s,n;for(const h of t)h.operator===">"||h.operator===">="?s=Bn(s,h,e):h.operator==="<"||h.operator==="<="?n=$n(n,h,e):i.add(h.semver);if(i.size>1)return null;let o;if(s&&n){if(o=Gr(s.semver,n.semver,e),o>0)return null;if(o===0&&(s.operator!==">="||n.operator!=="<="))return null}for(const h of i){if(s&&!ze(h,String(s),e)||n&&!ze(h,String(n),e))return null;for(const x of r)if(!ze(h,String(x),e))return!1;return!0}let u,c,a,f,l=n&&!e.includePrerelease&&n.semver.prerelease.length?n.semver:!1,v=s&&!e.includePrerelease&&s.semver.prerelease.length?s.semver:!1;l&&l.prerelease.length===1&&n.operator==="<"&&l.prerelease[0]===0&&(l=!1);for(const h of r){if(f=f||h.operator===">"||h.operator===">=",a=a||h.operator==="<"||h.operator==="<=",s){if(v&&h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===v.major&&h.semver.minor===v.minor&&h.semver.patch===v.patch&&(v=!1),h.operator===">"||h.operator===">="){if(u=Bn(s,h,e),u===h&&u!==s)return!1}else if(s.operator===">="&&!ze(s.semver,String(h),e))return!1}if(n){if(l&&h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===l.major&&h.semver.minor===l.minor&&h.semver.patch===l.patch&&(l=!1),h.operator==="<"||h.operator==="<="){if(c=$n(n,h,e),c===h&&c!==n)return!1}else if(n.operator==="<="&&!ze(n.semver,String(h),e))return!1}if(!h.operator&&(n||s)&&o!==0)return!1}return!(s&&a&&!n&&o!==0||n&&f&&!s&&o!==0||v||l)},Bn=(t,r,e)=>{if(!t)return r;const i=Gr(t.semver,r.semver,e);return i>0?t:i<0||r.operator===">"&&t.operator===">="?r:t},$n=(t,r,e)=>{if(!t)return r;const i=Gr(t.semver,r.semver,e);return i<0?t:i>0||r.operator==="<"&&t.operator==="<="?r:t};var cu=ou;const nr=ut,Rn=Lt,lu=re,An=Ei,hu=He,pu=ya,du=ma,vu=Ta,gu=Ba,xu=Aa,Eu=Pa,wu=Da,yu=Ma,_u=le,bu=Ka,mu=Ha,Iu=Lr,Tu=Ya,Su=Ja,Bu=Dt,$u=Cr,Ru=wi,Au=yi,Ou=Dr,Nu=Ur,Pu=_i,Lu=mo,Cu=Ut(),Du=he(),Uu=kt,ku=$o,Mu=No,Gu=Do,Fu=Mo,Vu=Vo,Ku=kr,qu=Qo,Xu=tu,Hu=nu,ju=au,Wu=cu;var zu={parse:hu,valid:pu,clean:du,inc:vu,diff:gu,major:xu,minor:Eu,patch:wu,prerelease:yu,compare:_u,rcompare:bu,compareLoose:mu,compareBuild:Iu,sort:Tu,rsort:Su,gt:Bu,lt:$u,eq:Ru,neq:Au,gte:Ou,lte:Nu,cmp:Pu,coerce:Lu,Comparator:Cu,Range:Du,satisfies:Uu,toComparators:ku,maxSatisfying:Mu,minSatisfying:Gu,minVersion:Fu,validRange:Vu,outside:Ku,gtr:qu,ltr:Xu,intersects:Hu,simplifyRange:ju,subset:Wu,SemVer:lu,re:nr.re,src:nr.src,tokens:nr.t,SEMVER_SPEC_VERSION:Rn.SEMVER_SPEC_VERSION,RELEASE_TYPES:Rn.RELEASE_TYPES,compareIdentifiers:An.compareIdentifiers,rcompareIdentifiers:An.rcompareIdentifiers};const mi=G.getDefaultExportFromCjs(zu);var Yu=G.inherits_browserExports,me=G.safeBufferExports.Buffer,Ii=Ar,Zu=me.alloc(128),Le=64;function Mt(t,r){Ii.call(this,"digest"),typeof r=="string"&&(r=me.from(r)),this._alg=t,this._key=r,r.length>Le?r=t(r):r.length<Le&&(r=me.concat([r,Zu],Le));for(var e=this._ipad=me.allocUnsafe(Le),i=this._opad=me.allocUnsafe(Le),s=0;s<Le;s++)e[s]=r[s]^54,i[s]=r[s]^92;this._hash=[e]}Yu(Mt,Ii);Mt.prototype._update=function(t){this._hash.push(t)};Mt.prototype._final=function(){var t=this._alg(me.concat(this._hash));return this._alg(me.concat([this._opad,t]))};var Qu=Mt,Ju=ri,ef=function(t){return new Ju().update(t).digest()},tf=G.inherits_browserExports,rf=Qu,Ti=Ar,Je=G.safeBufferExports.Buffer,nf=ef,pr=G.ripemd160,dr=Rr,sf=Je.alloc(128);function rt(t,r){Ti.call(this,"digest"),typeof r=="string"&&(r=Je.from(r));var e=t==="sha512"||t==="sha384"?128:64;if(this._alg=t,this._key=r,r.length>e){var i=t==="rmd160"?new pr:dr(t);r=i.update(r).digest()}else r.length<e&&(r=Je.concat([r,sf],e));for(var s=this._ipad=Je.allocUnsafe(e),n=this._opad=Je.allocUnsafe(e),o=0;o<e;o++)s[o]=r[o]^54,n[o]=r[o]^92;this._hash=t==="rmd160"?new pr:dr(t),this._hash.update(s)}tf(rt,Ti);rt.prototype._update=function(t){this._hash.update(t)};rt.prototype._final=function(){var t=this._hash.digest(),r=this._alg==="rmd160"?new pr:dr(this._alg);return r.update(this._opad).update(t).digest()};var af=function(r,e){return r=r.toLowerCase(),r==="rmd160"||r==="ripemd160"?new rt("rmd160",e):r==="md5"?new rf(nf,e):new rt(r,e)};const ge=af,of=Buffer.alloc(1,1),On=Buffer.alloc(1,0);function uf(t,r,e,i,s){let n=Buffer.alloc(32,0),o=Buffer.alloc(32,1);n=ge("sha256",n).update(o).update(On).update(r).update(t).update(s||"").digest(),o=ge("sha256",n).update(o).digest(),n=ge("sha256",n).update(o).update(of).update(r).update(t).update(s||"").digest(),o=ge("sha256",n).update(o).digest(),o=ge("sha256",n).update(o).digest();let u=o;for(;!i(u)||!e(u);)n=ge("sha256",n).update(o).update(On).digest(),o=ge("sha256",n).update(o).digest(),o=ge("sha256",n).update(o).digest(),u=o;return u}var ff=uf;const cf=qi,lf=Xi.ec,Fr=new lf("secp256k1"),hf=ff,_t=Buffer.alloc(32,0),bt=Buffer.from("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141","hex"),Nn=Buffer.from("fffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f","hex"),fe=Fr.curve.n,Si=fe.shrn(1),Gt=Fr.curve.g,Ft="Expected Private",Se="Expected Point",Vt="Expected Tweak",Bi="Expected Hash",pf="Expected Signature",df="Expected Extra Data (32 bytes)";function nt(t){return Buffer.isBuffer(t)&&t.length===32}function Kt(t){return nt(t)?t.compare(bt)<0:!1}function Ee(t){if(!Buffer.isBuffer(t)||t.length<33)return!1;const r=t[0],e=t.slice(1,33);if(e.compare(_t)===0||e.compare(Nn)>=0)return!1;if((r===2||r===3)&&t.length===33){try{Be(t)}catch{return!1}return!0}const i=t.slice(33);return i.compare(_t)===0||i.compare(Nn)>=0?!1:r===4&&t.length===65}function $i(t){return t[0]!==4}function vf(t){return Ee(t)?$i(t):!1}function we(t){return nt(t)?t.compare(_t)>0&&t.compare(bt)<0:!1}function gf(t){const r=t.slice(0,32),e=t.slice(32,64);return Buffer.isBuffer(t)&&t.length===64&&r.compare(bt)<0&&e.compare(bt)<0}function ft(t,r){return t===void 0&&r!==void 0?$i(r):t===void 0?!0:t}function ie(t){return new cf(t)}function mt(t){return t.toArrayLike(Buffer,"be",32)}function Be(t){return Fr.curve.decodePoint(t)}function Fe(t,r){return Buffer.from(t._encode(r))}function xf(t,r,e){if(!Ee(t))throw new TypeError(Se);if(!Ee(r))throw new TypeError(Se);const i=Be(t),s=Be(r),n=i.add(s);if(n.isInfinity())return null;const o=ft(e,t);return Fe(n,o)}function Ef(t,r,e){if(!Ee(t))throw new TypeError(Se);if(!Kt(r))throw new TypeError(Vt);const i=ft(e,t),s=Be(t);if(r.compare(_t)===0)return Fe(s,i);const n=ie(r),o=Gt.mul(n),u=s.add(o);return u.isInfinity()?null:Fe(u,i)}function wf(t,r){if(!Ee(t))throw new TypeError(Se);const e=Be(t);if(e.isInfinity())throw new TypeError(Se);const i=ft(r,t);return Fe(e,i)}function yf(t,r){if(!we(t))throw new TypeError(Ft);const e=ie(t),i=Gt.mul(e);if(i.isInfinity())return null;const s=ft(r);return Fe(i,s)}function _f(t,r,e){if(!Ee(t))throw new TypeError(Se);if(!Kt(r))throw new TypeError(Vt);const i=ft(e,t),s=Be(t),n=ie(r),o=s.mul(n);return o.isInfinity()?null:Fe(o,i)}function bf(t,r){if(!we(t))throw new TypeError(Ft);if(!Kt(r))throw new TypeError(Vt);const e=ie(t),i=ie(r),s=mt(e.add(i).umod(fe));return we(s)?s:null}function mf(t,r){if(!we(t))throw new TypeError(Ft);if(!Kt(r))throw new TypeError(Vt);const e=ie(t),i=ie(r),s=mt(e.sub(i).umod(fe));return we(s)?s:null}function If(t,r){return Ri(t,r)}function Tf(t,r,e){return Ri(t,r,e)}function Ri(t,r,e){if(!nt(t))throw new TypeError(Bi);if(!we(r))throw new TypeError(Ft);if(e!==void 0&&!nt(e))throw new TypeError(df);const i=ie(r),s=ie(t);let n,o;hf(t,r,function(a){const f=ie(a),l=Gt.mul(f);return!(l.isInfinity()||(n=l.x.umod(fe),n.isZero()===0)||(o=f.invm(fe).mul(s.add(i.mul(n))).umod(fe),o.isZero()===0))},we,e),o.cmp(Si)>0&&(o=fe.sub(o));const c=Buffer.allocUnsafe(64);return mt(n).copy(c,0),mt(o).copy(c,32),c}function Sf(t,r,e,i){if(!nt(t))throw new TypeError(Bi);if(!Ee(r))throw new TypeError(Se);if(!gf(e))throw new TypeError(pf);const s=Be(r),n=ie(e.slice(0,32)),o=ie(e.slice(32,64));if(i&&o.cmp(Si)>0||n.gtn(0)<=0||o.gtn(0)<=0)return!1;const u=ie(t),c=o.invm(fe),a=u.mul(c).umod(fe),f=n.mul(c).umod(fe),l=Gt.mulAdd(a,s,f);return l.isInfinity()?!1:l.x.umod(fe).eq(n)}var Ai={isPoint:Ee,isPointCompressed:vf,isPrivate:we,pointAdd:xf,pointAddScalar:Ef,pointCompress:wf,pointFromScalar:yf,pointMultiply:_f,privateAdd:bf,privateSub:mf,sign:If,signWithEntropy:Tf,verify:Sf},vr=G.safeBufferExports.Buffer,Bf=9007199254740991;function Vr(t){if(t<0||t>Bf||t%1!==0)throw new RangeError("value out of range")}function et(t,r,e){if(Vr(t),r||(r=vr.allocUnsafe(Oi(t))),!vr.isBuffer(r))throw new TypeError("buffer must be a Buffer instance");return e||(e=0),t<253?(r.writeUInt8(t,e),et.bytes=1):t<=65535?(r.writeUInt8(253,e),r.writeUInt16LE(t,e+1),et.bytes=3):t<=4294967295?(r.writeUInt8(254,e),r.writeUInt32LE(t,e+1),et.bytes=5):(r.writeUInt8(255,e),r.writeUInt32LE(t>>>0,e+1),r.writeUInt32LE(t/4294967296|0,e+5),et.bytes=9),r}function tt(t,r){if(!vr.isBuffer(t))throw new TypeError("buffer must be a Buffer instance");r||(r=0);var e=t.readUInt8(r);if(e<253)return tt.bytes=1,e;if(e===253)return tt.bytes=3,t.readUInt16LE(r+1);if(e===254)return tt.bytes=5,t.readUInt32LE(r+1);tt.bytes=9;var i=t.readUInt32LE(r+1),s=t.readUInt32LE(r+5),n=s*4294967296+i;return Vr(n),n}function Oi(t){return Vr(t),t<253?1:t<=65535?3:t<=4294967295?5:9}var $f={encode:et,decode:tt,encodingLength:Oi};const gr=G.getDefaultExportFromCjs($f);function Ni(t){if(t>Number.MAX_SAFE_INTEGER)throw new Error("Can't convert numbers > MAX_SAFE_INT");for(var r=Buffer.alloc(8,0),e=0;e<r.length;e++){var i=t&255;r[e]=i,t=(t-i)/256}return r}function Pi(t){var r=0;if(t.length!=8)throw new Error("Expected Bufffer of lenght 8");if(t[7]!=0)throw new Error("Can't encode numbers > MAX_SAFE_INT");if(t[6]>31)throw new Error("Can't encode numbers > MAX_SAFE_INT");for(var e=t.length-1;e>=0;e--)r=r*256+t[e];return r}var Y=function(){function t(){this.bufs=[]}return t.prototype.write=function(r,e){var i=Buffer.alloc(r);e(i),this.bufs.push(i)},t.prototype.writeUInt8=function(r){this.write(1,function(e){return e.writeUInt8(r,0)})},t.prototype.writeInt32=function(r){this.write(4,function(e){return e.writeInt32LE(r,0)})},t.prototype.writeUInt32=function(r){this.write(4,function(e){return e.writeUInt32LE(r,0)})},t.prototype.writeUInt64=function(r){var e=Ni(r);this.writeSlice(e)},t.prototype.writeVarInt=function(r){this.bufs.push(gr.encode(r))},t.prototype.writeSlice=function(r){this.bufs.push(Buffer.from(r))},t.prototype.writeVarSlice=function(r){this.writeVarInt(r.length),this.writeSlice(r)},t.prototype.buffer=function(){return Buffer.concat(this.bufs)},t}(),Ie=function(){function t(r,e){e===void 0&&(e=0),this.buffer=r,this.offset=e}return t.prototype.available=function(){return this.buffer.length-this.offset},t.prototype.readUInt8=function(){var r=this.buffer.readUInt8(this.offset);return this.offset++,r},t.prototype.readInt32=function(){var r=this.buffer.readInt32LE(this.offset);return this.offset+=4,r},t.prototype.readUInt32=function(){var r=this.buffer.readUInt32LE(this.offset);return this.offset+=4,r},t.prototype.readUInt64=function(){var r=this.readSlice(8),e=Pi(r);return e},t.prototype.readVarInt=function(){var r=gr.decode(this.buffer,this.offset);return this.offset+=gr.decode.bytes,r},t.prototype.readSlice=function(r){if(this.buffer.length<this.offset+r)throw new Error("Cannot read slice out of bounds");var e=this.buffer.slice(this.offset,this.offset+r);return this.offset+=r,e},t.prototype.readVarSlice=function(){return this.readSlice(this.readVarInt())},t.prototype.readVector=function(){for(var r=this.readVarInt(),e=[],i=0;i<r;i++)e.push(this.readVarSlice());return e},t}(),ye=50,Rf=1,Li=0,It=4294967295,Kr=1,Ci=118,qr=169,qt=20,Af=135,Di=136,Ui=172;function Ve(t){return new G.RIPEMD160().update(yt("sha256").update(t).digest()).digest()}var ct=globalThis&&globalThis.__extends||function(){var t=function(r,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(i[n]=s[n])},t(r,e)};return function(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");t(r,e);function i(){this.constructor=r}r.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),Of=function(){function t(r,e){this.psbt=r,this.masterFp=e}return t}(),Xt=function(t){ct(r,t);function r(){return t!==null&&t.apply(this,arguments)||this}return r.prototype.spendingCondition=function(e){if(e.length!=1)throw new Error("Expected single key, got "+e.length);return this.singleKeyCondition(e[0])},r.prototype.setInput=function(e,i,s,n,o){if(n.length!=1)throw new Error("Expected single key, got "+n.length);if(o.length!=1)throw new Error("Expected single path, got "+o.length);this.setSingleKeyInput(e,i,s,n[0],o[0])},r.prototype.setOwnOutput=function(e,i,s,n){if(s.length!=1)throw new Error("Expected single key, got "+s.length);if(n.length!=1)throw new Error("Expected single path, got "+n.length);this.setSingleKeyOutput(e,i,s[0],n[0])},r}(Of),Nf=function(t){ct(r,t);function r(){return t!==null&&t.apply(this,arguments)||this}return r.prototype.singleKeyCondition=function(e){var i=new Y,s=Ve(e);return i.writeSlice(Buffer.from([Ci,qr,qt])),i.writeSlice(s),i.writeSlice(Buffer.from([Di,Ui])),{scriptPubKey:i.buffer()}},r.prototype.setSingleKeyInput=function(e,i,s,n,o){if(!i)throw new Error("Full input base transaction required");this.psbt.setInputNonWitnessUtxo(e,i),this.psbt.setInputBip32Derivation(e,n,this.masterFp,o)},r.prototype.setSingleKeyOutput=function(e,i,s,n){this.psbt.setOutputBip32Derivation(e,s,this.masterFp,n)},r.prototype.getDescriptorTemplate=function(){return"pkh(@0)"},r}(Xt),Pf=function(t){ct(r,t);function r(){return t!==null&&t.apply(this,arguments)||this}return r.prototype.singleKeyCondition=function(e){var i=e.slice(1),s=new Y,n=this.getTaprootOutputKey(i);return s.writeSlice(Buffer.from([81,32])),s.writeSlice(n),{scriptPubKey:s.buffer()}},r.prototype.setSingleKeyInput=function(e,i,s,n,o){var u=n.slice(1);this.psbt.setInputTapBip32Derivation(e,u,[],this.masterFp,o),this.psbt.setInputWitnessUtxo(e,s.amount,s.cond.scriptPubKey)},r.prototype.setSingleKeyOutput=function(e,i,s,n){var o=s.slice(1);this.psbt.setOutputTapBip32Derivation(e,o,[],this.masterFp,n)},r.prototype.getDescriptorTemplate=function(){return"tr(@0)"},r.prototype.hashTapTweak=function(e){var i=Te.crypto.sha256(Buffer.from("TapTweak","utf-8"));return Te.crypto.sha256(Buffer.concat([i,i,e]))},r.prototype.getTaprootOutputKey=function(e){if(e.length!=32)throw new Error("Expected 32 byte pubkey. Got "+e.length);var i=Buffer.concat([Buffer.from([2]),e]),s=this.hashTapTweak(e),n=Buffer.from(Ai.pointAddScalar(i,s)),o=n.slice(1);return o},r}(Xt),Lf=function(t){ct(r,t);function r(){return t!==null&&t.apply(this,arguments)||this}return r.prototype.singleKeyCondition=function(e){var i=new Y,s=this.createRedeemScript(e),n=Ve(s);return i.writeSlice(Buffer.from([qr,qt])),i.writeSlice(n),i.writeUInt8(Af),{scriptPubKey:i.buffer(),redeemScript:s}},r.prototype.setSingleKeyInput=function(e,i,s,n,o){if(!i)throw new Error("Full input base transaction required");this.psbt.setInputNonWitnessUtxo(e,i),this.psbt.setInputBip32Derivation(e,n,this.masterFp,o);var u=s.cond.redeemScript,c=this.createRedeemScript(n);if(u&&!c.equals(u))throw new Error("User-supplied redeemScript ".concat(u.toString("hex"),` doesn't
       match expected `).concat(c.toString("hex")," for input ").concat(e));this.psbt.setInputRedeemScript(e,c),this.psbt.setInputWitnessUtxo(e,s.amount,s.cond.scriptPubKey)},r.prototype.setSingleKeyOutput=function(e,i,s,n){this.psbt.setOutputRedeemScript(e,i.redeemScript),this.psbt.setOutputBip32Derivation(e,s,this.masterFp,n)},r.prototype.getDescriptorTemplate=function(){return"sh(wpkh(@0))"},r.prototype.createRedeemScript=function(e){var i=Ve(e);return Buffer.concat([Buffer.from("0014","hex"),i])},r}(Xt),Cf=function(t){ct(r,t);function r(){return t!==null&&t.apply(this,arguments)||this}return r.prototype.singleKeyCondition=function(e){var i=new Y,s=Ve(e);return i.writeSlice(Buffer.from([0,qt])),i.writeSlice(s),{scriptPubKey:i.buffer()}},r.prototype.setSingleKeyInput=function(e,i,s,n,o){if(!i)throw new Error("Full input base transaction required");this.psbt.setInputNonWitnessUtxo(e,i),this.psbt.setInputBip32Derivation(e,n,this.masterFp,o),this.psbt.setInputWitnessUtxo(e,s.amount,s.cond.scriptPubKey)},r.prototype.setSingleKeyOutput=function(e,i,s,n){this.psbt.setOutputBip32Derivation(e,s,this.masterFp,n)},r.prototype.getDescriptorTemplate=function(){return"wpkh(@0)"},r}(Xt),Pn=globalThis&&globalThis.__read||function(t,r){var e=typeof Symbol=="function"&&t[Symbol.iterator];if(!e)return t;var i=e.call(t),s,n=[],o;try{for(;(r===void 0||r-- >0)&&!(s=i.next()).done;)n.push(s.value)}catch(u){o={error:u}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(o)throw o.error}}return n},Ln=globalThis&&globalThis.__spreadArray||function(t,r,e){if(e||arguments.length===2)for(var i=0,s=r.length,n;i<s;i++)(n||!(i in r))&&(n||(n=Array.prototype.slice.call(r,0,i)),n[i]=r[i]);return t.concat(n||Array.prototype.slice.call(r))},Ke=function(){function t(r,e){e===void 0&&(e=Te.crypto.sha256),this.leaves=r,this.h=e;var i=this.calculateRoot(r);this.rootNode=i.root,this.leafNodes=i.leaves}return t.prototype.getRoot=function(){return this.rootNode.hash},t.prototype.size=function(){return this.leaves.length},t.prototype.getLeaves=function(){return this.leaves},t.prototype.getLeafHash=function(r){return this.leafNodes[r].hash},t.prototype.getProof=function(r){if(r>=this.leaves.length)throw Error("Index out of bounds");return xr(this.leafNodes[r])},t.prototype.calculateRoot=function(r){var e=r.length;if(e==0)return{root:new ir(void 0,void 0,Buffer.alloc(32,0)),leaves:[]};if(e==1){var i=new ir(void 0,void 0,r[0]);return{root:i,leaves:[i]}}var s=Uf(e),n=this.calculateRoot(r.slice(0,s)),o=this.calculateRoot(r.slice(s)),u=n.root,c=o.root,a=this.hashNode(u.hash,c.hash),f=new ir(u,c,a);return u.parent=f,c.parent=f,{root:f,leaves:n.leaves.concat(o.leaves)}},t.prototype.hashNode=function(r,e){return this.h(Buffer.concat([Buffer.from([1]),r,e]))},t}();function qe(t,r){return r===void 0&&(r=Te.crypto.sha256),Df(Buffer.from([0]),t,r)}function Df(t,r,e){return e(Buffer.concat([t,r]))}var ir=function(){function t(r,e,i){this.leftChild=r,this.rightChild=e,this.hash=i}return t.prototype.isLeaf=function(){return this.leftChild==null},t}();function xr(t){if(!t.parent)return[];if(t.parent.leftChild==t){if(!t.parent.rightChild)throw new Error("Expected right child to exist");return Ln([t.parent.rightChild.hash],Pn(xr(t.parent)),!1)}else{if(!t.parent.leftChild)throw new Error("Expected left child to exist");return Ln([t.parent.leftChild.hash],Pn(xr(t.parent)),!1)}}function Uf(t){if(t<2)throw Error("Expected n >= 2");return kf(t)?t/2:1<<Math.floor(Math.log2(t))}function kf(t){return(t&t-1)==0}var Cn=function(){function t(r,e){this.descriptorTemplate=r,this.keys=[e]}return t.prototype.getWalletId=function(){return Te.crypto.sha256(this.serialize())},t.prototype.serialize=function(){var r=this.keys.map(function(s){return Buffer.from(s,"ascii")}),e=new Ke(r.map(function(s){return qe(s)})),i=new Y;return i.writeUInt8(1),i.writeUInt8(0),i.writeVarSlice(Buffer.from(this.descriptorTemplate,"ascii")),i.writeVarInt(this.keys.length),i.writeSlice(e.getRoot()),i.buffer()},t}();function Dn(t,r,e){var i=Nr(r);return"[".concat(t.toString("hex")).concat(i.substring(1),"]").concat(e,"/**")}function Mf(t){var r,e,i=new Y;i.writeUInt32(t.getGlobalTxVersion());var s=!!t.getInputWitnessUtxo(0);s&&i.writeSlice(Buffer.from([0,1]));var n=t.getGlobalInputCount();i.writeVarInt(n);for(var o=new Y,u=0;u<n;u++)i.writeSlice(t.getInputPreviousTxid(u)),i.writeUInt32(t.getInputOutputIndex(u)),i.writeVarSlice((r=t.getInputFinalScriptsig(u))!==null&&r!==void 0?r:Buffer.from([])),i.writeUInt32(t.getInputSequence(u)),s&&o.writeSlice(t.getInputFinalScriptwitness(u));var c=t.getGlobalOutputCount();i.writeVarInt(c);for(var u=0;u<c;u++)i.writeUInt64(t.getOutputAmount(u)),i.writeVarSlice(t.getOutputScript(u));return i.writeSlice(o.buffer()),i.writeUInt32((e=t.getGlobalFallbackLocktime())!==null&&e!==void 0?e:0),i.buffer()}var Gf=globalThis&&globalThis.__extends||function(){var t=function(r,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(i[n]=s[n])},t(r,e)};return function(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");t(r,e);function i(){this.constructor=r}r.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),Er=globalThis&&globalThis.__assign||function(){return Er=Object.assign||function(t){for(var r,e=1,i=arguments.length;e<i;e++){r=arguments[e];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},Er.apply(this,arguments)},ne;(function(t){t[t.TX_VERSION=2]="TX_VERSION",t[t.FALLBACK_LOCKTIME=3]="FALLBACK_LOCKTIME",t[t.INPUT_COUNT=4]="INPUT_COUNT",t[t.OUTPUT_COUNT=5]="OUTPUT_COUNT",t[t.TX_MODIFIABLE=6]="TX_MODIFIABLE",t[t.VERSION=251]="VERSION"})(ne||(ne={}));var M;(function(t){t[t.NON_WITNESS_UTXO=0]="NON_WITNESS_UTXO",t[t.WITNESS_UTXO=1]="WITNESS_UTXO",t[t.PARTIAL_SIG=2]="PARTIAL_SIG",t[t.SIGHASH_TYPE=3]="SIGHASH_TYPE",t[t.REDEEM_SCRIPT=4]="REDEEM_SCRIPT",t[t.BIP32_DERIVATION=6]="BIP32_DERIVATION",t[t.FINAL_SCRIPTSIG=7]="FINAL_SCRIPTSIG",t[t.FINAL_SCRIPTWITNESS=8]="FINAL_SCRIPTWITNESS",t[t.PREVIOUS_TXID=14]="PREVIOUS_TXID",t[t.OUTPUT_INDEX=15]="OUTPUT_INDEX",t[t.SEQUENCE=16]="SEQUENCE",t[t.TAP_KEY_SIG=19]="TAP_KEY_SIG",t[t.TAP_BIP32_DERIVATION=22]="TAP_BIP32_DERIVATION"})(M||(M={}));var ue;(function(t){t[t.REDEEM_SCRIPT=0]="REDEEM_SCRIPT",t[t.BIP_32_DERIVATION=2]="BIP_32_DERIVATION",t[t.AMOUNT=3]="AMOUNT",t[t.SCRIPT=4]="SCRIPT",t[t.TAP_BIP32_DERIVATION=7]="TAP_BIP32_DERIVATION"})(ue||(ue={}));var Ff=Buffer.from([112,115,98,116,255]),Vf=function(t){Gf(r,t);function r(){return t!==null&&t.apply(this,arguments)||this}return r}(Error),ki=function(){function t(){this.globalMap=new Map,this.inputMaps=[],this.outputMaps=[]}return t.prototype.setGlobalTxVersion=function(r){this.setGlobal(ne.TX_VERSION,Ce(r))},t.prototype.getGlobalTxVersion=function(){return this.getGlobal(ne.TX_VERSION).readUInt32LE(0)},t.prototype.setGlobalFallbackLocktime=function(r){this.setGlobal(ne.FALLBACK_LOCKTIME,Ce(r))},t.prototype.getGlobalFallbackLocktime=function(){var r;return(r=this.getGlobalOptional(ne.FALLBACK_LOCKTIME))===null||r===void 0?void 0:r.readUInt32LE(0)},t.prototype.setGlobalInputCount=function(r){this.setGlobal(ne.INPUT_COUNT,Un(r))},t.prototype.getGlobalInputCount=function(){return kn(this.getGlobal(ne.INPUT_COUNT))},t.prototype.setGlobalOutputCount=function(r){this.setGlobal(ne.OUTPUT_COUNT,Un(r))},t.prototype.getGlobalOutputCount=function(){return kn(this.getGlobal(ne.OUTPUT_COUNT))},t.prototype.setGlobalTxModifiable=function(r){this.setGlobal(ne.TX_MODIFIABLE,r)},t.prototype.getGlobalTxModifiable=function(){return this.getGlobalOptional(ne.TX_MODIFIABLE)},t.prototype.setGlobalPsbtVersion=function(r){this.setGlobal(ne.VERSION,Ce(r))},t.prototype.getGlobalPsbtVersion=function(){return this.getGlobal(ne.VERSION).readUInt32LE(0)},t.prototype.setInputNonWitnessUtxo=function(r,e){this.setInput(r,M.NON_WITNESS_UTXO,K(),e)},t.prototype.getInputNonWitnessUtxo=function(r){return this.getInputOptional(r,M.NON_WITNESS_UTXO,K())},t.prototype.setInputWitnessUtxo=function(r,e,i){var s=new Y;s.writeSlice(e),s.writeVarSlice(i),this.setInput(r,M.WITNESS_UTXO,K(),s.buffer())},t.prototype.getInputWitnessUtxo=function(r){var e=this.getInputOptional(r,M.WITNESS_UTXO,K());if(e){var i=new Ie(e);return{amount:i.readSlice(8),scriptPubKey:i.readVarSlice()}}},t.prototype.setInputPartialSig=function(r,e,i){this.setInput(r,M.PARTIAL_SIG,e,i)},t.prototype.getInputPartialSig=function(r,e){return this.getInputOptional(r,M.PARTIAL_SIG,e)},t.prototype.setInputSighashType=function(r,e){this.setInput(r,M.SIGHASH_TYPE,K(),Ce(e))},t.prototype.getInputSighashType=function(r){var e=this.getInputOptional(r,M.SIGHASH_TYPE,K());if(e)return e.readUInt32LE(0)},t.prototype.setInputRedeemScript=function(r,e){this.setInput(r,M.REDEEM_SCRIPT,K(),e)},t.prototype.getInputRedeemScript=function(r){return this.getInputOptional(r,M.REDEEM_SCRIPT,K())},t.prototype.setInputBip32Derivation=function(r,e,i,s){if(e.length!=33)throw new Error("Invalid pubkey length: "+e.length);this.setInput(r,M.BIP32_DERIVATION,e,this.encodeBip32Derivation(i,s))},t.prototype.getInputBip32Derivation=function(r,e){var i=this.getInputOptional(r,M.BIP32_DERIVATION,e);if(i)return this.decodeBip32Derivation(i)},t.prototype.setInputFinalScriptsig=function(r,e){this.setInput(r,M.FINAL_SCRIPTSIG,K(),e)},t.prototype.getInputFinalScriptsig=function(r){return this.getInputOptional(r,M.FINAL_SCRIPTSIG,K())},t.prototype.setInputFinalScriptwitness=function(r,e){this.setInput(r,M.FINAL_SCRIPTWITNESS,K(),e)},t.prototype.getInputFinalScriptwitness=function(r){return this.getInput(r,M.FINAL_SCRIPTWITNESS,K())},t.prototype.setInputPreviousTxId=function(r,e){this.setInput(r,M.PREVIOUS_TXID,K(),e)},t.prototype.getInputPreviousTxid=function(r){return this.getInput(r,M.PREVIOUS_TXID,K())},t.prototype.setInputOutputIndex=function(r,e){this.setInput(r,M.OUTPUT_INDEX,K(),Ce(e))},t.prototype.getInputOutputIndex=function(r){return this.getInput(r,M.OUTPUT_INDEX,K()).readUInt32LE(0)},t.prototype.setInputSequence=function(r,e){this.setInput(r,M.SEQUENCE,K(),Ce(e))},t.prototype.getInputSequence=function(r){var e,i;return(i=(e=this.getInputOptional(r,M.SEQUENCE,K()))===null||e===void 0?void 0:e.readUInt32LE(0))!==null&&i!==void 0?i:4294967295},t.prototype.setInputTapKeySig=function(r,e){this.setInput(r,M.TAP_KEY_SIG,K(),e)},t.prototype.getInputTapKeySig=function(r){return this.getInputOptional(r,M.TAP_KEY_SIG,K())},t.prototype.setInputTapBip32Derivation=function(r,e,i,s,n){if(e.length!=32)throw new Error("Invalid pubkey length: "+e.length);var o=this.encodeTapBip32Derivation(i,s,n);this.setInput(r,M.TAP_BIP32_DERIVATION,e,o)},t.prototype.getInputTapBip32Derivation=function(r,e){var i=this.getInput(r,M.TAP_BIP32_DERIVATION,e);return this.decodeTapBip32Derivation(i)},t.prototype.getInputKeyDatas=function(r,e){return this.getKeyDatas(this.inputMaps[r],e)},t.prototype.setOutputRedeemScript=function(r,e){this.setOutput(r,ue.REDEEM_SCRIPT,K(),e)},t.prototype.getOutputRedeemScript=function(r){return this.getOutput(r,ue.REDEEM_SCRIPT,K())},t.prototype.setOutputBip32Derivation=function(r,e,i,s){this.setOutput(r,ue.BIP_32_DERIVATION,e,this.encodeBip32Derivation(i,s))},t.prototype.getOutputBip32Derivation=function(r,e){var i=this.getOutput(r,ue.BIP_32_DERIVATION,e);return this.decodeBip32Derivation(i)},t.prototype.setOutputAmount=function(r,e){this.setOutput(r,ue.AMOUNT,K(),Xf(e))},t.prototype.getOutputAmount=function(r){var e=this.getOutput(r,ue.AMOUNT,K());return Pi(e)},t.prototype.setOutputScript=function(r,e){this.setOutput(r,ue.SCRIPT,K(),e)},t.prototype.getOutputScript=function(r){return this.getOutput(r,ue.SCRIPT,K())},t.prototype.setOutputTapBip32Derivation=function(r,e,i,s,n){var o=this.encodeTapBip32Derivation(i,s,n);this.setOutput(r,ue.TAP_BIP32_DERIVATION,e,o)},t.prototype.getOutputTapBip32Derivation=function(r,e){var i=this.getOutput(r,ue.TAP_BIP32_DERIVATION,e);return this.decodeTapBip32Derivation(i)},t.prototype.deleteInputEntries=function(r,e){var i=this,s=this.inputMaps[r];s.forEach(function(n,o,u){i.isKeyType(o,e)&&u.delete(o)})},t.prototype.copy=function(r){this.copyMap(this.globalMap,r.globalMap),this.copyMaps(this.inputMaps,r.inputMaps),this.copyMaps(this.outputMaps,r.outputMaps)},t.prototype.copyMaps=function(r,e){var i=this;r.forEach(function(s,n){var o=new Map;i.copyMap(s,o),e[n]=o})},t.prototype.copyMap=function(r,e){r.forEach(function(i,s){return e.set(s,Buffer.from(i))})},t.prototype.serialize=function(){var r=new Y;return r.writeSlice(Buffer.from([112,115,98,116,255])),sr(r,this.globalMap),this.inputMaps.forEach(function(e){sr(r,e)}),this.outputMaps.forEach(function(e){sr(r,e)}),r.buffer()},t.prototype.deserialize=function(r){var e=new Ie(r);if(!e.readSlice(5).equals(Ff))throw new Error("Invalid magic bytes");for(;this.readKeyPair(this.globalMap,e););for(var i=0;i<this.getGlobalInputCount();i++)for(this.inputMaps[i]=new Map;this.readKeyPair(this.inputMaps[i],e););for(var i=0;i<this.getGlobalOutputCount();i++)for(this.outputMaps[i]=new Map;this.readKeyPair(this.outputMaps[i],e););},t.prototype.readKeyPair=function(r,e){var i=e.readVarInt();if(i==0)return!1;var s=e.readUInt8(),n=e.readSlice(i-1),o=e.readVarSlice();return ar(r,s,n,o),!0},t.prototype.getKeyDatas=function(r,e){var i=this,s=[];return r.forEach(function(n,o){i.isKeyType(o,[e])&&s.push(Buffer.from(o.substring(2),"hex"))}),s},t.prototype.isKeyType=function(r,e){var i=Buffer.from(r.substring(0,2),"hex").readUInt8(0);return e.some(function(s){return s==i})},t.prototype.setGlobal=function(r,e){var i=new Ht(r,Buffer.from([]));this.globalMap.set(i.toString(),e)},t.prototype.getGlobal=function(r){return Ye(this.globalMap,r,K(),!1)},t.prototype.getGlobalOptional=function(r){return Ye(this.globalMap,r,K(),!0)},t.prototype.setInput=function(r,e,i,s){ar(this.getMap(r,this.inputMaps),e,i,s)},t.prototype.getInput=function(r,e,i){return Ye(this.inputMaps[r],e,i,!1)},t.prototype.getInputOptional=function(r,e,i){return Ye(this.inputMaps[r],e,i,!0)},t.prototype.setOutput=function(r,e,i,s){ar(this.getMap(r,this.outputMaps),e,i,s)},t.prototype.getOutput=function(r,e,i){return Ye(this.outputMaps[r],e,i,!1)},t.prototype.getMap=function(r,e){return e[r]?e[r]:e[r]=new Map},t.prototype.encodeBip32Derivation=function(r,e){var i=new Y;return this.writeBip32Derivation(i,r,e),i.buffer()},t.prototype.decodeBip32Derivation=function(r){var e=new Ie(r);return this.readBip32Derivation(e)},t.prototype.writeBip32Derivation=function(r,e,i){r.writeSlice(e),i.forEach(function(s){r.writeUInt32(s)})},t.prototype.readBip32Derivation=function(r){for(var e=r.readSlice(4),i=[];r.offset<r.buffer.length;)i.push(r.readUInt32());return{masterFingerprint:e,path:i}},t.prototype.encodeTapBip32Derivation=function(r,e,i){var s=new Y;return s.writeVarInt(r.length),r.forEach(function(n){s.writeSlice(n)}),this.writeBip32Derivation(s,e,i),s.buffer()},t.prototype.decodeTapBip32Derivation=function(r){for(var e=new Ie(r),i=e.readVarInt(),s=[],n=0;n<i;n++)s.push(e.readSlice(32));var o=this.readBip32Derivation(e);return Er({hashes:s},o)},t}();function Ye(t,r,e,i){if(!t)throw Error("No such map");var s=new Ht(r,e),n=t.get(s.toString());if(!n){if(i)return;throw new Vf(s.toString())}return Buffer.from(n)}var Ht=function(){function t(r,e){this.keyType=r,this.keyData=e}return t.prototype.toString=function(){var r=new Y;return this.toBuffer(r),r.buffer().toString("hex")},t.prototype.serialize=function(r){r.writeVarInt(1+this.keyData.length),this.toBuffer(r)},t.prototype.toBuffer=function(r){r.writeUInt8(this.keyType),r.writeSlice(this.keyData)},t}(),Kf=function(){function t(r,e){this.key=r,this.value=e}return t.prototype.serialize=function(r){this.key.serialize(r),r.writeVarSlice(this.value)},t}();function qf(t){return new Ht(t.readUInt8(0),t.slice(1))}function sr(t,r){for(var e in r.keys){var i=r.get(e),s=new Kf(qf(Buffer.from(e,"hex")),i);s.serialize(t)}t.writeUInt8(0)}function K(){return Buffer.from([])}function ar(t,r,e,i){var s=new Ht(r,e);t.set(s.toString(),i)}function Ce(t){var r=Buffer.alloc(4);return r.writeUInt32LE(t,0),r}function Xf(t){return Ni(t)}function Un(t){var r=new Y;return r.writeVarInt(t),r.buffer()}function kn(t){return new Ie(t).readVarInt()}function Hf(t){for(var r=t.getGlobalInputCount(),e=0;e<r;e++){var i=t.getInputKeyDatas(e,M.PARTIAL_SIG),s=t.getInputTapKeySig(e);if(i.length==0&&!s)throw Error("No signature for input ".concat(e," present"));if(i.length>0){if(i.length>1)throw Error("Expected exactly one signature, got ".concat(i.length));if(s)throw Error("Both taproot and non-taproot signatures present.");var n=!!t.getInputWitnessUtxo(e),o=t.getInputRedeemScript(e),u=!!o,c=t.getInputPartialSig(e,i[0]);if(!c)throw new Error("Expected partial signature for input "+e);if(n){var a=new Y;if(a.writeVarInt(2),a.writeVarInt(c.length),a.writeSlice(c),a.writeVarInt(i[0].length),a.writeSlice(i[0]),t.setInputFinalScriptwitness(e,a.buffer()),u){if(!o||o.length==0)throw new Error("Expected non-empty redeemscript. Can't finalize intput "+e);var f=new Y;f.writeUInt8(o.length),f.writeSlice(o),t.setInputFinalScriptsig(e,f.buffer())}}else{var l=new Y;Mn(l,c),Mn(l,i[0]),t.setInputFinalScriptsig(e,l.buffer())}}else{var c=t.getInputTapKeySig(e);if(!c)throw Error("No taproot signature found");if(c.length!=64&&c.length!=65)throw Error("Unexpected length of schnorr signature.");var a=new Y;a.writeVarInt(1),a.writeVarSlice(c),t.setInputFinalScriptwitness(e,a.buffer())}jf(t,e)}}function jf(t,r){var e=[M.BIP32_DERIVATION,M.PARTIAL_SIG,M.TAP_BIP32_DERIVATION,M.TAP_KEY_SIG],i=!!t.getInputWitnessUtxo(r),s=!!t.getInputNonWitnessUtxo(r);i&&s&&e.push(M.NON_WITNESS_UTXO),t.deleteInputEntries(r,e)}function Mn(t,r){if(r.length<=75)t.writeUInt8(r.length);else if(r.length<=256)t.writeUInt8(76),t.writeUInt8(r.length);else if(r.length<=256*256){t.writeUInt8(77);var e=Buffer.alloc(2);e.writeUInt16LE(r.length,0),t.writeSlice(e)}t.writeSlice(r)}function De(t,r){if(t[r]<253)return[t[r],1];if(t[r]===253)return[(t[r+2]<<8)+t[r+1],3];if(t[r]===254)return[(t[r+4]<<24)+(t[r+3]<<16)+(t[r+2]<<8)+t[r+1],5];throw new Error("getVarint called with unexpected parameters")}function z(t){if(t<253){var r=Buffer.alloc(1);return r[0]=t,r}if(t<=65535){var e=Buffer.alloc(3);return e[0]=253,e[1]=t&255,e[2]=t>>8&255,e}var i=Buffer.alloc(5);return i[0]=254,i[1]=t&255,i[2]=t>>8&255,i[3]=t>>16&255,i[4]=t>>24&255,i}function Mi(t){var r=t.outputs,e=Buffer.alloc(0);return typeof r<"u"&&(e=Buffer.concat([e,z(r.length)]),r.forEach(function(i){e=Buffer.concat([e,i.amount,z(i.script.length),i.script])})),e}function Xr(t,r,e,i){i===void 0&&(i=[]);var s=i.includes("decred"),n=i.includes("zcash"),o=i.includes("bech32"),u=Buffer.alloc(0),c=typeof t.witness<"u"&&!r;t.inputs.forEach(function(f){u=s||o?Buffer.concat([u,f.prevout,Buffer.from([0]),f.sequence]):Buffer.concat([u,f.prevout,z(f.script.length),f.script,f.sequence])});var a=Mi(t);return typeof t.outputs<"u"&&typeof t.locktime<"u"&&(a=Buffer.concat([a,c&&t.witness||Buffer.alloc(0),t.locktime,t.nExpiryHeight||Buffer.alloc(0),t.extraData||Buffer.alloc(0)])),n?Buffer.concat([t.version,t.nVersionGroupId||Buffer.alloc(0),Buffer.from([180,208,214,194]),t.locktime||Buffer.from([0,0,0,0]),t.nExpiryHeight||Buffer.from([0,0,0,0]),c?Buffer.from("0001","hex"):Buffer.alloc(0),z(t.inputs.length),u,a]):Buffer.concat([t.version,e||Buffer.alloc(0),t.nVersionGroupId||Buffer.alloc(0),c?Buffer.from("0001","hex"):Buffer.alloc(0),z(t.inputs.length),u,a])}var _e=globalThis&&globalThis.__awaiter||function(t,r,e,i){function s(n){return n instanceof e?n:new e(function(o){o(n)})}return new(e||(e=Promise))(function(n,o){function u(f){try{a(i.next(f))}catch(l){o(l)}}function c(f){try{a(i.throw(f))}catch(l){o(l)}}function a(f){f.done?n(f.value):s(f.value).then(u,c)}a((i=i.apply(t,r||[])).next())})},be=globalThis&&globalThis.__generator||function(t,r){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,o;return o={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function u(a){return function(f){return c([a,f])}}function c(a){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,s&&(n=a[0]&2?s.return:a[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,a[1])).done)return n;switch(s=0,n&&(a=[a[0]&2,n.value]),a[0]){case 0:case 1:n=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,s=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!n||a[1]>n[0]&&a[1]<n[3])){e.label=a[1];break}if(a[0]===6&&e.label<n[1]){e.label=n[1],n=a;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(a);break}n[2]&&e.ops.pop(),e.trys.pop();continue}a=r.call(t,e)}catch(f){a=[6,f],s=0}finally{i=n=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},Wf=["Bitcoin","Bitcoin Test"];function zf(t){return Wf.includes(t.name)&&mi.major(t.version)>=2}var Gn=function(){function t(r){this.client=r}return t.prototype.getWalletXpub=function(r){var e=r.path,i=r.xpubVersion;return _e(this,void 0,void 0,function(){var s,n,o;return be(this,function(u){switch(u.label){case 0:return s=xe(e),[4,this.client.getExtendedPubkey(!1,s)];case 1:if(n=u.sent(),o=fn(n),o.version!=i)throw new Error("Expected xpub version ".concat(i," doesn't match the xpub version from the device ").concat(o.version));return[2,n]}})})},t.prototype.getWalletPublicKey=function(r,e){var i,s;return _e(this,void 0,void 0,function(){var n,o,u,c,a,f;return be(this,function(l){switch(l.label){case 0:return n=xe(r),[4,this.client.getExtendedPubkey(!1,n)];case 1:return o=l.sent(),u=(i=e==null?void 0:e.verify)!==null&&i!==void 0?i:!1,[4,this.getWalletAddress(n,Yf((s=e==null?void 0:e.format)!==null&&s!==void 0?s:"legacy"),u)];case 2:return c=l.sent(),a=fn(o),f=Buffer.from(Ai.pointCompress(a.pubkey,!1)),[2,{publicKey:f.toString("hex"),bitcoinAddress:c,chainCode:a.chaincode.toString("hex")}]}})})},t.prototype.getWalletAddress=function(r,e,i){return _e(this,void 0,void 0,function(){var s,n,o,u,c;return be(this,function(a){switch(a.label){case 0:return s=ia(r),s.length+2!=r.length?[2,""]:[4,this.client.getExtendedPubkey(!1,s)];case 1:return n=a.sent(),[4,this.client.getMasterFingerprint()];case 2:return o=a.sent(),u=new Cn(e,Dn(o,s,n)),c=r.slice(-2,r.length),[2,this.client.getWalletAddress(u,Buffer.alloc(32,0),c[0],c[1],i)]}})})},t.prototype.createPaymentTransactionNew=function(r){return _e(this,void 0,void 0,function(){var e,i,s,n,o,u,c,a,E,f,l,v,h,x,m,E,B,p,$,R,P,I,U,L,H,A;return be(this,function(k){switch(k.label){case 0:if(e=r.inputs.length,e==0)throw Error("No inputs");return i=new ki,[4,this.client.getMasterFingerprint()];case 1:s=k.sent(),n=Zf(r,i,s),r.lockTime!=null&&i.setGlobalFallbackLocktime(r.lockTime),i.setGlobalInputCount(e),i.setGlobalPsbtVersion(2),i.setGlobalTxVersion(2),o=0,u=function(){r.onDeviceStreaming&&r.onDeviceStreaming({total:2*e,index:o,progress:++o/(2*e)})},c="",a=[],E=0,k.label=2;case 2:return E<e?(u(),f=xe(r.associatedKeysets[E]),c!=""?[3,4]:(a=f.slice(0,-2),[4,this.client.getExtendedPubkey(!1,a)])):[3,7];case 3:c=k.sent(),k.label=4;case 4:return[4,this.setInput(i,E,r.inputs[E],f,n,s,r.sigHashType)];case 5:k.sent(),k.label=6;case 6:return E++,[3,2];case 7:return l=Buffer.from(r.outputScriptHex,"hex"),v=new Ie(l),h=v.readVarInt(),i.setGlobalOutputCount(h),[4,this.outputScriptAt(a,n,r.changePath)];case 8:for(x=k.sent(),m=!x,E=0;E<h;E++)B=Number(v.readUInt64()),p=v.readVarSlice(),i.setOutputAmount(E,B),i.setOutputScript(E,p),$=x&&p.equals(x==null?void 0:x.cond.scriptPubKey),$&&(m=!0,R=xe(r.changePath),P=x.pubkey,n.setOwnOutput(E,x.cond,[P],[R]));if(!m)throw new Error("Change script not found among outputs! "+(x==null?void 0:x.cond.scriptPubKey.toString("hex")));return I=Dn(s,a,c),U=new Cn(n.getDescriptorTemplate(),I),r.onDeviceSignatureRequested&&r.onDeviceSignatureRequested(),L=!1,H=function(){L||(L=!0,r.onDeviceSignatureGranted&&r.onDeviceSignatureGranted()),u()},[4,this.signPsbt(i,U,H)];case 9:return k.sent(),Hf(i),A=Mf(i),[2,A.toString("hex")]}})})},t.prototype.outputScriptAt=function(r,e,i){return _e(this,void 0,void 0,function(){var s,n,o,u,c;return be(this,function(a){switch(a.label){case 0:if(!i)return[2,void 0];for(s=xe(i),n=0;n<r.length;n++)if(r[n]!=s[n])throw new Error("Path ".concat(i," not in account ").concat(Nr(r)));return[4,this.client.getExtendedPubkey(!1,s)];case 1:return o=a.sent(),u=un(o),c=e.spendingCondition([u]),[2,{cond:c,pubkey:u}]}})})},t.prototype.setInput=function(r,e,i,s,n,o,u){return _e(this,void 0,void 0,function(){var c,a,f,l,v,h,x,m,E,B,p;return be(this,function($){switch($.label){case 0:return c=i[0],a=i[1],f=i[2]?Buffer.from(i[2],"hex"):void 0,l=i[3],l!=null&&r.setInputSequence(e,l),u!=null&&r.setInputSighashType(e,u),v=Xr(c,!0),h=Te.crypto.hash256(v),[4,this.client.getExtendedPubkey(!1,s)];case 1:if(x=$.sent(),m=un(x),!c.outputs)throw Error("Missing outputs array in transaction to sign");return E=c.outputs[a],B={scriptPubKey:E.script,redeemScript:f},p={cond:B,amount:E.amount},n.setInput(e,v,p,[m],[s]),r.setInputPreviousTxId(e,h),r.setInputOutputIndex(e,a),[2]}})})},t.prototype.signPsbt=function(r,e,i){return _e(this,void 0,void 0,function(){var s;return be(this,function(n){switch(n.label){case 0:return[4,this.client.signPsbt(r,e,Buffer.alloc(32,0),i)];case 1:return s=n.sent(),s.forEach(function(o,u){var c=r.getInputKeyDatas(u,M.BIP32_DERIVATION),a;if(c.length!=1){if(a=r.getInputKeyDatas(u,M.TAP_BIP32_DERIVATION),a.length==0)throw Error("Missing pubkey derivation for input ".concat(u));r.setInputTapKeySig(u,o)}else a=c[0],r.setInputPartialSig(u,a,o)}),[2]}})})},t}();function Yf(t){if(t=="legacy")return"pkh(@0)";if(t=="p2sh")return"sh(wpkh(@0))";if(t=="bech32")return"wpkh(@0)";if(t=="bech32m")return"tr(@0)";throw new Error("Unsupported address format "+t)}function Zf(t,r,e){return t.additionals.includes("bech32m")?new Pf(r,e):t.additionals.includes("bech32")?new Cf(r,e):t.segwit?new Lf(r,e):new Nf(r,e)}var wr=globalThis&&globalThis.__assign||function(){return wr=Object.assign||function(t){for(var r,e=1,i=arguments.length;e<i;e++){r=arguments[e];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},wr.apply(this,arguments)},Qf=globalThis&&globalThis.__awaiter||function(t,r,e,i){function s(n){return n instanceof e?n:new e(function(o){o(n)})}return new(e||(e=Promise))(function(n,o){function u(f){try{a(i.next(f))}catch(l){o(l)}}function c(f){try{a(i.throw(f))}catch(l){o(l)}}function a(f){f.done?n(f.value):s(f.value).then(u,c)}a((i=i.apply(t,r||[])).next())})},Jf=globalThis&&globalThis.__generator||function(t,r){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,o;return o={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function u(a){return function(f){return c([a,f])}}function c(a){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,s&&(n=a[0]&2?s.return:a[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,a[1])).done)return n;switch(s=0,n&&(a=[a[0]&2,n.value]),a[0]){case 0:case 1:n=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,s=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!n||a[1]>n[0]&&a[1]<n[3])){e.label=a[1];break}if(a[0]===6&&e.label<n[1]){e.label=n[1],n=a;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(a);break}n[2]&&e.ops.pop(),e.trys.pop();continue}a=r.call(t,e)}catch(f){a=[6,f],s=0}finally{i=n=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},Fn={legacy:0,p2sh:1,bech32:2,cashaddr:3};function yr(t,r){return Qf(this,void 0,void 0,function(){var e,i,s,n,o,u,c,a,f,l,v,h,x;return Jf(this,function(m){switch(m.label){case 0:if(e=wr({verify:!1,format:"legacy"},r),i=e.path,s=e.verify,n=e.format,!(n in Fn))throw new Error("btc.getWalletPublicKey invalid format="+n);return o=Or(i),u=s?1:0,c=Fn[n],[4,t.send(224,64,u,c,o)];case 1:return a=m.sent(),f=a[0],l=a[1+f],v=a.slice(1,1+f).toString("hex"),h=a.slice(1+f+1,1+f+1+l).toString("ascii"),x=a.slice(1+f+1+l,1+f+1+l+32).toString("hex"),[2,{publicKey:v,bitcoinAddress:h,chainCode:x}]}})})}var _r=globalThis&&globalThis.__awaiter||function(t,r,e,i){function s(n){return n instanceof e?n:new e(function(o){o(n)})}return new(e||(e=Promise))(function(n,o){function u(f){try{a(i.next(f))}catch(l){o(l)}}function c(f){try{a(i.throw(f))}catch(l){o(l)}}function a(f){f.done?n(f.value):s(f.value).then(u,c)}a((i=i.apply(t,r||[])).next())})},br=globalThis&&globalThis.__generator||function(t,r){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,o;return o={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function u(a){return function(f){return c([a,f])}}function c(a){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,s&&(n=a[0]&2?s.return:a[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,a[1])).done)return n;switch(s=0,n&&(a=[a[0]&2,n.value]),a[0]){case 0:case 1:n=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,s=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!n||a[1]>n[0]&&a[1]<n[3])){e.label=a[1];break}if(a[0]===6&&e.label<n[1]){e.label=n[1],n=a;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(a);break}n[2]&&e.ops.pop(),e.trys.pop();continue}a=r.call(t,e)}catch(f){a=[6,f],s=0}finally{i=n=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},or=globalThis&&globalThis.__values||function(t){var r=typeof Symbol=="function"&&Symbol.iterator,e=r&&t[r],i=0;if(e)return e.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")};function Ue(t,r,e){return _r(this,void 0,void 0,function(){var i,s,n,o,u;return br(this,function(c){switch(c.label){case 0:return s=!1,typeof e=="number"?(s=!0,n=Buffer.alloc(4),n.writeUInt32BE(e,0),i=Buffer.concat([n,r],r.length+4)):i=r,[4,t.send(224,66,s?0:128,0,i)];case 1:return o=c.sent(),u=o.slice(0,o.length-2).toString("hex"),[2,u]}})})}function Hr(t,r,e,i){return i===void 0&&(i=[]),_r(this,void 0,void 0,function(){var s,n,o,u,c,a,f,l,v,h,x,m,E,B,p,A,$,R,P,I,A,U,L,H,A,k,N,d,g,_,T=this;return br(this,function(w){switch(w.label){case 0:if(s=e.version,n=e.inputs,o=e.outputs,u=e.locktime,c=e.nExpiryHeight,a=e.extraData,!o||!u)throw new Error("getTrustedInput: locktime & outputs is expected");return f=i.includes("decred"),l=i.includes("stealthcoin"),v=function(y,O){return _r(T,void 0,void 0,function(){var S,b,D,q,F,j,X,te,pe,ve,je;return br(this,function(se){switch(se.label){case 0:for(S=O||Buffer.alloc(0),b=[],D=0;D!==y.length;)q=y.length-D>ye?ye:y.length-D,D+q!==y.length?b.push(y.slice(D,D+q)):b.push(Buffer.concat([y.slice(D,D+q),S])),D+=q;y.length===0&&b.push(S),se.label=1;case 1:se.trys.push([1,6,7,8]),j=or(b),X=j.next(),se.label=2;case 2:return X.done?[3,5]:(te=X.value,[4,Ue(t,te)]);case 3:F=se.sent(),se.label=4;case 4:return X=j.next(),[3,2];case 5:return[3,8];case 6:return pe=se.sent(),ve={error:pe},[3,8];case 7:try{X&&!X.done&&(je=j.return)&&je.call(j)}finally{if(ve)throw ve.error}return[7];case 8:return[2,F]}})})},h=function(y){return Ue(t,y)},[4,Ue(t,Buffer.concat([e.version,e.timestamp||Buffer.alloc(0),e.nVersionGroupId||Buffer.alloc(0),z(n.length)]),r)];case 1:w.sent(),w.label=2;case 2:w.trys.push([2,8,9,10]),x=or(n),m=x.next(),w.label=3;case 3:return m.done?[3,7]:(E=m.value,B=l&&Buffer.compare(s,Buffer.from([2,0,0,0]))===0,p=f?E.tree||Buffer.from([0]):Buffer.alloc(0),A=Buffer.concat([E.prevout,p,B?Buffer.from([0]):z(E.script.length)]),[4,Ue(t,A)]);case 4:return w.sent(),[4,f?h(Buffer.concat([E.script,E.sequence])):B?h(E.sequence):v(E.script,E.sequence)];case 5:w.sent(),w.label=6;case 6:return m=x.next(),[3,3];case 7:return[3,10];case 8:return $=w.sent(),N={error:$},[3,10];case 9:try{m&&!m.done&&(d=x.return)&&d.call(x)}finally{if(N)throw N.error}return[7];case 10:return[4,Ue(t,z(o.length))];case 11:w.sent(),w.label=12;case 12:w.trys.push([12,17,18,19]),R=or(o),P=R.next(),w.label=13;case 13:return P.done?[3,16]:(I=P.value,A=Buffer.concat([I.amount,f?Buffer.from([0,0]):Buffer.alloc(0),z(I.script.length),I.script]),[4,Ue(t,A)]);case 14:w.sent(),w.label=15;case 15:return P=R.next(),[3,13];case 16:return[3,19];case 17:return U=w.sent(),g={error:U},[3,19];case 18:try{P&&!P.done&&(_=R.return)&&_.call(R)}finally{if(g)throw g.error}return[7];case 19:return L=[],c&&c.length>0&&L.push(c),a&&a.length>0&&L.push(a),L.length&&(A=Buffer.concat(L),H=f?A:Buffer.concat([z(A.length),A])),[4,v(Buffer.concat([u,H||Buffer.alloc(0)]))];case 20:return k=w.sent(),ei.invariant(k,"missing result in processScriptBlocks"),[2,k]}})})}var ec=globalThis&&globalThis.__awaiter||function(t,r,e,i){function s(n){return n instanceof e?n:new e(function(o){o(n)})}return new(e||(e=Promise))(function(n,o){function u(f){try{a(i.next(f))}catch(l){o(l)}}function c(f){try{a(i.throw(f))}catch(l){o(l)}}function a(f){f.done?n(f.value):s(f.value).then(u,c)}a((i=i.apply(t,r||[])).next())})},tc=globalThis&&globalThis.__generator||function(t,r){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,o;return o={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function u(a){return function(f){return c([a,f])}}function c(a){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,s&&(n=a[0]&2?s.return:a[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,a[1])).done)return n;switch(s=0,n&&(a=[a[0]&2,n.value]),a[0]){case 0:case 1:n=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,s=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!n||a[1]>n[0]&&a[1]<n[3])){e.label=a[1];break}if(a[0]===6&&e.label<n[1]){e.label=n[1],n=a;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(a);break}n[2]&&e.ops.pop(),e.trys.pop();continue}a=r.call(t,e)}catch(f){a=[6,f],s=0}finally{i=n=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},Vn=globalThis&&globalThis.__values||function(t){var r=typeof Symbol=="function"&&Symbol.iterator,e=r&&t[r],i=0;if(e)return e.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")};function ur(t,r,e,i,s,n,o){s===void 0&&(s=!1),n===void 0&&(n=!1),o===void 0&&(o=[]);var u=o.includes("cashaddr")?3:s?o.includes("sapling")?5:n?4:2:0;return t.send(224,68,e?0:128,r?u:128,i)}function Tt(t,r,e,i,s,n,o,u){return s===void 0&&(s=!1),n===void 0&&(n=!1),o===void 0&&(o=[]),u===void 0&&(u=!1),ec(this,void 0,void 0,function(){var c,a,f,l,v,h,x,m,E,B,p,$,R,P,I,U,L,H,A,k;return tc(this,function(N){switch(N.label){case 0:return c=Buffer.concat([e.version,e.timestamp||Buffer.alloc(0),e.nVersionGroupId||Buffer.alloc(0),z(e.inputs.length)]),[4,ur(t,r,!0,c,s,n,o)];case 1:N.sent(),a=0,f=o.includes("decred"),N.label=2;case 2:N.trys.push([2,15,16,17]),l=Vn(e.inputs),v=l.next(),N.label=3;case 3:return v.done?[3,14]:(h=v.value,x=void 0,m=i[a].value,s?u&&i[a].trustedInput?x=Buffer.from([1,m.length]):x=Buffer.from([2]):i[a].trustedInput?x=Buffer.from([1,i[a].value.length]):x=Buffer.from([0]),c=Buffer.concat([x,m,f?Buffer.from([0]):Buffer.alloc(0),z(h.script.length)]),[4,ur(t,r,!1,c,s,n,o)]);case 4:if(N.sent(),E=[],B=0,h.script.length===0)E.push(h.sequence);else for(;B!==h.script.length;)p=h.script.length-B>ye?ye:h.script.length-B,B+p!==h.script.length?E.push(h.script.slice(B,B+p)):E.push(Buffer.concat([h.script.slice(B,B+p),h.sequence])),B+=p;N.label=5;case 5:N.trys.push([5,10,11,12]),$=(A=void 0,Vn(E)),R=$.next(),N.label=6;case 6:return R.done?[3,9]:(P=R.value,[4,ur(t,r,!1,P,s,n,o)]);case 7:N.sent(),N.label=8;case 8:return R=$.next(),[3,6];case 9:return[3,12];case 10:return I=N.sent(),A={error:I},[3,12];case 11:try{R&&!R.done&&(k=$.return)&&k.call($)}finally{if(A)throw A.error}return[7];case 12:a++,N.label=13;case 13:return v=l.next(),[3,3];case 14:return[3,17];case 15:return U=N.sent(),L={error:U},[3,17];case 16:try{v&&!v.done&&(H=l.return)&&H.call(l)}finally{if(L)throw L.error}return[7];case 17:return[2]}})})}function jr(t,r,e,i){if(i===void 0&&(i=[]),!e)throw new Error("getTrustedInputBIP143: missing tx");var s=i.includes("decred");if(s)throw new Error("Decred does not implement BIP143");var n=yt("sha256").update(yt("sha256").update(Xr(e,!0)).digest()).digest(),o=Buffer.alloc(4);o.writeUInt32LE(r,0);var u=e.outputs,c=e.locktime;if(!u||!c)throw new Error("getTrustedInputBIP143: locktime & outputs is expected");if(!u[r])throw new Error("getTrustedInputBIP143: wrong index");return n=Buffer.concat([n,o,u[r].amount]),n.toString("hex")}function rc(t){var r=t[64]&1?3:2,e=Buffer.alloc(1);return e[0]=r,Buffer.concat([e,t.slice(1,1+32)])}function mr(t,r,e,i,s,n){n===void 0&&(n=[]);var o=n.includes("decred"),u=Or(r),c=Buffer.alloc(4);c.writeUInt32BE(e,0);var a=o?Buffer.concat([u,c,s||Buffer.from([0,0,0,0]),Buffer.from([i])]):Buffer.concat([u,Buffer.from([0]),c,Buffer.from([i])]);return s&&!o&&(a=Buffer.concat([a,s])),t.send(224,72,0,0,a).then(function(f){return f.length>0?(f[0]=48,f.slice(0,f.length-2)):f})}var nc=globalThis&&globalThis.__awaiter||function(t,r,e,i){function s(n){return n instanceof e?n:new e(function(o){o(n)})}return new(e||(e=Promise))(function(n,o){function u(f){try{a(i.next(f))}catch(l){o(l)}}function c(f){try{a(i.throw(f))}catch(l){o(l)}}function a(f){f.done?n(f.value):s(f.value).then(u,c)}a((i=i.apply(t,r||[])).next())})},ic=globalThis&&globalThis.__generator||function(t,r){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,o;return o={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function u(a){return function(f){return c([a,f])}}function c(a){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,s&&(n=a[0]&2?s.return:a[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,a[1])).done)return n;switch(s=0,n&&(a=[a[0]&2,n.value]),a[0]){case 0:case 1:n=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,s=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!n||a[1]>n[0]&&a[1]<n[3])){e.label=a[1];break}if(a[0]===6&&e.label<n[1]){e.label=n[1],n=a;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(a);break}n[2]&&e.ops.pop(),e.trys.pop();continue}a=r.call(t,e)}catch(f){a=[6,f],s=0}finally{i=n=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};function Kn(t,r){var e=Or(r);return t.send(224,74,255,0,e)}function St(t,r,e){return e===void 0&&(e=[]),nc(this,void 0,void 0,function(){var i,s,n,o,u,c;return ic(this,function(a){switch(a.label){case 0:if(i=0,s=128,n=e.includes("decred"),n)return[2,t.send(224,74,s,0,r)];a.label=1;case 1:return i<r.length?(o=i+ye>=r.length?r.length-i:ye,u=i+o===r.length?128:0,c=r.slice(i,i+o),[4,t.send(224,74,u,0,c)]):[3,3];case 2:return a.sent(),i+=o,[3,1];case 3:return[2]}})})}var sc=globalThis&&globalThis.__awaiter||function(t,r,e,i){function s(n){return n instanceof e?n:new e(function(o){o(n)})}return new(e||(e=Promise))(function(n,o){function u(f){try{a(i.next(f))}catch(l){o(l)}}function c(f){try{a(i.throw(f))}catch(l){o(l)}}function a(f){f.done?n(f.value):s(f.value).then(u,c)}a((i=i.apply(t,r||[])).next())})},ac=globalThis&&globalThis.__generator||function(t,r){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,o;return o={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function u(a){return function(f){return c([a,f])}}function c(a){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,s&&(n=a[0]&2?s.return:a[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,a[1])).done)return n;switch(s=0,n&&(a=[a[0]&2,n.value]),a[0]){case 0:case 1:n=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,s=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!n||a[1]>n[0]&&a[1]<n[3])){e.label=a[1];break}if(a[0]===6&&e.label<n[1]){e.label=n[1],n=a;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(a);break}n[2]&&e.ops.pop(),e.trys.pop();continue}a=r.call(t,e)}catch(f){a=[6,f],s=0}finally{i=n=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},Gi=function(t){return sc(void 0,void 0,void 0,function(){var r,e,i,s,n,o,u,c,a;return ac(this,function(f){switch(f.label){case 0:return[4,t.send(176,1,0,0)];case 1:return r=f.sent(),e=0,i=r[e++],ei.invariant(i===1,"getAppAndVersion: format not supported"),s=r[e++],n=r.slice(e,e+=s).toString("ascii"),o=r[e++],u=r.slice(e,e+=o).toString("ascii"),c=r[e++],a=r.slice(e,e+=c),[2,{name:n,version:u,flags:a}]}})})};function oc(t){var r=t.version,e=t.name;return e==="Decred"?!1:e==="Exchange"?!0:mi.gte(r,"1.4.0")}var ke=globalThis&&globalThis.__assign||function(){return ke=Object.assign||function(t){for(var r,e=1,i=arguments.length;e<i;e++){r=arguments[e];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},ke.apply(this,arguments)},uc=globalThis&&globalThis.__awaiter||function(t,r,e,i){function s(n){return n instanceof e?n:new e(function(o){o(n)})}return new(e||(e=Promise))(function(n,o){function u(f){try{a(i.next(f))}catch(l){o(l)}}function c(f){try{a(i.throw(f))}catch(l){o(l)}}function a(f){f.done?n(f.value):s(f.value).then(u,c)}a((i=i.apply(t,r||[])).next())})},fc=globalThis&&globalThis.__generator||function(t,r){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,o;return o={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function u(a){return function(f){return c([a,f])}}function c(a){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,s&&(n=a[0]&2?s.return:a[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,a[1])).done)return n;switch(s=0,n&&(a=[a[0]&2,n.value]),a[0]){case 0:case 1:n=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,s=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!n||a[1]>n[0]&&a[1]<n[3])){e.label=a[1];break}if(a[0]===6&&e.label<n[1]){e.label=n[1],n=a;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(a);break}n[2]&&e.ops.pop(),e.trys.pop();continue}a=r.call(t,e)}catch(f){a=[6,f],s=0}finally{i=n=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},cc=globalThis&&globalThis.__values||function(t){var r=typeof Symbol=="function"&&Symbol.iterator,e=r&&t[r],i=0;if(e)return e.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},lc={lockTime:Li,sigHashType:Kr,segwit:!1,additionals:[],onDeviceStreaming:function(t){},onDeviceSignatureGranted:function(){},onDeviceSignatureRequested:function(){}};function hc(t,r){return uc(this,void 0,void 0,function(){var e,i,s,n,o,u,c,a,f,l,v,h,x,m,E,B,p,$,R,P,I,U,L,H,A,k,N,d,g,_,T,w,y,O,S,b,D,q,F,j,ae,X,te,pe,ve,je,se,C,Wr,C,C,ae,jt,We,zr,Yr,C,Wt,zt,Yt,oe,pt,C,Zr,dt,Zt,Qr;return fc(this,function(V){switch(V.label){case 0:if(e=ke(ke({},lc),r),i=e.inputs,s=e.associatedKeysets,n=e.changePath,o=e.outputScriptHex,u=e.lockTime,c=e.sigHashType,a=e.segwit,f=e.initialTimestamp,l=e.additionals,v=e.expiryHeight,h=e.onDeviceStreaming,x=e.onDeviceSignatureGranted,m=e.onDeviceSignatureRequested,E=e.useTrustedInputForSegwit,E!==void 0)return[3,4];V.label=1;case 1:return V.trys.push([1,3,,4]),[4,Gi(t)];case 2:return B=V.sent(),E=oc(B),[3,4];case 3:if(p=V.sent(),p.statusCode===27904)E=!1;else throw p;return[3,4];case 4:$=function(Ae,Oe){var Ne=i.length;if(!(Ne<3)){var Jr=Ne*Ae+Oe,en=2*Ne,Fi=Jr/en;h({progress:Fi,total:en,index:Jr})}},R=l.includes("decred"),P=l.includes("zcash"),I=l.includes("stealthcoin"),U=Date.now(),L=l.includes("sapling"),H=a&&l.includes("bech32"),A=a||!!l&&(l.includes("abc")||l.includes("gold")||l.includes("bip143"))||!!v&&!R,k=Buffer.alloc(4),k.writeUInt32LE(u,0),N=Buffer.alloc(0),d=Buffer.alloc(0),g=Buffer.alloc(4),v&&!R?g.writeUInt32LE(P?2147483653:L?2147483652:2147483651,0):I?g.writeUInt32LE(2,0):g.writeUInt32LE(1,0),_=[],T=[],w=[],y=[],O=!0,S=!1,b={inputs:[],version:g,timestamp:Buffer.alloc(0)},D=A&&!E?jr:Hr,q=Buffer.from(o,"hex"),$(0,0),V.label=5;case 5:V.trys.push([5,11,12,13]),F=cc(i),j=F.next(),V.label=6;case 6:return j.done?[3,10]:(ae=j.value,S?[3,8]:[4,D(t,ae[1],ae[0],l)]);case 7:X=V.sent(),Jn.log("hw","got trustedInput="+X),te=Buffer.alloc(4),te.writeUInt32LE(ae.length>=4&&typeof ae[3]=="number"?ae[3]:It,0),_.push({trustedInput:!0,value:Buffer.from(X,"hex"),sequence:te}),V.label=8;case 8:pe=ae[0].outputs,ve=ae[1],pe&&ve<=pe.length-1&&T.push(pe[ve]),v&&!R?(b.nVersionGroupId=Buffer.from(P?[10,39,167,38]:L?[133,32,47,137]:[112,130,196,3]),b.nExpiryHeight=v,b.extraData=Buffer.from(L?[0,0,0,0,0,0,0,0,0,0,0]:[0])):R&&(b.nExpiryHeight=v),V.label=9;case 9:return j=F.next(),[3,6];case 10:return[3,13];case 11:return je=V.sent(),Zt={error:je},[3,13];case 12:try{j&&!j.done&&(Qr=F.return)&&Qr.call(F)}finally{if(Zt)throw Zt.error}return[7];case 13:if(b.inputs=i.map(function(Ae,Oe){var Ne=Buffer.alloc(4);return Ne.writeUInt32LE(Ae.length>=4&&typeof Ae[3]=="number"?Ae[3]:It,0),{script:P?T[Oe].script:N,prevout:d,sequence:Ne}}),S)return[3,18];se=[],C=0,V.label=14;case 14:return C<i.length?[4,yr(t,{path:s[C]})]:[3,17];case 15:Wr=V.sent(),$(0,C+1),se.push(Wr),V.label=16;case 16:return C++,[3,14];case 17:for(C=0;C<se.length;C++)y.push(rc(Buffer.from(se[C].publicKey,"hex")));V.label=18;case 18:return f!==void 0&&(b.timestamp=Buffer.alloc(4),b.timestamp.writeUInt32LE(Math.floor(f+(Date.now()-U)/1e3),0)),m(),A?[4,Tt(t,!0,b,_,!0,!!v,l,E)]:[3,23];case 19:return V.sent(),!S&&n?[4,Kn(t,n)]:[3,21];case 20:V.sent(),V.label=21;case 21:return[4,St(t,q)];case 22:V.sent(),V.label=23;case 23:return v&&!R?[4,mr(t,"",u,Kr,v)]:[3,25];case 24:V.sent(),V.label=25;case 25:C=0,V.label=26;case 26:return C<i.length?(ae=i[C],jt=i[C].length>=3&&typeof ae[2]=="string"?Buffer.from(ae[2],"hex"):a?Buffer.concat([Buffer.from([Ci,qr,qt]),Ve(y[C]),Buffer.from([Di,Ui])]):T[C].script,We=Object.assign({},b),zr=A?[_[C]]:_,A?We.inputs=[ke(ke({},We.inputs[C]),{script:jt})]:We.inputs[C].script=jt,[4,Tt(t,!A&&O,We,zr,A,!!v&&!R,l,E)]):[3,34];case 27:return V.sent(),A?[3,31]:!S&&n?[4,Kn(t,n)]:[3,29];case 28:V.sent(),V.label=29;case 29:return[4,St(t,q,l)];case 30:V.sent(),V.label=31;case 31:return O&&(x(),$(1,0)),[4,mr(t,s[C],u,c,v,l)];case 32:Yr=V.sent(),$(1,C+1),w.push(Yr),b.inputs[C].script=N,O&&(O=!1),V.label=33;case 33:return C++,[3,26];case 34:for(C=0;C<i.length;C++)a?(b.witness=Buffer.alloc(0),H||(b.inputs[C].script=Buffer.concat([Buffer.from("160014","hex"),Ve(y[C])]))):(Wt=Buffer.alloc(1),zt=Buffer.alloc(1),Wt[0]=w[C].length,zt[0]=y[C].length,b.inputs[C].script=Buffer.concat([Wt,w[C],zt,y[C]])),Yt=A&&!E?0:4,b.inputs[C].prevout=_[C].value.slice(Yt,Yt+36);if(b.locktime=k,oe=Buffer.concat([Xr(b,!1,b.timestamp,l),q]),a&&!R){for(pt=Buffer.alloc(0),C=0;C<i.length;C++)Zr=Buffer.concat([Buffer.from("02","hex"),Buffer.from([w[C].length]),w[C],Buffer.from([y[C].length]),y[C]]),pt=Buffer.concat([pt,Zr]);oe=Buffer.concat([oe,pt])}return P||(oe=Buffer.concat([oe,k]),v&&(oe=Buffer.concat([oe,b.nExpiryHeight||Buffer.alloc(0),b.extraData||Buffer.alloc(0)]))),R&&(dt=Buffer.from([b.inputs.length]),i.forEach(function(Ae,Oe){dt=Buffer.concat([dt,Buffer.from([0,0,0,0,0,0,0,0]),Buffer.from([0,0,0,0]),Buffer.from([255,255,255,255]),Buffer.from([b.inputs[Oe].script.length]),b.inputs[Oe].script])}),oe=Buffer.concat([oe,dt])),P&&(oe=Buffer.concat([oe,Buffer.from([0,0,0])])),[2,oe.toString("hex")]}})})}var pc=globalThis&&globalThis.__awaiter||function(t,r,e,i){function s(n){return n instanceof e?n:new e(function(o){o(n)})}return new(e||(e=Promise))(function(n,o){function u(f){try{a(i.next(f))}catch(l){o(l)}}function c(f){try{a(i.throw(f))}catch(l){o(l)}}function a(f){f.done?n(f.value):s(f.value).then(u,c)}a((i=i.apply(t,r||[])).next())})},qn=globalThis&&globalThis.__generator||function(t,r){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,o;return o={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function u(a){return function(f){return c([a,f])}}function c(a){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,s&&(n=a[0]&2?s.return:a[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,a[1])).done)return n;switch(s=0,n&&(a=[a[0]&2,n.value]),a[0]){case 0:case 1:n=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,s=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!n||a[1]>n[0]&&a[1]<n[3])){e.label=a[1];break}if(a[0]===6&&e.label<n[1]){e.label=n[1],n=a;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(a);break}n[2]&&e.ops.pop(),e.trys.pop();continue}a=r.call(t,e)}catch(f){a=[6,f],s=0}finally{i=n=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};function dc(t,r){var e=r.path,i=r.messageHex;return pc(this,void 0,void 0,function(){var s,n,o,u,c,a,f,l;return qn(this,function(v){switch(v.label){case 0:s=$r.bippath.fromString(e).toPathArray(),n=Buffer.from(i,"hex"),o=0,u=function(){var h,x,m;return qn(this,function(E){switch(E.label){case 0:return h=o===0?ye-1-s.length*4-4:ye,x=o+h>n.length?n.length-o:h,m=Buffer.alloc(o===0?1+s.length*4+2+x:x),o===0?(m[0]=s.length,s.forEach(function(B,p){m.writeUInt32BE(B,1+4*p)}),m.writeUInt16BE(n.length,1+4*s.length),n.copy(m,1+4*s.length+2,o,o+x)):n.copy(m,0,o,o+x),[4,t.send(224,78,0,o===0?1:128,m)];case 1:return E.sent(),o+=x,[2]}})},v.label=1;case 1:return o===n.length?[3,3]:[5,u()];case 2:return v.sent(),[3,1];case 3:return[4,t.send(224,78,128,0,Buffer.from([0]))];case 4:return c=v.sent(),a=c[0]-48,f=c.slice(4,4+c[3]),f[0]===0&&(f=f.slice(1)),f=f.toString("hex"),o=4+c[3]+2,l=c.slice(o,o+c[o-1]),l[0]===0&&(l=l.slice(1)),l=l.toString("hex"),[2,{v:a,r:f,s:l}]}})})}var Me=globalThis&&globalThis.__assign||function(){return Me=Object.assign||function(t){for(var r,e=1,i=arguments.length;e<i;e++){r=arguments[e];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},Me.apply(this,arguments)},vc=globalThis&&globalThis.__awaiter||function(t,r,e,i){function s(n){return n instanceof e?n:new e(function(o){o(n)})}return new(e||(e=Promise))(function(n,o){function u(f){try{a(i.next(f))}catch(l){o(l)}}function c(f){try{a(i.throw(f))}catch(l){o(l)}}function a(f){f.done?n(f.value):s(f.value).then(u,c)}a((i=i.apply(t,r||[])).next())})},gc=globalThis&&globalThis.__generator||function(t,r){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,o;return o={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function u(a){return function(f){return c([a,f])}}function c(a){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,s&&(n=a[0]&2?s.return:a[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,a[1])).done)return n;switch(s=0,n&&(a=[a[0]&2,n.value]),a[0]){case 0:case 1:n=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,s=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!n||a[1]>n[0]&&a[1]<n[3])){e.label=a[1];break}if(a[0]===6&&e.label<n[1]){e.label=n[1],n=a;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(a);break}n[2]&&e.ops.pop(),e.trys.pop();continue}a=r.call(t,e)}catch(f){a=[6,f],s=0}finally{i=n=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},xc=globalThis&&globalThis.__values||function(t){var r=typeof Symbol=="function"&&Symbol.iterator,e=r&&t[r],i=0;if(e)return e.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},Ec={lockTime:Li,sigHashType:Kr,segwit:!1,transactionVersion:Rf};function wc(t,r){return vc(this,void 0,void 0,function(){var e,i,s,n,o,u,c,a,f,l,v,h,x,m,E,B,p,$,R,P,I,d,U,k,L,H,A,N,k,N,d,g,_,T,w,y,O;return gc(this,function(S){switch(S.label){case 0:e=Me(Me({},Ec),r),i=e.inputs,s=e.associatedKeysets,n=e.outputScriptHex,o=e.lockTime,u=e.sigHashType,c=e.segwit,a=e.transactionVersion,f=Buffer.alloc(0),l=Buffer.alloc(0),v=Buffer.alloc(4),v.writeUInt32LE(a,0),h=[],x=[],m=[],E=!0,B=!1,p={inputs:[],version:v},$=c?jr:Hr,R=Buffer.from(n,"hex"),S.label=1;case 1:S.trys.push([1,7,8,9]),P=xc(i),I=P.next(),S.label=2;case 2:return I.done?[3,6]:(d=I.value,B?[3,4]:[4,$(t,d[1],d[0])]);case 3:U=S.sent(),k=Buffer.alloc(4),k.writeUInt32LE(d.length>=4&&typeof d[3]=="number"?d[3]:It,0),h.push({trustedInput:!1,value:c?Buffer.from(U,"hex"):Buffer.from(U,"hex").slice(4,4+36),sequence:k}),S.label=4;case 4:L=d[0].outputs,H=d[1],L&&H<=L.length-1&&x.push(L[H]),S.label=5;case 5:return I=P.next(),[3,2];case 6:return[3,9];case 7:return A=S.sent(),y={error:A},[3,9];case 8:try{I&&!I.done&&(O=P.return)&&O.call(P)}finally{if(y)throw y.error}return[7];case 9:for(N=0;N<i.length;N++)k=Buffer.alloc(4),k.writeUInt32LE(i[N].length>=4&&typeof i[N][3]=="number"?i[N][3]:It,0),p.inputs.push({script:f,prevout:l,sequence:k});return c?[4,Tt(t,!0,p,h,!0)]:[3,12];case 10:return S.sent(),[4,St(t,R)];case 11:S.sent(),S.label=12;case 12:N=0,S.label=13;case 13:return N<i.length?(d=i[N],g=i[N].length>=3&&typeof d[2]=="string"?Buffer.from(d[2],"hex"):x[N].script,_=Object.assign({},p),T=c?[h[N]]:h,c?_.inputs=[Me(Me({},_.inputs[N]),{script:g})]:_.inputs[N].script=g,[4,Tt(t,!c&&E,_,T,c)]):[3,19];case 14:return S.sent(),c?[3,16]:[4,St(t,R)];case 15:S.sent(),S.label=16;case 16:return[4,mr(t,s[N],o,u)];case 17:w=S.sent(),m.push(c?w.toString("hex"):w.slice(0,w.length-1).toString("hex")),p.inputs[N].script=f,E&&(E=!1),S.label=18;case 18:return N++,[3,13];case 19:return[2,m]}})})}var Bt=globalThis&&globalThis.__assign||function(){return Bt=Object.assign||function(t){for(var r,e=1,i=arguments.length;e<i;e++){r=arguments[e];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},Bt.apply(this,arguments)},Xn=globalThis&&globalThis.__awaiter||function(t,r,e,i){function s(n){return n instanceof e?n:new e(function(o){o(n)})}return new(e||(e=Promise))(function(n,o){function u(f){try{a(i.next(f))}catch(l){o(l)}}function c(f){try{a(i.throw(f))}catch(l){o(l)}}function a(f){f.done?n(f.value):s(f.value).then(u,c)}a((i=i.apply(t,r||[])).next())})},Hn=globalThis&&globalThis.__generator||function(t,r){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,o;return o={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function u(a){return function(f){return c([a,f])}}function c(a){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,s&&(n=a[0]&2?s.return:a[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,a[1])).done)return n;switch(s=0,n&&(a=[a[0]&2,n.value]),a[0]){case 0:case 1:n=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,s=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!n||a[1]>n[0]&&a[1]<n[3])){e.label=a[1];break}if(a[0]===6&&e.label<n[1]){e.label=n[1],n=a;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(a);break}n[2]&&e.ops.pop(),e.trys.pop();continue}a=r.call(t,e)}catch(f){a=[6,f],s=0}finally{i=n=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},yc=function(){function t(r){this.transport=r,this.derivationsCache={}}return t.prototype.derivatePath=function(r){return Xn(this,void 0,void 0,function(){var e;return Hn(this,function(i){switch(i.label){case 0:return this.derivationsCache[r]?[2,this.derivationsCache[r]]:[4,yr(this.transport,{path:r})];case 1:return e=i.sent(),this.derivationsCache[r]=e,[2,e]}})})},t.prototype.getWalletXpub=function(r){var e=r.path,i=r.xpubVersion;return Xn(this,void 0,void 0,function(){var s,n,o,u,c,a;return Hn(this,function(f){switch(f.label){case 0:return s=xe(e),n=s.slice(0,-1),[4,this.derivatePath(Nr(n))];case 1:return o=f.sent(),[4,this.derivatePath(e)];case 2:return u=f.sent(),c=_c(Wn(Buffer.from(o.publicKey,"hex"))),a=bc(i,s.length,c,s[s.length-1],Buffer.from(u.chainCode,"hex"),Wn(Buffer.from(u.publicKey,"hex"))),[2,a]}})})},t.prototype.getWalletPublicKey=function(r,e){if((e==null?void 0:e.format)==="bech32m")throw new Error("Unsupported address format bech32m");return yr(this.transport,Bt(Bt({},e),{path:r}))},t.prototype.signMessageNew=function(r,e){return dc(this.transport,{path:r,messageHex:e})},t.prototype.createPaymentTransactionNew=function(r){return arguments.length>1&&console.warn("@ledgerhq/hw-app-btc: createPaymentTransactionNew multi argument signature is deprecated. please switch to named parameters."),hc(this.transport,r)},t.prototype.signP2SHTransaction=function(r){return arguments.length>1&&console.warn("@ledgerhq/hw-app-btc: signP2SHTransaction multi argument signature is deprecated. please switch to named parameters."),wc(this.transport,r)},t}();function _c(t){return Tc(t).slice(0,4)}function jn(t){var r=Buffer.allocUnsafe(4);return r.writeUInt32BE(t,0),r}var Wn=function(t){return Buffer.concat([Buffer.from([2+(t[64]&1)]),t.slice(1,33)])};function bc(t,r,e,i,s,n){var o=jn(i);o[0]|=128;var u=Buffer.concat([jn(t),Buffer.from([r]),e,o,s,n]),c=mc(u).slice(0,4);return Qs.encode(Buffer.concat([u,c]))}function Ir(t){return yt("sha256").update(t).digest()}function mc(t){return Ir(Ir(t))}function Ic(t){return new G.RIPEMD160().update(t).digest()}function Tc(t){return Ic(Ir(t))}var Sc=function(){function t(r,e){if(r.length!=e.length)throw new Error("keys and values should have the same length");for(var i=0;i<r.length-1;i++)if(r[i].toString("hex")>=r[i+1].toString("hex"))throw new Error("keys must be in strictly increasing order");this.keys=r,this.keysTree=new Ke(r.map(function(s){return qe(s)})),this.values=e,this.valuesTree=new Ke(e.map(function(s){return qe(s)}))}return t.prototype.commitment=function(){return Buffer.concat([z(this.keys.length),this.keysTree.getRoot(),this.valuesTree.getRoot()])},t}(),Bc=globalThis&&globalThis.__extends||function(){var t=function(r,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(i[n]=s[n])},t(r,e)};return function(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");t(r,e);function i(){this.constructor=r}r.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),fr=globalThis&&globalThis.__read||function(t,r){var e=typeof Symbol=="function"&&t[Symbol.iterator];if(!e)return t;var i=e.call(t),s,n=[],o;try{for(;(r===void 0||r-- >0)&&!(s=i.next()).done;)n.push(s.value)}catch(u){o={error:u}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(o)throw o.error}}return n},cr=globalThis&&globalThis.__spreadArray||function(t,r,e){if(e||arguments.length===2)for(var i=0,s=r.length,n;i<s;i++)(n||!(i in r))&&(n||(n=Array.prototype.slice.call(r,0,i)),n[i]=r[i]);return t.concat(n||Array.prototype.slice.call(r))},$c=function(t){Bc(r,t);function r(e){var i=t.call(this)||this;i.inputMerkleMaps=[],i.outputMerkleMaps=[],e.copy(i),i.globalMerkleMap=r.createMerkleMap(i.globalMap);for(var s=0;s<i.getGlobalInputCount();s++)i.inputMerkleMaps.push(r.createMerkleMap(i.inputMaps[s]));i.inputMapCommitments=cr([],fr(i.inputMerkleMaps.values()),!1).map(function(n){return n.commitment()});for(var s=0;s<i.getGlobalOutputCount();s++)i.outputMerkleMaps.push(r.createMerkleMap(i.outputMaps[s]));return i.outputMapCommitments=cr([],fr(i.outputMerkleMaps.values()),!1).map(function(n){return n.commitment()}),i}return r.prototype.getGlobalSize=function(){return this.globalMap.size},r.prototype.getGlobalKeysValuesRoot=function(){return this.globalMerkleMap.commitment()},r.createMerkleMap=function(e){var i=cr([],fr(e.keys()),!1).sort(),s=i.map(function(u){var c=e.get(u);if(!c)throw new Error("No value for key "+u);return c}),n=i.map(function(u){return Buffer.from(u,"hex")}),o=new Sc(n,s);return o},r}(ki),lt=globalThis&&globalThis.__extends||function(){var t=function(r,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(i[n]=s[n])},t(r,e)};return function(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");t(r,e);function i(){this.constructor=r}r.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),Tr=globalThis&&globalThis.__read||function(t,r){var e=typeof Symbol=="function"&&t[Symbol.iterator];if(!e)return t;var i=e.call(t),s,n=[],o;try{for(;(r===void 0||r-- >0)&&!(s=i.next()).done;)n.push(s.value)}catch(u){o={error:u}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(o)throw o.error}}return n},Sr=globalThis&&globalThis.__spreadArray||function(t,r,e){if(e||arguments.length===2)for(var i=0,s=r.length,n;i<s;i++)(n||!(i in r))&&(n||(n=Array.prototype.slice.call(r,0,i)),n[i]=r[i]);return t.concat(n||Array.prototype.slice.call(r))},zn=globalThis&&globalThis.__values||function(t){var r=typeof Symbol=="function"&&Symbol.iterator,e=r&&t[r],i=0;if(e)return e.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},$e;(function(t){t[t.YIELD=16]="YIELD",t[t.GET_PREIMAGE=64]="GET_PREIMAGE",t[t.GET_MERKLE_LEAF_PROOF=65]="GET_MERKLE_LEAF_PROOF",t[t.GET_MERKLE_LEAF_INDEX=66]="GET_MERKLE_LEAF_INDEX",t[t.GET_MORE_ELEMENTS=160]="GET_MORE_ELEMENTS"})($e||($e={}));var ht=function(){function t(){}return t}(),Rc=function(t){lt(r,t);function r(e,i){var s=t.call(this)||this;return s.progressCallback=i,s.code=$e.YIELD,s.results=e,s}return r.prototype.execute=function(e){return this.results.push(Buffer.from(e.subarray(1))),this.progressCallback(),Buffer.from("")},r}(ht),Ac=function(t){lt(r,t);function r(e,i){var s=t.call(this)||this;return s.code=$e.GET_PREIMAGE,s.known_preimages=e,s.queue=i,s}return r.prototype.execute=function(e){var i=Buffer.from(e.subarray(1));if(i.length!=1+32)throw new Error("Invalid request, unexpected trailing data");if(i[0]!=0)throw new Error("Unsupported request, the first byte should be 0");for(var s=Buffer.alloc(32),n=0;n<32;n++)s[n]=i[1+n];var o=s.toString("hex"),u=this.known_preimages.get(o);if(u!=null){var c=z(u.length),a=255-c.length-1,f=Math.min(a,u.length);if(f<u.length)for(var n=f;n<u.length;n++)this.queue.push(Buffer.from([u[n]]));return Buffer.concat([c,Buffer.from([f]),Buffer.from(u.subarray(0,f))])}throw Error("Requested unknown preimage for: ".concat(o))},r}(ht),Oc=function(t){lt(r,t);function r(e,i){var s=t.call(this)||this;return s.code=$e.GET_MERKLE_LEAF_PROOF,s.known_trees=e,s.queue=i,s}return r.prototype.execute=function(e){var i,s=Buffer.from(e.subarray(1));if(s.length<32+1+1)throw new Error("Invalid request, expected at least 34 bytes");var n=new Ie(s),o=n.readSlice(32),u=o.toString("hex"),c,a;try{c=n.readVarInt(),a=n.readVarInt()}catch{throw new Error("Invalid request, couldn't parse tree_size or leaf_index")}var f=this.known_trees.get(u);if(!f)throw Error("Requested Merkle leaf proof for unknown tree: ".concat(u));if(a>=c||f.size()!=c)throw Error("Invalid index or tree size.");if(this.queue.length!=0)throw Error("This command should not execute when the queue is not empty.");var l=f.getProof(a),v=Math.min(Math.floor((255-32-1-1)/32),l.length),h=l.length-v;return h>0&&(i=this.queue).push.apply(i,Sr([],Tr(l.slice(-h)),!1)),Buffer.concat(Sr([f.getLeafHash(a),Buffer.from([l.length]),Buffer.from([v])],Tr(l.slice(0,v)),!1))},r}(ht),Nc=function(t){lt(r,t);function r(e){var i=t.call(this)||this;return i.code=$e.GET_MERKLE_LEAF_INDEX,i.known_trees=e,i}return r.prototype.execute=function(e){var i=Buffer.from(e.subarray(1));if(i.length!=32+32)throw new Error("Invalid request, unexpected trailing data");for(var s=Buffer.alloc(32),n=0;n<32;n++)s[n]=i.readUInt8(n);for(var o=s.toString("hex"),u=Buffer.alloc(32),n=0;n<32;n++)u[n]=i.readUInt8(32+n);var c=u.toString("hex"),a=this.known_trees.get(o);if(!a)throw Error("Requested Merkle leaf index for unknown root: ".concat(o));for(var f=0,l=0,n=0;n<a.size();n++)if(a.getLeafHash(n).toString("hex")==c){l=1,f=n;break}return Buffer.concat([Buffer.from([l]),z(f)])},r}(ht),Pc=function(t){lt(r,t);function r(e){var i=t.call(this)||this;return i.code=$e.GET_MORE_ELEMENTS,i.queue=e,i}return r.prototype.execute=function(e){if(e.length!=1)throw new Error("Invalid request, unexpected trailing data");if(this.queue.length===0)throw new Error("No elements to get");var i=this.queue[0].length;if(this.queue.some(function(u){return u.length!=i}))throw new Error("The queue contains elements with different byte length, which is not expected");var s=Math.floor(253/i),n=Math.min(s,this.queue.length),o=this.queue.splice(0,n);return Buffer.concat(Sr([Buffer.from([n]),Buffer.from([i])],Tr(o),!1))},r}(ht),Yn=function(){function t(r){var e,i;this.roots=new Map,this.preimages=new Map,this.yielded=[],this.queue=[],this.commands=new Map;var s=[new Rc(this.yielded,r),new Ac(this.preimages,this.queue),new Nc(this.roots),new Oc(this.roots,this.queue),new Pc(this.queue)];try{for(var n=zn(s),o=n.next();!o.done;o=n.next()){var u=o.value;if(this.commands.has(u.code))throw new Error("Multiple commands with code ".concat(u.code));this.commands.set(u.code,u)}}catch(c){e={error:c}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}}return t.prototype.getYielded=function(){return this.yielded},t.prototype.addKnownPreimage=function(r){this.preimages.set(Te.crypto.sha256(r).toString("hex"),r)},t.prototype.addKnownList=function(r){var e,i;try{for(var s=zn(r),n=s.next();!n.done;n=s.next()){var o=n.value,u=Buffer.concat([Buffer.from([0]),o]);this.addKnownPreimage(u)}}catch(a){e={error:a}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(e)throw e.error}}var c=new Ke(r.map(function(a){return qe(a)}));this.roots.set(c.getRoot().toString("hex"),c)},t.prototype.addKnownMapping=function(r){this.addKnownList(r.keys),this.addKnownList(r.values)},t.prototype.execute=function(r){if(r.length==0)throw new Error("Unexpected empty command");var e=r[0],i=this.commands.get(e);if(!i)throw new Error("Unexpected command code ".concat(e));return i.execute(r)},t}(),Ze=globalThis&&globalThis.__awaiter||function(t,r,e,i){function s(n){return n instanceof e?n:new e(function(o){o(n)})}return new(e||(e=Promise))(function(n,o){function u(f){try{a(i.next(f))}catch(l){o(l)}}function c(f){try{a(i.throw(f))}catch(l){o(l)}}function a(f){f.done?n(f.value):s(f.value).then(u,c)}a((i=i.apply(t,r||[])).next())})},Qe=globalThis&&globalThis.__generator||function(t,r){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,o;return o={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function u(a){return function(f){return c([a,f])}}function c(a){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,s&&(n=a[0]&2?s.return:a[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,a[1])).done)return n;switch(s=0,n&&(a=[a[0]&2,n.value]),a[0]){case 0:case 1:n=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,s=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!n||a[1]>n[0]&&a[1]<n[3])){e.label=a[1];break}if(a[0]===6&&e.label<n[1]){e.label=n[1],n=a;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(a);break}n[2]&&e.ops.pop(),e.trys.pop();continue}a=r.call(t,e)}catch(f){a=[6,f],s=0}finally{i=n=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},lr=globalThis&&globalThis.__values||function(t){var r=typeof Symbol=="function"&&Symbol.iterator,e=r&&t[r],i=0;if(e)return e.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},Lc=225,Cc=248,Ge;(function(t){t[t.GET_PUBKEY=0]="GET_PUBKEY",t[t.REGISTER_WALLET=2]="REGISTER_WALLET",t[t.GET_WALLET_ADDRESS=3]="GET_WALLET_ADDRESS",t[t.SIGN_PSBT=4]="SIGN_PSBT",t[t.GET_MASTER_FINGERPRINT=5]="GET_MASTER_FINGERPRINT"})(Ge||(Ge={}));var Br;(function(t){t[t.CONTINUE_INTERRUPTED=1]="CONTINUE_INTERRUPTED"})(Br||(Br={}));var Dc=function(){function t(r){this.transport=r}return t.prototype.makeRequest=function(r,e,i){return Ze(this,void 0,void 0,function(){var s,n,o;return Qe(this,function(u){switch(u.label){case 0:return[4,this.transport.send(Lc,r,0,0,e,[36864,57344])];case 1:s=u.sent(),u.label=2;case 2:if(s.readUInt16BE(s.length-2)!==57344)return[3,4];if(!i)throw new Error("Unexpected SW_INTERRUPTED_EXECUTION");return n=s.slice(0,-2),o=i.execute(n),[4,this.transport.send(Cc,Br.CONTINUE_INTERRUPTED,0,0,o,[36864,57344])];case 3:return s=u.sent(),[3,2];case 4:return[2,s.slice(0,-2)]}})})},t.prototype.getExtendedPubkey=function(r,e){return Ze(this,void 0,void 0,function(){var i;return Qe(this,function(s){switch(s.label){case 0:if(e.length>6)throw new Error("Path too long. At most 6 levels allowed.");return[4,this.makeRequest(Ge.GET_PUBKEY,Buffer.concat([Buffer.from(r?[1]:[0]),gi(e)]))];case 1:return i=s.sent(),[2,i.toString("ascii")]}})})},t.prototype.getWalletAddress=function(r,e,i,s,n){return Ze(this,void 0,void 0,function(){var o,u,c;return Qe(this,function(a){switch(a.label){case 0:if(i!==0&&i!==1)throw new Error("Change can only be 0 or 1");if(s<0||!Number.isInteger(s))throw new Error("Invalid address index");if(e!=null&&e.length!=32)throw new Error("Invalid HMAC length");return o=new Yn(function(){}),o.addKnownList(r.keys.map(function(f){return Buffer.from(f,"ascii")})),o.addKnownPreimage(r.serialize()),u=Buffer.alloc(4),u.writeUInt32BE(s,0),[4,this.makeRequest(Ge.GET_WALLET_ADDRESS,Buffer.concat([Buffer.from(n?[1]:[0]),r.getWalletId(),e||Buffer.alloc(32,0),Buffer.from([i]),u]),o)];case 1:return c=a.sent(),[2,c.toString("ascii")]}})})},t.prototype.signPsbt=function(r,e,i,s){return Ze(this,void 0,void 0,function(){var n,o,u,c,l,a,f,l,v,h,x,m,E,B,p,$,R,P,I,U,L;return Qe(this,function(H){switch(H.label){case 0:if(n=new $c(r),i!=null&&i.length!=32)throw new Error("Invalid HMAC length");o=new Yn(s),o.addKnownList(e.keys.map(function(A){return Buffer.from(A,"ascii")})),o.addKnownPreimage(e.serialize()),o.addKnownMapping(n.globalMerkleMap);try{for(u=lr(n.inputMerkleMaps),c=u.next();!c.done;c=u.next())l=c.value,o.addKnownMapping(l)}catch(A){$={error:A}}finally{try{c&&!c.done&&(R=u.return)&&R.call(u)}finally{if($)throw $.error}}try{for(a=lr(n.outputMerkleMaps),f=a.next();!f.done;f=a.next())l=f.value,o.addKnownMapping(l)}catch(A){P={error:A}}finally{try{f&&!f.done&&(I=a.return)&&I.call(a)}finally{if(P)throw P.error}}return o.addKnownList(n.inputMapCommitments),v=new Ke(n.inputMapCommitments.map(function(A){return qe(A)})).getRoot(),o.addKnownList(n.outputMapCommitments),h=new Ke(n.outputMapCommitments.map(function(A){return qe(A)})).getRoot(),[4,this.makeRequest(Ge.SIGN_PSBT,Buffer.concat([n.getGlobalKeysValuesRoot(),z(n.getGlobalInputCount()),v,z(n.getGlobalOutputCount()),h,e.getWalletId(),i||Buffer.alloc(32,0)]),o)];case 1:H.sent(),x=o.getYielded(),m=new Map;try{for(E=lr(x),B=E.next();!B.done;B=E.next())p=B.value,m.set(p[0],p.slice(1))}catch(A){U={error:A}}finally{try{B&&!B.done&&(L=E.return)&&L.call(E)}finally{if(U)throw U.error}}return[2,m]}})})},t.prototype.getMasterFingerprint=function(){return Ze(this,void 0,void 0,function(){return Qe(this,function(r){return[2,this.makeRequest(Ge.GET_MASTER_FINGERPRINT,Buffer.from([]))]})})},t}();function Uc(t){var r="TX";return r+=" version "+t.version.toString("hex"),t.locktime&&(r+=" locktime "+t.locktime.toString("hex")),t.witness&&(r+=" witness "+t.witness.toString("hex")),t.timestamp&&(r+=" timestamp "+t.timestamp.toString("hex")),t.nVersionGroupId&&(r+=" nVersionGroupId "+t.nVersionGroupId.toString("hex")),t.nExpiryHeight&&(r+=" nExpiryHeight "+t.nExpiryHeight.toString("hex")),t.extraData&&(r+=" extraData "+t.extraData.toString("hex")),t.inputs.forEach(function(e,i){var s=e.prevout,n=e.script,o=e.sequence;r+=`
input `.concat(i,":"),r+=" prevout ".concat(s.toString("hex")),r+=" script ".concat(n.toString("hex")),r+=" sequence ".concat(o.toString("hex"))}),(t.outputs||[]).forEach(function(e,i){var s=e.amount,n=e.script;r+=`
output `.concat(i,":"),r+=" amount ".concat(s.toString("hex")),r+=" script ".concat(n.toString("hex"))}),r}function kc(t,r,e,i,s){r===void 0&&(r=!1),e===void 0&&(e=!1),i===void 0&&(i=!1),s===void 0&&(s=[]);var n=[],o=[],u=!1,c=0,a=Buffer.alloc(0),f=Buffer.alloc(0),l=Buffer.alloc(0),v=Buffer.alloc(0),h,x,m=s.includes("decred"),E=s.includes("zencash"),B=s.includes("zcash"),p=Buffer.from(t,"hex"),$=p.slice(c,c+4),R=$.equals(Buffer.from([3,0,0,128]))||$.equals(Buffer.from([4,0,0,128]))||$.equals(Buffer.from([5,0,0,128])),P=B&&$.equals(Buffer.from([5,0,0,128]));c+=4,!e&&r&&p[c]===0&&p[c+1]!==0&&!E&&(c+=2,u=!0),e&&(a=p.slice(c,4+c),c+=4),R&&(l=p.slice(c,4+c),c+=4),P&&(x=p.slice(c+4,c+8),f=p.slice(c+8,c+12),c+=12);var I=De(p,c),U=I[0];c+=I[1];for(var L=0;L<U;L++){var H=p.slice(c,c+36);c+=36;var A=Buffer.alloc(0),k=Buffer.alloc(0);m?(k=p.slice(c,c+1),c+=1):(I=De(p,c),c+=I[1],A=p.slice(c,c+I[0]),c+=I[0]);var N=p.slice(c,c+4);c+=4,n.push({prevout:H,script:A,sequence:N,tree:k})}I=De(p,c);var d=I[0];c+=I[1];for(var L=0;L<d;L++){var g=p.slice(c,c+8);c+=8,m&&(c+=2),I=De(p,c),c+=I[1];var A=p.slice(c,c+I[0]);c+=I[0],o.push({amount:g,script:A})}if(u?(h=p.slice(c,-4),x=p.slice(p.length-4)):P||(x=p.slice(c,c+4)),c+=4,(R||m)&&!P&&(f=p.slice(c,c+4),c+=4),i&&(v=p.slice(c)),m){if(I=De(p,c),c+=I[1],I[0]!==U)throw new Error("splitTransaction: incoherent number of witnesses");for(var L=0;L<U;L++){c+=8,c+=4,c+=4,I=De(p,c),c+=I[1];var A=p.slice(c,c+I[0]);c+=I[0],n[L].script=A}}var _={version:$,inputs:n,outputs:o,locktime:x,witness:h,timestamp:a,nVersionGroupId:l,nExpiryHeight:f,extraData:v};return Jn.log("btc","splitTransaction ".concat(t,`:
`).concat(Uc(_))),_}var Zn=globalThis&&globalThis.__awaiter||function(t,r,e,i){function s(n){return n instanceof e?n:new e(function(o){o(n)})}return new(e||(e=Promise))(function(n,o){function u(f){try{a(i.next(f))}catch(l){o(l)}}function c(f){try{a(i.throw(f))}catch(l){o(l)}}function a(f){f.done?n(f.value):s(f.value).then(u,c)}a((i=i.apply(t,r||[])).next())})},Qn=globalThis&&globalThis.__generator||function(t,r){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,o;return o={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function u(a){return function(f){return c([a,f])}}function c(a){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,s&&(n=a[0]&2?s.return:a[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,a[1])).done)return n;switch(s=0,n&&(a=[a[0]&2,n.value]),a[0]){case 0:case 1:n=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,s=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!n||a[1]>n[0]&&a[1]<n[3])){e.label=a[1];break}if(a[0]===6&&e.label<n[1]){e.label=n[1],n=a;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(a);break}n[2]&&e.ops.pop(),e.trys.pop();continue}a=r.call(t,e)}catch(f){a=[6,f],s=0}finally{i=n=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},Mc=function(){function t(r,e){e===void 0&&(e="BTC"),this._lazyImpl=null,this.transport=r,r.decorateAppAPIMethods(this,["getWalletXpub","getWalletPublicKey","signP2SHTransaction","signMessageNew","createPaymentTransactionNew","getTrustedInput","getTrustedInputBIP143"],e)}return t.prototype.getWalletXpub=function(r){return this.getCorrectImpl().then(function(e){return e.getWalletXpub(r)})},t.prototype.getWalletPublicKey=function(r,e){var i=this,s;return arguments.length>2||typeof e=="boolean"?(console.warn("btc.getWalletPublicKey deprecated signature used. Please switch to getWalletPublicKey(path, { format, verify })"),s={verify:!!e,format:arguments[2]?"p2sh":"legacy"}):s=e||{},this.getCorrectImpl().then(function(n){return n instanceof Gn&&s.format!="bech32m"&&(!s.verify||s.verify==!1)&&!Gc(r)?(console.warn(`WARNING: Using deprecated device protocol to get the public key because
        
        * a non-standard path is requested, and
        * verify flag is false
        
        The new protocol only allows export of non-standard paths if the 
        verify flag is true. Standard paths are (currently):

        M/44'/(1|0)'/X'
        M/49'/(1|0)'/X'
        M/84'/(1|0)'/X'
        M/86'/(1|0)'/X'
        M/48'/(1|0)'/X'/Y'

        followed by "", "(0|1)", or "(0|1)/b", where a and b are 
        non-hardened. For example, the following paths are standard
        
        M/48'/1'/99'/7'
        M/86'/1'/99'/0
        M/48'/0'/99'/7'/1/17

        The following paths are non-standard

        M/48'/0'/99'           // Not deepest hardened path
        M/48'/0'/99'/7'/1/17/2 // Too many non-hardened derivation steps
        M/199'/0'/1'/0/88      // Not a known purpose 199
        M/86'/1'/99'/2         // Change path item must be 0 or 1

        This compatibility safeguard will be removed in the future.
        Please consider calling Btc.getWalletXpub() instead.`),i.old().getWalletPublicKey(r,s)):n.getWalletPublicKey(r,s)})},t.prototype.signMessageNew=function(r,e){return this.old().signMessageNew(r,e)},t.prototype.createPaymentTransactionNew=function(r){return arguments.length>1&&console.warn("@ledgerhq/hw-app-btc: createPaymentTransactionNew multi argument signature is deprecated. please switch to named parameters."),this.getCorrectImpl().then(function(e){return e.createPaymentTransactionNew(r)})},t.prototype.signP2SHTransaction=function(r){return this.old().signP2SHTransaction(r)},t.prototype.splitTransaction=function(r,e,i,s,n){return e===void 0&&(e=!1),i===void 0&&(i=!1),s===void 0&&(s=!1),n===void 0&&(n=[]),kc(r,e,i,s,n)},t.prototype.serializeTransactionOutputs=function(r){return Mi(r)},t.prototype.getTrustedInput=function(r,e,i){return i===void 0&&(i=[]),Hr(this.transport,r,e,i)},t.prototype.getTrustedInputBIP143=function(r,e,i){return i===void 0&&(i=[]),jr(this.transport,r,e,i)},t.prototype.getCorrectImpl=function(){return Zn(this,void 0,void 0,function(){var r,e;return Qn(this,function(i){switch(i.label){case 0:return r=this._lazyImpl,r?[2,r]:[4,this.inferCorrectImpl()];case 1:return e=i.sent(),this._lazyImpl=e,[2,e]}})})},t.prototype.inferCorrectImpl=function(){return Zn(this,void 0,void 0,function(){var r,e;return Qn(this,function(i){switch(i.label){case 0:return[4,Gi(this.transport)];case 1:return r=i.sent(),e=zf(r),e?[2,this.new()]:[2,this.old()]}})})},t.prototype.old=function(){return new yc(this.transport)},t.prototype.new=function(){return new Gn(new Dc(this.transport))},t}();function Gc(t){var r=2147483648,e=xe(t),i=function(o){return o>=r},s=function(o){return!o||o<r},n=function(o){return!o||o==0||o==1};return!!(e.length>=3&&e.length<=5&&[44+r,49+r,84+r,86+r].some(function(o){return o==e[0]})&&[0+r,1+r].some(function(o){return o==e[1]})&&i(e[2])&&n(e[3])&&s(e[4])||e.length>=4&&e.length<=6&&48+r==e[0]&&[0+r,1+r].some(function(o){return o==e[1]})&&i(e[2])&&i(e[3])&&n(e[4])&&s(e[5]))}exports.default=Mc;
