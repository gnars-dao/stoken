"use strict";var A,N;function O(){return N||(N=1,A=function(e){e.prototype[Symbol.iterator]=function*(){for(let t=this.head;t;t=t.next)yield t.value}}),A}var _=r;r.Node=c;r.create=r;function r(e){var t=this;if(t instanceof r||(t=new r),t.tail=null,t.head=null,t.length=0,e&&typeof e.forEach=="function")e.forEach(function(h){t.push(h)});else if(arguments.length>0)for(var i=0,n=arguments.length;i<n;i++)t.push(arguments[i]);return t}r.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,i=e.prev;return t&&(t.prev=i),i&&(i.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=i),e.list.length--,e.next=null,e.prev=null,e.list=null,t};r.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}};r.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}};r.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)C(this,arguments[e]);return this.length};r.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)G(this,arguments[e]);return this.length};r.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}};r.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}};r.prototype.forEach=function(e,t){t=t||this;for(var i=this.head,n=0;i!==null;n++)e.call(t,i.value,n,this),i=i.next};r.prototype.forEachReverse=function(e,t){t=t||this;for(var i=this.tail,n=this.length-1;i!==null;n--)e.call(t,i.value,n,this),i=i.prev};r.prototype.get=function(e){for(var t=0,i=this.head;i!==null&&t<e;t++)i=i.next;if(t===e&&i!==null)return i.value};r.prototype.getReverse=function(e){for(var t=0,i=this.tail;i!==null&&t<e;t++)i=i.prev;if(t===e&&i!==null)return i.value};r.prototype.map=function(e,t){t=t||this;for(var i=new r,n=this.head;n!==null;)i.push(e.call(t,n.value,this)),n=n.next;return i};r.prototype.mapReverse=function(e,t){t=t||this;for(var i=new r,n=this.tail;n!==null;)i.push(e.call(t,n.value,this)),n=n.prev;return i};r.prototype.reduce=function(e,t){var i,n=this.head;if(arguments.length>1)i=t;else if(this.head)n=this.head.next,i=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var h=0;n!==null;h++)i=e(i,n.value,h),n=n.next;return i};r.prototype.reduceReverse=function(e,t){var i,n=this.tail;if(arguments.length>1)i=t;else if(this.tail)n=this.tail.prev,i=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var h=this.length-1;n!==null;h--)i=e(i,n.value,h),n=n.prev;return i};r.prototype.toArray=function(){for(var e=new Array(this.length),t=0,i=this.head;i!==null;t++)e[t]=i.value,i=i.next;return e};r.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,i=this.tail;i!==null;t++)e[t]=i.value,i=i.prev;return e};r.prototype.slice=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var i=new r;if(t<e||t<0)return i;e<0&&(e=0),t>this.length&&(t=this.length);for(var n=0,h=this.head;h!==null&&n<e;n++)h=h.next;for(;h!==null&&n<t;n++,h=h.next)i.push(h.value);return i};r.prototype.sliceReverse=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var i=new r;if(t<e||t<0)return i;e<0&&(e=0),t>this.length&&(t=this.length);for(var n=this.length,h=this.tail;h!==null&&n>t;n--)h=h.prev;for(;h!==null&&n>e;n--,h=h.prev)i.push(h.value);return i};r.prototype.splice=function(e,t,...i){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var n=0,h=this.head;h!==null&&n<e;n++)h=h.next;for(var u=[],n=0;h&&n<t;n++)u.push(h.value),h=this.removeNode(h);h===null&&(h=this.tail),h!==this.head&&h!==this.tail&&(h=h.prev);for(var n=0;n<i.length;n++)h=D(this,h,i[n]);return u};r.prototype.reverse=function(){for(var e=this.head,t=this.tail,i=e;i!==null;i=i.prev){var n=i.prev;i.prev=i.next,i.next=n}return this.head=t,this.tail=e,this};function D(e,t,i){var n=t===e.head?new c(i,null,t,e):new c(i,t,t.next,e);return n.next===null&&(e.tail=n),n.prev===null&&(e.head=n),e.length++,n}function C(e,t){e.tail=new c(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function G(e,t){e.head=new c(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function c(e,t,i,n){if(!(this instanceof c))return new c(e,t,i,n);this.list=n,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,i?(i.prev=this,this.next=i):this.next=null}try{O()(r)}catch{}const I=_,f=Symbol("max"),o=Symbol("length"),y=Symbol("lengthCalculator"),x=Symbol("allowStale"),v=Symbol("maxAge"),l=Symbol("dispose"),T=Symbol("noDisposeOnSet"),s=Symbol("lruList"),a=Symbol("cache"),L=Symbol("updateAgeOnGet"),b=()=>1;class U{constructor(t){if(typeof t=="number"&&(t={max:t}),t||(t={}),t.max&&(typeof t.max!="number"||t.max<0))throw new TypeError("max must be a non-negative number");this[f]=t.max||1/0;const i=t.length||b;if(this[y]=typeof i!="function"?b:i,this[x]=t.stale||!1,t.maxAge&&typeof t.maxAge!="number")throw new TypeError("maxAge must be a number");this[v]=t.maxAge||0,this[l]=t.dispose,this[T]=t.noDisposeOnSet||!1,this[L]=t.updateAgeOnGet||!1,this.reset()}set max(t){if(typeof t!="number"||t<0)throw new TypeError("max must be a non-negative number");this[f]=t||1/0,d(this)}get max(){return this[f]}set allowStale(t){this[x]=!!t}get allowStale(){return this[x]}set maxAge(t){if(typeof t!="number")throw new TypeError("maxAge must be a non-negative number");this[v]=t,d(this)}get maxAge(){return this[v]}set lengthCalculator(t){typeof t!="function"&&(t=b),t!==this[y]&&(this[y]=t,this[o]=0,this[s].forEach(i=>{i.length=this[y](i.value,i.key),this[o]+=i.length})),d(this)}get lengthCalculator(){return this[y]}get length(){return this[o]}get itemCount(){return this[s].length}rforEach(t,i){i=i||this;for(let n=this[s].tail;n!==null;){const h=n.prev;R(this,t,n,i),n=h}}forEach(t,i){i=i||this;for(let n=this[s].head;n!==null;){const h=n.next;R(this,t,n,i),n=h}}keys(){return this[s].toArray().map(t=>t.key)}values(){return this[s].toArray().map(t=>t.value)}reset(){this[l]&&this[s]&&this[s].length&&this[s].forEach(t=>this[l](t.key,t.value)),this[a]=new Map,this[s]=new I,this[o]=0}dump(){return this[s].map(t=>E(this,t)?!1:{k:t.key,v:t.value,e:t.now+(t.maxAge||0)}).toArray().filter(t=>t)}dumpLru(){return this[s]}set(t,i,n){if(n=n||this[v],n&&typeof n!="number")throw new TypeError("maxAge must be a number");const h=n?Date.now():0,u=this[y](i,t);if(this[a].has(t)){if(u>this[f])return m(this,this[a].get(t)),!1;const p=this[a].get(t).value;return this[l]&&(this[T]||this[l](t,p.value)),p.now=h,p.maxAge=n,p.value=i,this[o]+=u-p.length,p.length=u,this.get(t),d(this),!0}const g=new H(t,i,u,h,n);return g.length>this[f]?(this[l]&&this[l](t,i),!1):(this[o]+=g.length,this[s].unshift(g),this[a].set(t,this[s].head),d(this),!0)}has(t){if(!this[a].has(t))return!1;const i=this[a].get(t).value;return!E(this,i)}get(t){return S(this,t,!0)}peek(t){return S(this,t,!1)}pop(){const t=this[s].tail;return t?(m(this,t),t.value):null}del(t){m(this,this[a].get(t))}load(t){this.reset();const i=Date.now();for(let n=t.length-1;n>=0;n--){const h=t[n],u=h.e||0;if(u===0)this.set(h.k,h.v);else{const g=u-i;g>0&&this.set(h.k,h.v,g)}}}prune(){this[a].forEach((t,i)=>S(this,i,!1))}}const S=(e,t,i)=>{const n=e[a].get(t);if(n){const h=n.value;if(E(e,h)){if(m(e,n),!e[x])return}else i&&(e[L]&&(n.value.now=Date.now()),e[s].unshiftNode(n));return h.value}},E=(e,t)=>{if(!t||!t.maxAge&&!e[v])return!1;const i=Date.now()-t.now;return t.maxAge?i>t.maxAge:e[v]&&i>e[v]},d=e=>{if(e[o]>e[f])for(let t=e[s].tail;e[o]>e[f]&&t!==null;){const i=t.prev;m(e,t),t=i}},m=(e,t)=>{if(t){const i=t.value;e[l]&&e[l](i.key,i.value),e[o]-=i.length,e[a].delete(i.key),e[s].removeNode(t)}};class H{constructor(t,i,n,h,u){this.key=t,this.value=i,this.length=n,this.now=h,this.maxAge=u||0}}const R=(e,t,i,n)=>{let h=i.value;E(e,h)&&(m(e,i),e[x]||(h=void 0)),h&&t.call(n,h.value,h.key,e)};var M=U;exports.lruCache=M;
