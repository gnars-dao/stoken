"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DataManager = void 0;
const assets_1 = require("../utils/assets");
const coinInfo_1 = require("./coinInfo");
const firmwareInfo_1 = require("./firmwareInfo");
const transportInfo_1 = require("./transportInfo");
const config_1 = require("./config");
class DataManager {
    static async load(settings, withAssets = true) {
        const ts = settings.env === 'web' ? `?r=${settings.timestamp}` : '';
        this.settings = settings;
        if (!withAssets)
            return;
        const assetPromises = config_1.config.assets.map(async (asset) => {
            const json = await (0, assets_1.httpRequest)(`${asset.url}${ts}`, 'json');
            this.assets[asset.name] = json;
        });
        await Promise.all(assetPromises);
        this.messages = await (0, assets_1.httpRequest)(`${config_1.config.messages}${ts}`, 'json');
        (0, transportInfo_1.parseBridgeJSON)(this.assets.bridge);
        (0, coinInfo_1.parseCoinsJson)(this.assets.coins);
        (0, firmwareInfo_1.parseFirmware)(this.assets['firmware-t1'], 1);
        (0, firmwareInfo_1.parseFirmware)(this.assets['firmware-t2'], 2);
    }
    static getProtobufMessages() {
        return this.messages;
    }
    static getSettings(key) {
        if (!this.settings)
            return null;
        if (typeof key === 'string') {
            return this.settings[key];
        }
        return this.settings;
    }
    static getConfig() {
        return config_1.config;
    }
}
exports.DataManager = DataManager;
DataManager.assets = {};
//# sourceMappingURL=DataManager.js.map