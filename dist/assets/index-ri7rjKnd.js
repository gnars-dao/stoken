import{H as I,r as s,j as e,F as w,s as P,k as F,a2 as Y,a3 as $,a4 as H,B as A,E as N,Q,Y as q,ad as J,ae as Z,V as X,ac as ee,a0 as te,ag as oe,ay as ne,ah as se,a7 as re}from"./index-MtGPO_T6.js";import{a as ae,v as ie,M as ce,C as le}from"./MarkdownRenderers-Avr826kM.js";const de=({onClose:D,author:f,permlink:u,weight:x=1e4,userVote:t})=>{const y=I(),[n,j]=s.useState(5e3),[v,b]=s.useState(""),[S,g]=s.useState("Vote"),[E,V]=s.useState(!1),l=o=>o===-1e4?"I hate it":o===-5e3?"I don't care for it":o===0?"Skaters can do better":o===5e3?"That's kind of cool":o===1e4?"That's awesome":"",T=async()=>{var o;if(!y||!((o=y.user)!=null&&o.name)){console.error("User not logged in or missing username");return}try{await ie(y.user.name,u,f,n),console.log("Voting successful!"),t.isVoted=!0,t.percent=n,g("Already Voted");const k=l(n);b(k)}catch(k){console.error("Voting failed:",k),V(!0)}},d={"-10000":"💩","-5000":"💀",0:"😐",5e3:"🙂",1e4:"🛹"},_={fontSize:"2em",position:"absolute",top:"50%",left:`${(n+1e4)/2e4*100}%`,transform:"translate(-50%, -50%)",cursor:"grab"};return s.useEffect(()=>{t.isVoted&&t.percent===n&&g("Already Voted"),t.isVoted&&t.percent!==n&&g("Change Vote");const o=l(n);b(o)},[n]),s.useEffect(()=>{t.isVoted&&(j(t.percent),g("Already Voted"));const o=l(t.percent);b(o)},[t]),e.jsxs(w,{flexDirection:"column",alignItems:"center",minWidth:"100%",borderRadius:"10px",border:"1px white solid",padding:"20px",children:[e.jsxs(P,{width:"100%",marginBottom:"20px",position:"relative",children:[e.jsx(F,{textAlign:"center",children:" Your opinion on this post"}),e.jsxs(Y,{min:-1e4,max:1e4,step:5e3,value:n,onChange:o=>j(o),children:[e.jsx($,{bg:"white",children:e.jsx(H,{bg:"yellow"})}),e.jsx("span",{role:"img","aria-label":"Skateboard",style:_,children:d[n.toString()]})]}),e.jsx(F,{color:"yellow",mt:2,textAlign:"center",children:v})]}),e.jsx(w,{justifyContent:"flex-end",width:"100%",alignItems:"flex-end",children:e.jsx(A,{bg:"white",color:"#020202",borderRadius:"4px",border:"1px solid limegreen",p:2,onClick:T,_hover:{bg:"yellow",color:"black"},isDisabled:t.isVoted&&t.percent===n,children:S})}),e.jsx(ae,{isOpen:E,onClose:()=>V(!1),errorMessage:"Voting Error, Pepe is Confused!"})]})},pe=()=>{const f=window.location.pathname.split("/");f[2];const u=f[3].substring(1),x=f[4],[t,y]=s.useState(null),[n,j]=s.useState([]),[v,b]=s.useState(!1),[S,g]=s.useState(""),[E,V]=s.useState(0),[l,T]=s.useState(null),d=I();s.useEffect(()=>{const a=new N.Client("https://api.hive.blog"),m=async()=>{try{const i=await a.database.call("get_content",[u,x]);let r=await oe(i.body);r=ne(r),r=se(r),r=re(r),y({...i,body:r}),console.log(t)}catch(i){console.error("Error fetching post data:",i)}},h=async()=>{var i;try{const r=u,B=x;let c=await a.call("bridge","get_discussion",{author:r,permlink:B,observer:((i=d==null?void 0:d.user)==null?void 0:i.name)||""});const K=`${r}/${B}`;delete c[K];for(const p in c){const z=c[p].replies;c[p].repliesFetched=[];for(let R=0;R<z.length;R++){const G=z[R];c[p].repliesFetched.push(c[G])}c[p].net_votes=c[p].active_votes.length}const W=[];for(const p in c){const M=c[p];M.parent_author===r&&M.parent_permlink===B&&W.push(c[p])}j(W)}catch(r){console.error("Error fetching comments:",r)}};m(),h()},[u,x,v]);const _=a=>{const m=a.active_votes.find(i=>i.voter===l),h=parseInt(m==null?void 0:m.percent);if(m&&(h>0||h<0)){const i={isVoted:!0,rshares:m.rshares,percent:h};return console.log(i,a.permlink),i}return{isVoted:!1,rshares:0,percent:0}};s.useEffect(()=>{var a;d&&((a=d.user)!=null&&a.name)&&T(d.user.name)},[d]);const o={fontWeight:"bold",color:"yellow",fontSize:"20px",paddingBottom:"8px"},k=()=>{if(!window.hive_keychain){console.error("Hive Keychain extension not found!");return}if(!l){console.error("Username is missing");return}const a=new Date().toISOString().replace(/[^a-zA-Z0-9]/g,"").toLowerCase(),m=[["comment",{parent_author:u,parent_permlink:x,author:l,permlink:a,title:"",body:S,json_metadata:JSON.stringify({tags:["skateboard"],app:"pepeskate"})}]];window.hive_keychain.requestBroadcast(l,m,"posting",h=>{h.success?(alert("Comment successfully posted!"),g(""),b(!0),window.location.reload()):console.error("Error posting comment:",h.message)})},[C]=Q("(min-width: 768px)"),U={maxWidth:C?"50%":"100%",margin:"0 auto",padding:"10px",border:"2px solid orange",borderRadius:"10px"},O={width:"100%",margin:0,padding:"10px",marginTop:"-30px"},L={fontWeight:"bold",color:"yellow",fontSize:"26px",padding:"20px",borderRadius:"10px"};return e.jsxs("div",{style:O,children:[e.jsx("center",{children:e.jsx("h1",{style:L,children:t==null?void 0:t.title})}),e.jsxs(w,{direction:C?"row":"column",style:{marginTop:10},children:[e.jsx(P,{style:{...U,maxWidth:C?"50%":"100%"},children:e.jsx(q,{children:t==null?void 0:t.body,rehypePlugins:[J],remarkPlugins:[Z],components:ce})}),e.jsxs(X,{style:{...U,maxWidth:C?"50%":"100%",margin:"0 auto",padding:"10px",border:"1px solid orange",borderRadius:"10px"},children:[e.jsx(de,{onClose:()=>{},user:l,author:u,permlink:x,weight:E,userVote:t?_(t):{isVoted:!1,rshares:0,percent:0}}),e.jsx("center",{children:e.jsx("h1",{style:o,children:"Say something about it 💬"})}),e.jsxs(P,{minWidth:"100%",border:"1px solid white",borderRadius:"10px",padding:"10px",margin:"3px",children:[e.jsx(ee,{border:"1px solid white",value:S,onChange:a=>g(a.target.value),placeholder:"Write the first thing that comes to your wasted head..."}),e.jsx(A,{border:"1px solid white",mt:"10px",onClick:k,children:"Submit Comment"})]}),e.jsxs(w,{direction:"column",style:{width:"100%"},children:[e.jsx("center",{children:e.jsx("h1",{style:o,children:"Comments"})}),n&&n.length>0?e.jsx(le,{comments:n,commentPosted:!1,blockedUser:"hivebuzz",permlink:x}):e.jsx("center",{children:e.jsx("h1",{children:"No comments yet"})})]})]})]}),e.jsx(w,{children:e.jsx(te,{to:"/",children:e.jsx(A,{variant:"outline",colorScheme:"blue",size:"sm",marginBottom:"10px",children:"Go Back"})})})]})};export{pe as default};
